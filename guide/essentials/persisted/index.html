<!doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="msapplication-TileColor" content="#FFFFFF">
  <meta name="msapplication-TileImage" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/mstile-144x144.png">
  <meta name="msapplication-square70x70logo" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/mstile-70x70.png">
  <meta name="msapplication-square150x150logo" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/mstile-150x150.png">
  <meta name="msapplication-wide310x150logo" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/mstile-310x150.png">
  <meta name="msapplication-square310x310logo" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/mstile-310x310.png">
  <meta name="google-site-verification" content="luspUdq52gkUU0FFChQ2xmeXSs5HDafpARQ7fVXVBp4">
  
  <!-- Schema.org markup for Google+ -->
  <meta itemprop="name" content="Working with persistent data">
  <meta itemprop="image" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/favicon-196x196.png">
  
  <!-- Twitter Card data -->
  <meta name="twitter:card" value="summary">
  <meta name="twitter:site" content="@kuzzleio">
  <meta name="twitter:title" content="Working with persistent data">
  <meta name="twitter:creator" content="@kuzzleio">
  <meta name="twitter:image" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/favicon-196x196.png">
  
  <!-- Open Graph data -->
  <meta property="og:title" content="Working with persistent data">
  <meta property="og:type" content="article">
  <meta property="og:site_name" content="">
  <meta property="og:image" content="https://stafyniaksacha.github.io/documentation/assets/images/favicon/favicon-96x96.png">
  <meta property="article:published_time" content="2017-05-21T13:38:01.601Z">
  <meta property="article:modified_time" content="2017-05-21T13:38:01.601Z">
  <meta property="article:section" content="Guide">
  <meta property="article:tag" content="Essentials">
  
  
  <link rel="apple-touch-icon-precomposed" sizes="57x57" href="/documentation/assets/images/favicon/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/documentation/assets/images/favicon/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/documentation/assets/images/favicon/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/documentation/assets/images/favicon/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon-precomposed" sizes="60x60" href="/documentation/assets/images/favicon/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon-precomposed" sizes="120x120" href="/documentation/assets/images/favicon/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon-precomposed" sizes="76x76" href="/documentation/assets/images/favicon/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon-precomposed" sizes="152x152" href="/documentation/assets/images/favicon/apple-touch-icon-152x152.png">
  <link rel="icon" type="image/png" href="/documentation/assets/images/favicon/favicon-196x196.png" sizes="196x196">
  <link rel="icon" type="image/png" href="/documentation/assets/images/favicon/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/documentation/assets/images/favicon/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/documentation/assets/images/favicon/favicon-16x16.png" sizes="16x16">
  <link rel="icon" type="image/png" href="/documentation/assets/images/favicon/favicon-128.png" sizes="128x128">
  
  <link rel="stylesheet" href="/documentation/assets/font-awesome/scss/font-awesome.css">
  <link href="//fonts.googleapis.com/css?family=Ubuntu:400,500,700" rel="stylesheet">
  
  <title>
      Working with persistent data
      - Essentials
      - Guide
       -
  
     Kuzzle documentation
  </title>

  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/atom-one-light.min.css">

  <link href="/documentation/assets/stylesheets/full/screen.css" rel="stylesheet" type="text/css" media="screen">
</head>

<body class="index">
<header>
  <div class="wrapper">
    <div id="logo">
      <a href="http://kuzzle.io/">&#xA0;</a>
    </div>

    <a class="mobile-nav-burger" href="javascript:;"></a>

    <nav>
      <ul>
        <li>
          <a href="http://kuzzle.io/kuzzle-entreprise" class="nav-item">product</a>
        </li>
        <li>
          <a href="https://stafyniaksacha.github.io/documentation/" class="nav-item developers active">Documentation</a>
          <ul class="mobile-nav">
              <li class="active">
                <a href="/documentation/guide"><span>Guide</span></a>

                <ul class="sub-nav">
                  <li>
                    <a href="/documentation/guide/getting-started"><span>Getting started</span></a>
                  </li>
                  <li class="active">
                    <a href="/documentation/guide/essentials"><span>Essentials</span></a>
                  </li>
                  <li>
                    <a href="/documentation/guide/tutorial"><span>Tutorial</span></a>
                  </li>
                  <li>
                    <a href="/documentation/guide/kuzzle-depth"><span>Kuzzle in depth</span></a>
                  </li>
                </ul>
              </li>
              <li>
                <a href="/documentation/sdk-reference"><span>SDK Reference</span></a>
              </li>
              <li>
                <a href="/documentation/kuzzle-dsl"><span>Kuzzle DSL</span></a>
              </li>
              <li>
                <a href="/documentation/validation-reference"><span>Data Validation</span></a>
              </li>
              <li>
                <a href="/documentation/api-documentation"><span>API Documentation</span></a>
              </li>
              <li>
                <a href="/documentation/plugins-reference"><span>Plugins Reference</span></a>
              </li>
              <li>
                <a href="/documentation/elasticsearch-cookbook"><span>Elasticsearch Cookbook</span></a>
              </li>
          </ul>
        </li>
        <li>
          <a href="http://kuzzle.io/demos-tutorials/" class="nav-item ">Demos</a>
        </li>
        <li>
          <a href="http://kuzzle.io/blog/" class="nav-item ">Blog</a>
        </li>
        <li>
          <a href="http://kuzzle.io/contact/" class="nav-item ">Contact</a>
        </li>
        <li>
          <a href="https://github.com/kuzzleio/kuzzle" target="_blank" class="nav-item github">
            <i class="icon icon-github icon-small"></i>
          </a>
        </li>
      </ul>
    </nav>
  </div>
  <div class="developer-nav open">
    <ul class="search">
      <li>
        <input name="search" type="search" placeholder="search" tabindex="1">
        <!-- <input name="search" type="search" placeholder="search"></input> -->
      </li>
    </ul>
    <ul class="nav">
        <li class="active">
          <a href="/documentation/guide"><span>Guide</span></a>
        </li>
        <li>
          <a href="/documentation/sdk-reference"><span>SDK Reference</span></a>
        </li>
        <li>
          <a href="/documentation/kuzzle-dsl"><span>Kuzzle DSL</span></a>
        </li>
        <li>
          <a href="/documentation/validation-reference"><span>Data Validation</span></a>
        </li>
        <li>
          <a href="/documentation/api-documentation"><span>API Documentation</span></a>
        </li>
        <li>
          <a href="/documentation/plugins-reference"><span>Plugins Reference</span></a>
        </li>
        <li>
          <a href="/documentation/elasticsearch-cookbook"><span>Elasticsearch Cookbook</span></a>
        </li>
    </ul>

    <div class="search-results"><ul></ul></div>

    <script type="text/plain" id="search-results-template">
      <li>
        <a href="__link__" tabindex="__tabindex__">
          <p class="page">
            <span class="title">__title__</span>
            <span class="firstMember">__firstMember__</span>
            <span class="parent">__parent__</span>
          </p>
          <p class="preview">__preview__</p>
        </a>
      </li>
    </script>
  </div>
</header>

<div class="container">
  <div class="tocify-wrapper">
    <ul class="search-results"></ul>
  
    <div class="tocify">
      <ul class="tocify-header">
        <li class="tocify-item tocify-focus tocify-hover"></li>
      </ul>
      <ul class="tocify-header">
        <li class="tocify-item"><a style="color: #111; text-decoration: none;" href="https://stafyniaksacha.github.io/documentation/guide" title="back to Guide home">Guide</a></li>
        <ul class="tocify-subheader">
  
              <li class="tocify-item"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/getting-started" title="learn kuzzle in a few steps">Getting started</a></li>
  
          <li class="tocify-item tocify-focus"><a style="color: #FFF; text-decoration: none;" href="#" title="learn mechanisms of kuzzle">Essentials</a></li>
            <ul class="tocify-header">
              <ul class="tocify-subheader">
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials" title="learn mechanisms of kuzzle">&#x203A; Introduction</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/installing-kuzzle" title="Installing Kuzzle">&#x203A; Installing Kuzzle</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/installing-backoffice" title="Installing Kuzzle Backoffice">&#x203A; Installing Kuzzle Backoffice</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/configuration" title="Configuring Kuzzle">&#x203A; Configuring Kuzzle</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/proxy-configuration" title="Configuring Kuzzle proxy">&#x203A; Configuring Kuzzle proxy</a></li>
                      <li class="tocify-item tocify-level-2 tocify-focus"><a style="color: #FFF; text-decoration: none;" href="/documentation/guide/essentials/persisted" title="Working with persistent data">&#x203A; Working with persistent data</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/data-validation" title="Data Validation">&#x203A; Data Validation</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/real-time" title="Real-time notifications">&#x203A; Real-time notifications</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/security" title="Security">&#x203A; Security</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/request-and-response-format" title="Request and Response format">&#x203A; Request and Response format</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/cli" title="Command Line Interface">&#x203A; Command Line Interface</a></li>
                      <li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/essentials/plugins" title="The Plugin System">&#x203A; The Plugin System</a></li>
              </ul>
            </ul>
  
              <li class="tocify-item"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/tutorial" title="learn kuzzle in a real case">Tutorial</a></li>
  
              <li class="tocify-item"><a style="color: #002835; text-decoration: none;" href="/documentation/guide/kuzzle-depth" title="understand how to extend kuzzle">Kuzzle in depth</a></li>
        </ul>
      </ul>
      <ul class="toc-footer">
        <!-- community links here ! -->
  
            <li><span style="color:#717171">1.0.0-RC9 (latest)</span></li>
            <li><a href="/documentation/v/edge/">1.0.0-RC10 (next)</a></li>
      </ul>
    </div>
  </div>

  <div class="page-wrapper">
    <div class="toc">
      <ul>
        <li class="toc-item toc-level-1">
            <a href="#working-with-persistent-data" title="Working with persistent data">
              Working with persistent data
            </a>
        </li>
        <li class="toc-item toc-level-2">
            <a href="#document-crud" title="Document CRUD">
              Document CRUD
            </a>
        </li>
        <li class="toc-item toc-level-2">
            <a href="#document-search" title="Document Search">
              Document Search
            </a>
        </li>
        <li class="toc-item toc-level-2">
            <a href="#document-metadata" title="Document metadata">
              Document metadata
            </a>
        </li>
        <li class="toc-item toc-level-2">
            <a href="#document-mapping" title="Document mapping">
              Document mapping
            </a>
        </li>
        <li class="toc-item toc-level-2">
            <a href="#where-do-we-go-from-here" title="Where do we go from here?">
              Where do we go from here?
            </a>
        </li>
      </ul>
    </div>

    <div class="content">

      <div class="mobile-breadcrumb">
        <p>
        <a href="https://stafyniaksacha.github.io/documentation/">Kuzzle documentation</a>
      
          &#xBB; <a href="https://stafyniaksacha.github.io/documentation/guide">Guide</a>
          &#xBB; <a href="https://stafyniaksacha.github.io/documentation/guide/essentials">Essentials</a>
      
          &#xBB; Working with persistent data
         </p>
      </div>
      
      <div class="nav-sibling">
        <div class="nav-left">
          <p>
            <a href="https://github.com/kuzzleio/documentation/edit/rcx-refactor-doc/src/guide/essentials/persisted.md">edit on github<i class="icon icon-github icon-small"></i></a>
            <span class="separator">|</span>
            <a href="https://github.com/kuzzleio/documentation/issues/new?labels=guide&amp;title=Feedback%20about%20page%20&apos;guide/essentials/persisted.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a>
            <span class="separator">|</span>
            <select class="rate-documentation">
              <option value=""></option>
              <option value="1">Unusable documentation</option>
              <option value="2">Poor documentation</option>
              <option value="3">OK documentation</option>
              <option value="4">Good documentation</option>
              <option value="5">Excellent documentation</option>
            </select>
          </p>
        </div>
        <div class="nav-right">
          <p>
            <a href="https://stafyniaksacha.github.io/documentation/guide/essentials/proxy-configuration">&#xAB; Configuring Kuzzle proxy</a>
            <span class="separator">|</span>
            <a href="https://stafyniaksacha.github.io/documentation/guide/essentials/data-validation">Data Validation &#xBB;</a>
          </p>
        </div>
        <div style="clear:both"></div>
      </div>

      <div class="toc-inline">
        <ul>
          <li class="toc-item toc-level-1">
              <a href="#working-with-persistent-data" title="Working with persistent data">
                Working with persistent data
              </a>
          </li>
          <li class="toc-item toc-level-2">
              <a href="#document-crud" title="Document CRUD">
                Document CRUD
              </a>
          </li>
          <li class="toc-item toc-level-2">
              <a href="#document-search" title="Document Search">
                Document Search
              </a>
          </li>
          <li class="toc-item toc-level-2">
              <a href="#document-metadata" title="Document metadata">
                Document metadata
              </a>
          </li>
          <li class="toc-item toc-level-2">
              <a href="#document-mapping" title="Document mapping">
                Document mapping
              </a>
          </li>
          <li class="toc-item toc-level-2">
              <a href="#where-do-we-go-from-here" title="Where do we go from here?">
                Where do we go from here?
              </a>
          </li>
        </ul>
      </div>

      <div class="main-content">
        <h1><a class="anchor" id="working-with-persistent-data"></a>Working with persistent data</h1>
<p>Kuzzle relies on <a href="https://www.elastic.co/">Elasticsearch</a> to store and fetch persistent data.</p>
<p>In Kuzzle, data is organized in the following way:</p>
<ul>
<li><strong>Documents</strong> are the atomic unit of data. They are defined as JSON structures, in the classical NoSQL fashion and are identified by a unique <code>_id</code>.</li>
<li>Documents are grouped into <strong>Collections</strong>, identified by a unique name.</li>
<li>Collections are grouped into <strong>Indexes</strong>, identified by a unique name.</li>
</ul>
<hr>
<h2><a class="anchor" id="document-crud"></a>Document CRUD</h2>
<p>Kuzzle ships with a full data <a href="https://en.wikipedia.org/wiki/Create,_read,_update_and_delete">CRUD</a> API that enables you to operate in many ways on your documents.</p>
<p>Let&apos;s <a href="/documentation/api-documentation/controller-document/create"><strong>create a new document</strong></a>, for example, in <code>mycollection</code>, within <code>myindex</code> via the HTTP protocol.
This is done by sending a <code>POST</code> request to the API endpoint <code>http://localhost:7512/myindex/mycollection/_create</code> with the body set to</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, world!&quot;</span>
}</code></pre>

<p>Notice that the document is associated to the auto-generated id <code>AVkDBl3YsT6qHI7MxLz0</code>, as we can see in the response:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;38d08fa9-449d-47f7-8593-dc136f8b3559&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;create&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
    <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
    <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDBl3YsT6qHI7MxLz0&quot;</span>,
    <span class="hljs-attr">&quot;_version&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">&quot;result&quot;</span>: <span class="hljs-string">&quot;created&quot;</span>,
    <span class="hljs-attr">&quot;_shards&quot;</span>: {
      <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">&quot;successful&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">&quot;failed&quot;</span>: <span class="hljs-number">0</span>
    },
    <span class="hljs-attr">&quot;created&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">&quot;_source&quot;</span>: {
      <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, world!&quot;</span>,
      <span class="hljs-attr">&quot;_meta&quot;</span>: {
        <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
        <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481814465050</span>,
        <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
        <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
      }
    }
  }
}</code></pre>


<p>Take some time to examine the content of a <a href="/documentation/guide/essentials/request-and-response-format/#status-codes">Kuzzle Response</a>. You may notice that it contains useful information like the name of the controller and action that correspond to the HTTP route we hit with our request, or the complete KuzzleDocument object we just created.</p>
<p>One more thing you may notice is that <code>myindex</code> and <code>mycollection</code> are created on-the-fly along with the document. Let&apos;s verify it by <a href="/documentation/api-documentation/controller-collection/list"><strong>getting the list of collections</strong></a> stored in <code>myindex</code> by sending a <code>GET</code> request to <code>http://localhost:7512/myindex/_list</code>.</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;51b276c3-3698-4412-b3dc-80d0f84541fb&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;collection&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;list&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;collections&quot;</span>: [
      {
        <span class="hljs-attr">&quot;name&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;stored&quot;</span>
      }
    ],
    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;all&quot;</span>
  }
}</code></pre>

<p>Take a look at the <code>result</code> field in the Response from Kuzzle. It contains an array of <code>collections</code>, each one defined by a <code>name</code> and a <code>type</code>. <code>mycollection</code> is of type <code>stored</code> (which stands for persistent). This is made to distinguish persisted collection from the <code>realtime</code> (or volatile) collections, used to identify <a href="/documentation/guide/essentials/real-time">real-time documents</a>.</p>
<p>Let&apos;s <a href="/documentation/api-documentation/controller-document/update"><strong>modify to our brand new document</strong></a> by sending a <code>PUT</code> request to <code>http://localhost:7512/myindex/mycollection/AVkDBl3YsT6qHI7MxLz0/_update</code> with the body set to:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;in a bottle&quot;</span>,
  <span class="hljs-attr">&quot;an_englishman&quot;</span>: <span class="hljs-string">&quot;in New York&quot;</span>
}</code></pre>

<p>Which gives us the response...</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;6241ec4d-8529-43ba-9b77-3028b99cd621&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;update&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
    <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
    <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDBl3YsT6qHI7MxLz0&quot;</span>,
    <span class="hljs-attr">&quot;_version&quot;</span>: <span class="hljs-number">2</span>,
    <span class="hljs-attr">&quot;result&quot;</span>: <span class="hljs-string">&quot;updated&quot;</span>,
    <span class="hljs-attr">&quot;_shards&quot;</span>: {
      <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">2</span>,
      <span class="hljs-attr">&quot;successful&quot;</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">&quot;failed&quot;</span>: <span class="hljs-number">0</span>
    }
  }
}</code></pre>

<p>...telling us that the document has been successfully updated.</p>
<p>Now, we&apos;ll let you figure out what happens when we send a <code>DELETE</code> request to <code>http://localhost:7512/myindex/mycollection/AVkDBl3YsT6qHI7MxLz0</code> with an empty body (take a look at the <a href="/documentation/api-documentation/controller-document/delete">API Reference</a> if you don&apos;t want to try).</p>
<hr>
<h2><a class="anchor" id="document-search"></a>Document Search</h2>
<p>One thing that Elasticsearch is <em>really</em> good at doing is... Searching! It enables to create extremely precise search queries, thanks to its powerful query DSL. We wrote a <a href="/documentation/elasticsearch-cookbook">comprehensive cookbook</a> to help you understand how it works in detail, but let&apos;s take a look at a couple of simple examples, just to get started.</p>
<p>Say we want to <a href="/documentation/api-documentation/controller-document/search"><strong>find</strong></a> all the documents within <code>mycollection</code>, via the HTTP protocol. To do it, we send a <code>POST</code> request to <code>http://localhost:7512/myindex/mycollection/_search</code> (we leave the body empty since we have no filters to apply to our query). Depending on the documents you have created in your database, the response will look like:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;3b486d49-f1f9-4595-8c10-b63cc5fc1279&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;took&quot;</span>: <span class="hljs-number">69</span>,
    <span class="hljs-attr">&quot;timed_out&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">&quot;_shards&quot;</span>: {
      <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;successful&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;failed&quot;</span>: <span class="hljs-number">0</span>
    },
    <span class="hljs-attr">&quot;hits&quot;</span>: [
      {
        <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
        <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDLAdCsT6qHI7MxLz4&quot;</span>,
        <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;_source&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hey! Ho!&quot;</span>
        },
        <span class="hljs-attr">&quot;_meta&quot;</span>: {
          <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
          <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816934209</span>,
          <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
        }
      },
      {
        <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
        <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDK9iNsT6qHI7MxLz3&quot;</span>,
        <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;_source&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, world!&quot;</span>
        },
        <span class="hljs-attr">&quot;_meta&quot;</span>: {
          <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
          <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816922252</span>,
          <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
        }
      },
      {
        <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
        <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDLCdRsT6qHI7MxLz5&quot;</span>,
        <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;_source&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Let&apos;s go!&quot;</span>
        },
        <span class="hljs-attr">&quot;_meta&quot;</span>: {
          <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
          <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816942415</span>,
          <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
        }
      }
    ],
    <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">&quot;max_score&quot;</span>: <span class="hljs-number">0</span>
  }
}</code></pre>

<p>Looks neat. Say that now we only want to <strong>query</strong> the documents containing the word <code>Hey</code> in the <code>message</code> field. We can achieve this by adding the following query to our body:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;query&quot;</span>: {
      <span class="hljs-attr">&quot;match&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>:<span class="hljs-string">&quot;Hey&quot;</span>
      }
    }
}</code></pre>

<p>Which gives, as a result, the following response:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;e00cf6d6-8983-498b-8481-96a1fe1b5d46&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;took&quot;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">&quot;timed_out&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">&quot;_shards&quot;</span>: {
      <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;successful&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;failed&quot;</span>: <span class="hljs-number">0</span>
    },
    <span class="hljs-attr">&quot;hits&quot;</span>: [
      {
        <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
        <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDLAdCsT6qHI7MxLz4&quot;</span>,
        <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0.25811607</span>,
        <span class="hljs-attr">&quot;_source&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hey! Ho!&quot;</span>
        },
        <span class="hljs-attr">&quot;_meta&quot;</span>: {
          <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
          <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816934209</span>,
          <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
        }
      }
    ],
    <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">&quot;max_score&quot;</span>: <span class="hljs-number">0.25811607</span>
  }
}</code></pre>

<hr>
<h2><a class="anchor" id="document-metadata"></a>Document metadata</h2>
<p>When you create or update a document, Kuzzle adds metadata. These metadata describe the life-cycle of the document.
They are available in the <code>_meta</code> part of a document:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDLAdCsT6qHI7MxLz4&quot;</span>,
  <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0.25811607</span>,
  <span class="hljs-attr">&quot;_source&quot;</span>: {
    <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hey! Ho!&quot;</span>
  },
  <span class="hljs-attr">&quot;_meta&quot;</span>: {
    <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
    <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816934209</span>,
    <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
    <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
  }
}</code></pre>

<ul>
<li><code>author</code>: The author identifier</li>
<li><code>createdAt</code>: The UNIX Timestamp of the document creation (create or replace)</li>
<li><code>updatedAt</code>: The UNIX Timestamp of the last document update, or <code>null</code> if no update has been made</li>
<li><code>updater</code>: The updater identifier, or <code>null</code> if no update has been made</li>
<li><code>active</code>: Always <code>true</code> for now</li>
<li><code>deletedAt</code>: Always <code>null</code> for now</li>
</ul>
<p>They can be used in search queries to filter and sort documents like a normal document field:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;query&quot;</span>: {
      <span class="hljs-attr">&quot;range&quot;</span>: {
          <span class="hljs-attr">&quot;_meta.createdAt&quot;</span>: {
            <span class="hljs-attr">&quot;lte&quot;</span>: <span class="hljs-number">1481816930000</span>
          }
      }
    }
}</code></pre>

<p>Which gives, as a result, the following response:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;e00cf6d6-8983-498b-8481-96a1fe1b5d46&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;document&quot;</span>,
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;search&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;headers&quot;</span>: {},
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;took&quot;</span>: <span class="hljs-number">6</span>,
    <span class="hljs-attr">&quot;timed_out&quot;</span>: <span class="hljs-literal">false</span>,
    <span class="hljs-attr">&quot;_shards&quot;</span>: {
      <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;successful&quot;</span>: <span class="hljs-number">5</span>,
      <span class="hljs-attr">&quot;failed&quot;</span>: <span class="hljs-number">0</span>
    },
    <span class="hljs-attr">&quot;hits&quot;</span>: [
      {
        <span class="hljs-attr">&quot;_index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
        <span class="hljs-attr">&quot;_type&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
        <span class="hljs-attr">&quot;_id&quot;</span>: <span class="hljs-string">&quot;AVkDK9iNsT6qHI7MxLz3&quot;</span>,
        <span class="hljs-attr">&quot;_score&quot;</span>: <span class="hljs-number">0</span>,
        <span class="hljs-attr">&quot;_source&quot;</span>: {
          <span class="hljs-attr">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello, world!&quot;</span>
        },
        <span class="hljs-attr">&quot;_meta&quot;</span>: {
          <span class="hljs-attr">&quot;author&quot;</span>: <span class="hljs-string">&quot;-1&quot;</span>,
          <span class="hljs-attr">&quot;createdAt&quot;</span>: <span class="hljs-number">1481816922252</span>,
          <span class="hljs-attr">&quot;updatedAt&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;updater&quot;</span>: <span class="hljs-literal">null</span>,
          <span class="hljs-attr">&quot;active&quot;</span>: <span class="hljs-literal">true</span>,
          <span class="hljs-attr">&quot;deletedAt&quot;</span>: <span class="hljs-literal">null</span>
        }
      }
    ],
    <span class="hljs-attr">&quot;total&quot;</span>: <span class="hljs-number">1</span>,
    <span class="hljs-attr">&quot;max_score&quot;</span>: <span class="hljs-number">0.25811607</span>
  }
}</code></pre>

<hr>
<h2><a class="anchor" id="document-mapping"></a>Document mapping</h2>
<p>As previously said, Kuzzle relies on Elasticsearch to persist documents. Elasticsearch uses a mapping internally to match
a document field to a field type. This mapping is attached to a <code>collection</code> (a <code>type</code> in Elasticsearch terminology).
If no mapping is defined, Elasticsearch will infer it automatically from input documents.</p>
<p>ou may want to define mappings manually, especially to provide more details to Elasticsearch on how it should interpret the documents stored in your collections.
To do so, Kuzzle expose a mapping creation API route.
This is done by sending a <code>PUT</code> request to the API endpoint <code>http://localhost:7512/myindex/mycollection/_mapping</code> with the body set to your mapping:</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;properties&quot;</span>: {
    <span class="hljs-attr">&quot;someField&quot;</span>: {
      <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;date&quot;</span>
    }
  }
}</code></pre>

<p>Which gives us the response...</p>
<pre><code class="hljs json">{
  <span class="hljs-attr">&quot;action&quot;</span>: <span class="hljs-string">&quot;updateMapping&quot;</span>,
  <span class="hljs-attr">&quot;collection&quot;</span>: <span class="hljs-string">&quot;mycollection&quot;</span>,
  <span class="hljs-attr">&quot;controller&quot;</span>: <span class="hljs-string">&quot;collection&quot;</span>,
  <span class="hljs-attr">&quot;error&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;index&quot;</span>: <span class="hljs-string">&quot;myindex&quot;</span>,
  <span class="hljs-attr">&quot;volatile&quot;</span>: <span class="hljs-literal">null</span>,
  <span class="hljs-attr">&quot;requestId&quot;</span>: <span class="hljs-string">&quot;8acca50e-592d-4f0d-962c-31719b11e171&quot;</span>,
  <span class="hljs-attr">&quot;result&quot;</span>: {
    <span class="hljs-attr">&quot;acknowledged&quot;</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>
}</code></pre>

<p>Here we defined a new field called <code>someField</code> of type <code>date</code> in our collection <code>mycollection</code>. This is especially useful when
dealing with capabilities such as specific types (<code>date</code>, <code>geo_shape</code>, ...), full-text search and complex data structures (<code>nested</code>, ...) of Elasticsearch.
As the mapping of the collection can not be changed once it is set (even if Elasticsearch did it automatically for you),
you should almost always define mappings when creating collections, preferably before sending documents in them.</p>
<p>The syntax to use is the one defined by <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.x/mapping.html">Elasticsearch</a>.</p>
<hr>
<h2><a class="anchor" id="where-do-we-go-from-here"></a>Where do we go from here?</h2>
<ul>
<li>Refer to the <a href="/documentation/elasticsearch-cookbook">Elasticsearch cookbook</a> to get more details on how querying works in Kuzzle.</li>
<li>Keep track of the changes on your documents via the <a href="/documentation/guide/essentials/real-time">Realtime Notifications</a>.</li>
</ul>

        <div style="clear: both"></div>
      </div>

      <hr>
      <div id="disqus_thread"></div>
      
      <script async>
        var disqus_developer = 1;
      
        var disqus_config = function () {
          this.page.url = 'https://stafyniaksacha.github.io/documentation/guide/essentials/persisted';
          this.page.title = 'Working with persistent data';
          this.page.identifier = 'guide/essentials/persisted';
        };
      
        (function() {
          var d = document, s = d.createElement('script');
          s.src = 'https://kuzzle-documentation.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>

      <div class="nav-sibling bottom">
        <div class="nav-left">
          <p>
            <a href="https://github.com/kuzzleio/documentation/edit/rcx-refactor-doc/src/guide/essentials/persisted.md">edit on github<i class="icon icon-github icon-small"></i></a>
            <span class="separator">|</span>
            <a href="https://github.com/kuzzleio/documentation/issues/new?labels=guide&amp;title=Feedback%20about%20page%20&apos;guide/essentials/persisted.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a>
            <span class="separator">|</span>
            <select class="rate-documentation">
              <option value=""></option>
              <option value="1">Unusable documentation</option>
              <option value="2">Poor documentation</option>
              <option value="3">OK documentation</option>
              <option value="4">Good documentation</option>
              <option value="5">Excellent documentation</option>
            </select>
          </p>
        </div>
        <div class="nav-right">
          <p>
            <a href="https://stafyniaksacha.github.io/documentation/guide/essentials/proxy-configuration">&#xAB; Configuring Kuzzle proxy</a>
            <span class="separator">|</span>
            <a href="https://stafyniaksacha.github.io/documentation/guide/essentials/data-validation">Data Validation &#xBB;</a>
          </p>
        </div>
        <div style="clear:both"></div>
      </div>
    </div>
  </div>
</div>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js"></script>
<script src="/documentation/assets/javascript/lib/jquery.barrating.js"></script>

<script type="text/javascript">
  // store helper
  var store = function store(key, value) {
    var lsSupport = false;

    // Check for native support
    if (localStorage) {
      lsSupport = true;
    }

    // If value is detected, set new or modify store
    if (typeof value !== "undefined" && value !== null) {
      // Convert object values to JSON
      if ( typeof value === 'object' ) {
        value = JSON.stringify(value);
      }
      // Set the store
      if (lsSupport) { // Native support
        localStorage.setItem(key, value);
      } else { // Use Cookie
        createCookie(key, value, 30);
      }
    }

    // No value supplied, return value
    if (typeof value === "undefined") {
      // Get value
      if (lsSupport) { // Native support
        data = localStorage.getItem(key);
      } else { // Use cookie
        data = readCookie(key);
      }

      // Try to parse JSON...
      try {
        data = JSON.parse(data);
      }
      catch(e) {
        data = data;
      }

      return data;
    }

    // Null specified, remove store
    if (value === null) {
      if (lsSupport) { // Native support
        localStorage.removeItem(key);
      } else { // Use cookie
        createCookie(key, '', -1);
      }
    }

    /**
     * Creates new cookie or removes cookie with negative expiration
     * @param  key       The key or identifier for the store
     * @param  value     Contents of the store
     * @param  exp       Expiration - creation defaults to 30 days
     */
    function createCookie(key, value, exp) {
      var date = new Date();
      date.setTime(date.getTime() + (exp * 24 * 60 * 60 * 1000));
      var expires = "; expires=" + date.toGMTString();
      document.cookie = key + "=" + value + expires + "; path=/";
    }

    /**
     * Returns contents of cookie
     * @param  key       The key or identifier for the store
     */
    function readCookie(key) {
      var nameEQ = key + "=";
      var ca = document.cookie.split(';');
      for (var i = 0, max = ca.length; i < max; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }
  };






  // google analytics
  (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
              (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
      a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-67035328-1', 'auto');
  ga('send', 'pageview');

  (function scrollToHash() {
    if (window.location.hash != '') {
      var anchor = $(location.hash).get(0);
      if (anchor) {
        anchor.scrollIntoView();
      }
    }
  })();




  (function mobileNavBuger() {
    var $body = $('body');

    $('.mobile-nav-burger').on('click', function() {
      $body.toggleClass('nav-burger-open');
    });
  })();







  (function rateDocumentation() {
    var $rateDocumentation = $('.rate-documentation');
    var pagePath = 'guide/essentials/persisted'.replace(/\//g, '-');
    var categoryRating = parseInt(store('rate-documentation-' + pagePath));

    $rateDocumentation.barrating({
      theme: 'fontawesome-stars',
      initialRatting: 0,
      allowEmpty: true,
      onSelect: function(value, text, event) {
        if (typeof(event) !== 'undefined') {
          // rating was selected by a user
          store('rate-documentation-' + pagePath, event.target.dataset.ratingValue);
          $rateDocumentation.barrating('set', event.target.dataset.ratingValue);
          // $rateDocumentation.barrating('readonly', true); // wired on mobile

          ga('send', 'event', {
            eventCategory: 'documentation-rate',
            eventAction: 'https://stafyniaksacha.github.io/documentation/guide/essentials/persisted',
            eventLabel: event.target.dataset.ratingText,
            transport: 'beacon'
          });

          window.setTimeout(function() {
            $('.br-current-rating').css('transition', 'opacity 0.15s');
            $('.br-current-rating').css('opacity', '0');

            window.setTimeout(function() {
              $('.br-current-rating').css('transition', 'opacity 0.9s');
              $('.br-current-rating').text("thank's for feedback !");
              $('.br-current-rating').css('opacity', '1');
            }, 140);
          }, 1);

          window.setTimeout(function() {
            $('.br-current-rating').css('opacity', '0');

            window.setTimeout(function() {
              $('.br-current-rating').css('transition', 'opacity 0.2s');
              if (event.target.dataset.ratingText === 'Excellent documentation') {
                $('.br-current-rating').text(event.target.dataset.ratingText + ' \\o/');
              }
              else {
                $('.br-current-rating').text(event.target.dataset.ratingText);
              }
              $('.br-current-rating').css('opacity', '1');
            }, 1000);
          }, 2500);
        }
        else {
          // rating was selected programmatically
          // by calling `set` method
        }
      }
    });

    $('.br-current-rating').addClass('visible');

    if (!isNaN(categoryRating)) {
      $rateDocumentation.barrating('set', categoryRating);
      $rateDocumentation.barrating('readonly', true);
    }
  })();











  (function leftNavUX() {
    var $wrapper = $('.tocify-wrapper');

    if ($wrapper.length !== 0) {
      var $selectedItem = $('.tocify-level-2.tocify-focus', $wrapper);

      if ($selectedItem.length === 0) {
        $selectedItem = $('.tocify-focus', $wrapper);
      }

      if ($selectedItem.get(0).offsetTop + 120 > $wrapper.height()) {
        $wrapper.scrollTop(Math.ceil($selectedItem.get(0).offsetTop - $wrapper.height() / 2));
      }
    }
  })();









  (function tocUX() {
    var $toc = $('.toc');
    var $content = $('.content');

    //----------------------------
    // fixes toc next to content
    if ($toc.length > 0) {
      var debounceComputeSize = false;
      var computeSize = function() {
        // 280 is the width of left nav / 15 is the margin with content
        $toc.css('left', $content.get('0').offsetLeft + $content.get('0').offsetWidth + 280 + 15 +'px');
        // 30 is the margin with bottom window
        $toc.css('max-height', window.innerHeight - $toc.get('0').offsetTop - 30  + 'px');
      }

      $(window).on('resize', function() {
        clearTimeout(debounceComputeSize);
        debounceComputeSize = setTimeout(computeSize, 13);
      })
      computeSize();
    }
    //----------------------------

    //---------------------------------------------------------------------
    // toogle 'active' class on toc link when headings pass window offset
    if ($toc.length > 0) {
      var headings = {};
      var debounceActiveItem = false;
      var computeActiveItem = function() {
        var lastPassedItem;

        for (let key in headings) {
          headings[key].$link.removeClass('active');

          if (headings[key].offset <= window.pageYOffset + 70) {
            lastPassedItem = headings[key];
          }
        }

        if (lastPassedItem) {
          lastPassedItem.$link.addClass('active');
        }
      }

      $('a[href]', $toc).each(function(index, element) {
        var id = element.href.slice(element.href.indexOf('#'));
        var $ref = $(id).parent();

        if ($ref.length > 0) {
          headings[id] = {
            $ref: $ref,
            $link: $(element),
            offset: $ref.get('0').offsetTop
          }
        }
      });

      $(window).on('scroll', function() {
        clearTimeout(debounceActiveItem);
        debounceActiveItem = setTimeout(computeActiveItem, 10);
      })
      computeActiveItem();
    }
    //---------------------------------------------------------------------
  })();

















  //---------------------------------------------------------------------
  // copy code to clipboard button
  (function codeClipboard() {
    $hljs = $('.hljs');

    if ($hljs.length > 0) {
      var debounceClipboard = false;
      var clipboardSnippets;

      function fallbackMessage(action) {
          var actionMsg = '';
          var actionKey = (action === 'cut' ? 'X' : 'C');
          if (/iPhone|iPad/i.test(navigator.userAgent)) {
              actionMsg = 'No support :(';
          } else if (/Mac/i.test(navigator.userAgent)) {
              actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
          } else {
              actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
          }
          return actionMsg;
      }

      $hljs.each(function(index, element) {
        $(element).before('<button class="clipboard" title="copy code to clipboard" data-clipboard-snippet><i class="fa fa-clipboard" aria-hidden="true"></i></button>');
      })

      clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
          target: function(trigger) {
              return trigger.nextElementSibling;
          }
      });

      clipboardSnippets.on('success', function(e) {
          e.clearSelection();
          $(e.trigger).text('Copied!')

          clearTimeout(debounceClipboard);
          debounceClipboard = setTimeout(function() {
            $(e.trigger).html('<i class="fa fa-clipboard" aria-hidden="true"></i>');
          }, 1200);
      });
      clipboardSnippets.on('error', function(e) {
        e.clearSelection();
        $(e.trigger).text(fallbackMessage(e.action));

        clearTimeout(debounceClipboard);
        debounceClipboard = setTimeout(function() {
          $(e.trigger).html('<i class="fa fa-clipboard" aria-hidden="true"></i>');
        }, 2400);
      });
    }
  })();
  //---------------------------------------------------------------------








  //---------------------------------------------------------------------
  // language tab selector
  (function languageTabSelector() {
    var $languageTabSelector = $('.language-tab-selector a');
    var pageCategory = 'guide'.replace(/\//g, '-');
    var selectedLanguage = store('selected-language' + pageCategory);

    if (selectedLanguage) {
      if ($('.language-tab[data-language="' + selectedLanguage + '"]').length > 0) {
        $('.language-tab-active').removeClass('language-tab-active');
        $('.language-tab-selector a[data-language-name="' + selectedLanguage + '"]').addClass('language-tab-active');
        $('.language-tab[data-language="' + selectedLanguage + '"]').addClass('language-tab-active');
      }
    }

    if ($languageTabSelector.length > 0) {
      $languageTabSelector.on('click touch', function(e) {
        e.preventDefault();
        e.stopPropagation();

        var language = $(this).data('languageName');

        $('.language-tab-active').removeClass('language-tab-active');
        $('.language-tab-selector a[data-language-name="' + language + '"]').addClass('language-tab-active');
        $('.language-tab[data-language="' + language + '"]').addClass('language-tab-active');

        store('selected-language' + pageCategory, language)
      });
    }
  })();
  //---------------------------------------------------------------------









  (function instantSearchUI() {
    var KEY_UP = 38;
    var KEY_DOWN = 40;
    var client = algoliasearch("4RFBRWISJR", "6febf1ebe906bd82bce58d5a20ac6c1b");
    var index = client.initIndex('kuzzle-documentation');
    var template = $('#search-results-template').html();
    var $searchInput = $('.search input[type=search]');
    var $searchResults = $('.search-results');
    var $searchResultsContainer = $('ul', $searchResults);
    var watchResultsDebounce = false;
    var selectedIndex = -1;
    var watchClose = false;
    var lastHits = 0;

    // focus search input on content loaded
    $searchInput.focus();


    $(window).on('keydown', function (event) {
      if (watchClose) {
        var $results = $('a', $searchResultsContainer);
        var $focusResult = $('a:hover, a:focus', $searchResultsContainer);

        if ($focusResult.length > 0) {
          $results.each(function(index, element) {
            console.log('key:', index, $results[index], $focusResult.get(0));

            if ($results[index] === $focusResult.get(0)) {
              selectedIndex = index;
            }
          })
        }

        console.log('post selectedIndex:', selectedIndex, $results.length, $focusResult.length);

        switch (event.keyCode) {
          case KEY_UP:
            event.stopPropagation();
            if (selectedIndex === 0) {
              selectedIndex = -1;
            }

            if (selectedIndex === -1) {
              $searchInput.focus();
              selectedIndex = $results.length - 1;
            }
            else {
              selectedIndex -= 1;
              $results.get(selectedIndex).focus();
            }
            //$('li:not(:last-child).selected').removeClass('selected').next().addClass('selected');

            return false;
          case KEY_DOWN:
            event.stopPropagation();
            if (selectedIndex >= $results.length -1) {
              $searchInput.focus();
              selectedIndex = -1;
            }
            else {
              selectedIndex += 1;
              $results.get(selectedIndex).focus();
            }
            //$('li:not(:first-child).selected').removeClass('selected').prev().addClass('selected');
            return false;
        }
      }
    });

    // search results open/close handlers
    $(window).on('click touch', function() {
      console.log('?')
      if (watchClose) {
        $searchResults.removeClass('display');
        watchClose = false;

        if (watchResultsDebounce) {
          window.clearTimeout(watchResultsDebounce);
        }
      }
    });

    $searchInput.on('click touch', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }
      event.stopPropagation();
    });

    $searchInput.on('focus', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }

      selectedIndex = -1;
    });

    $searchInput.on('blur', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }
    });
    // end - search results open/close handlers


    // main input listener
    $searchInput.on('input', function(event) {
      var $input = $(this);
      var searchResultsContent = '';
      // var length = (this.value.length + 1) * 6;

      selectedIndex = -1;

      // // resize input length to fit value
      // length = (length > 450) ? 450 : length;
      // this.style.width = (length > 220) ? length + 'px' : '220px';


      // clear search result on empty input
      if (this.value === '') {
        $searchResultsContainer.empty();
        $searchResults.removeClass('display');
        watchClose = false;

        return;
      }

      index.search(this.value, function(err, res) {
        if (err) {
          console.error(err);
          return;
        }

        lastHits = res.hits.length;
        if (watchResultsDebounce) {
          window.clearTimeout(watchResultsDebounce);
        }

        if (lastHits === 0) {
          $searchResultsContainer.empty();
          $searchResults.removeClass('display');
          return;
        }

        // send ga event when user has search results but does nothing
        watchResultsDebounce = window.setTimeout(function() {
          ga('send', 'event', {
            eventCategory: 'documentation-search',
            eventAction: (lastHits > 0) ? '<watch_results>' : '<no_results>',
            eventLabel: $searchInput.val(),
            transport: 'beacon'
          });
        }, 4000);

        $searchResults.addClass('display');
        watchClose = true;

        // make search result item from
        for (var key in res.hits) {
          var content = template;

          // here we secure manualy all xml tags wich may can be retrieved by results, but we keep <em> tags for highlighting
          var elements = res.hits[key]._snippetResult.content.value.split('<em>');
          var preview = '';

          for (var k in elements) {
            elements[k] = elements[k].replace(/</g, '&lt;');
            elements[k] = elements[k].replace(/>/g, '&gt;');
          }

          // restore <em></em> tags
          preview = elements.join('<em>');
          preview = preview.replace(/&lt;\/em&gt;/g, '</em>');

          // replace variables in template
          content = content.replace(/__tabindex__/g, key + 2);
          content = content.replace(/__link__/g, 'https://stafyniaksacha.github.io/documentation/' + res.hits[key].path);
          content = content.replace(/__parent__/g, res.hits[key].parent || '');
          content = content.replace(/__firstMember__/g, res.hits[key].firstMember || '');
          content = content.replace(/__title__/g, res.hits[key]._highlightResult.title.value);
          content = content.replace(/__preview__/g, preview);

          searchResultsContent += content;
        }

        // add algolia copyright
        searchResultsContent += '<li style="text-align: right"><img src="https://www.algolia.com/assets/pricing_new/algolia-powered-by-ac7dba62d03d1e28b0838c5634eb42a9.svg" style="margin: 8px 8px 0 0;"></li>';

        // magic jQuery
        $searchResultsContainer.html(searchResultsContent);

        // send ga event on search result hit
        $('a', $searchResultsContainer).on('click touch', function(event) {
          ga('send', 'event', {
            eventCategory: 'documentation-search',
            eventAction: this.href,
            eventLabel: $searchInput.val(),
            transport: 'beacon'
          });
        });
      });
    });

  })();
</script>
</body>
</html>
