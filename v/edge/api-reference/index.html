<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google-site-verification" content="luspUdq52gkUU0FFChQ2xmeXSs5HDafpARQ7fVXVBp4" />
    <title>Kuzzle API Reference</title>

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="images/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="images/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="images/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="images/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-128.png" sizes="128x128" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="images/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="images/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="images/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="images/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="images/favicon/mstile-310x310.png" />

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages([{"tag":"http","label":"HTTP","selector":".http + *"},{"tag":"others","label":"Other protocols","selector":".others + *"}]);
        });
      </script>
  </head>

  <body class="index">
    <header>
      <div class="wrapper">
        <div id="logo">
            <a href="http://kuzzle.io/">&nbsp;</a>
        </div>

        <nav>
          <ul>
            <li>
              <a href="http://kuzzle.io/" class="nav-item">Home</a>
            </li>
            <li>
              <a href="http://docs.kuzzle.io/" class="nav-item developers active">Documentation</a>
            </li>
            <li>
              <a href="http://kuzzle.io/demos-tutorials/" class="nav-item ">Demos</a>
            </li>
            <li>
              <a href="http://kuzzle.io/blog/" class="nav-item ">Blog</a>
            </li>
            <li>
              <a href="https://github.com/kuzzleio/kuzzle" target="_blank" class="nav-item github">
                <i class="icon icon-github icon-small"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="developer-nav open">
        <ul>
            <li><a href="/guide/"><span>Guide</span></a></li>
            <li><a href="/sdk-reference/"><span>SDK</span></a></li>
            <li><a href="/real-time-filters/"><span>Real-time filters</span></a></li>
            <li><a href="/validation-reference/"><span>Data Validation</span></a></li>
            <li class="active"><a href="/api-reference/"><span>API</span></a></li>
            <li><a href="/plugin-reference/"><span>Plugins</span></a></li>
            <li><a href="/elasticsearch-cookbook/"><span>Elasticsearch Cookbook</span></a></li>
        </ul>
        <div class="search">
          <input type="text" class="search" id="input-search" tabindex="1" placeholder="Search in the guide">
        </div>
      </div>
    </header>

    <div class="container">
      <a href="#" id="nav-button">
        <span>
          NAV
          <img src="images/navbar.png" />
        </span>
      </a>
      <div class="tocify-wrapper">
          <div class="lang-selector">
              <a href="#" data-language-name="http">HTTP</a>
              <a href="#" data-language-name="others">Other protocols</a>
          </div>
          <ul class="search-results"></ul>

<!--
        <div id="version-selector">
          <label>
            select version:
            <select>
              <option value="/">v1.0.x (current)</option>
              <option value="/v/edge">next</option>
            </select>
          </label>
        </div>
-->

        <div id="toc">
        </div>
          <ul class="toc-footer">
              <li><a href="http://kuzzle.io">Kuzzle official website</a></li>
              <li><a href="http://github.com/kuzzleio/kuzzle">Kuzzle on GitHub</a></li>
              <li><a href="http://github.com/tripit/slate">Documentation Powered by Slate</a></li>
          </ul>
      </div>
      <div class="page-wrapper">
        <div class="dark-box"></div>
        <div class="content">
          <h1 id="introduction">Introduction</h1>

<aside class="warning">
This documentation is exposing the low-level API to Kuzzle.  
If you are a Javascript or Android developer, you may first like to start by having a look at the <a href="http://kuzzle.io/documentation/sdk-reference">Kuzzle SDK</a>.
</aside>

<p>Welcome to the Kuzzle API Documentation!</p>

            <h1 id="connecting-to-kuzzle">Connecting to Kuzzle</h1>

<p>The connection to Kuzzle depends on the protocol to be used.</p>

<h2 id="http">HTTP</h2>

<section class="http"></section>
<pre class="highlight shell"><code> <span class="nv">$ </span>curl <span class="s2">"http://localhost:7511/"</span>
</code></pre>

<p>By default, Kuzzle exposes itself on the 7511 port. Assuming the Kuzzle server runs locally,
it can be reached on <code class="prettyprint">http://localhost:7511/</code>.
Note that HTTP is the only protocol shipped in Kuzzle&rsquo;s core.</p>

<p>The default response is the <a href="?http#serverinfo">ServerInfo</a> controller.
With this you will get detailed information about available HTTP API routes.</p>

<h2 id="websocket">WebSocket</h2>

<section class="others"></section>

<blockquote>
<p>Websocket</p>
</blockquote>

<section class="others"></section>
<pre class="highlight html"><code><span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">"ws://localhost:7513"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<p>By default, Kuzzle embarks our official <a href="https://www.npmjs.com/package/kuzzle-plugin-websocket">WebSocket</a> plugin,
accepting websocket requests on the 7513 port.</p>

<h2 id="socket-io-websocket-like">Socket.io (WebSocket-like)</h2>

<section class="others"></section>

<blockquote>
<p>Socket.io</p>
</blockquote>

<section class="others"></section>
<pre class="highlight html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.socket.io/socket.io-1.4.5.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="s2">"http://localhost:7512"</span><span class="p">);</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<p>To ensure compatibility with older web browsers, our official docker images embeds the
<a href="https://www.npmjs.com/package/kuzzle-plugin-socketio">Socket.io</a> protocol plugin.</p>

<p>By default, this plugin listens to the port 7512.</p>

<h2 id="mqtt-protocols">MQTT protocols</h2>

<p>Kuzzle provides a <a href="https://github.com/kuzzleio/kuzzle-plugin-mqtt">plugin protocol</a> that supports the MQTT protocol.
This plugin protocol is a 2-way means of communication between your application and Kuzzle, forwarding your queries
forth to Kuzzle, and notifications/responses from Kuzzle back to your application.</p>

<h3 id="examples">Examples</h3>

<section class="others"></section>

<blockquote>
<p>MQTT</p>
</blockquote>

<section class="others"></section>
<pre class="highlight shell"><code><span class="c"># shell 1</span>
node_modules/.bin/mqtt subscribe -v -h rabbit -t Kuzzle

<span class="c"># shell 2</span>
node_modules/.bin/mqtt publish -h rabbit -t Kuzzle -m <span class="s1">'{
  "collection":"index",
  "collection":"collection",
  "controller": "document",
  "action": "createOrReplace",
  "body": {
    "firstName": "John",
    "lastName": "Doe"
  }
}'</span>

<span class="c"># shell 1 (prettified)</span>
Kuzzle <span class="o">{</span>
  <span class="s2">"error"</span>: null,
  <span class="s2">"result"</span>: <span class="o">{</span>
    <span class="s2">"_id"</span>: <span class="s2">"AVF8NG3k5ZVpUuiPrN1K"</span>,
    <span class="s2">"_index"</span>: <span class="s2">"index"</span>,
    <span class="s2">"_source"</span>: <span class="o">{</span><span class="s2">"firstName"</span>:<span class="s2">"John"</span>, <span class="s2">"lastName"</span>:<span class="s2">"Doe"</span><span class="o">}</span>,
    <span class="s2">"_type"</span>: <span class="s2">"collection"</span>,
    <span class="s2">"_version"</span>: 1,
    <span class="s2">"action"</span>: <span class="s2">"createOrReplace"</span>,
    <span class="s2">"collection"</span>: <span class="s2">"collection"</span>,
    <span class="s2">"controller"</span>: <span class="s2">"document"</span>,
    <span class="s2">"created"</span>: <span class="nb">true</span>,
    <span class="s2">"metadata"</span>: <span class="o">{}</span>,
    <span class="s2">"requestId"</span>:<span class="s2">"5cb4d930-62f4-4393-afc1-9a71e284a214"</span>
  <span class="o">}</span>,
  <span class="s2">"status"</span>: 200
<span class="o">}</span>
</code></pre>

<p>By default, the MQTT plugin protocol listens on the port 1883.</p>

<aside class="notice">
    The examples given in this documentation use the cli client from the mqtt node.js
    library that is shipped within the Kuzzle Docker container.<br />
    You can play them by entering the kuzzle container. Once your docker compose stack is running:<br />
    <code>docker exec -ti kuzzle_kuzzle_1 ash</code>
</aside>

            <h1 id="query-syntax">Query syntax</h1>

<p>The query message format is (almost) identical between all the protocols.</p>

<p>The only exceptions are about the specific nature of HTTP protocol, where the URL represents the action.</p>

<p>Please refer to the code samples on the right pane for more detail on the specific implementations.</p>

<h2 id="common-attributes">Common attributes</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;action route&gt;[route options]</code><br>
<strong>Method:</strong> <code class="prettyprint">get|post|put|delete</code><br>
<strong>Body:</strong> Can be empty (usually with get and delete methods) or a JSON object
of the resource body (usually with post and put methods).</p>
</blockquote>

<section class="others"></section>

<blockquote>
<p><strong>Websocket:</strong> The Websocket layer listens to a specific socket room in order
to forward your queries to the right Kuzzle controller.
<strong>Room name:</strong> <code class="prettyprint">kuzzle</code>
<strong>Query body syntax (JSON data):</strong></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p><strong>MQTT:</strong> The MQTT layer listens to a specific topic in order to forward your queries to the right Kuzzle controller.
<strong>Topic name:</strong> <code class="prettyprint">kuzzle</code>
<strong>Query body syntax (JSON data):</strong></p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Optional: Unique request Identifier
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",

  // Required: Controller and Action to call:
  "controller": "<span class="nt">&lt;controller&gt;</span>",
  "action": "<span class="nt">&lt;action&gt;</span>",

  // Index on which the action is handled (empty for actions that do not manage a unique index)
  "index": "<span class="nt">&lt;index&gt;</span>",

  // Collection on which the action is handled (empty for actions that do not manage a unique collection)
  "collection": "<span class="nt">&lt;collection&gt;</span>",

  // A set of filters matching documents you want to listen to
  "body": {..}
}
</code></pre>

<h3 id="controller">controller</h3>

<p><em>mandatory</em></p>

<p>The controller attribute specifies the type of action to perform.
The current implementation of Kuzzle embeds nine controllers:
<code class="prettyprint">auth</code>, <code class="prettyprint">bulk</code>, <code class="prettyprint">collection</code>, <code class="prettyprint">document</code>, <code class="prettyprint">index</code>, <code class="prettyprint">memoryStorage</code>, <code class="prettyprint">realtime</code>, <code class="prettyprint">security</code> and <code class="prettyprint">server</code>.</p>

<h3 id="action">action</h3>

<p><em>mandatory</em></p>

<p>The action attribute indicates to Kuzzle which action to perform for the controller.</p>

<p>For instance, using the <code class="prettyprint">document</code> controller, we can perform a <code class="prettyprint">get</code> action or a <code class="prettyprint">search</code>.</p>

<h3 id="index">index</h3>

<p><em>required depending on the controller/action</em></p>

<p>Kuzzle attaches its collections to a index.
Any action impacting a document, a collection or an index itself will need this attribute fed.</p>

<h3 id="collection">collection</h3>

<p><em>required depending on the controller/action</em></p>

<p>Kuzzle attaches its documents to a collection.
Any action impacting a document or a collection itself will need this attribute fed.</p>

<h3 id="body">body</h3>

<p><em>mandatory</em></p>

<p>The <code class="prettyprint">body</code> field contains the body of the resource sent to Kuzzle.</p>

<p>For instance, the <code class="prettyprint">body</code> attribute will contain the filters on which to listen
to during a real-time subscription or the content of the document to create/publish.</p>

<h3 id="requestid">requestId</h3>

<p><em>optional</em></p>

<p>Kuzzle will create a unique ID if you don&rsquo;t provide one, but if you want to easily
identify which query generated the response you got, the best way is to provide it yourself in the request.</p>

<h2 id="authorization-token">Authorization token</h2>

<section class="http"></section>
<pre class="highlight shell"><code> <span class="nv">$ </span>curl -H <span class="s2">"Authorization: Bearer &lt;encrypted_jwt_token&gt;"</span> <span class="s2">"http://localhost:7511/..."</span>
</code></pre>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Optional: Unique request Identifier
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "<span class="nt">&lt;controller&gt;</span>",
  "action": "<span class="nt">&lt;action&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",

  // Request headers:
  "jwt": "<span class="nt">&lt;encrypted</span><span class="na">_jwt_token</span><span class="nt">&gt;</span>"

  "body": {..}
}
</code></pre>

<p>Kuzzle uses <a href="https://tools.ietf.org/html/rfc7519">JSON Web Tokens</a> send within request headers to authenticate users.
The token himself is generated by the <a href="#auth-controller">Auth controller</a> login action and must be included with each request.</p>

            <h1 id="kuzzle-response">Kuzzle response</h1>
<pre class="highlight literate_coffeescript"><code>{
  // Integer containing the status code (HTTP-like: 200 if OK, 4xx or 5xx in case of error)
  "status": 200,

  // Complex object containing error information, if something went wrong (null if OK)
  "error": {...},

  // Some information about the initial request
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "<span class="nt">&lt;controller&gt;</span>",
  "action": "<span class="nt">&lt;action&gt;</span>",

  // For notification only, completion state of the request.
  // A pending request will receive a "done" notification once it is processed by Kuzzle.
  "state": "<span class="nt">&lt;done</span><span class="err">|</span><span class="na">pending</span><span class="nt">&gt;</span>",

  // For notifications only, indicates if the document is added or removed from the subscription.
  "scope": "<span class="nt">&lt;in</span><span class="err">|</span><span class="na">out</span><span class="nt">&gt;</span>",

  // Arbitrary data repeated from the initial request (optional).
  "metadata": { foo: "bar" },

  // Your query unique identifier.
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",

  // Complex object, depending on your query
  "result": {
    <span class="p">...</span>
  }
}
</code></pre>

<p>A <code class="prettyprint">response</code> is the result of a query you send to Kuzzle.
It may be the results of a search query, an acknowledgement of a created action, and so on.
When you subscribe to a room, Kuzzle also sends a notification to your application in the form of a <code class="prettyprint">response</code> object.</p>

<p>A <code class="prettyprint">response</code> is a JSON object as shown in the sample pane.</p>

<p><em>NB: For more details about status code and error object, see status-codes.md</em></p>

            <h1 id="sending-metadata">Sending metadata</h1>

<p>In every request you send to Kuzzle, you can include a <code class="prettyprint">metadata</code> object.
This object content will be ignored by Kuzzle,
but it will also be forwarded back in <code class="prettyprint">responses</code> and in <code class="prettyprint">notifications</code> (see below).</p>

<p>You can also include metadata information to a subscription request.
These metadata information will be forwarded to other subscribers at the moment of the subscription,
and when you leave the room. Please note that when leaving the room,
the forwarded metadata are those provided in the <strong>subscription</strong> request.</p>

<p>This feature is especially useful to include volatile information about the performed request.</p>

<h2 id="updating-a-document">Updating a document</h2>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  "_id": "<span class="nt">&lt;documentId&gt;</span>",
  "body": {
    <span class="s">"somefield"</span><span class="o">:</span> <span class="s">"now has a new value"</span>
  },
  "metadata": {
    <span class="s">"modifiedBy"</span><span class="o">:</span> <span class="s">"awesome me"</span><span class="p">,</span>
    <span class="s">"reason"</span><span class="o">:</span> <span class="s">"it needed to be modified"</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>The following <code class="prettyprint">update</code> notification will be sent to all subscribers:</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,
  "error": null,
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  "state": "pending",
  "scope": "<span class="nt">&lt;in</span><span class="err">|</span><span class="na">out</span><span class="nt">&gt;</span>",
  "metadata": {
    <span class="s">"modifiedBy"</span><span class="o">:</span> <span class="s">"awesome me"</span><span class="p">,</span>
    <span class="s">"reason"</span><span class="o">:</span> <span class="s">"it needed to be modified"</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"a document ID"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"somefield"</span><span class="o">:</span> <span class="s">"now has a new value"</span><span class="p">,</span>
      <span class="s">"someOtherField"</span><span class="o">:</span> <span class="s">"was left unchanged"</span>
    <span class="p">},</span>
  }
}
</code></pre>

<h2 id="subscribe-to-a-room">Subscribe to a room</h2>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "subscribe",
  "body": {
    <span class="o">//</span> <span class="nx">subscription</span> <span class="nx">filters</span>
  },
  "metadata": {
    <span class="s">"hello"</span><span class="o">:</span> <span class="s">"my name is Bob"</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>And then, if you leave the room, the other subscribers will receive the following notification:</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,
  "error": null,
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "unsubscribe",
  "state": "done",
  "scope": "out",
  "metadata": {
    <span class="s">"hello"</span><span class="o">:</span> <span class="s">"my name is Bob"</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span><span class="p">,</span>
    <span class="s">"count"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">the</span> <span class="k">new</span> <span class="nx">user</span> <span class="nx">count</span> <span class="no">on</span> <span class="nx">that</span> <span class="nx">room</span><span class="o">&gt;</span>
  }
}
</code></pre>

            <h1 id="notifications">Notifications</h1>

<section class="others"></section>

<blockquote>
<p>Websocket</p>
</blockquote>

<section class="others"></section>
<pre class="highlight html"><code>// For browsers not supporting websocket, use socket.io instead
<span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span>
    <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">"ws://localhost:7513"</span><span class="p">),</span>
    <span class="nx">channel</span><span class="p">;</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

    <span class="cm">/*
     step 1 - we get the created channel name, as notifications will be sent
        with "room = channelName"
     */</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">room</span> <span class="o">===</span> <span class="s2">"mySubscription"</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// we now have a channel to listen to</span>
      <span class="nx">channel</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">room</span> <span class="o">===</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Received a notification: "</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>

      <span class="cm">/*
      {
        "status": 200,
        "error": null,
        "index": "index",
        "collection":"collection",
        "controller": "realtime",
        "action": "publish",
        "state": "done",
        "scope": "in",
        "requestId": "&lt;unique request identifier&gt;",
        "result": {
          ...                      // the published document
        }
      }
      */</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="c1">// step 2 - we subscribe to our documents</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="s2">"requestId"</span><span class="p">:</span> <span class="s2">"mySubscription"</span><span class="p">,</span>
      <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
      <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
      <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
      <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"subscribe"</span><span class="p">,</span>
      <span class="s2">"body"</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}));</span>

    <span class="c1">// step 3 - when publishing a message, we get some notifications back</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
      <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
      <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
      <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"publish"</span><span class="p">,</span>
      <span class="s2">"body"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"bar"</span>
      <span class="p">}</span>
    <span class="p">}));</span>
  <span class="p">};</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<section class="others"></section>

<blockquote>
<p>Socket.io</p>
</blockquote>
<pre class="highlight html"><code><span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.socket.io/socket.io-1.4.5.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="s2">"http://localhost:7512"</span><span class="p">);</span>

  <span class="c1">// step 1 - we prepare ourself to receive Kuzzle's subscription response and then listen to the created channel.</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">"mySubscription"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// we now have a channel to listen to</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">channel</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notification</span><span class="p">);</span>

      <span class="cm">/*
      {
        "status": 200,
        "error": null,
        "index": "index",
        "collection":"collection",
        "controller": "realtime",
        "action": "publish",
        "state": "done",
        "scope": "in",
        "requestId": "&lt;unique request identifier&gt;",
        "result": {
          ...                      // the published document
        }
      }
      */</span>
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="c1">// step 2 - we subscribe to our documents</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"kuzzle"</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">"requestId"</span><span class="p">:</span> <span class="s2">"mySubscription"</span><span class="p">,</span>
    <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
    <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
    <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
    <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"subscribe"</span><span class="p">,</span>
    <span class="s2">"body"</span><span class="p">:</span> <span class="p">{}</span>
  <span class="p">});</span>

  <span class="c1">// step 3 - when publishing a message, we get some notifications back</span>
  <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"kuzzle"</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
    <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
    <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
    <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"publish"</span><span class="p">,</span>
    <span class="s2">"body"</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">"foo"</span><span class="p">:</span> <span class="s2">"bar"</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<section class="others"></section>

<blockquote>
<p>MQTT</p>
</blockquote>

<section class="others"></section>
<pre class="highlight shell"><code><span class="c"># shell 1 - getting direct responses from kuzzle</span>
node_modules/.bin/mqtt subscribe -v -h rabbit -t mqtt.myId

<span class="c"># shell 2 - we subscribe to our documents</span>
node_modules/.bin/mqtt publish -h rabbit -t kuzzle -m <span class="s1">'{
  "controller": "realtime",
  "action":"subscribe",
  "index": "index",
  "collection": "collection",
  "body": {}
}'</span>

<span class="c"># shell 1 (prettified)</span>
mqtt/myId <span class="o">{</span>
  <span class="s2">"status"</span>: 200,
  <span class="s2">"error"</span>: null,
  <span class="s2">"index"</span>: <span class="s2">"index"</span>,
  <span class="s2">"collection"</span>: <span class="s2">"collection"</span>,
  <span class="s2">"controller"</span>: <span class="s2">"controller"</span>,
  <span class="s2">"action"</span>: <span class="s2">"action"</span>,
  <span class="s2">"metadata"</span>: <span class="o">{}</span>,
  <span class="s2">"requestId"</span>: <span class="s2">"60621753-2da2-441a-b30b-546127f26cd1"</span>,
  <span class="s2">"result"</span>: <span class="o">{</span>
    <span class="s2">"roomId"</span>: <span class="s2">"632682a9eac95cfb95e3a697b29b7739"</span>,
    <span class="s2">"channel"</span>: <span class="s2">"632682a9eac95cfb95e3a697b29b7739-1c7beed7521fd0b0a8177f219b786d2e"</span>,
    <span class="s2">"timestamp"</span>: 1450267140597
  <span class="o">}</span>
<span class="o">}</span>

<span class="c"># shell 3 - we subscribe to the nofitications</span>
node_modules/.bin/mqtt subscribe -h rabbit -t 632682a9eac95cfb95e3a697b29b7739-1c7beed7521fd0b0a8177f219b786d2e

<span class="c"># shell 2 - we publish a message</span>
node_modules/.bin/mqtt publish -h rabbit -t kuzzle -m <span class="s1">'{
  "controller": "realtime",
  "action": "publish",
  "index": "index",
  "collection": "collection",
  "body": {"foo": "bar"}
}'</span>

<span class="c"># shell 3</span>
<span class="o">{</span>
  <span class="s2">"status"</span>: 200,
  <span class="s2">"error"</span>: null,
  <span class="s2">"index"</span>: <span class="s2">"index"</span>,
  <span class="s2">"collection"</span>: <span class="s2">"collection"</span>,
  <span class="s2">"controller"</span>: <span class="s2">"controller"</span>,
  <span class="s2">"action"</span>: <span class="s2">"action"</span>,
  <span class="s2">"state"</span>: <span class="s2">"done"</span>,
  <span class="s2">"scope"</span>: <span class="s2">"in"</span>,
  <span class="s2">"metadata"</span>: <span class="o">{}</span>,
  <span class="s2">"requestId"</span>: <span class="s2">"10bca195-f375-4b72-817a-04fcb22b3681"</span>,
  <span class="s2">"result"</span>: <span class="o">{</span>
    <span class="s2">"_source"</span>: <span class="o">{</span><span class="s2">"foo"</span>:<span class="s2">"bar"</span><span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>

<p><a href="#on">Subscribing to some documents in Kuzzle</a> allows to be notified back each time a document matches your criteria.
The subscription action (realtime/subscribe) returns a channel identifier which you can then listen to receive the
notifications.</p>

<p>You can receive the following types of notifications:</p>

<p><strong>Document Notifications:</strong></p>

<ul>
<li>A document has been created</li>
<li>A document has been updated and entered your subscription scope</li>
<li>A document has been updated and left your subscription scope</li>
<li>A document has been deleted</li>
<li>A document is about to be created (realtime)</li>
<li>A document is about to be deleted (realtime)</li>
</ul>

<p><strong>Subscription Notifications:</strong></p>

<ul>
<li>A user subscribed to this room</li>
<li>A user left this room</li>
</ul>

<p><strong>Server Notifications:</strong></p>

<ul>
<li>Your JWT Token has expired</li>
</ul>

<h2 id="a-document-has-been-created">A document has been created</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "create",
  "state": "done",                      // The document has been fully created
  "scope": "in",                        // The document entered your room scope
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {                           // The created document
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"documentId"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{...}</span>
  }
}
</code></pre>

<h2 id="an-updated-document-entered-your-listening-scope">An updated document entered your listening scope</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  "state": "done",                      // The document has been fully updated
  "scope": "in",                        // The document entered your room scope
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {                           // The updated document
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<h2 id="an-updated-document-left-your-listening-scope">An updated document left your listening scope</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  "state": "done",                     // The document has been fully updated
  "scope": "out",                      // The document left your room scope
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {                          // The updated document
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<h2 id="a-document-has-been-deleted">A document has been deleted</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "delete",
  "state": "done",                     // The document has been fully deleted
  "scope": "out",                      // The document left your room scope
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {                          // The updated document
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<h2 id="a-document-is-about-to-be-created">A document is about to be created</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "create",
  "state": "pending",                   // Indicates that the document will be created
  "metadata": {},
  "result": {}
}
</code></pre>

<h2 id="a-document-is-about-to-be-deleted">A document is about to be deleted</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "delete",
  "state": "pending",                   // Indicates that the document will be deleted
  "metadata": {},
  "result": {}
}
</code></pre>

<h2 id="a-user-subscribed-to-this-room">A user subscribed to this room</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "subscribe",
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span><span class="p">,</span>
    <span class="s">"count"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">the</span> <span class="k">new</span> <span class="nx">user</span> <span class="nx">count</span> <span class="no">on</span> <span class="nx">that</span> <span class="nx">room</span><span class="o">&gt;</span>
  }
}
</code></pre>

<h2 id="a-user-left-this-room">A user left this room</h2>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "unsubscribe",
  "metadata": {
    <span class="o">//</span> <span class="nx">metadata</span> <span class="nx">embedded</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">request</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span><span class="p">,</span>
    <span class="s">"count"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">the</span> <span class="k">new</span> <span class="nx">user</span> <span class="nx">count</span> <span class="no">on</span> <span class="nx">that</span> <span class="nx">room</span><span class="o">&gt;</span>
  }
}
</code></pre>

<h2 id="your-jwt-token-has-expired">Your JWT Token has expired</h2>

<aside class="warning">
This notification is sent to all subscriptions when the JWT Token expires, and
it cannot be filtered.
</aside>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "controller": "auth",
  "action": "jwtTokenExpired",
  "requestId": "server notification",
}
</code></pre>

            <h1 id="auth-controller">~ auth controller</h1>

<h2 id="checktoken">checkToken</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_checkToken</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "token": "..."
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "checkToken",
  "body": {
    <span class="s">"token"</span><span class="o">:</span> <span class="s">"..."</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "auth",
  "action": "checkToken",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"valid"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span><span class="p">,</span>

    <span class="o">//</span> <span class="k">if</span> <span class="s">"valid"</span> <span class="o">is</span> <span class="no">false</span><span class="p">,</span> <span class="nx">contains</span> <span class="nx">the</span> <span class="nx">reason</span> <span class="nx">why</span> <span class="nx">the</span> <span class="nx">provided</span> <span class="nx">token</span> <span class="o">is</span>
    <span class="o">//</span> <span class="nx">invalid</span><span class="p">.</span>
    <span class="o">//</span> <span class="nx">This</span> <span class="nx">field</span> <span class="o">is</span> <span class="o">not</span> <span class="nx">present</span> <span class="k">if</span> <span class="s">"valid"</span> <span class="o">is</span> <span class="no">true</span><span class="p">.</span>
    <span class="s">"state"</span><span class="o">:</span> <span class="s">"Error message"</span><span class="p">,</span>

    <span class="o">//</span> <span class="k">if</span> <span class="s">"valid"</span> <span class="o">is</span> <span class="no">true</span><span class="p">,</span> <span class="nx">contains</span> <span class="nx">the</span> <span class="nx">expiration</span> <span class="nx">timestamp</span><span class="p">.</span>
    <span class="o">//</span> <span class="nx">This</span> <span class="nx">field</span> <span class="o">is</span> <span class="o">not</span> <span class="nx">present</span> <span class="k">if</span> <span class="s">"valid"</span> <span class="o">is</span> <span class="no">false</span><span class="p">.</span>
    <span class="s">"expiresAt"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">timestamp</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Checks a JWT Token validity.
This API route does not require to be logged in.</p>

<h2 id="getcurrentuser">getCurrentUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_me</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code><br>
<strong>Headers:</strong> <code class="prettyprint">Authorization: &quot;Bearer &lt;encrypted_jwt_token&gt;&quot;</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "getCurrentUser"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "auth",
  "action": "getCurrentUser",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "jwt": "<span class="nt">&lt;encrypted</span><span class="na">_jwt_token</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span><span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"first"</span><span class="o">:</span> <span class="s">"Steve"</span><span class="p">,</span>
        <span class="s">"last"</span><span class="o">:</span> <span class="s">"Wozniak"</span>
        <span class="p">},</span>
        <span class="p">...</span>                         <span class="o">//</span> <span class="nx">The</span> <span class="nx">user</span> <span class="nx">object</span> <span class="nx">content</span>
        <span class="s">"profile"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span><span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>
          <span class="s">"roles"</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">...</span>                     <span class="o">//</span> <span class="nx">Users</span> <span class="nx">roles</span> <span class="nx">definitions</span>
          <span class="p">]</span>
        <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Gets the user object identified by the <code class="prettyprint">JSON Web Token</code> provided in the query or the <code class="prettyprint">Authorization</code> header.</p>

<h2 id="getmyrights">getMyRights</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_me/_rights</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code><br>
<strong>Headers:</strong> <code class="prettyprint">Authorization: &quot;Bearer &lt;encrypted_jwt_token&gt;&quot;</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="websocket"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "getMyRights"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "jwt": "<span class="nt">&lt;encrypted</span><span class="na">_jwt_token</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">objects</span> <span class="nx">containing</span> <span class="nx">the</span> <span class="nx">user</span> <span class="nx">rights</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"controller"</span><span class="o">:</span> <span class="s">"&lt;ctrl_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"action"</span><span class="o">:</span> <span class="s">"&lt;action_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"collection"</span><span class="o">:</span> <span class="s">"&lt;collection_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"value"</span><span class="o">:</span> <span class="s">"&lt;allowed|denied|conditional&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Another</span> <span class="nx">rights</span> <span class="nx">item</span><span class="p">...</span> <span class="na">and</span> <span class="nx">so</span> <span class="no">on</span>
      <span class="p">}</span>
    <span class="p">],</span>
}
</code></pre>

<p>Gets the rights of the user identified by the <code class="prettyprint">JSON Web Token</code> provided in the query or the <code class="prettyprint">Authorization</code> header.</p>

<h2 id="login">login</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_login</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // authentication strategy identifier (optionnal : kuzzle will use "local" strategy if not set)
  "strategy": "<span class="nt">&lt;passportjs</span><span class="na">_strategy</span><span class="nt">&gt;</span>",

  // jwt token expiration time (optional - kuzzle will use server default value if not set)
  // expressed in seconds or a string describing a time span. Eg: 60, "2 days", "10h", "7d", "1y"
  "expiresIn": "<span class="nt">&lt;expiresIn&gt;</span>",

  // set of parameters depending of the chosen strategy. Example for "local" strategy:
  "username": "<span class="nt">&lt;username&gt;</span>",
  "password": "<span class="nt">&lt;password&gt;</span>"
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "login",

  "body": {
    <span class="o">//</span> <span class="nx">authentication</span> <span class="nx">strategy</span> <span class="nx">identifier</span> <span class="p">(</span><span class="nx">optional</span> <span class="o">-</span> <span class="nx">kuzzle</span> <span class="nx">will</span> <span class="nx">use</span> <span class="s">"local"</span> <span class="nx">strategy</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">set</span><span class="p">)</span>
    <span class="s">"strategy"</span><span class="o">:</span> <span class="s">"&lt;passportjs_strategy&gt;"</span><span class="p">,</span>

    <span class="o">//</span> <span class="nx">jwt</span> <span class="nx">token</span> <span class="nx">expiration</span> <span class="nx">time</span> <span class="p">(</span><span class="nx">optional</span> <span class="o">-</span> <span class="nx">kuzzle</span> <span class="nx">will</span> <span class="nx">use</span> <span class="nx">server</span> <span class="nx">default</span> <span class="nx">value</span> <span class="k">if</span> <span class="o">not</span> <span class="nx">set</span><span class="p">)</span>
    <span class="o">//</span> <span class="nx">expressed</span> <span class="k">in</span> <span class="nx">seconds</span> <span class="o">or</span> <span class="nx">a</span> <span class="nx">string</span> <span class="nx">describing</span> <span class="nx">a</span> <span class="nx">time</span> <span class="nx">span</span><span class="p">.</span> <span class="na">Eg</span><span class="o">:</span> <span class="mi">60</span><span class="p">,</span> <span class="s">"2 days"</span><span class="p">,</span> <span class="s">"10h"</span><span class="p">,</span> <span class="s">"7d"</span><span class="p">,</span> <span class="s">"1y"</span>
    <span class="s">"expiresIn"</span><span class="o">:</span> <span class="s">"&lt;expiresIn&gt;"</span><span class="p">,</span>

    <span class="o">//</span> <span class="nx">set</span> <span class="k">of</span> <span class="nx">parameters</span> <span class="nx">depending</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">chosen</span> <span class="nx">strategy</span><span class="p">.</span> <span class="na">Example</span> <span class="k">for</span> <span class="s">"local"</span> <span class="na">strategy</span><span class="o">:</span>
    <span class="s">"username"</span><span class="o">:</span> <span class="s">"&lt;username&gt;"</span><span class="p">,</span>
    <span class="s">"password"</span><span class="o">:</span> <span class="s">"&lt;password&gt;"</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "auth",
  "action": "login",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "metadata": {},
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"jwt"</span><span class="o">:</span> <span class="s">"&lt;JWT encrypted token&gt;"</span>
  }
}
</code></pre>

<p>Authenticates a user with a defined <strong>passportjs</strong> authentication strategy.
See <a href="http://www.passportjs.org/">passportjs.org</a> for more details about authentication strategies.</p>

<p>Strategies are implemented as <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/plugins.md">plugins</a>.
The default &ldquo;local&rdquo; strategy is enabled by default
(see <a href="https://github.com/kuzzleio/kuzzle-plugin-auth-passport-local">kuzzle-plugin-auth-passport-local</a>),
and let you authenticate with a login and password.</p>

<p>The <strong>_login</strong> action returns an encrypted JWT token, that must then be sent within the <a href="#authorization-header">requests headers</a>.</p>

<h2 id="logout">logout</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_logout</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code><br>
<strong>Headers:</strong> <code class="prettyprint">Authorization: &quot;Bearer &lt;encrypted_jwt_token&gt;&quot;</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "logout",
  "jwt": "<span class="nt">&lt;encrypted</span><span class="na">_jwt_token</span><span class="nt">&gt;</span>"
}
</code></pre>

<p>Revokes the token validity &amp; unsubscribe from registered rooms.</p>

<p>The <strong>_logout</strong> action doesn&rsquo;t take strategy.</p>

<aside class="warning">
    <strong>The auth/logout action will be removed on the next RC1 release of Kuzzle.</strong>
    <br>
    <br>
    Kuzzle will implement two authentication modes soon:
  <ol>
    <li>
      A default stateless mode, in which the expiration will solely rely on the JWT ttl.
      The logout action won&rsquo;t be available in this mode.
    </li>
    <li>
      A full Session mode, handled by a plugin, in which the logout route will be updated (@tbd).
    </li>
  </ol>
</aside>

<h2 id="updateself">updateSelf</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_updateSelf</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Headers:</strong> <code class="prettyprint">Authorization: &quot;Bearer &lt;encrypted_jwt_token&gt;&quot;</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
    <span class="s">"foo"</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">,</span>                    <span class="o">//</span> <span class="nx">Some</span> <span class="nx">properties</span> <span class="nx">to</span> <span class="nx">update</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"Walter Smith"</span><span class="p">,</span>
    <span class="p">...</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "auth",
  "action": "updateSelf",
  "jwt": "<span class="nt">&lt;encrypted</span><span class="na">_jwt_token</span><span class="nt">&gt;</span>",
  "body": {
    <span class="s">"foo"</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">,</span>                    <span class="o">//</span> <span class="nx">Some</span> <span class="nx">properties</span> <span class="nx">to</span> <span class="nx">update</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"Walter Smith"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "updateSelf",
  "controller": "auth",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"foo"</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">,</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="s">"Walter Smith"</span><span class="p">,</span>
      <span class="p">....</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Updates the current User object in Kuzzle&rsquo;s database layer.</p>

<aside class="notice">
  User must be connected in order to perform this action.
  The current user can not update its profile using this action.
  <a href="#updateuser">Security / updateUser</a> must be used instead.
</aside>

            <h1 id="bulk-controller">~ bulk controller</h1>

<p>A bulk import allows your application to perform multiple writing operations thanks to a single query.
This is especially useful if you want to create a large number of documents. A bulk import will be
a lot faster compared to creating them individually using <code class="prettyprint">create</code> queries.</p>

<p>For other queries, the syntax for bulk imports closely resembles the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-bulk.html">ElasticSearch Bulk API</a>.</p>

<aside class="warning">
The bulk operations only apply to the persistent data storage layer.
You <strong>won&rsquo;t receive any real-time notfications</strong> on your document subcriptions
even if some of the documents in the import match your subscription filters.
</aside>

<h2 id="import">import</h2>

<h3 id="performing-a-bulk-import-on-a-data-collection">Performing a bulk import on a data collection</h3>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_bulk</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch bulk syntax.
  "bulkData": <span class="err">[</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
    <span class="p">{</span><span class="s">"a"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">,</span> <span class="s">"with"</span><span class="o">:</span> <span class="s">"any"</span><span class="p">,</span> <span class="s">"number"</span><span class="o">:</span> <span class="s">"of fields"</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
    <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
    <span class="p">{</span><span class="s">"and"</span><span class="o">:</span> <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"one"</span><span class="p">}},</span>
    <span class="p">{</span><span class="s">"..."</span><span class="o">:</span> <span class="s">"..."</span><span class="p">}</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "bulk",
  "action": "import",

  "body": {
    <span class="o">//</span> <span class="nx">Data</span> <span class="nx">mapping</span> <span class="nx">using</span> <span class="nx">ElasticSearch</span> <span class="nx">bulk</span> <span class="nx">syntax</span><span class="p">.</span>
    <span class="s">"bulkData"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
      <span class="p">{</span><span class="s">"a"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">,</span> <span class="s">"with"</span><span class="o">:</span> <span class="s">"any"</span><span class="p">,</span> <span class="s">"number"</span><span class="o">:</span> <span class="s">"of fields"</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
      <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{}},</span>
      <span class="p">{</span><span class="s">"and"</span><span class="o">:</span> <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"one"</span><span class="p">}},</span>
      <span class="p">{</span><span class="s">"..."</span><span class="o">:</span> <span class="s">"..."</span><span class="p">}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "bulk",
  "action": "import",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">executed</span> <span class="nx">queries</span><span class="p">,</span> <span class="nx">with</span> <span class="nx">their</span> <span class="nx">status</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"create"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
          <span class="s">"status"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">HTTP</span> <span class="nx">status</span> <span class="nx">code</span><span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"create"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
          <span class="s">"status"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">HTTP</span> <span class="nx">status</span> <span class="nx">code</span><span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"create"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
          <span class="s">"status"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">HTTP</span> <span class="nx">status</span> <span class="nx">code</span><span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>You can use the <code class="prettyprint">bulk import</code> to save a list of documents in one specific <code class="prettyprint">collection</code> in a specified <code class="prettyprint">index</code>.<br>
In such case, the <code class="prettyprint">collection</code> in which the documents need to be inserted needs to be specified in the query.</p>

<h3 id="performing-a-global-bulk-import">Performing a global bulk import</h3>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_bulk</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch bulk syntax.
  "bulkData": <span class="err">[</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
    <span class="p">{</span><span class="s">"a"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">,</span> <span class="s">"with"</span><span class="o">:</span> <span class="s">"any"</span><span class="p">,</span> <span class="s">"number"</span><span class="o">:</span> <span class="s">"of fields"</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
    <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
    <span class="p">{</span><span class="s">"and"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"another"</span><span class="o">:</span> <span class="s">"one"</span><span class="p">}</span> <span class="p">},</span>
    <span class="p">...</span>
    <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"index"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;another index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;another collection&gt;"</span> <span class="p">}}}</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "bulk",
  "action": "import",

  "body": {
    <span class="o">//</span> <span class="nx">Data</span> <span class="nx">mapping</span> <span class="nx">using</span> <span class="nx">ElasticSearch</span> <span class="nx">bulk</span> <span class="nx">syntax</span><span class="p">.</span>
    <span class="s">"bulkData"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
      <span class="p">{</span><span class="s">"a"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">,</span> <span class="s">"with"</span><span class="o">:</span> <span class="s">"any"</span><span class="p">,</span> <span class="s">"number"</span><span class="o">:</span> <span class="s">"of fields"</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
      <span class="p">{</span><span class="s">"another"</span><span class="o">:</span> <span class="s">"document"</span><span class="p">},</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">}},</span>
      <span class="p">{</span><span class="s">"and"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"another"</span><span class="o">:</span> <span class="s">"one"</span><span class="p">}</span> <span class="p">},</span>
      <span class="p">...</span>
      <span class="p">{</span><span class="s">"create"</span><span class="o">:</span> <span class="p">{</span><span class="s">"index"</span><span class="o">:</span> <span class="p">{</span> <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;another index&gt;"</span><span class="p">,</span> <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;another collection&gt;"</span> <span class="p">}}}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "bulk",
  "action": "import",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">executed</span> <span class="nx">queries</span><span class="p">,</span> <span class="nx">with</span> <span class="nx">their</span> <span class="nx">status</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"create"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
          <span class="s">"status"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">HTTP</span> <span class="nx">status</span> <span class="nx">code</span><span class="o">&gt;</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"create"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="s">""</span><span class="o">&lt;</span><span class="nx">documentId</span><span class="o">&gt;</span><span class="s">",
          "</span><span class="nx">status</span><span class="s">": &lt;HTTP status code&gt;
        }
      },
      {
        "</span><span class="nx">create</span><span class="s">": {
          "</span><span class="nx">_id</span><span class="s">": "</span><span class="o">&lt;</span><span class="nx">documentId</span><span class="o">&gt;</span><span class="s">",
          "</span><span class="nx">status</span><span class="s">": &lt;HTTP status code&gt;
        }
      }
    ]
</span>  }
}
</code></pre>

<p>The <code class="prettyprint">bulk import</code> can also be used in a more versatile (yet a little more verbose) way,
to execute operations on a whole database, modifying multiple data collections in different indexes at once.<br>
The <code class="prettyprint">collections</code> to modify then need to be specified inside the query message,using the <code class="prettyprint">_type</code>argument, as specified in the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/docs-bulk.html">ElasticSearch Bluk API</a>.</p>

            <h1 id="collection-controller">~ collection controller</h1>

<h2 id="create">create</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;data&gt;/&lt;collection&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "create"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,
  "error": null,
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "create",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>When creating a document, Kuzzle will automatically create a collection if needed.
But in some cases, you may want to create an empty collection directly, prior to storing any document in it.<br>
This method does nothing if the collection already exists.</p>

<h2 id="deletespecifications">deleteSpecifications</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_specifications</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "deleteSpecifications",
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "deleteSpecifications",
  "controller": "collection",
  "result": {}
}
</code></pre>

<p>Deletes the validation specification set for the <index>/<collection>.
It responds 200 even there where no validation specification manually set before.</p>

<p><strong><em>Note:</em></strong> by default, an empty specification is implicitally applied to all collections which. In a way, &ldquo;no specification set&rdquo; means &ldquo;all documents are valid&rdquo;. This is why, using this route when no specifications have been set before, does not produce an error.</p>

<h2 id="exists">exists</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_exists</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "exists"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "exists",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": true
}
</code></pre>

<p>Checks if a collection exists in Kuzzle database storage layer.</p>

<h2 id="getmapping">getMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mapping</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "getMapping"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "getMapping",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"mainindex"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mappings"</span><span class="o">:</span> <span class="p">{</span>
        <span class="o">&lt;</span><span class="nx">collection</span><span class="o">&gt;:</span> <span class="p">{</span>

          <span class="o">//</span> <span class="nx">Data</span> <span class="nx">mapping</span> <span class="nx">using</span> <span class="nx">ElasticSearch</span> <span class="nx">mapping</span> <span class="nx">syntax</span>
          <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span><span class="na">type</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span> <span class="s">"...options..."</span> <span class="p">},</span>
            <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span><span class="na">type</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span> <span class="s">"...options..."</span> <span class="p">},</span>
            <span class="p">...</span>
            <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span><span class="na">type</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span> <span class="s">"...options..."</span> <span class="p">},</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Gets the mapping of the given <code class="prettyprint">collection</code>.</p>

<h2 id="getspecifications">getSpecifications</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_specifications</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code>  </p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "getSpecifications",
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "getSpecifications",
  "controller": "collection",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "index": "<span class="nt">&lt;index&gt;</span>",
  "result": {
    <span class="s">"collection"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
    <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
    <span class="s">"validation"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">myField</span><span class="s">": {
          "</span><span class="nx">defaultValue</span><span class="s">": 42,
          "</span><span class="nx">mandatory</span><span class="s">": true,
          "</span><span class="nx">type</span><span class="s">": "</span><span class="nx">integer</span><span class="s">"
        }
        ...
      },
      "</span><span class="nx">strict</span><span class="s">": true
    }
</span>  }
}

{
  "status": 404,                      // No validation specification has been set for this index/collection
  "error": {
<span class="s">    "</span><span class="nx">_source</span><span class="s">": {
      "</span><span class="nx">body</span><span class="s">": {}
    },
    "</span><span class="nx">message</span><span class="s">": "</span><span class="nx">Not</span> <span class="nx">Found</span><span class="s">"
</span>  },
  "action": "getSpecifications",
  "controller": "collection",
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>"
  "result": null
}
</code></pre>

<p>Allows to get the validation specifications associated to the given
index and collection if some specifications has been defined first.</p>

<h2 id="list">list</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/_list(/&lt;all|stored|realtime&gt;)[?from=0][&amp;size=42]</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "collection",
  "action": "list",
  "type": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">stored</span><span class="err">|</span><span class="na">realtime</span><span class="nt">&gt;</span>",
  // "from" and "size" argument for pagination
  "from": 0,
  "size": 42
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "collection",
  "action": "list",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"realtime_1"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"realtime"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"realtime_2"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"realtime"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"realtime_..."</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"realtime"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"realtime_n"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"realtime"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"stored_1"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"stored"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"stored_2"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"stored"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"stored_..."</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"stored"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"name"</span><span class="o">:</span> <span class="s">"stored_n"</span><span class="p">,</span> <span class="s">"type"</span><span class="o">:</span> <span class="s">"stored"</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"type"</span><span class="o">:</span> <span class="s">"all"</span>
  }
}
</code></pre>

<p>Returns the complete list of realtime and stored data collections in requested index sorted by name in alphanumerical order.<br>
The <code class="prettyprint">type</code> argument filters the returned collections. Allowed values: <code class="prettyprint">all</code>, <code class="prettyprint">stored</code> and <code class="prettyprint">realtime</code> (default : <code class="prettyprint">all</code>).<br>
The <code class="prettyprint">from</code> and <code class="prettyprint">size</code> arguments allow pagination. They are returned in the response if provided.</p>

<h2 id="searchspecifications">searchSpecifications</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_searchSpecifications</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // A set of filters or queries matching documents you are looking for.
  "query": {
    <span class="p">...</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "collection",
  "action": "searchSpecifications",
  "body": {
    <span class="o">//</span> <span class="nx">A</span> <span class="nx">set</span> <span class="k">of</span> <span class="nx">filters</span> <span class="o">or</span> <span class="nx">queries</span> <span class="nx">matching</span> <span class="nx">documents</span> <span class="nx">you</span> <span class="nx">are</span> <span class="nx">looking</span> <span class="k">for</span><span class="p">.</span>
    <span class="s">"query"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"Some"</span><span class="o">:</span> <span class="s">"filters"</span>
    <span class="p">}</span>
  },
  // "from" and "size" argument for pagination
  "from": 0,
  "size": 42
}
</code></pre>
<pre class="highlight plaintext"><code>
&gt;Response

```litcoffee
{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "collection",
  "action": "searchSpecifications",
  "metadata": {},
  "requestId": "&lt;unique request identifier&gt;",
  "result": {
    "_shards": {
        "failed": 0,
        "successful": 5,
        "total": 5
    },
    "hits": [
      {
        "_id": "myIndex#myCollection", 
        "_index": "%kuzzle", 
        "_score": 1, 
        "_source": {
          "collection": "myCollection", 
          "index": "myIndex", 
          "validation": {
            "fields": {
              "fieldName": {
                "defaultValue": "a default value", 
                "mandatory": true, 
                "multivalued": {
                  "maxCount": 5, 
                  "minCount": 1, 
                  "value": true
                }, 
                "type": "string", 
                "typeOptions": {
                  "length": {
                    "max": 12, 
                    "min": 2
                  }
                }
              }
            }, 
            "strict": true
          }
        }, 
        "_type": "validations"
      }
    ],
    "max_score": null,
    "timed_out": false,
    "took": 1,
    "total": &lt;number of results&gt;
  }
}
</code></pre>

<p>Allows to search in the persistence layer for collection specifications.</p>

<h2 id="truncate">truncate</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_truncate</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "truncate"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,
  "error": null,
  "action": "truncate",
  "controller": "collection",
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
  }
}
</code></pre>

<p>Empties a collection from all its documents, while keeping any associated mapping.<br>
It is also faster than deleting all documents from a collection using a query.</p>

<h2 id="updatemapping">updateMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mapping</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch mapping syntax
  "properties": {
    <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="p">...</span>
    <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "collection",
  "action": "updateMapping",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="p">...</span>
      <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"...options..."</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "updateMapping",
  "controller": "collection",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {}
}
</code></pre>

<p>When creating a new data <code class="prettyprint">collection</code> in the persistent data storage layer, Kuzzle uses a default mapping.</p>

<p>It means that, by default, you won&rsquo;t be able to exploit the full capabilities of our
persistent data storage layer (currently handled by <a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a>),
and your searches may suffer from below-average performances, depending on the amount of data you
stored in a collection and the complexity of your database.</p>

<p>To solve this matter, Kuzzle&rsquo;s API offers a way to create data mapping and to expose the entire
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping.html">mapping capabilities of ElasticSearch</a>.</p>

<h2 id="updatespecifications">updateSpecifications</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_specifications</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "myindex": {
    <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
        <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">field</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "collection",
  "action": "updateSpecifications",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"myindex"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
          <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">field</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }

}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "updateSpecifications",
  "controller": "collection",
  "result": {
    <span class="s">"myindex"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
          <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">field</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}

{
  "status": 400,                      // There was an error on specification
  "action": "updateSpecifications",
  "controller": "collections",
  "error": {
    <span class="s">"_source"</span><span class="o">:</span> <span class="o">//</span> <span class="p">...</span> <span class="na">given</span> <span class="nx">specifications</span><span class="p">,</span>
    <span class="s">"message"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"description"</span><span class="o">:</span> <span class="o">//</span> <span class="p">...</span><span class="na">global</span> <span class="nx">error</span> <span class="nx">description</span><span class="p">,</span>
      <span class="s">"details"</span><span class="o">:</span> <span class="o">//</span> <span class="p">...</span> <span class="na">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">detailed</span> <span class="nx">problem</span> <span class="nx">found</span><span class="p">,</span>
      <span class="s">"valid"</span><span class="o">:</span> <span class="no">false</span> <span class="o">//</span> <span class="nx">the</span> <span class="nx">specifications</span> <span class="nx">are</span> <span class="o">not</span> <span class="nx">valid</span>
    <span class="p">}</span>
  },
  "metadata": {},
  "result": {
    <span class="s">"myindex"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"myField"</span><span class="o">:</span> <span class="p">{</span>
             <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="nx">with</span> <span class="nx">an</span> <span class="nx">error</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>You can specify validation specifications in order to enforce your own rules over documents and real-time messages.
Whenever a document is stored or updated, or a message is published, Kuzzle applies these specifications to check if the new data complies to the defined rules. If not, the document or message will be rejected along with an appropriate error message.
This method allows you to specify or update the validation specifications. You can both use it to create or update validation specifications for one index/collection couple or more.
When the validation specification is not well formatted, a detailed error message is answered by Kuzzle to help you to debug.</p>

<h2 id="validatespecifications">validateSpecifications</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_validateSpecifications</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "myindex": {
    <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
      <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
        <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">field</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "admin",
  "action": "updateSpecifications",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"myindex"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mycollection"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"strict"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
          <span class="o">//</span> <span class="p">...</span> <span class="na">specification</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">field</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }

}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "updateMapping",
  "controller": "admin",
  "state": "done",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"valid"</span><span class="o">:</span> <span class="o">&lt;</span><span class="no">true</span><span class="o">|</span><span class="no">false</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s">"details"</span><span class="o">:</span> <span class="p">[</span> <span class="o">//</span> <span class="nx">it</span> <span class="nx">some</span> <span class="nx">errors</span> <span class="nx">have</span> <span class="nx">been</span> <span class="nx">found</span>
      <span class="o">//</span> <span class="nx">each</span> <span class="nx">spotted</span> <span class="nx">errors</span>
    <span class="p">],</span>
    <span class="s">"description"</span><span class="o">:</span> <span class="s">"&lt;string&gt;"</span> <span class="o">//</span> <span class="nx">global</span> <span class="nx">description</span> <span class="k">if</span> <span class="nx">validation</span> <span class="nx">fails</span>
  }
}
</code></pre>

<p>You can specify validation specifications in order to enforce your own rules over documents and real-time messages.
Whenever a document is stored or updated, or a message is published, Kuzzle applies these specifications to check if the new data complies to the defined rules. If not, the document or message will be rejected along with an appropriate error message.
This method checks if a validation specification is well-formed. It does not store nor modify in any way the existing specifications database.
When the validation specification is not well formatted, a detailed error message is answered by Kuzzle to help you to debug.</p>

            <h1 id="document-controller">~ document controller</h1>

<h2 id="count">count</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_count</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // A set of filters or queries matching documents you are looking for.
  // Use "query" instead of "filter" if you want to perform a query instead.
  "filter": {
    <span class="p">...</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "count",

  // A set of filters or queries matching documents you are looking for.
  // Use "query" instead of "filter" if you want to perform a query instead.
  "body": {
    <span class="s">"filter"</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "count",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"count"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">found</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Given some filters, gets the number of matching documents from Kuzzle&rsquo;s data storage layer.</p>

<p>Kuzzle uses the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/query-dsl.html">ElasticSearch Query DSL</a> syntax.</p>

<h2 id="create">create</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_create[?refresh=wait_for]</code> or <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;/_create[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The message to send
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "create",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "_id": "<span class="nt">&lt;documentId&gt;</span>",              // Optional. If not provided, will be generated automatically.
  "body": {
    <span class="o">//</span> <span class="nx">the</span> <span class="nb">document</span> <span class="nx">to</span> <span class="nx">create</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "create",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>            <span class="o">//</span> <span class="nx">The</span> <span class="nx">generated</span> <span class="o">or</span> <span class="nx">provided</span> <span class="nb">document</span> <span class="nx">id</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span>                     <span class="o">//</span> <span class="nx">The</span> <span class="nx">version</span> <span class="k">of</span> <span class="nx">the</span> <span class="nb">document</span> <span class="k">in</span> <span class="nx">the</span> <span class="nx">persistent</span> <span class="nx">data</span> <span class="nx">storage</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>                      <span class="o">//</span> <span class="nx">The</span> <span class="nx">created</span> <span class="nb">document</span>
      <span class="p">...</span>
    <span class="p">},</span>
  }
}
</code></pre>

<p>Creates a new document in the persistent data storage.</p>

<p>Returns an error if the document already exists.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="createorreplace">createOrReplace</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The document to update
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "createOrReplace",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "_id": "<span class="nt">&lt;documentId&gt;</span>",            // Mandatory: The document id.
  // The document itself
  "body": {
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "createOrReplace",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>                      <span class="o">//</span> <span class="nx">The</span> <span class="nx">created</span> <span class="nb">document</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">,</span>             <span class="o">//</span> <span class="nx">The</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">number</span> <span class="k">of</span> <span class="k">this</span> <span class="nb">document</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">boolean</span><span class="o">&gt;</span>              <span class="o">//</span> <span class="na">true</span><span class="o">:</span> <span class="nx">a</span> <span class="k">new</span> <span class="nb">document</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">created</span><span class="p">,</span> <span class="na">false</span><span class="o">:</span> <span class="nx">the</span> <span class="nb">document</span> <span class="nx">has</span> <span class="nx">been</span> <span class="nx">updated</span>
  }
}
</code></pre>

<p>Creates a new document in the persistent data storage, or replaces it if it already exists.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="delete">delete</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "delete",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>

  // The document id you provided or that was generated at document creation.
  // it is also the one returned during a search query.
  "_id": "<span class="nt">&lt;documentId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "delete",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span>             <span class="o">//</span> <span class="nx">The</span> <span class="nx">deleted</span> <span class="nb">document</span> <span class="nx">identifier</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">documentId</code>, deletes the corresponding document from Kuzzle&rsquo;s database.</p>

<p>Only documents in the persistent data storage layer can be deleted.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document deletion (and its unavailability in <code class="prettyprint">search</code>).</p>

<h2 id="deletebyquery">deleteByQuery</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_query</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // A set of filters or queries matching documents you are looking for.
  // Use "query" instead of "filter" if you want to perform a query instead.
  "filter": {
    <span class="p">...</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "deleteByQuery",

  // A set of filters or queries matching documents you are looking for.
  // Use "query" instead of "filter" if you want to perform a query instead.
  "body": {
    <span class="s">"filter"</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "deleteByQuery",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nb">Array</span> <span class="k">of</span> <span class="nx">strings</span> <span class="nx">listing</span> <span class="nx">the</span> <span class="nx">IDs</span> <span class="k">of</span> <span class="nx">removed</span> <span class="nx">documents</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span><span class="s">"id1"</span><span class="p">,</span> <span class="s">"id2"</span><span class="p">,</span> <span class="p">...,</span> <span class="s">"idn"</span><span class="p">]</span>
  }
}
</code></pre>

<p>Deletes all the documents matching the given filter or query from Kuzzle&rsquo;s database.</p>

<p>Kuzzle uses the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/query-dsl.html">ElasticSearch Query DSL</a> syntax.</p>

<h2 id="get">get</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "get",

  // The document id you provided or that was generated at document creation.
  // it is also the one returned during a search query.
  "_id": "<span class="nt">&lt;documentId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "get",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"first"</span><span class="o">:</span> <span class="s">"Steve"</span><span class="p">,</span>
        <span class="s">"last"</span><span class="o">:</span> <span class="s">"Wozniak"</span>
      <span class="p">},</span>
      <span class="s">"hobby"</span><span class="o">:</span> <span class="s">"Segway polo"</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">document id</code>, retrieves the corresponding document from the database.</p>

<p>Only documents in the persistent data storage layer can be retrieved.</p>

<h2 id="replace">replace</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;/_replace[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The document to update
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "replace",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  // The document itself
  "body": {
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "replace",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>                      <span class="o">//</span> <span class="nx">The</span> <span class="nx">resulting</span> <span class="nb">document</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">,</span>             <span class="o">//</span> <span class="nx">The</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">number</span> <span class="k">of</span> <span class="k">this</span> <span class="nb">document</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span>
  }
}
</code></pre>

<p>Replaces an existing document in the persistent data storage.
Only documents in the persistent data storage layer can be replaced.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="scroll">scroll</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_scroll/&lt;scrollId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The scroll parameter tells Elasticsearch to keep the search context open for another 1m.
  "scroll": "1m"
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "document",
  "action": "scroll",

  "body": {
    <span class="s">"scrollId"</span><span class="o">:</span> <span class="s">"&lt;scrollId&gt;"</span>
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">scroll</span> <span class="nx">parameter</span> <span class="nx">tells</span> <span class="nx">Elasticsearch</span> <span class="nx">to</span> <span class="nx">keep</span> <span class="nx">the</span> <span class="nx">search</span> <span class="nx">context</span> <span class="nx">open</span> <span class="k">for</span> <span class="nx">another</span> <span class="mi">1</span><span class="nx">m</span><span class="p">.</span>
    <span class="s">"scroll"</span><span class="o">:</span> <span class="s">"1m"</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "scroll",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">initial</span> <span class="nx">search</span> <span class="nx">request</span> <span class="o">and</span> <span class="nx">each</span> <span class="nx">subsequent</span> <span class="nx">scroll</span> <span class="nx">request</span> <span class="nx">returns</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">_scroll_id</span><span class="err"> </span>
    <span class="o">//</span> <span class="nx">only</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">recent</span> <span class="nx">_scroll_id</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">used</span><span class="p">.</span>
    <span class="s">"_scroll_id"</span><span class="o">:</span> <span class="s">"&lt;new scroll id&gt;"</span><span class="p">,</span>

    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">objects</span> <span class="nx">containing</span> <span class="nx">your</span> <span class="nx">retrieved</span> <span class="nx">documents</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"documentId"</span><span class="p">,</span>
        <span class="s">"_score"</span><span class="o">:</span> <span class="s">"&lt;document score&gt;"</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span> <span class="p">..</span> <span class="p">}</span>         <span class="o">//</span> <span class="nx">The</span> <span class="nx">actual</span> <span class="nb">document</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Another</span> <span class="nb">document</span><span class="p">...</span> <span class="na">and</span> <span class="nx">so</span> <span class="no">on</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">found</span> <span class="nx">documents</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s">"max_score"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"timed_out"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
    <span class="s">"took"</span><span class="o">:</span> <span class="mi">1</span>
  }
}
</code></pre>

<p>While a search request returns a single “page” of results, the scroll API can
be used to retrieve large numbers of results (or even all results) from a single
search request, in much the same way as you would use a cursor on a traditional database.</p>

<p>Scrolling is not intended for real time user requests, but rather for processing large amounts of data.</p>

<p>In order to use scrolling, the initial search request should specify the scroll parameter in the query string,
which tells Elasticsearch how long it should keep the “search context” alive.</p>

<aside class="warning">
  The results that are returned from a scroll request reflect the state of the index at the time
  that the initial search request was made, like a snapshot in time. Subsequent changes
  to documents (index, update or delete) will only affect later search requests.
</aside>

<h2 id="search">search</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_search[?from=0][&amp;size=42]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // A set of filters or queries matching documents you are looking for.
  "query": {
    <span class="p">...</span>
  },
  "aggregations": {
    <span class="p">...</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "search",

  "body": {
    <span class="o">//</span> <span class="nx">A</span> <span class="nx">set</span> <span class="k">of</span> <span class="nx">filters</span> <span class="o">or</span> <span class="nx">queries</span> <span class="nx">matching</span> <span class="nx">documents</span> <span class="nx">you</span> <span class="nx">are</span> <span class="nx">looking</span> <span class="k">for</span><span class="p">.</span>
    <span class="s">"query"</span><span class="o">:</span> <span class="p">{</span>

    <span class="p">},</span>
    <span class="s">"aggregations"</span><span class="o">:</span> <span class="p">{</span>

    <span class="p">}</span>
  },
  // "from" and "size" argument for pagination
  "from": 0,
  "size": 42
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "search",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">initial</span> <span class="nx">search</span> <span class="nx">request</span> <span class="o">and</span> <span class="nx">each</span> <span class="nx">subsequent</span> <span class="nx">scroll</span> <span class="nx">request</span> <span class="nx">returns</span> <span class="nx">a</span> <span class="k">new</span> <span class="nx">_scroll_id</span><span class="err"> </span>
    <span class="o">//</span> <span class="nx">only</span> <span class="nx">the</span> <span class="nx">most</span> <span class="nx">recent</span> <span class="nx">_scroll_id</span> <span class="nx">should</span> <span class="nx">be</span> <span class="nx">used</span><span class="p">.</span>
    <span class="s">"_scroll_id"</span><span class="o">:</span> <span class="s">"&lt;scroll id&gt;"</span><span class="p">,</span>

    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">objects</span> <span class="nx">containing</span> <span class="nx">your</span> <span class="nx">retrieved</span> <span class="nx">documents</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"documentId"</span><span class="p">,</span>
        <span class="s">"_score"</span><span class="o">:</span> <span class="s">"&lt;document score&gt;"</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>         <span class="o">//</span> <span class="nx">The</span> <span class="nx">actual</span> <span class="nb">document</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Another</span> <span class="nb">document</span><span class="p">...</span> <span class="na">and</span> <span class="nx">so</span> <span class="no">on</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"aggregations"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"aggs_name"</span><span class="o">:</span> <span class="p">{</span>

      <span class="p">}</span>
    <span class="p">}</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">found</span> <span class="nx">documents</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="s">"max_score"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"timed_out"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
    <span class="s">"took"</span><span class="o">:</span> <span class="mi">1</span>
  }
}
</code></pre>

<p>Only documents in the persistent data storage layer can be searched.</p>

<p>Kuzzle uses the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html">ElasticSearch Query DSL</a> syntax.</p>

<p><code class="prettyprint">aggregations</code> is not mandatory, see the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations.html">Elasticsearch Documentation</a>
for more details.</p>

<h2 id="mcreate">mCreate</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mCreate[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "documents": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>              <span class="o">//</span> <span class="nx">Optional</span><span class="p">.</span> <span class="na">If</span> <span class="o">not</span> <span class="nx">provided</span><span class="p">,</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">generated</span> <span class="nx">automatically</span><span class="p">.</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span>        <span class="o">//</span> <span class="nx">Optional</span><span class="p">.</span> <span class="na">If</span> <span class="o">not</span> <span class="nx">provided</span><span class="p">,</span> <span class="nx">will</span> <span class="nx">be</span> <span class="nx">generated</span> <span class="nx">automatically</span><span class="p">.</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mCreate",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "body": {
    <span class="s">"documents"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mCreate",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484225532686</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"created"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484225532686</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"created"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Other</span> <span class="nx">created</span> <span class="nx">documents</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">created</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Creates new documents in the persistent data storage.</p>

<p>Returns a partial error (with status 206) if one or more documents already exist.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="mcreateorreplace">mCreateOrReplace</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mCreateOrReplace[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "documents": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>              <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span>        <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mCreateOrReplace",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "body": {
    <span class="s">"documents"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mCreateOrReplace",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226104822</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226104822</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Other</span> <span class="nx">created</span> <span class="o">or</span> <span class="nx">replaced</span> <span class="nx">documents</span> 
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">created</span> <span class="o">or</span> <span class="nx">replaced</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Creates or replaces documents in the persistent data storage.</p>

<p>Returns a partial error (with status 206) if one or more documents can not be created or replaced.</p>

<h2 id="mdelete">mDelete</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mDelete[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "ids": <span class="p">[</span><span class="nv">"&lt;documentId&gt;", "&lt;anotherDocumentId&gt;", ...</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mDelete",
  "body": {
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;documentId&gt;"</span><span class="p">,</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span> <span class="p">...]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mDelete",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": <span class="err">[</span>
    <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<p>Deletes documents in the persistent data storage.</p>

<p>Returns a partial error (with status 206) if one or more document can not be deleted.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="mget">mGet</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mGet</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "ids": <span class="p">[</span><span class="nv">"&lt;documentId&gt;", "&lt;anotherDocumentId&gt;", ...</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mGet",
  "body": {
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;documentId&gt;"</span><span class="p">,</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span> <span class="p">...]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mGet",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226562795</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"some"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s">"found"</span><span class="o">:</span> <span class="no">true</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226562795</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"some"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s">"found"</span><span class="o">:</span> <span class="no">true</span>
      <span class="p">}</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Other</span> <span class="nx">documents</span> 
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">retrieved</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Given <code class="prettyprint">document ids</code>, retrieves the corresponding documents from the database.</p>

<p>Only documents in the persistent data storage layer can be retrieved.</p>

<h2 id="mreplace">mReplace</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mReplace[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "documents": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>              <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span>        <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mReplace",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "body": {
    <span class="s">"documents"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mReplace",
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226104822</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_kuzzle_info"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"active"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
            <span class="s">"author"</span><span class="o">:</span> <span class="s">"-1"</span><span class="p">,</span>
            <span class="s">"createdAt"</span><span class="o">:</span> <span class="mi">1484226104822</span><span class="p">,</span>
            <span class="s">"deletedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updatedAt"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
            <span class="s">"updater"</span><span class="o">:</span> <span class="no">null</span>
          <span class="p">},</span>
          <span class="s">"document"</span><span class="o">:</span> <span class="s">"body"</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Other</span> <span class="nx">replaced</span> <span class="nx">documents</span> 
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">replaced</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Replaces documents in the persistent data storage.</p>

<p>Returns a partial error (with status 206) if one or more documents can not be replaced.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="mupdate">mUpdate</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_mUpdate[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "documents": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>              <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"partial"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span>        <span class="o">//</span> <span class="nx">Mandatory</span>
      <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"partial"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "mUpdate",
  "body": {
    <span class="s">"documents"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"partial"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"body"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"partial"</span><span class="o">:</span> <span class="s">"body"</span><span class="p">,</span>
          <span class="p">...</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "action": "mUpdate",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  "controller": "document",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherDocumentId&gt;"</span><span class="p">,</span>
        <span class="s">"_index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
        <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
          <span class="s">"successful"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
          <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">},</span>
        <span class="s">"_type"</span><span class="o">:</span> <span class="s">"&lt;collection&gt;"</span><span class="p">,</span>
        <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s">"result"</span><span class="o">:</span> <span class="s">"updated"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Other</span> <span class="nx">updated</span> <span class="nx">documents</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">updated</span> <span class="nx">documents</span><span class="o">&gt;</span>
  }
}
</code></pre>

<p>Updates documents in the persistent data storage.</p>

<p>Returns a partial error (with status 206) if one or more documents can not be updated.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="update">update</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/&lt;documentId&gt;/_update[?refresh=wait_for]</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "field_to_update1": "new value",
  "field_to_update2": "new value",
  ...
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  <span class="p">[</span><span class="nv">"refresh": "wait_for",</span><span class="p">]</span>
  // The document id you provided or that was generated at document creation.
  // it is also the one returned during a search query.
  "_id": "<span class="nt">&lt;documentId&gt;</span>"

  // The actual update query
  "body": {
    <span class="s">"field_to_update1"</span><span class="o">:</span> <span class="s">"new value"</span><span class="p">,</span>
    <span class="s">"field_to_update2"</span><span class="o">:</span> <span class="s">"new value"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "document",
  "action": "update",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;documentId&gt;"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span><span class="o">&gt;</span><span class="p">,</span>             <span class="o">//</span> <span class="nx">The</span> <span class="k">new</span> <span class="nx">version</span> <span class="nx">number</span> <span class="k">of</span> <span class="k">this</span> <span class="nb">document</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span>
  }
}
</code></pre>

<p>Only documents in the persistent data storage layer can be updated.</p>

<p>Elastisearch 5.x and above only: The optional parameter <code class="prettyprint">refresh</code> can be used
with the value <code class="prettyprint">wait_for</code> in order to wait for the document indexation (indexed documents are available for <code class="prettyprint">search</code>).</p>

<h2 id="validate">validate</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_validate</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">message</span> <span class="nx">to</span> <span class="nx">send</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  index: "<span class="nt">&lt;index&gt;</span>",
  collection: "<span class="nt">&lt;collection&gt;</span>",
  controller: "document",
  action: "validate",
  // The document itself
  body: {
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  status: 200,                      // Assuming everything went well
  error: null,                      // Assuming everything went well
  index: "<span class="nt">&lt;index&gt;</span>",
  collection: "<span class="nt">&lt;collection&gt;</span>",
  controller: "document",
  action: "validate",
  metadata: {},
  result: {
    <span class="na">errorMessages</span><span class="o">:</span> <span class="p">{},</span>              <span class="o">//</span> <span class="nx">There</span> <span class="o">is</span> <span class="no">no</span> <span class="nx">error</span> <span class="nx">messages</span>
    <span class="na">valid</span><span class="o">:</span> <span class="no">true</span>                     <span class="o">//</span> <span class="nx">The</span> <span class="nb">document</span> <span class="nx">complies</span> <span class="nx">with</span> <span class="nx">validation</span> <span class="nx">specifications</span>
  }  
}
</code></pre>

<p>Validates data against existing validation rules. The data is not published nor stored by Kuzzle
If the document complies, the <code class="prettyprint">result.valid</code> value is <code class="prettyprint">true</code>, if not, it is <code class="prettyprint">false</code>.
When the document does not complies, both <code class="prettyprint">result.errorMessages</code> contains some very detailed hints on what is wrong with the document.
Note that if no validation specifications are set for the &lt;data index&gt;/&lt;data collection&gt;, the document always validate.
In any ways, the document is <strong>not</strong> stored nor published.</p>

            <h1 id="index-controller">~ index controller</h1>

<h2 id="create">create</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "create"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "action": "create",
  "controller": "index",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>When creating a document or a collection, Kuzzle will automatically create a data index if needed.
But in some cases, you may want to create an empty index directly, prior to storing any document in it.</p>

<p>Create an <code class="prettyprint">index</code> in Kuzzle&rsquo;s persistent storage layer.</p>

<h2 id="delete">delete</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "delete"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "delete",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>Deletes an entire <code class="prettyprint">index</code> from Kuzzle&rsquo;s persistent storage layer.</p>

<h2 id="exists">exists</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/_exists</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "exists"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "exists",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": true
}
</code></pre>

<p>Checks if the given index exists in Kuzzle storage layer.</p>

<h2 id="getautorefresh">getAutoRefresh</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/_autoRefresh</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "getAutoRefresh"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "getAutoRefresh",
  "result":  true|false             // The autoRefresh status for <span class="nt">&lt;index&gt;</span>
}
</code></pre>

<p>The <code class="prettyprint">autoRefresh</code> flag, when set to true, will make Kuzzle perform a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a> request
immediately after each write request, forcing the documents to be immediately visible to search.</p>

<p>The <code class="prettyprint">getAutoRefresh</code> actions returns the current <code class="prettyprint">autoRefresh</code> status for the given index.</p>

<aside class="left warning">
  <p>
    A refresh operation comes with some performance costs.
  </p>
  <p>
    While forcing the autoRefresh can be convenient on a development or test environmnent, it is advised to avoid
    using it on production or at least to carefully monitor its implications before using it.
  </p>
</aside>

<h2 id="list">list</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_list</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "index",
  "action": "list"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "index",
  "action": "list",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"total"</span><span class="o">:</span> <span class="mi">13</span><span class="p">,</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="s">"index_1"</span><span class="p">,</span>
      <span class="s">"index_2"</span><span class="p">,</span>
      <span class="s">"index_..."</span><span class="p">,</span>
      <span class="s">"index_n"</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>Returns the complete data indexes.</p>

<h2 id="mdelete">mDelete</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_mDelete</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight plaintext"><code>indexes: [
  "index1",
  "index2",
  ...
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "index",
  "action": "mDelete",
  "body": {
    <span class="s">"indexes"</span><span class="o">:</span> <span class="p">[</span>
      <span class="s">"index1"</span><span class="p">,</span>
      <span class="s">"index2"</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "mDelete",
  "controller": "index",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {  // list of actual deleted indexes
    <span class="s">"deleted"</span><span class="o">:</span><span class="p">[</span>
      <span class="s">"index1"</span><span class="p">,</span>
      <span class="s">"index2"</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>Deletes all <code class="prettyprint">indexes</code> specified in the body, that current user is allowed to delete, from Kuzzle&rsquo;s persistent storage layer.</p>

<p>If no <code class="prettyprint">indexes</code> is specified in the body, all the indexes that the current user is allowed to delete will be deleted.</p>

<p>That means: if Kuzzle contains indexes &ldquo;index1&rdquo;, &ldquo;index2&rdquo; and &ldquo;index3&rdquo;,
but current user is only allowed to delete &ldquo;index1&rdquo; and &ldquo;index2&rdquo;, only both of them are deleted,
and &ldquo;index3&rdquo; is kept in the persistent storage layer.</p>

<p>The response contains the list of indexes that were actually deleted.</p>

<h2 id="refresh">refresh</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/_refresh</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "refresh"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "refresh",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
        <span class="s">"succressful"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s">"total"</span><span class="o">:</span> <span class="mi">10</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>When writing or deleting documents in Kuzzle&rsquo;s database layer, the update needs to be indexed before being reflected
in the search index.
By default, this operation can take up to 1 second.</p>

<p>Given an index, the <code class="prettyprint">refresh</code> action forces a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a>,
on it, making the documents visible to search immediately.</p>

<aside class="left warning">
  <p>
    A refresh operation comes with some performance costs.<br>
  </p>
  <p>
    From <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api">
    Elasticsearch documentation</a>:
    <div class="quote">
      &ldquo;While a refresh is much lighter than a commit, it still has a performance cost.
      A manual refresh can be useful when writing tests, but don’t do a manual refresh every time
      you index a document in production; it will hurt your performance. Instead, your application
      needs to be aware of the near real-time nature of Elasticsearch and make allowances for it.&rdquo;
    </div>
  </p>
</aside>

<h2 id="refreshinternal">refreshInternal</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_refreshInternal</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "index",
  "action": "refreshInternal"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "index",
  "action": "refreshInternal",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>When writing or deleting security and internal documents (users, roles, profiles, configuration, etc.)
in Kuzzle&rsquo;s database layer, the update needs to be indexed before being reflected in the search index.
By default, this operation can take up to 1 second.</p>

<p>Given an index, the <code class="prettyprint">refreshInternal</code> action forces a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a>,
on the internal index, making the documents visible to search immediately.</p>

<aside class="left warning">
  <p>
    A refresh operation comes with some performance costs.<br>
  </p>
  <p>
    From <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api">
    Elasticsearch documentation</a>:
    <div class="quote">
      &ldquo;While a refresh is much lighter than a commit, it still has a performance cost.
      A manual refresh can be useful when writing tests, but don’t do a manual refresh every time
      you index a document in production; it will hurt your performance. Instead, your application
      needs to be aware of the near real-time nature of Elasticsearch and make allowances for it.&rdquo;
    </div>
  </p>
</aside>

<h2 id="setautorefresh">setAutoRefresh</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/_autoRefresh</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code></p>

<p>Query</p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "autoRefresh": true|false
}
</code></pre>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "setAutoRefresh",
  "body": {
    <span class="s">"autoRefresh"</span><span class="o">:</span> <span class="no">true</span><span class="o">|</span><span class="no">false</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "controller": "index",
  "action": "setAutoRefresh",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": true|false                // The autoRefresh status set for the index
}
</code></pre>

<p>The <code class="prettyprint">autoRefresh</code> flag, when set to true, will make Kuzzle perform a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a> request
immediately after each write request, forcing the documents to be immediately visible to search.</p>

<p>Given an index, the <code class="prettyprint">setAutoRefresh</code> action updates its <code class="prettyprint">autoRefresh</code> status.</p>

<aside class="left warning">
  <p>
    A refresh operation comes with some performance costs.
  </p>
  <p>
    While forcing the autoRefresh can be convenient on a development or test environmnent, it is advised to avoid
    using it on production or at least to carefully monitor its implications before using it.
  </p>
</aside>

            <h1 id="memorystorage-controller">~ memoryStorage controller</h1>

<h2 id="description">Description</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/ms/_ping</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "action": "ping",
  "controller": "ms",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,
  "error": null,
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "ms",
  "action": "ping",
  "metadata": {},
  "result": "PONG"
}
</code></pre>

<p>Kuzzle&rsquo;s memory storage is a separate data store from the database layer.
It is internaly based on Redis. You can access most of Redis functions (all lowercased), except:</p>

<ul>
<li>all cluster based functions</li>
<li>all script based functions</li>
<li>all cursors functions</li>
</ul>

<p>Here is the list of non implemented commands:</p>

<p><code class="prettyprint">client</code>
<code class="prettyprint">cluster</code>
<code class="prettyprint">config</code>
<code class="prettyprint">debug</code>
<code class="prettyprint">echo</code>
<code class="prettyprint">eval</code>
<code class="prettyprint">evalsha</code>
<code class="prettyprint">flushall</code>
<code class="prettyprint">migrate</code>
<code class="prettyprint">monitor</code>
<code class="prettyprint">move</code>
<code class="prettyprint">psubscribe</code>
<code class="prettyprint">pubsub</code>
<code class="prettyprint">punsubscribe</code>
<code class="prettyprint">quit</code>
<code class="prettyprint">readonly</code>
<code class="prettyprint">readwrite</code>
<code class="prettyprint">role</code>
<code class="prettyprint">script</code>
<code class="prettyprint">select</code>
<code class="prettyprint">shutdown</code>
<code class="prettyprint">slaveof</code>
<code class="prettyprint">slowlog</code>
<code class="prettyprint">subscribe</code>
<code class="prettyprint">sync</code>
<code class="prettyprint">unsubscribe</code>
<code class="prettyprint">scan</code>
<code class="prettyprint">sscan</code>
<code class="prettyprint">hscan</code>
<code class="prettyprint">zscan</code></p>

<p>You can find a list of all redis command at: <a href="http://redis.io/commands">http://redis.io/commands</a></p>

            <h1 id="realtime-controller">~ realtime controller</h1>

<h2 id="count">count</h2>

<section class="http"></section>

<blockquote>
<p>Due to the synchronous nature of the HTTP protocol, real-time messaging is not supported.</p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "count",
  "body": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"unique room ID"</span>
  },
  "metadata": {
    <span class="o">//</span> <span class="nx">query</span> <span class="nx">metadata</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Response</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "count",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span><span class="p">,</span>
    <span class="s">"count"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">number</span> <span class="k">of</span> <span class="nx">subscriptions</span><span class="o">&gt;</span><span class="p">,</span>
  }
}
</code></pre>

<p>Returns the number of people/applications who have subscribed to the same documents as you have.</p>

<p>The expected parameter is the roomId returned by Kuzzle during the subscription.</p>

<h2 id="join">join</h2>

<section class="http"></section>

<blockquote>
<p>Due to the synchronous nature of the HTTP protocol, real-time messaging is not supported.</p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "join",
  "body": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;the room identifier to join&gt;"</span>
  },
  "metadata": {
    <span class="o">//</span> <span class="nx">query</span> <span class="nx">metadata</span>
  },
  "scope": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">in</span><span class="err">|</span><span class="na">out</span><span class="err">|</span><span class="na">none</span><span class="nt">&gt;</span>",
  "state": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">pending</span><span class="err">|</span><span class="na">done</span><span class="nt">&gt;</span>",
  "users": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">in</span><span class="err">|</span><span class="na">out</span><span class="err">|</span><span class="na">none</span><span class="nt">&gt;</span>"
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Response</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "subscribe",
  "metadata": {},                     // subscription metadata
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span>
  }
}
</code></pre>

<p>Joins a previously created subscription.</p>

<p>The <code class="prettyprint">roomId</code> parameter is returned by Kuzzle when <a href="#subscribe">subscribing</a> to some documents.</p>

<h2 id="list">list</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_listSubscriptions</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "realtime",
  "action": "list"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "error": null,
  "status": 200,
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "publish",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"&lt;index&gt;"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"&lt;collection&gt;"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"afcd909773f197ab859447594bfbd154"</span><span class="o">:</span> <span class="mi">12</span><span class="p">,</span>
        <span class="s">"4adbc1948ac4dc84ac89d14b488bcad1"</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">},</span>
      <span class="s">"&lt;anotherCollection&gt;"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"bcd4ab54cdb4ad5b464ba4cd4564dc46"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">...</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"&lt;anotherIndex&gt;"</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="p">...</span>
  },
}
</code></pre>

<p>Lists all subscriptions on all indexes and all collections.</p>

<h2 id="publish">publish</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_publish</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The message to send
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "publish",
  // The document itself
  "body": {
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "error": null,
  "status": 200,
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "publish",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {}
}
</code></pre>

<p>Sends a real-time message to Kuzzle. The message will be dispatched to all the clients
who have subscribed to a subscription for which the filters match the message content.</p>

<aside class="warning">
  The message is **not** persisted in the database.
</aside>

<h2 id="subscribe">subscribe</h2>

<section class="http"></section>

<blockquote>
<p>Due to the synchronous nature of the HTTP protocol, real-time messaging is not supported.</p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "subscribe",
  "body": {
    <span class="o">//</span> <span class="nx">subscription</span> <span class="nx">filters</span>
  },
  "metadata": {
    <span class="o">//</span> <span class="nx">query</span> <span class="nx">metadata</span>
  },

  /<span class="err">*</span>
<span class="p">   *</span> The "scope" argument filters document modifications when a change has been
<span class="p">   *</span> detected in the database.
<span class="p">   *</span> You may receive notifications only when documents enter your
<span class="p">   *</span> scope (scope: "in"), when documents leave it (scope: "out"), or
<span class="p">   *</span> both (scope: "all")
<span class="p">   *</span>
<span class="p">   *</span> You may also filter out all these notifications (scope = "none")
<span class="p">   *</span>
<span class="p">   *</span> Default: scope: "all"
   <span class="err">*</span>/
  "scope": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">in</span><span class="err">|</span><span class="na">out</span><span class="err">|</span><span class="na">none</span><span class="nt">&gt;</span>",

  /<span class="err">*</span>
<span class="p">   *</span> The "state" argument filters document notifications depending on their state.
<span class="p">   *</span> This does not affect pub/sub messages or user events.
<span class="p">   *</span>
<span class="p">   *</span> You may choose to only receive document notifications when a change has
<span class="p">   *</span> been detected in the database (state = "done"), when a document is
<span class="p">   *</span> about to be changed (state: "pending"), or both (state: "all")
<span class="p">   *</span>
<span class="p">   *</span> Default: "done"
   <span class="err">*</span>/
  "state": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">pending</span><span class="err">|</span><span class="na">done</span><span class="nt">&gt;</span>",

  /<span class="err">*</span>
<span class="p">   *</span> User events are notification sent when users enter or leave the room you
<span class="p">   *</span> subscribed to.
<span class="p">   *</span>
<span class="p">   *</span> You may choose to receive notifications when users enter the
<span class="p">   *</span> room (users: "in"), when they leave the room (users: "out"), or
<span class="p">   *</span> both (users: "all")
<span class="p">   *</span>
<span class="p">   *</span> Default: "none"
   <span class="err">*</span>/
  "users": "<span class="nt">&lt;all</span><span class="err">|</span><span class="na">in</span><span class="err">|</span><span class="na">out</span><span class="err">|</span><span class="na">none</span><span class="nt">&gt;</span>"
}
</code></pre>

<section class="others"></section>

<aside class="right notice">
  If an empty body is provided, the subscription is performed on the whole collection.
</aside>

<section class="others"></section>

<blockquote>
<p>Response</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "realtime",
  "action": "subscribe",
  "metadata": {},                     // subscription metadata
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span><span class="p">,</span>
    <span class="s">"channel"</span><span class="o">:</span> <span class="s">"&lt;unique channel identifier&gt;"</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Websocket</p>
</blockquote>

<section class="others"></section>
<pre class="highlight html"><code><span class="nt">&lt;script&gt;</span>
  <span class="kd">var</span>
    <span class="nx">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">"ws://localhost:7513"</span><span class="p">),</span>
    <span class="nx">channel</span><span class="p">;</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">payload</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">payload</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">room</span> <span class="o">===</span> <span class="s2">"mySubscription"</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">channel</span> <span class="o">=</span> <span class="nx">response</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">room</span> <span class="o">===</span> <span class="nx">channel</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Received a notification: "</span><span class="p">,</span> <span class="nx">response</span><span class="p">);</span>

      <span class="cm">/*
      {
        "status": 200,
        "error": null,
        "index": "index",
        "collection":"collection",
        "controller": "realtime",
        "action": "publish",
        "state": "done",
        "scope": "in",
        "requestId": "&lt;unique request identifier&gt;",
        "result":{
          "roomId":"632682a9eac95cfb95e3a697b29b7739",
          "requestId":"mySubscription",
          "timestamp":1449564937142
        }
      }
      */</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">socket</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">socket</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
      <span class="s2">"requestId"</span><span class="p">:</span> <span class="s2">"mySubscription"</span><span class="p">,</span>
      <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
      <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
      <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
      <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"subscribe"</span><span class="p">,</span>
      <span class="s2">"body"</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">}));</span>
  <span class="p">};</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<section class="others"></section>

<blockquote>
<p>Socket.io</p>
</blockquote>

<section class="others"></section>
<pre class="highlight html"><code>/*
  Using socket.io
 */
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.socket.io/socket.io-1.4.5.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">socket</span> <span class="o">=</span> <span class="nx">io</span><span class="p">(</span><span class="s2">"http://localhost:7512"</span><span class="p">);</span>

    <span class="nx">socket</span><span class="p">.</span><span class="nx">once</span><span class="p">(</span><span class="s2">"mySubscription"</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>

      <span class="cm">/*
      {
        "error": null,
        "status": 200,
        "index": "&lt;index&gt;",
        "collection": "&lt;collection&gt;"
        "controller": "realtime",
        "action": "subscribe",
        "state": "done",
        "metadata": {},
        "result": {
          "roomId": "632682a9eac95cfb95e3a697b29b7739",
          "requestId": "mySubscription",
          "timestamp": 1449564937142
        }
      }
      */</span>
    <span class="p">});</span>

    <span class="nx">socket</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s2">"kuzzle"</span><span class="p">,</span> <span class="p">{</span>
      <span class="s2">"requestId"</span><span class="p">:</span> <span class="s2">"mySubscription"</span><span class="p">,</span>
      <span class="s2">"index"</span><span class="p">:</span> <span class="s2">"index"</span><span class="p">,</span>
      <span class="s2">"collection"</span><span class="p">:</span> <span class="s2">"collection"</span><span class="p">,</span>
      <span class="s2">"controller"</span><span class="p">:</span> <span class="s2">"realtime"</span><span class="p">,</span>
      <span class="s2">"action"</span><span class="p">:</span> <span class="s2">"subscribe"</span><span class="p">,</span>
      <span class="s2">"body"</span><span class="p">:</span> <span class="p">{}</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre>

<p>Subscription works differently in Kuzzle than with a regular publish/subscribe protocol.
In Kuzzle, you don&rsquo;t exactly subscribe to a room or to a topic but, instead, you subscribe to documents.</p>

<p>What it means is that, along with your subscription query, you also give to Kuzzle a set of document or message filters.
Of course, you may also subscribe to a <code class="prettyprint">data collection</code> with no other matching criteria,
and you&rsquo;ll effectively listen to a &ldquo;topic&rdquo;.</p>

<p>Once you have subscribed to a room, depending on your filters, you may receive the following notifications:</p>

<ul>
<li>whenever a pub/sub message is published matching your criteria (realtime)</li>
<li>whenever a matching document is about to be created or deleted (realtime)</li>
<li>whenever a matching stored document is created, updated or deleted (once the change is effective in the database)</li>
<li>whenever a user enters or leaves the room</li>
</ul>

<p>Good news is, you may ask Kuzzle to send only the notifications relevant to your application,
by configuring your subscription request (see below).
You can also subscribe multiple times to the same room, with different configurations.
Kuzzle will provide you with a channel for each of these subscriptions,
allowing different part of your application to concentrate on what it needs to process.</p>

<p>The matching criteria you pass on to Kuzzle are based upon <a href="./filters.md">Kuzzle DSL</a></p>

<p>How subscription works:</p>

<ul>
<li>=&gt; You send a subscription query to Kuzzle</li>
<li>&lt;= Kuzzle responds to you with a <code class="prettyprint">roomId</code> and a <code class="prettyprint">channel</code></li>
<li>=&gt; You listen to the <code class="prettyprint">channel</code> provided in the response</li>
<li>&lt;= Kuzzle forwards the corresponding <a href="/#notifications">notifications</a> on that channel</li>
</ul>

<h2 id="unsubscribe">unsubscribe</h2>

<section class="http"></section>

<blockquote>
<p>Due to the synchronous nature of the HTTP protocol, real-time messaging is not supported.</p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "index": "<span class="nt">&lt;data</span> <span class="na">index</span><span class="nt">&gt;</span>",
  "collection": "<span class="nt">&lt;data</span> <span class="na">collection</span><span class="nt">&gt;</span>",
  "controller": "realtime",
  "action": "unsubscribe",

  "body": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique room ID&gt;"</span>
  },
  "metadata": {
    <span class="o">//</span> <span class="nx">query</span> <span class="nx">metadata</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Response</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                        // Assuming everything went well
  "error": null,                        // Assuming everything went well
  "index": "<span class="nt">&lt;data</span> <span class="na">index</span><span class="nt">&gt;</span>",
  "collection": "<span class="nt">&lt;data</span> <span class="na">collection</span><span class="nt">&gt;</span>",
  "controller": "realtime",
  "action": "unsubscribe",
  "metadata": {},                       // subscription metadata
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"roomId"</span><span class="o">:</span> <span class="s">"&lt;unique Kuzzle room identifier&gt;"</span>
  }
}
</code></pre>

<p>Instructs Kuzzle to detach you from its subscribers for the given room.
In practice, your subscription won&rsquo;t receive any new message on the room once this action is triggered.</p>

<p>The expected parameter is the <code class="prettyprint">roomId</code> that Kuzzle returned during the subscription.</p>

<h2 id="validate">validate</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;index&gt;/&lt;collection&gt;/_validate</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
    <span class="o">//</span> <span class="nx">The</span> <span class="nx">message</span> <span class="nx">to</span> <span class="nx">send</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  index: "<span class="nt">&lt;index&gt;</span>",
  collection: "<span class="nt">&lt;collection&gt;</span>",
  controller: "realtime",
  action: "validate",
  // The document itself
  body: {
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  status: 200,                      // Assuming everything went well
  error: null,                      // Assuming everything went well
  index: "<span class="nt">&lt;index&gt;</span>",
  collection: "<span class="nt">&lt;collection&gt;</span>",
  controller: "realtime",
  action: "validate",
  metadata: {},
  result: {
    <span class="na">errorMessages</span><span class="o">:</span> <span class="p">{},</span>              <span class="o">//</span> <span class="nx">There</span> <span class="o">is</span> <span class="no">no</span> <span class="nx">error</span> <span class="nx">messages</span>
    <span class="na">valid</span><span class="o">:</span> <span class="no">true</span>                     <span class="o">//</span> <span class="nx">The</span> <span class="nb">document</span> <span class="nx">complies</span> <span class="nx">with</span> <span class="nx">validation</span> <span class="nx">specifications</span>
  }  
}
</code></pre>

<p>Validates data against existing validation rules. The data is not published nor stored by Kuzzle
If the document complies, the <code class="prettyprint">result.valid</code> value is <code class="prettyprint">true</code>, if not, it is <code class="prettyprint">false</code>.
When the document does not complies, both <code class="prettyprint">result.errorMessages</code> contains some very detailed hints on what is wrong with the document.
Note that if no validation specifications are set for the &lt;data index&gt;/&lt;data collection&gt;, the document always validate.
In any ways, the document is <strong>not</strong> stored nor published.</p>

            <h1 id="security-controller">~ security controller</h1>

<h2 id="createfirstadmin">createFirstAdmin</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/&lt;userId&gt;/_createFirstAdmin[?reset=1]</code> or <code class="prettyprint">http://kuzzle:7511/_createFirstAdmin[?reset=1]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "name": "John Doe",                     // Additional optional User properties
  ...
}

// example with a "local" authentication

{
  "name": "John Doe",                     // Additional optional User properties
  ...
  "password": "MyPassword"                // ie: Mandatory for "local" authentication plugin
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createFirstAdmin",
  "reset": true|false,                    // Optional. Will reset the preset roles if set to true.
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.

  "body": {
    <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>       <span class="o">//</span> <span class="nx">Mandatory</span><span class="p">.</span> <span class="na">The</span> <span class="nx">profile</span> <span class="nx">ids</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">user</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
  }
}

// example with a "local" authentication

{
  "controller": "security",
  "action": "createFirstAdmin",
  "reset": true|false,                    // Optional. Will reset the preset roles if set to true.
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.

  "body": {
    <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>        <span class="o">//</span> <span class="nx">Mandatory</span><span class="p">.</span> <span class="na">The</span> <span class="nx">profile</span> <span class="nx">ids</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">user</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
    <span class="s">"password"</span><span class="o">:</span> <span class="s">"MyPassword"</span>              <span class="o">//</span> <span class="na">ie</span><span class="o">:</span> <span class="nx">Mandatory</span> <span class="k">for</span> <span class="s">"local"</span> <span class="nx">authentication</span> <span class="nx">plugin</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "security",
  "action": "createFirstAdmin",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;user id, either provided or auto-generated&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>
      <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span>
        <span class="s">"admin"</span>
      <span class="p">],</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Creates the first admin <code class="prettyprint">user</code> in Kuzzle&rsquo;s database layer. Does nothing if an admin user already exists.</p>

<p>If an <code class="prettyprint">_id</code> is provided in the query and if a <code class="prettyprint">user</code> already exists with the given <code class="prettyprint">_id</code>,
it will be replaced and its <code class="prettyprint">profileIds</code> will be set to <code class="prettyprint">[&quot;admin&quot;]</code>. If not provided, the <code class="prettyprint">_id</code> will be auto-generated.</p>

<p>If the optional field <code class="prettyprint">reset</code> is set to <code class="prettyprint">true</code> (<code class="prettyprint">1</code> with http),
the preset roles (<code class="prettyprint">anonymous</code> and <code class="prettyprint">default</code>) will be reset with more restrictive rights.</p>

<p>Other mandatory additional information are needed depending on the authentication plugins installed you want to use.</p>

<h2 id="createorreplaceprofile">createOrReplaceProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/&lt;profileId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The new array of role IDs and restrictions (cannot be empty)
  "roles": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;anotherRoleId&gt;"</span><span class="p">,</span>
      <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
          <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
            <span class="s">"&lt;coll2&gt;"</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createOrReplaceProfile",
  "_id": "<span class="nt">&lt;profileId&gt;</span>",

  // the profile definition
  "body": {
    <span class="o">//</span> <span class="nx">The</span> <span class="k">new</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">role</span> <span class="nx">IDs</span> <span class="o">and</span> <span class="nx">restrictions</span> <span class="p">(</span><span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">empty</span><span class="p">)</span>
    <span class="s">"roles"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
        <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
            <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
              <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
              <span class="s">"&lt;coll2&gt;"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"profiles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "security",
  "action": "createOrReplaceProfile",
  "metadata": {}
}
</code></pre>

<p>Creates (if no <code class="prettyprint">_id</code> provided) or updates (if <code class="prettyprint">_id</code> matches an existing one) a profile with a new list of roles.</p>

<h2 id="createorreplacerole">createOrReplaceRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/&lt;roleId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controllers": {
    <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createOrReplaceRole",
  "_id": "<span class="nt">&lt;roleId&gt;</span>",

  // the role definition
  "body": {
    <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                     // Assuming everything went well
  "error": null,                     // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"roles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span> <span class="o">//</span> <span class="nx">your</span> <span class="nx">role</span> <span class="nx">definition</span>
      <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "security",
  "action": "createOrReplaceRole",
  "metadata": {},
}
</code></pre>

<p>Validates and stores a role in Kuzzle&rsquo;s persistent data storage.</p>

<p>The body content needs to match Kuzzle&rsquo;s role definition.
To get some more detailed information on the expected role definition,
please refer to <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/security/roles-reference.md">Kuzzle&rsquo;s role reference definition documentation</a>.</p>

<p>To get some more detailed information about Kuzzle&rsquo;s user management model,
please refer to <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/security/">Kuzzle&rsquo;s security documentation</a>.</p>

<h2 id="createorreplaceuser">createOrReplaceUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "profileIds": <span class="p">[</span><span class="nv">"&lt;profileId&gt;", "anotherProfileId", "..."</span><span class="p">]</span> // Mandatory. The profile ids for the user
  "name": "John Doe",                                      // Additional optional User properties
  ...
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createOrReplaceUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",
  "body": {
    <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">,</span> <span class="s">"anotherProfileId"</span><span class="p">,</span> <span class="s">"..."</span><span class="p">]</span> <span class="o">//</span> <span class="nx">Mandatory</span><span class="p">.</span> <span class="na">The</span> <span class="nx">profile</span> <span class="nx">ids</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">user</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                                      <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "users",
  "controller": "security",
  "action": "createOrReplaceUser",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">,</span> <span class="s">"anotherProfileId"</span><span class="p">,</span> <span class="s">"..."</span><span class="p">],</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"users"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>Persists a <code class="prettyprint">user</code> object to Kuzzle&rsquo;s database layer.</p>

<p>The <code class="prettyprint">user</code> is created if it does not exists yet or replaced with the given object if it does.</p>

<h2 id="createprofile">createProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/&lt;profileId&gt;/_create</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // The new array of role IDs and restrictions (cannot be empty)
  "policies": <span class="err">[</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
      <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
          <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
            <span class="s">"&lt;coll2&gt;"</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">},</span>
    <span class="p">...</span>
  ]
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createProfile",
  "_id": "<span class="nt">&lt;profileId&gt;</span>",

  // the profile definition
  "body": {
    <span class="o">//</span> <span class="nx">The</span> <span class="k">new</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">role</span> <span class="nx">IDs</span> <span class="o">and</span> <span class="nx">restrictions</span> <span class="p">(</span><span class="nx">cannot</span> <span class="nx">be</span> <span class="nx">empty</span><span class="p">)</span>
    <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
        <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
            <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
              <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
              <span class="s">"&lt;coll2&gt;"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"profiles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{}</span> <span class="o">//</span> <span class="nx">your</span> <span class="nx">profile</span> <span class="nx">definition</span>
  },
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "security",
  "action": "createProfile",
  "metadata": {},
}
</code></pre>

<p>Creates a profile with a new list of roles.</p>

<p><strong>Note:</strong> The <code class="prettyprint">_id</code> parameter is mandatory.</p>

<h2 id="createrole">createRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/&lt;roleId&gt;/_create</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controllers": {
    <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createRole",
  "_id": "<span class="nt">&lt;roleId&gt;</span>",

  // the role definition
  "body": {
    <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"roles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span> <span class="o">//</span> <span class="nx">your</span> <span class="nx">role</span> <span class="nx">definition</span>
      <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "controller": "security",
  "action": "createRole",
  "metadata": {},
}
</code></pre>

<p>Validates and stores a role in Kuzzle&rsquo;s persistent data storage.
<strong>Note:</strong> The <code class="prettyprint">_id</code> parameter is mandatory.</p>

<p>The body content needs to match Kuzzle&rsquo;s role definition.
To get some more detailed information on the expected role definition,
please refer to <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/security/roles-reference.md">Kuzzle&rsquo;s role reference definition documentation</a>.</p>

<p>To get some more detailed information about Kuzzle&rsquo;s user management model,
please refer to <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/security/">Kuzzle&rsquo;s security documentation</a>.</p>

<h2 id="createuser">createUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;/_create</code> or <code class="prettyprint">http://kuzzle:7511/users/_create</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "profileIds": <span class="p">[</span><span class="nv">"&lt;profileId&gt;"</span><span class="p">]</span>,          // Mandatory. The profile ids for the user
  "name": "John Doe",                     // Additional optional User properties
  ...
}

// example with a "local" authentication

{
  "profileIds": <span class="p">[</span><span class="nv">"&lt;profileId&gt;"</span><span class="p">]</span>,          // Mandatory. The profile ids for the user
  "name": "John Doe",                     // Additional optional User properties
  ...
  "password": "MyPassword"                // ie: Mandatory for "local" authentication plugin
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.

  "body": {
    <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>        <span class="o">//</span> <span class="nx">Mandatory</span><span class="p">.</span> <span class="na">The</span> <span class="nx">profile</span> <span class="nx">ids</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">user</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
  }
}

// example with a "local" authentication

{
  "controller": "security",
  "action": "createUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.

  "body": {
    <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>        <span class="o">//</span> <span class="nx">Mandatory</span><span class="p">.</span> <span class="na">The</span> <span class="nx">profile</span> <span class="nx">ids</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">user</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
    <span class="s">"password"</span><span class="o">:</span> <span class="s">"MyPassword"</span>              <span class="o">//</span> <span class="na">ie</span><span class="o">:</span> <span class="nx">Mandatory</span> <span class="k">for</span> <span class="s">"local"</span> <span class="nx">authentication</span> <span class="nx">plugin</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "users",
  "controller": "security",
  "action": "createUser",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;user id, either provided or auto-generated&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"users"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>Creates a new <code class="prettyprint">user</code> in Kuzzle&rsquo;s database layer.</p>

<p>If an <code class="prettyprint">_id</code> is provided in the query and if a <code class="prettyprint">user</code> already exists with the given <code class="prettyprint">_id</code>, an error is returned.
If not provided, the <code class="prettyprint">_id</code> will be auto-generated.</p>

<p>Provided profile ids are used to set the permissions of the user.</p>

<p>Other mandatory additional information are needed depending on the authentication plugins installed you want to use.</p>

<h2 id="createrestricteduser">createRestrictedUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;/_createRestricted</code> or <code class="prettyprint">http://kuzzle:7511/users/_createRestricted</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "name": "John Doe",                     // Additional optional User properties
  ...
}

// example with a "local" authentication

{
  "name": "John Doe",                     // Additional optional User properties
  ...
  "password": "MyPassword"                // ie: Mandatory for "local" authentication plugin
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "createRestrictedUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.
  "body": {
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
  }
}

// example with a "local" authentication

{
  "controller": "security",
  "action": "createRestrictedUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",                      // Optional. If not provided, will be generated automatically.
  "body": {
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>                   <span class="o">//</span> <span class="nx">Additional</span> <span class="nx">optional</span> <span class="nx">User</span> <span class="nx">properties</span>
    <span class="p">...</span>
    <span class="s">"password"</span><span class="o">:</span> <span class="s">"MyPassword"</span>              <span class="o">//</span> <span class="na">ie</span><span class="o">:</span> <span class="nx">Mandatory</span> <span class="k">for</span> <span class="s">"local"</span> <span class="nx">authentication</span> <span class="nx">plugin</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "users",
  "controller": "security",
  "action": "createRestrictedUser",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">[</span><span class="s">"&lt;profileId&gt;"</span><span class="p">],</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="s">"John Doe"</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"users"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"created"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>Creates a new <code class="prettyprint">user</code> in Kuzzle&rsquo;s database layer.</p>

<p>If an <code class="prettyprint">_id</code> is provided in the query and if a <code class="prettyprint">user</code> already exists with the given <code class="prettyprint">_id</code>, an error is returned.
If not provided, the <code class="prettyprint">_id</code> will be auto-generated.</p>

<p>Profile ids are set accordingly to the Kuzzle configuration.
This route is especially useful to allow anonymous users to create a user.</p>

<p>Other mandatory additional information are needed depending on the authentication plugins installed you want to use.</p>

<h2 id="deleteprofile">deleteProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_profiles/&lt;profileId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "deleteProfile",

  // The profile unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a profile.
  "_id": "<span class="nt">&lt;profileId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>             <span class="o">//</span> <span class="nx">The</span> <span class="nx">profile</span> <span class="nx">id</span>
  },
  "index": "%kuzzle",
  "collection": "profiles",
  "action": "deleteProfile",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>"
}
</code></pre>

<p>Given a <code class="prettyprint">profile id</code>, deletes the corresponding profile from the database. Note
that the related roles will NOT be deleted.</p>

<h2 id="deleterole">deleteRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/&lt;roleId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "deleteRole",

  // The role unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a role.
  "_id": "<span class="nt">&lt;roleId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>                 <span class="o">//</span> <span class="nx">The</span> <span class="nx">role</span> <span class="nx">id</span>
  }
  "index": "%kuzzle",
  "collection": "roles"
  "action": "deleteRole",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>"
}
</code></pre>

<p>Given a <code class="prettyprint">role id</code>, deletes the corresponding role from the database.</p>

<h2 id="deleteuser">deleteUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">DELETE</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "deleteUser",

  // The role unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a role.
  "_id": "<span class="nt">&lt;roleId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>                 <span class="o">//</span> <span class="nx">The</span> <span class="nx">role</span> <span class="nx">id</span>
  }
  "index": "%kuzzle",
  "collection": "users",
  "action": "deleteUser",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>"
}
</code></pre>

<p>Given a <code class="prettyprint">user id</code>, deletes the corresponding <code class="prettyprint">user</code> from Kuzzle&rsquo;s database layer.</p>

<h2 id="getprofile">getProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_profiles/&lt;profileId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getProfile",

  // The profile unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a profile.
  "_id": "<span class="nt">&lt;profileId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>             <span class="o">//</span> <span class="nx">The</span> <span class="nx">profile</span> <span class="nx">id</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>                      <span class="o">//</span> <span class="nx">The</span> <span class="nx">requested</span> <span class="nx">profile</span>
      <span class="p">...</span>
    <span class="p">},</span>
    <span class="s">"index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"collection"</span><span class="o">:</span> <span class="s">"profiles"</span>
    <span class="s">"action"</span><span class="o">:</span> <span class="s">"getProfile"</span><span class="p">,</span>
    <span class="s">"controller"</span><span class="o">:</span> <span class="s">"security"</span><span class="p">,</span>
    <span class="s">"requestId"</span><span class="o">:</span> <span class="s">"&lt;unique request identifier&gt;"</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">profile id</code>, retrieves the corresponding profile from the database.</p>

<h2 id="getprofilemapping">getProfileMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/_mapping</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getProfileMapping"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "security",
  "action": "getProfileMapping",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"mapping"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"policies"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"_id"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
          <span class="p">},</span>
          <span class="s">"allowInternalIndex"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"boolean"</span>
          <span class="p">},</span>
          <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"collections"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span><span class="p">,</span>
                <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span><span class="p">,</span>
                    <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="s">"index"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span><span class="p">,</span>
                <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span><span class="p">,</span>
                    <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="s">"roleId"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span><span class="p">,</span>
            <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span><span class="p">,</span>
                <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Gets the mapping of the internal <code class="prettyprint">profiles</code> collection.</p>

<h2 id="getprofilerights">getProfileRights</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_profiles/&lt;profileId&gt;/_rights</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getProfileRights",

  // The profile unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a profile.
  "_id": "<span class="nt">&lt;profileId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">objects</span> <span class="nx">containing</span> <span class="nx">the</span> <span class="nx">profile</span> <span class="nx">rights</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"controller"</span><span class="o">:</span> <span class="s">"&lt;ctrl_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"action"</span><span class="o">:</span> <span class="s">"&lt;action_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"collection"</span><span class="o">:</span> <span class="s">"&lt;collection_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"value"</span><span class="o">:</span> <span class="s">"&lt;allowed|denied|conditional&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Another</span> <span class="nx">rights</span> <span class="nx">item</span><span class="p">...</span> <span class="na">and</span> <span class="nx">so</span> <span class="no">on</span>
      <span class="p">}</span>
    <span class="p">],</span>
}
</code></pre>

<p>Given a <code class="prettyprint">profile id</code>, retrieves the corresponding rights.</p>

<h2 id="getrole">getRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/&lt;role id&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getRole",

  // The role unique identifier. It's the same one that Kuzzle sends you
  // in its responses when you create a role.
  "_id": "<span class="nt">&lt;roleId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>                <span class="o">//</span> <span class="nx">The</span> <span class="nx">role</span> <span class="nx">id</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"indexes"</span><span class="o">:</span> <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">}</span>
  },
  "index": "%kuzzle",
  "collection": "roles"
  "action": "getRole",
  "controller": "security",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>"
}
</code></pre>

<p>Given a <code class="prettyprint">role id</code>, retrieves the corresponding role from the database.</p>

<h2 id="getrolemapping">getRoleMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/_mapping</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getRoleMapping"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "security",
  "action": "getRoleMapping",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"mapping"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"object"</span><span class="p">,</span>
        <span class="s">"enabled"</span><span class="o">:</span> <span class="no">false</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Gets the mapping of the internal <code class="prettyprint">roles</code> collection.</p>

<h2 id="getuser">getUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "collection": "<span class="nt">&lt;collection&gt;</span>",
  "controller": "security",
  "action": "getUser",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"profileId"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>
      <span class="p">...</span>                             <span class="o">//</span> <span class="nx">The</span> <span class="nx">user</span> <span class="nx">object</span> <span class="nx">content</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">user id</code>, gets the matching user from Kuzzle&rsquo;s dabatase layer.</p>

<h2 id="getusermapping">getUserMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_mapping</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getUserMapping"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "security",
  "action": "getUserMapping",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"mapping"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"hobby"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span><span class="p">,</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span>
      <span class="p">},</span>
      <span class="s">"name"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"first"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span>
          <span class="p">},</span>
          <span class="s">"last"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span>
          <span class="p">},</span>
          <span class="s">"real"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"fields"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"keyword"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"ignore_above"</span><span class="o">:</span> <span class="mi">256</span><span class="p">,</span>
                <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"type"</span><span class="o">:</span> <span class="s">"text"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"password"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"index"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
      <span class="p">},</span>
      <span class="s">"profileIds"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"keyword"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Gets the mapping of the internal <code class="prettyprint">users</code> collection.</p>

<h2 id="getuserrights">getUserRights</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_users/&lt;userId&gt;/_rights</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "getUserRights",
  "_id": "<span class="nt">&lt;userId&gt;</span>"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result": {
    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">objects</span> <span class="nx">containing</span> <span class="nx">the</span> <span class="nx">user</span> <span class="nx">rights</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"controller"</span><span class="o">:</span> <span class="s">"&lt;ctrl_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"action"</span><span class="o">:</span> <span class="s">"&lt;action_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"collection"</span><span class="o">:</span> <span class="s">"&lt;collection_name|*&gt;"</span><span class="p">,</span>
        <span class="s">"value"</span><span class="o">:</span> <span class="s">"&lt;allowed|denied|conditional&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="o">//</span> <span class="nx">Another</span> <span class="nx">rights</span> <span class="nx">item</span><span class="p">...</span> <span class="na">and</span> <span class="nx">so</span> <span class="no">on</span>
      <span class="p">}</span>
    <span class="p">],</span>
}
</code></pre>

<p>Given a <code class="prettyprint">user id</code>, gets the matching user&rsquo;s rights from Kuzzle&rsquo;s dabatase layer.</p>

<h2 id="mdeleteprofile">mDeleteProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/_mdelete</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // ids must be an array of profile ids
  "ids": <span class="p">[</span><span class="nv">"myFirstProfile", "mySecondProfile"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "mDeleteProfile",
  "body": {
    <span class="o">//</span> <span class="nx">ids</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">profile</span> <span class="nx">ids</span>
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myFirstProfile"</span><span class="p">,</span> <span class="s">"mySecondProfile"</span><span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "mDeleteProfile",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": <span class="err">[</span>
    <span class="s">"myFirstProfile"</span><span class="p">,</span>
    <span class="s">"mySecondProfile"</span>
  ]
}
</code></pre>

<p>Deletes a list of <code class="prettyprint">profile</code> objects from Kuzzle&rsquo;s database layer given a list of profile ids.</p>

<h2 id="mdeleterole">mDeleteRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/_mdelete</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // ids must be an array of profile ids
  "ids": <span class="p">[</span><span class="nv">"myFirstRole", "mySecondRole"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "mDeleteRole",
  "body": {
    <span class="o">//</span> <span class="nx">ids</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">profile</span> <span class="nx">ids</span>
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myFirstRole"</span><span class="p">,</span> <span class="s">"mySecondRole"</span><span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "mDeleteRole",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": <span class="err">[</span>
    <span class="s">"myFirstRole"</span><span class="p">,</span>
    <span class="s">"mySecondRole"</span>
  ]
}
</code></pre>

<p>Deletes a list of <code class="prettyprint">roles</code> objects from Kuzzle&rsquo;s database layer given a list of role ids.</p>

<h2 id="mdeleteuser">mDeleteUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_mdelete</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // ids must be an array of profile ids
  "ids": <span class="p">[</span><span class="nv">"myFirstUserId", "mySecondUserId"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "mDeleteRole",
  "body": {
    <span class="o">//</span> <span class="nx">ids</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">profile</span> <span class="nx">ids</span>
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myFirstUserId"</span><span class="p">,</span> <span class="s">"mySecondUserId"</span><span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "mDeleteRole",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": <span class="err">[</span>
    <span class="s">"myFirstUserId"</span><span class="p">,</span>
    <span class="s">"mySecondUserId"</span>
   ]
  }
}
</code></pre>

<p>Deletes a list of <code class="prettyprint">users</code> objects from Kuzzle&rsquo;s database layer given a list of user ids.</p>

<h2 id="mgetprofiles">mGetProfiles</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/_mGet</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // ids must be an array of profile ids
  "ids": <span class="p">[</span><span class="nv">"myFirstProfile", "MySecondProfile"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "mGetProfiles",
  "body": {
    <span class="o">//</span> <span class="nx">ids</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">profile</span> <span class="nx">ids</span>
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myFirstProfile"</span><span class="p">,</span> <span class="s">"MySecondProfile"</span><span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "profiles"
  "action": "mGetProfiles",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
      <span class="p">...</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Retrieves a list of <code class="prettyprint">profile</code> objects from Kuzzle&rsquo;s database layer given a list of profile ids.</p>

<h2 id="mgetroles">mGetRoles</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/_mGet</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // ids must be an array of role id
  "ids": <span class="p">[</span><span class="nv">"myFirstRole", "MySecondRole"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="websocket"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "mGetRoles",
  "body": {
    <span class="o">//</span> <span class="nx">ids</span> <span class="nx">must</span> <span class="nx">be</span> <span class="nx">an</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">role</span> <span class="nx">id</span>
    <span class="s">"ids"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myFirstRole"</span><span class="p">,</span> <span class="s">"MySecondRole"</span><span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "action": "mGetRoles",
  "collection": "roles",
  "controller": "security",
  "error": null,
  "index": "%kuzzle",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result":
  {
     <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
       <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
       <span class="s">"successful"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
       <span class="s">"total"</span><span class="o">:</span> <span class="mi">5</span>
     <span class="p">},</span>
     <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
       <span class="p">{</span>
         <span class="s">"_id"</span><span class="o">:</span> <span class="s">"test"</span><span class="p">,</span>
         <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
         <span class="s">"_score"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
           <span class="s">"_id"</span><span class="o">:</span> <span class="s">"test"</span><span class="p">,</span>
           <span class="s">"indexes"</span><span class="o">:</span> <span class="p">{}</span> <span class="o">//</span> <span class="nx">Rights</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">indexes</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">,</span> <span class="p">...</span> <span class="na">can</span> <span class="nx">be</span> <span class="nx">found</span> <span class="nx">here</span>
         <span class="p">},</span>
         <span class="s">"_type"</span><span class="o">:</span> <span class="s">"roles"</span>
       <span class="p">}</span>
     <span class="p">],</span>
     <span class="s">"max_score"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
     <span class="s">"timed_out"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
     <span class="s">"took"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">"total"</span><span class="o">:</span> <span class="mi">1</span>
  },
  "status": 200
}
</code></pre>

<p>Retrieves a list of <code class="prettyprint">role</code> objects from Kuzzle&rsquo;s database layer given a list of role ids.</p>

<h2 id="searchprofiles">searchProfiles</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/_search[?from=0][&amp;size=42]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // A roles array containing a list of role IDs can be added
  "policies":  <span class="err">[</span>
    <span class="s">"myrole"</span><span class="p">,</span>
    <span class="s">"admin"</span>
  ],
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "searchProfiles",
  "body": {
    <span class="o">//</span> <span class="nx">A</span> <span class="nx">roles</span> <span class="nx">array</span> <span class="nx">containing</span> <span class="nx">a</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">role</span> <span class="nx">IDs</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">added</span>
    <span class="s">"policies"</span><span class="o">:</span>  <span class="p">[</span>
      <span class="s">"myrole"</span><span class="p">,</span>
      <span class="s">"admin"</span>
    <span class="p">]</span>
  },
  // filter can handle pagination using the from and size properties
  "from": 0,
  "size": 42
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "result":
  {
    <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
      <span class="s">"successful"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
      <span class="s">"total"</span><span class="o">:</span> <span class="mi">5</span>
    <span class="p">},</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"my-profile-1"</span><span class="p">,</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"_id"</span><span class="o">:</span> <span class="s">"myroleId"</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"my-profile-2"</span><span class="p">,</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"_id"</span><span class="o">:</span> <span class="s">"myroleId"</span>
          <span class="p">]</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">],</span>
    <span class="s">"max_score"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"timed_out"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
    <span class="s">"took"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">"total"</span><span class="o">:</span> <span class="mi">2</span>
    <span class="p">},</span>
    <span class="s">"index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"collection"</span><span class="o">:</span> <span class="s">"profiles"</span>
    <span class="s">"action"</span><span class="o">:</span> <span class="s">"searchProfiles"</span><span class="p">,</span>
    <span class="s">"controller"</span><span class="o">:</span> <span class="s">"security"</span><span class="p">,</span>
    <span class="s">"requestId"</span><span class="o">:</span> <span class="s">"&lt;unique request identifier&gt;"</span>
  }
}
</code></pre>

<p>Retrieves profiles referring to a given set of roles in their policies.</p>

<p>Attribute <code class="prettyprint">policies</code> in body is optional.</p>

<p>The <code class="prettyprint">from</code> and <code class="prettyprint">size</code> arguments allow pagination.</p>

<p>Available filters:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">policies</code></td>
<td>array</td>
<td>Contains an array <code class="prettyprint">policies</code> with a list of role ids</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h2 id="searchroles">searchRoles</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/_search[?from=0][&amp;size=42]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // indexes must be an array of index
  "indexes": <span class="p">[</span><span class="nv">"myindex"</span><span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "searchRoles",
  "body": {
    <span class="s">"indexes"</span><span class="o">:</span> <span class="p">[</span><span class="s">"myindex"</span><span class="p">],</span>
    <span class="o">//</span> <span class="s">"from"</span> <span class="o">and</span> <span class="s">"size"</span> <span class="nx">argument</span> <span class="k">for</span> <span class="nx">pagination</span>
    <span class="s">"from"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s">"size"</span><span class="o">:</span> <span class="mi">10</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "action": "searchRoles",
  "collection": "roles",
  "controller": "security",
  "error": null,
  "index": ""%kuzzle",
  "metadata": {},
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result":
  {
     <span class="s">"_shards"</span><span class="o">:</span> <span class="p">{</span>
       <span class="s">"failed"</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
       <span class="s">"successful"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
       <span class="s">"total"</span><span class="o">:</span> <span class="mi">5</span>
     <span class="p">},</span>
     <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
       <span class="p">{</span>
         <span class="s">"_id"</span><span class="o">:</span> <span class="s">"test"</span><span class="p">,</span>
         <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
         <span class="s">"_score"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
         <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span>
           <span class="s">"_id"</span><span class="o">:</span> <span class="s">"test"</span><span class="p">,</span>
           <span class="s">"indexes"</span><span class="o">:</span> <span class="p">{}</span> <span class="o">//</span> <span class="nx">Rights</span> <span class="k">for</span> <span class="nx">each</span> <span class="nx">indexes</span><span class="p">,</span> <span class="nx">controllers</span><span class="p">,</span> <span class="p">...</span> <span class="na">can</span> <span class="nx">be</span> <span class="nx">found</span> <span class="nx">here</span>
         <span class="p">},</span>
         <span class="s">"_type"</span><span class="o">:</span> <span class="s">"roles"</span>
       <span class="p">}</span>
     <span class="p">],</span>
     <span class="s">"max_score"</span><span class="o">:</span> <span class="no">null</span><span class="p">,</span>
     <span class="s">"timed_out"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
     <span class="s">"took"</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
     <span class="s">"total"</span><span class="o">:</span> <span class="mi">1</span>
  },
  "status": 200
}
</code></pre>

<p>Retrieves all roles with rights defined for given <code class="prettyprint">indexes</code>.</p>

<p>Attribute <code class="prettyprint">indexes</code> in body is optional.</p>

<p>The <code class="prettyprint">from</code> and <code class="prettyprint">size</code> arguments allow pagination.</p>

<p>Available filters:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">indexes</code></td>
<td>array</td>
<td>List of indexes id related to the searched role</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h2 id="searchusers">searchUsers</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_search[?from=0][&amp;size=42]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "filter": {
    <span class="s">"and"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"in"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"profileId"</span><span class="o">:</span> <span class="p">[</span><span class="s">"anonymous"</span><span class="p">,</span> <span class="s">"default"</span><span class="p">],</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"geo_distance"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"distance"</span><span class="o">:</span> <span class="s">"10km"</span><span class="p">,</span>
          <span class="s">"pos"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"lat"</span><span class="o">:</span> <span class="s">"48.8566140"</span><span class="p">,</span>
            <span class="s">"lon"</span><span class="o">:</span> <span class="s">"2.352222"</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "searchUsers",
  "body": {
    <span class="s">"filter"</span><span class="o">:</span> <span class="p">{</span> <span class="o">//</span> <span class="nx">If</span> <span class="nx">empty</span> <span class="o">or</span> <span class="nx">missing</span><span class="p">,</span> <span class="nx">Kuzzle</span> <span class="nx">will</span> <span class="k">return</span> <span class="nx">all</span> <span class="nx">users</span><span class="p">.</span>
      <span class="s">"and"</span><span class="o">:</span> <span class="p">[</span>
        <span class="p">{</span>
          <span class="s">"in"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"profileId"</span><span class="o">:</span> <span class="p">[</span>
              <span class="s">"anonymous"</span><span class="p">,</span>
              <span class="s">"default"</span>
            <span class="p">],</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s">"geo_distance"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"distance"</span><span class="o">:</span> <span class="s">"10km"</span><span class="p">,</span>
            <span class="s">"pos"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"lat"</span><span class="o">:</span> <span class="s">"48.8566140"</span><span class="p">,</span>
              <span class="s">"lon"</span><span class="o">:</span> <span class="s">"2.352222"</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">]</span>
    <span class="p">}</span>
  },
  // "from" and "size" argument for pagination
  "from": 0,
  "size": 10
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "users",
  "action": "search",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"total"</span><span class="o">:</span> <span class="o">&lt;</span><span class="nx">total</span> <span class="nx">number</span> <span class="k">of</span> <span class="nx">users</span> <span class="nx">matching</span> <span class="nx">the</span> <span class="nx">filter</span><span class="o">&gt;</span><span class="p">,</span>
    <span class="o">//</span> <span class="nx">An</span> <span class="nx">array</span> <span class="k">of</span> <span class="nx">user</span> <span class="nx">objects</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
        <span class="s">"_source"</span><span class="o">:</span> <span class="p">{</span> <span class="p">...</span> <span class="p">}</span>             <span class="o">//</span> <span class="nx">The</span> <span class="nx">user</span> <span class="nx">object</span> <span class="nx">content</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="p">...</span>
      <span class="p">}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>Retrieves all the users matching the given filter.</p>

<p>The <code class="prettyprint">from</code> and <code class="prettyprint">size</code> arguments allow pagination.</p>

<h2 id="updateprofile">updateProfile</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/&lt;profile id&gt;/_update</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
    <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
        <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
            <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
              <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
              <span class="s">"&lt;coll2&gt;"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateProfile",
  "_id": "<span class="nt">&lt;profileId&gt;</span>",
  "body": {
    <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
        <span class="s">"restrictedTo"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span>
          <span class="p">},</span>
          <span class="p">{</span>
            <span class="s">"index"</span><span class="o">:</span> <span class="s">"&lt;index&gt;"</span><span class="p">,</span>
            <span class="s">"collections"</span><span class="o">:</span> <span class="p">[</span>
              <span class="s">"&lt;coll1&gt;"</span><span class="p">,</span>
              <span class="s">"&lt;coll2&gt;"</span>
            <span class="p">]</span>
          <span class="p">}</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "profiles",
  "action": "updateProfile",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;profileId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"profiles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">profile id</code>, updates the matching Profile object in Kuzzle&rsquo;s database layer.</p>

<h2 id="updateprofilemapping">updateProfileMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/profiles/_mapping</code>
<strong>Method:</strong> <code class="prettyprint">PUT</code>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch mapping syntax
  "properties": {
    <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="p">...</span>
    <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateProfileMapping",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="p">...</span>
      <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "updateProfileMapping",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  },
}
</code></pre>

<p>At the first initialization, Kuzzle defines a default mapping for the <code class="prettyprint">profiles</code> internal collection in the persistent data storage layer.</p>

<p>This mapping is intended to store the basic information of a profile; typically, its policies (roles and restrictions).</p>

<p>But if you want to store more information about your users, Kuzzle&rsquo;s API offers a way to update the <code class="prettyprint">profiles</code> data mapping using the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping.html">mapping capabilities of ElasticSearch</a>.</p>

<h2 id="updaterole">updateRole</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/&lt;roleId&gt;/_update</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controllers": {
    <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateRole",
  "_id": "<span class="nt">&lt;roleId&gt;</span>",
  "body": {
    <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "roles",
  "action": "updateRole",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;roleId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"roles"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">role id</code>, updates the matching Role object in Kuzzle&rsquo;s database layer.</p>

<p>The body content needs to match Kuzzle&rsquo;s role definition.</p>

<aside class="warning">
Unlike a regular document update, this method will replace the whole role definition by the body content.<br>
In other words, you always need to provide the complete role definition in the body.
</aside>

<p>To get some more detailed information on the expected role definition, please refer to
<a href="https://github.com/kuzzleio/kuzzle/blob/beta/docs/security/roles-reference.md">Kuzzle&rsquo;s role reference definition documentation</a>.</p>

<p>To get some more detailed information about Kuzzle&rsquo;s user management model,
please refer to <a href="https://github.com/kuzzleio/kuzzle/blob/master/docs/security/">Kuzzle&rsquo;s security documentation</a>.</p>

<h2 id="updaterolemapping">updateRoleMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/roles/_mapping</code>
<strong>Method:</strong> <code class="prettyprint">PUT</code>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch mapping syntax
  "properties": {
    <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="p">...</span>
    <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateRoleMapping",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="p">...</span>
      <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "updateRoleMapping",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  },
}
</code></pre>

<p>At the first initialization, Kuzzle defines a default mapping for the <code class="prettyprint">roles</code> internal collection in the persistent data storage layer.</p>

<p>This mapping is intended to store the basic information of a role; typically, its allowed controllers and actions.</p>

<p>But if you want to store more information about your users, Kuzzle&rsquo;s API offers a way to update the <code class="prettyprint">roles</code> data mapping using the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping.html">mapping capabilities of ElasticSearch</a>.</p>

<h2 id="updateuser">updateUser</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/&lt;userId&gt;/_update</code><br>
<strong>Method:</strong> <code class="prettyprint">PUT</code><br>
<strong>Body</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
    <span class="s">"foo"</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">,</span>                    <span class="o">//</span> <span class="nx">Some</span> <span class="nx">properties</span> <span class="nx">to</span> <span class="nx">update</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"Walter Smith"</span><span class="p">,</span>
    <span class="p">...</span>
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateUser",
  "_id": "<span class="nt">&lt;userId&gt;</span>",
  "body": {
    <span class="s">"foo"</span><span class="o">:</span> <span class="s">"bar"</span><span class="p">,</span>                    <span class="o">//</span> <span class="nx">Some</span> <span class="nx">properties</span> <span class="nx">to</span> <span class="nx">update</span>
    <span class="s">"name"</span><span class="o">:</span> <span class="s">"Walter Smith"</span><span class="p">,</span>
    <span class="p">...</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "%kuzzle",
  "collection": "users",
  "action": "updateUser",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"_id"</span><span class="o">:</span> <span class="s">"&lt;userId&gt;"</span><span class="p">,</span>
    <span class="s">"_index"</span><span class="o">:</span> <span class="s">"%kuzzle"</span><span class="p">,</span>
    <span class="s">"_type"</span><span class="o">:</span> <span class="s">"users"</span><span class="p">,</span>
    <span class="s">"_version"</span><span class="o">:</span> <span class="mi">2</span>
  }
}
</code></pre>

<p>Given a <code class="prettyprint">user id</code>, updates the matching User object in Kuzzle&rsquo;s database layer.</p>

<h2 id="updateusermapping">updateUserMapping</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/users/_mapping</code>
<strong>Method:</strong> <code class="prettyprint">PUT</code>
<strong>Body:</strong></p>
</blockquote>

<section class="http"></section>
<pre class="highlight literate_coffeescript"><code>{
  // Data mapping using ElasticSearch mapping syntax
  "properties": {
    <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">},</span>
    <span class="p">...</span>
    <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
      <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
    <span class="p">}</span>
  }
}
</code></pre>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "security",
  "action": "updateUserMapping",

  // Data mapping using ElasticSearch mapping syntax
  "body": {
    <span class="s">"properties"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"field1"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="s">"field2"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">},</span>
      <span class="p">...</span>
      <span class="s">"fieldn"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="o">:</span> <span class="s">"field type"</span><span class="p">,</span>
        <span class="s">"other"</span><span class="o">:</span> <span class="s">"...options..."</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "updateUserMapping",
  "controller": "security",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"acknowledged"</span><span class="o">:</span> <span class="no">true</span>
  },
}
</code></pre>

<p>At the first initialization, Kuzzle defines a default mapping for the <code class="prettyprint">users</code> internal collection in the persistent data storage layer.</p>

<p>This mapping is intended to store the basic information of a user; typically, its credentials and profiles.</p>

<p>But if you want to store more information about your users, Kuzzle&rsquo;s API offers a way to update the <code class="prettyprint">users</code> data mapping using the
<a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.3/mapping.html">mapping capabilities of ElasticSearch</a>.</p>

            <h1 id="server-controller">~ server controller</h1>

<h2 id="adminexists">adminExists</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_adminExists</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "adminExists"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "index": "<span class="nt">&lt;index&gt;</span>",
  "action": "adminExists",
  "controller": "server",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"exists"</span><span class="o">:</span> <span class="no">true</span>
  }
}
</code></pre>

<p>Checks if an administrator account has been created, and return a boolean as a result.</p>

<h2 id="getallstats">getAllStats</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_getAllStats</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "getAllStats"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "getAllStats",
  "controller": "server",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"total"</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"completedRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">148</span><span class="p">,</span>
          <span class="s">"http"</span><span class="o">:</span> <span class="mi">24</span><span class="p">,</span>
          <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">78</span>
        <span class="p">},</span>
        <span class="s">"failedRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">3</span>
        <span class="p">},</span>
        <span class="s">"ongoingRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
          <span class="s">"http"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">}</span>
        <span class="s">"connections"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">13</span>
        <span class="p">},</span>
        <span class="s">"timestamp"</span><span class="o">:</span> <span class="s">"1453110641308"</span>
      <span class="p">},</span>
      <span class="p">...</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>Kuzzle monitors its internal activities and make snapshots regularly. This command allows getting all the stored statistics.
By default, snapshots are made every 10s, and these snapshots are stored for 1hr.</p>

<p>These statistics include:</p>

<ul>
<li>the number of connected users per protocol for the ones which allow to get this information (websocket, udp, &hellip;)</li>
<li>the number of ongoing requests</li>
<li>the number of completed requests since the last frame</li>
<li>the number of failed requests since the last frame</li>
</ul>

<p>Statistics are returned as a JSON-object with each key being the snapshot&rsquo;s timestamp (utc, in milliseconds).</p>

<h2 id="getconfig">getConfig</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_getConfig</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "getConfig"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "getConfig",
  "controller": "server",
  "result": {
    <span class="s">"kuzzle"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"_"</span><span class="o">:</span> <span class="p">[</span>
        <span class="s">"start"</span>
      <span class="p">],</span>
      <span class="s">"dump"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"dateFormat"</span><span class="o">:</span> <span class="s">"YYYYMMDD-HHmm"</span><span class="p">,</span>
        <span class="s">"enabled"</span><span class="o">:</span> <span class="no">false</span><span class="p">,</span>
        <span class="s">"gcore"</span><span class="o">:</span> <span class="s">"gcore"</span><span class="p">,</span>
        <span class="s">"handledErrors"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"enabled"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
          <span class="s">"whitelist"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"RangeError"</span><span class="p">,</span>
            <span class="s">"TypeError"</span><span class="p">,</span>
            <span class="s">"KuzzleError"</span><span class="p">,</span>
            <span class="s">"InternalError"</span><span class="p">,</span>
            <span class="s">"PluginImplementationError"</span>
          <span class="p">]</span>
        <span class="p">},</span>
        <span class="s">"path"</span><span class="o">:</span> <span class="s">"./dump/"</span>
      <span class="p">},</span>
      <span class="s">"http"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"accessControlAllowOrigin"</span><span class="o">:</span> <span class="s">"*"</span><span class="p">,</span>
        <span class="s">"routes"</span><span class="o">:</span> <span class="p">[</span>
          <span class="p">{</span>
            <span class="s">"action"</span><span class="o">:</span> <span class="s">"exists"</span><span class="p">,</span>
            <span class="s">"controller"</span><span class="o">:</span> <span class="s">"collection"</span><span class="p">,</span>
            <span class="s">"url"</span><span class="o">:</span> <span class="s">"/:index/:collection/_exists"</span><span class="p">,</span>
            <span class="s">"verb"</span><span class="o">:</span> <span class="s">"get"</span>
          <span class="p">},</span>
          <span class="o">/*</span>
           <span class="o">*</span> <span class="p">...</span> <span class="na">A</span> <span class="nx">long</span> <span class="nx">list</span> <span class="k">of</span> <span class="nx">http</span> <span class="nx">routes</span> <span class="p">...</span>
           <span class="o">*/</span>
        <span class="p">]</span>
      <span class="p">},</span>
      <span class="s">"plugins"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"common"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"object"</span><span class="o">:</span> <span class="p">{},</span>
          <span class="s">"pipeTimeout"</span><span class="o">:</span> <span class="mi">250</span><span class="p">,</span>
          <span class="s">"pipeWarnTime"</span><span class="o">:</span> <span class="mi">40</span><span class="p">,</span>
          <span class="s">"workerPrefix"</span><span class="o">:</span> <span class="s">"kpw:"</span>
        <span class="p">},</span>
        <span class="s">"kuzzle-plugin-auth-passport-local"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"activated"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
          <span class="s">"config"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"algorithm"</span><span class="o">:</span> <span class="s">"sha1"</span><span class="p">,</span>
            <span class="s">"digest"</span><span class="o">:</span> <span class="s">"hex"</span><span class="p">,</span>
            <span class="s">"secret"</span><span class="o">:</span> <span class="s">"changeme"</span>
          <span class="p">},</span>
          <span class="s">"object"</span><span class="o">:</span> <span class="p">{},</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"3.0.2"</span>
        <span class="p">},</span>
        <span class="s">"kuzzle-plugin-logger"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"activated"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
          <span class="s">"config"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"services"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"file"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"addDate"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                <span class="s">"outputs"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"error"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"filename"</span><span class="o">:</span> <span class="s">"kuzzle.log"</span><span class="p">,</span>
                    <span class="s">"level"</span><span class="o">:</span> <span class="s">"warn"</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="s">"stdout"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"level"</span><span class="o">:</span> <span class="s">"info"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"threads"</span><span class="o">:</span> <span class="mi">2</span>
          <span class="p">},</span>
          <span class="s">"object"</span><span class="o">:</span> <span class="p">{},</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"2.0.5"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"queues"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"cliQueue"</span><span class="o">:</span> <span class="s">"cli-queue"</span>
      <span class="p">},</span>
      <span class="s">"repositories"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"common"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"cacheTTL"</span><span class="o">:</span> <span class="mi">1440</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"security"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"default"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"role"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">"jwt"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"algorithm"</span><span class="o">:</span> <span class="s">"HS256"</span><span class="p">,</span>
          <span class="s">"expiresIn"</span><span class="o">:</span> <span class="s">"1h"</span><span class="p">,</span>
          <span class="s">"secret"</span><span class="o">:</span> <span class="s">"Kuzzle rocks"</span>
        <span class="p">},</span>
        <span class="s">"restrictedProfileIds"</span><span class="o">:</span> <span class="p">[</span>
          <span class="s">"default"</span>
        <span class="p">],</span>
        <span class="s">"standard"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"profiles"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"admin"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="s">"allowInternalIndex"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                  <span class="s">"roleId"</span><span class="o">:</span> <span class="s">"admin"</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">},</span>
            <span class="s">"anonymous"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="s">"roleId"</span><span class="o">:</span> <span class="s">"anonymous"</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">},</span>
            <span class="s">"default"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"policies"</span><span class="o">:</span> <span class="p">[</span>
                <span class="p">{</span>
                  <span class="s">"roleId"</span><span class="o">:</span> <span class="s">"default"</span>
                <span class="p">}</span>
              <span class="p">]</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="s">"roles"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"admin"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"*"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"*"</span><span class="o">:</span> <span class="no">true</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"anonymous"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"auth"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"checkToken"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"getCurrentUser"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"getMyRights"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"login"</span><span class="o">:</span> <span class="no">true</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="s">"server"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"info"</span><span class="o">:</span> <span class="no">true</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"default"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"controllers"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"auth"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"checkToken"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"getCurrentUser"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"getMyRights"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"logout"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                    <span class="s">"updateSelf"</span><span class="o">:</span> <span class="no">true</span>
                  <span class="p">}</span>
                <span class="p">},</span>
                <span class="s">"server"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"actions"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"info"</span><span class="o">:</span> <span class="no">true</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"server"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"maxConcurrentRequests"</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s">"maxRequestHistorySize"</span><span class="o">:</span> <span class="mi">50</span><span class="p">,</span>
        <span class="s">"maxRetainedRequests"</span><span class="o">:</span> <span class="mi">50000</span><span class="p">,</span>
        <span class="s">"warningRetainedRequestsLimit"</span><span class="o">:</span> <span class="mi">5000</span>
      <span class="p">},</span>
      <span class="s">"services"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"common"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"defaultInitTimeout"</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
          <span class="s">"retryInterval"</span><span class="o">:</span> <span class="mi">1000</span>
        <span class="p">},</span>
        <span class="s">"db"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"aliases"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"storageEngine"</span>
          <span class="p">],</span>
          <span class="s">"apiVersion"</span><span class="o">:</span> <span class="s">"5.0"</span><span class="p">,</span>
          <span class="s">"backend"</span><span class="o">:</span> <span class="s">"elasticsearch"</span><span class="p">,</span>
          <span class="s">"host"</span><span class="o">:</span> <span class="s">"elasticsearch"</span><span class="p">,</span>
          <span class="s">"port"</span><span class="o">:</span> <span class="mi">9200</span>
        <span class="p">},</span>
        <span class="s">"garbageCollector"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"cleanInterval"</span><span class="o">:</span> <span class="mi">86400000</span><span class="p">,</span>
          <span class="s">"maxDelete"</span><span class="o">:</span> <span class="mi">1000</span>
        <span class="p">},</span>
        <span class="s">"internalBroker"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"aliases"</span><span class="o">:</span> <span class="p">[</span>
            <span class="s">"broker"</span>
          <span class="p">],</span>
          <span class="s">"retryInterval"</span><span class="o">:</span> <span class="mi">1000</span><span class="p">,</span>
          <span class="s">"socket"</span><span class="o">:</span> <span class="s">"./run/broker.sock"</span>
        <span class="p">},</span>
        <span class="s">"internalCache"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"backend"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
          <span class="s">"node"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"host"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
            <span class="s">"port"</span><span class="o">:</span> <span class="mi">6379</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">"memoryStorage"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"backend"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
          <span class="s">"database"</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
          <span class="s">"node"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"host"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
            <span class="s">"port"</span><span class="o">:</span> <span class="mi">6379</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">"proxyBroker"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"host"</span><span class="o">:</span> <span class="s">"proxy"</span><span class="p">,</span>
          <span class="s">"port"</span><span class="o">:</span> <span class="mi">7331</span><span class="p">,</span>
          <span class="s">"retryInterval"</span><span class="o">:</span> <span class="mi">1000</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"stats"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"statsInterval"</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
        <span class="s">"ttl"</span><span class="o">:</span> <span class="mi">3600</span>
      <span class="p">},</span>
      <span class="s">"validation"</span><span class="o">:</span> <span class="p">{},</span>
      <span class="s">"version"</span><span class="o">:</span> <span class="s">"1.0.0-RC8"</span>
    <span class="p">},</span>
    <span class="s">"plugins"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"config"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"kuzzle-plugin-auth-passport-local"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"activated"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
          <span class="s">"config"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"algorithm"</span><span class="o">:</span> <span class="s">"sha1"</span><span class="p">,</span>
            <span class="s">"digest"</span><span class="o">:</span> <span class="s">"hex"</span><span class="p">,</span>
            <span class="s">"secret"</span><span class="o">:</span> <span class="s">"changeme"</span>
          <span class="p">},</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"3.0.2"</span>
        <span class="p">},</span>
        <span class="s">"kuzzle-plugin-logger"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"activated"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
          <span class="s">"config"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"services"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"file"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"addDate"</span><span class="o">:</span> <span class="no">true</span><span class="p">,</span>
                <span class="s">"outputs"</span><span class="o">:</span> <span class="p">{</span>
                  <span class="s">"error"</span><span class="o">:</span> <span class="p">{</span>
                    <span class="s">"filename"</span><span class="o">:</span> <span class="s">"kuzzle.log"</span><span class="p">,</span>
                    <span class="s">"level"</span><span class="o">:</span> <span class="s">"warn"</span>
                  <span class="p">}</span>
                <span class="p">}</span>
              <span class="p">},</span>
              <span class="s">"stdout"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"level"</span><span class="o">:</span> <span class="s">"info"</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"threads"</span><span class="o">:</span> <span class="mi">2</span>
          <span class="p">},</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"2.0.5"</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="s">"routes"</span><span class="o">:</span> <span class="p">[]</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Returns the current Kuzzle configuration as loaded at Kuzzle start.</p>

<h2 id="getlaststats">getLastStats</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_getLastStats</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "getLastStats"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "getLastStats",
  "controller": "server",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"completedRequests"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">148</span><span class="p">,</span>
      <span class="s">"http"</span><span class="o">:</span> <span class="mi">24</span><span class="p">,</span>
      <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">78</span>
    <span class="p">},</span>
    <span class="s">"failedRequests"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">3</span>
    <span class="p">},</span>
    <span class="s">"ongoingRequests"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
      <span class="s">"http"</span><span class="o">:</span> <span class="mi">2</span>
    <span class="p">}</span>
    <span class="s">"connections"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">13</span>
    <span class="p">},</span>
    <span class="s">"timestamp"</span><span class="o">:</span> <span class="s">"1453110641308"</span>
  }
}
</code></pre>

<p>Kuzzle monitors its internal activities and make snapshots regularly.
Allows to get the last stored statistics frame.
By default, snapshots are made every 10s.</p>

<p>These statistics include:</p>

<ul>
<li>the number of connected users per protocol for the ones which allow to get this information (websocket, udp, &hellip;)</li>
<li>the number of ongoing requests</li>
<li>the number of completed requests since the last frame</li>
<li>the number of failed requests since the last frame</li>
</ul>

<p>Statistics are returned as a JSON-object with each key being the snapshot&rsquo;s timestamp (utc, in milliseconds).</p>

<h2 id="getstats">getStats</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_getStats[?startTime=123456789][&amp;stopTime=234567890]</code><br>
<strong>Method:</strong> <code class="prettyprint">POST</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "getStats",

  // Optional: Kuzzle will return all statistics if nor the startTime and stopTime are defined
  "startTime": <span class="nt">&lt;timestamp&gt;</span>,
  "stopTime": <span class="nt">&lt;timestamp&gt;</span>
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "action": "getStats",
  "controller": "server",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"total"</span><span class="o">:</span> <span class="mi">25</span><span class="p">,</span>
    <span class="s">"hits"</span><span class="o">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="s">"completedRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">148</span><span class="p">,</span>
          <span class="s">"http"</span><span class="o">:</span> <span class="mi">24</span><span class="p">,</span>
          <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">78</span>
        <span class="p">},</span>
        <span class="s">"failedRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">3</span>
        <span class="p">},</span>
        <span class="s">"ongoingRequests"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"mqtt"</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span>
          <span class="s">"http"</span><span class="o">:</span> <span class="mi">2</span>
        <span class="p">}</span>
        <span class="s">"connections"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"websocket"</span><span class="o">:</span> <span class="mi">13</span>
        <span class="p">},</span>
        <span class="s">"timestamp"</span><span class="o">:</span> <span class="s">"1453110641308"</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
      <span class="p">}</span>
    <span class="p">]</span>
  }
}
</code></pre>

<p>Allows to get statistics frames saved/stored after a provided timestamp (utc, in milliseconds).</p>

<p>These statistics include:</p>

<ul>
<li>the number of connected users per protocol for the ones which allow to get this information (websocket, udp, &hellip;)</li>
<li>the number of ongoing requests</li>
<li>the number of completed requests since the last frame</li>
<li>the number of failed requests since the last frame</li>
</ul>

<p>Statistics are returned as a JSON-object with each key being the snapshot&rsquo;s timestamp (utc, in milliseconds).</p>

<h2 id="info">info</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_serverInfo</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>

<blockquote>
<p>Query</p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "info"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "server",
  "action": "info",
  "result": {
    <span class="s">"serverInfo"</span><span class="o">:</span> <span class="p">{</span>
      <span class="s">"kuzzle"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"api"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"routes"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"controller1"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"action1"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"method"</span><span class="o">:</span> <span class="s">"get"</span><span class="p">,</span>
                <span class="s">"name"</span><span class="o">:</span> <span class="s">"action1"</span><span class="p">,</span>
                <span class="s">"route"</span><span class="o">:</span> <span class="s">"..."</span>
              <span class="p">},</span>
              <span class="s">"action2"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"method"</span><span class="o">:</span> <span class="s">"post"</span><span class="p">,</span>
                <span class="s">"name"</span><span class="o">:</span> <span class="s">"action2"</span><span class="p">,</span>
                <span class="s">"route"</span><span class="o">:</span> <span class="s">"..."</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="s">"controller2"</span><span class="o">:</span> <span class="p">{</span>
              <span class="s">"action1"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"method"</span><span class="o">:</span> <span class="s">"get"</span><span class="p">,</span>
                <span class="s">"name"</span><span class="o">:</span> <span class="s">"action1"</span><span class="p">,</span>
                <span class="s">"route"</span><span class="o">:</span> <span class="s">"..."</span>
              <span class="p">},</span>
              <span class="s">"action2"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"method"</span><span class="o">:</span> <span class="s">"post"</span><span class="p">,</span>
                <span class="s">"name"</span><span class="o">:</span> <span class="s">"action2"</span><span class="p">,</span>
                <span class="s">"route"</span><span class="o">:</span> <span class="s">"..."</span>
              <span class="p">},</span>
              <span class="p">{</span>
                <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
            <span class="p">}</span>
          <span class="p">},</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"1.0"</span>
        <span class="p">},</span>
        <span class="s">"memoryUsed"</span><span class="o">:</span> <span class="mi">82747392</span><span class="p">,</span>
        <span class="s">"nodeVersion"</span><span class="o">:</span> <span class="s">"v4.4.3"</span><span class="p">,</span>
        <span class="s">"plugins"</span><span class="o">:</span> <span class="p">{},</span>
        <span class="s">"system"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"cpus"</span><span class="o">:</span> <span class="p">[</span>
            <span class="p">{</span>
              <span class="s">"model"</span><span class="o">:</span> <span class="s">"Intel(R) Core(TM) i5-4670 CPU @ 3.40GHz"</span><span class="p">,</span>
              <span class="s">"speed"</span><span class="o">:</span> <span class="mi">2700</span><span class="p">,</span>
              <span class="s">"times"</span><span class="o">:</span> <span class="p">{</span>
                <span class="s">"idle"</span><span class="o">:</span> <span class="mi">19767912700</span><span class="p">,</span>
                <span class="s">"irq"</span><span class="o">:</span> <span class="mi">73805400</span><span class="p">,</span>
                <span class="s">"nice"</span><span class="o">:</span> <span class="mi">66474700</span><span class="p">,</span>
                <span class="s">"sys"</span><span class="o">:</span> <span class="mi">588744200</span><span class="p">,</span>
                <span class="s">"user"</span><span class="o">:</span> <span class="mi">1733754000</span>
              <span class="p">}</span>
            <span class="p">},</span>
            <span class="p">{</span>
              <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
            <span class="p">}</span>
          <span class="p">],</span>
          <span class="s">"memory"</span><span class="o">:</span> <span class="p">{</span>
            <span class="s">"free"</span><span class="o">:</span> <span class="mi">1157988352</span><span class="p">,</span>
            <span class="s">"total"</span><span class="o">:</span> <span class="mi">16768524288</span>
          <span class="p">}</span>
        <span class="p">},</span>
        <span class="s">"uptime"</span><span class="o">:</span> <span class="s">"349.923s"</span><span class="p">,</span>
        <span class="s">"version"</span><span class="o">:</span> <span class="s">"1.0.0-RC4"</span>
      <span class="p">},</span>
      <span class="s">"services"</span><span class="o">:</span> <span class="p">{</span>
        <span class="s">"internalCache"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"memoryPeak"</span><span class="o">:</span> <span class="s">"1.06M"</span><span class="p">,</span>
          <span class="s">"memoryUsed"</span><span class="o">:</span> <span class="s">"978.63K"</span><span class="p">,</span>
          <span class="s">"mode"</span><span class="o">:</span> <span class="s">"standalone"</span><span class="p">,</span>
          <span class="s">"type"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"3.0.7"</span>
        <span class="p">},</span>
        <span class="s">"memoryStorage"</span><span class="o">:</span> <span class="p">{</span>
          <span class="s">"memoryPeak"</span><span class="o">:</span> <span class="s">"1.06M"</span><span class="p">,</span>
          <span class="s">"memoryUsed"</span><span class="o">:</span> <span class="s">"1014.62K"</span><span class="p">,</span>
          <span class="s">"mode"</span><span class="o">:</span> <span class="s">"standalone"</span><span class="p">,</span>
          <span class="s">"type"</span><span class="o">:</span> <span class="s">"redis"</span><span class="p">,</span>
          <span class="s">"version"</span><span class="o">:</span> <span class="s">"3.0.7"</span>
        <span class="p">},</span>
        <span class="p">{</span>
          <span class="s">"etc..."</span><span class="o">:</span> <span class="s">"etc ..."</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  }
}
</code></pre>

<p>Retrieves information about Kuzzle, its plugins and active services.</p>

<h2 id="now">now</h2>

<section class="http"></section>

<blockquote>
<p><strong>URL:</strong> <code class="prettyprint">http://kuzzle:7511/_now</code><br>
<strong>Method:</strong> <code class="prettyprint">GET</code></p>
</blockquote>

<section class="others"></section>
<pre class="highlight literate_coffeescript"><code>{
  "controller": "server",
  "action": "now"
}
</code></pre>

<blockquote>
<p>Response</p>
</blockquote>
<pre class="highlight literate_coffeescript"><code>{
  "status": 200,                      // Assuming everything went well
  "error": null,                      // Assuming everything went well
  "controller": "server",
  "action": "now",
  "requestId": "<span class="nt">&lt;unique</span> <span class="na">request</span> <span class="na">identifier</span><span class="nt">&gt;</span>",
  "result": {
    <span class="s">"now"</span><span class="o">:</span> <span class="mi">1447151167622</span>              <span class="o">//</span> <span class="nx">Epoch</span> <span class="nx">time</span>
  }
}
</code></pre>

<p>Returns the current Kuzzle UTC timestamp as Epoch time (number of milliseconds elapsed since 1 January 1970 00:00:00).</p>

        </div>
        <div class="dark-box">
            <div class="lang-selector">
                <a href="#" data-language-name="http">HTTP</a>
                <a href="#" data-language-name="others">Other protocols</a>
            </div>
        </div>
      </div>
    </div>
    <script>
      ((window.gitter = {}).chat = {}).options = {
        room: 'kuzzleio/kuzzle'
      };
    </script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
    <script type="text/javascript">
      (function(i, s, o, g, r, a, m) {
          i['GoogleAnalyticsObject'] = r;
          i[r] = i[r] || function() {
                  (i[r].q = i[r].q || []).push(arguments)
              }, i[r].l = 1 * new Date();
          a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-67035328-1', 'auto');
      ga('send', 'pageview');


      (function() {
        var
          r,
          version;

        r = /\/v\/([^/]+)(?:\/[^/]+\.html?)?$/.exec(window.location.pathname);

        if (r) {
          version = r[1];
          $('#version-selector option[value="/v/' + version + '"]').prop('selected', true);
        }

        $('#version-selector').change(function (e) {
          var
            versionPath = $('#version-selector option:selected').val();
          window.location = window.location.pathname
            .replace(/\/v\/([^/]+)(\/[^/]+\.html?)?$/, '\2')
            + versionPath
            +'#' + window.location.hash;
        });
      })();
    </script>
  </body>
</html>
