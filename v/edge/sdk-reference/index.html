<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="google-site-verification" content="luspUdq52gkUU0FFChQ2xmeXSs5HDafpARQ7fVXVBp4" />
    <title>Kuzzle SDK Documentation</title>

    <link rel="apple-touch-icon-precomposed" sizes="57x57" href="images/favicon/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="images/favicon/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="images/favicon/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="images/favicon/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon-precomposed" sizes="60x60" href="images/favicon/apple-touch-icon-60x60.png" />
    <link rel="apple-touch-icon-precomposed" sizes="120x120" href="images/favicon/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon-precomposed" sizes="76x76" href="images/favicon/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="images/favicon/apple-touch-icon-152x152.png" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-196x196.png" sizes="196x196" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-16x16.png" sizes="16x16" />
    <link rel="icon" type="image/png" href="images/favicon/favicon-128.png" sizes="128x128" />
    <meta name="msapplication-TileColor" content="#FFFFFF" />
    <meta name="msapplication-TileImage" content="images/favicon/mstile-144x144.png" />
    <meta name="msapplication-square70x70logo" content="images/favicon/mstile-70x70.png" />
    <meta name="msapplication-square150x150logo" content="images/favicon/mstile-150x150.png" />
    <meta name="msapplication-wide310x150logo" content="images/favicon/mstile-310x150.png" />
    <meta name="msapplication-square310x310logo" content="images/favicon/mstile-310x310.png" />

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages([{"tag":"javascript","label":"Javascript","selector":".javascript"},{"tag":"java","label":"Android","selector":".java"},{"tag":"php","label":"PHP","selector":".php"}]);
        });
      </script>
  </head>

  <body class="index">
    <header>
      <div class="wrapper">
        <div id="logo">
            <a href="http://kuzzle.io/">&nbsp;</a>
        </div>

        <nav>
          <ul>
            <li>
              <a href="http://kuzzle.io/" class="nav-item">Home</a>
            </li>
            <li>
              <a href="http://docs.kuzzle.io/" class="nav-item developers active">Documentation</a>
            </li>
            <li>
              <a href="http://kuzzle.io/demos-tutorials/" class="nav-item ">Demos</a>
            </li>
            <li>
              <a href="http://kuzzle.io/blog/" class="nav-item ">Blog</a>
            </li>
            <li>
              <a href="https://github.com/kuzzleio/kuzzle" target="_blank" class="nav-item github">
                <i class="icon icon-github icon-small"></i>
              </a>
            </li>
          </ul>
        </nav>
      </div>
      <div class="developer-nav open">
        <ul>
            <li><a href="/guide/"><span>Guide</span></a></li>
            <li class="active"><a href="/sdk-reference/"><span>SDK</span></a></li>
            <li><a href="/real-time-filters/"><span>Real-time filters</span></a></li>
            <li><a href="/validation-reference/"><span>Data Validation</span></a></li>
            <li><a href="/api-reference/"><span>API</span></a></li>
            <li><a href="/plugin-reference/"><span>Plugins</span></a></li>
            <li><a href="/elasticsearch-cookbook/"><span>Elasticsearch Cookbook</span></a></li>
        </ul>
        <div class="search">
          <input type="text" class="search" id="input-search" tabindex="1" placeholder="Search in the guide">
        </div>
      </div>
    </header>

    <div class="container">
      <a href="#" id="nav-button">
        <span>
          NAV
          <img src="images/navbar.png" />
        </span>
      </a>
      <div class="tocify-wrapper">
          <div class="lang-selector">
              <a href="#" data-language-name="javascript">Javascript</a>
              <a href="#" data-language-name="java">Android</a>
              <a href="#" data-language-name="php">PHP</a>
          </div>
          <ul class="search-results"></ul>

<!--
        <div id="version-selector">
          <label>
            select version:
            <select>
              <option value="/">v1.0.x (current)</option>
              <option value="/v/edge">next</option>
            </select>
          </label>
        </div>
-->

        <div id="toc">
        </div>
          <ul class="toc-footer">
              <li><a href="http://kuzzle.io">Kuzzle official website</a></li>
              <li><a href="http://github.com/kuzzleio/kuzzle">Kuzzle on GitHub</a></li>
              <li><a href="http://github.com/tripit/slate">Documentation Powered by Slate</a></li>
          </ul>
      </div>
      <div class="page-wrapper">
        <div class="dark-box"></div>
        <div class="content">
          <h1 id="introduction">Introduction</h1>

<p>Welcome to the Kuzzle SDK Documentation!</p>

<p>Here is the list of currently implemented SDKs:</p>

<ul>
<li><a href="https://github.com/kuzzleio/sdk-javascript">Javascript/NodeJS</a></li>
<li><a href="https://github.com/kuzzleio/sdk-android">Android</a></li>
<li><a href="https://github.com/kuzzleio/sdk-php">PHP</a></li>
</ul>

            <h1 id="kuzzle">Kuzzle</h1>

<p>This is the main entry point to communicate with Kuzzle. Every other objects inherits properties from this one.</p>

<h2 id="constructors">Constructors</h2>

<p>Connects to a Kuzzle instance.</p>
<pre class="highlight javascript"><code><span class="cm">/*
 As this SDK embarks two protocols instead of just one (WebSocket and SocketIO),
 the "port" option has been replaced by a "wsPort" and "ioPort" ones, used
 to set, respectively, the WebSocket port and the SocketIO one.

 These ports are defaulted to Kuzzle default values, so you only have to change
 them if you modify the protocols default values server-side.
 */</span>
<span class="kd">var</span> <span class="nx">kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">defaultIndex</span><span class="p">:</span> <span class="s1">'some index'</span><span class="p">,</span>
  <span class="na">autoReconnect</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span><span class="na">someheader</span><span class="p">:</span> <span class="s2">"value"</span><span class="p">},</span>
  <span class="na">ioPort</span><span class="p">:</span> <span class="mi">7512</span><span class="p">,</span>
  <span class="na">wsPort</span><span class="p">:</span> <span class="mi">7513</span>
<span class="p">});</span>

<span class="c1">// A callback is also available and will be invoked once connected to the Kuzzle instance:</span>
<span class="nx">kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">KuzzleOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">KuzzleOptions</span><span class="o">();</span>

<span class="n">options</span><span class="o">.</span><span class="na">setDefaultIndex</span><span class="o">(</span><span class="s">"some index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setAutoReconnect</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span>
  <span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"someheader"</span><span class="o">,</span> <span class="s">"value"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">setPort</span><span class="o">(</span><span class="mi">7512</span><span class="o">);</span>

<span class="n">Kuzzle</span> <span class="n">kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Kuzzle</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="n">options</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Void</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// invoked once connected, object contains the kuzzle instance</span>
 <span class="o">}</span>

 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
   <span class="c1">// Handle connection error</span>
 <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">'defaultIndex'</span> <span class="o">=&gt;</span> <span class="s1">'some index'</span><span class="p">,</span>
  <span class="s1">'port'</span> <span class="o">=&gt;</span> <span class="mi">7512</span>
<span class="p">]);</span>
</code></pre>

<h3 id="kuzzle-host-options-callback">Kuzzle(host, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">host</code></td>
<td>string</td>
<td>The server name (or the IP address) of a Kuzzle instance</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional Kuzzle connection configuration</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">autoQueue</code></td>
<td>boolean</td>
<td>Automatically queue all requests during offline mode</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">autoReconnect</code></td>
<td>boolean</td>
<td>Automatically reconnect after a connection loss</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">autoReplay</code></td>
<td>boolean</td>
<td>Automatically replay queued requests on a <code class="prettyprint">reconnected</code> event</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">autoResubscribe</code></td>
<td>boolean</td>
<td>Automatically renew all subscriptions on a <code class="prettyprint">reconnected</code> event</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">connect</code></td>
<td>string</td>
<td>Manually or automatically connect to the Kuzzle instance</td>
<td><code class="prettyprint">auto</code></td>
</tr>
<tr>
<td><code class="prettyprint">defaultIndex</code></td>
<td>string</td>
<td>Set the default index to use</td>
<td></td>
</tr>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>JSON object</td>
<td>Common headers for all sent documents</td>
<td></td>
</tr>
<tr>
<td><code class="prettyprint">ioPort</code></td>
<td>integer</td>
<td>(Javascript SDK only) Kuzzle network port for socket.io</td>
<td>7512</td>
</tr>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Common metadata, will be sent to all future requests</td>
<td></td>
</tr>
<tr>
<td><code class="prettyprint">offlineMode</code></td>
<td>string</td>
<td>Offline mode configuration</td>
<td><code class="prettyprint">manual</code></td>
</tr>
<tr>
<td><code class="prettyprint">port</code></td>
<td>integer</td>
<td>(All SDKs except Javascript) Kuzzle network port</td>
<td>7512</td>
</tr>
<tr>
<td><code class="prettyprint">queueTTL</code></td>
<td>integer</td>
<td>Time a queued request is kept during offline mode, in milliseconds</td>
<td><code class="prettyprint">120000</code></td>
</tr>
<tr>
<td><code class="prettyprint">queueMaxSize</code></td>
<td>integer</td>
<td>Number of maximum requests kept during offline mode</td>
<td><code class="prettyprint">500</code></td>
</tr>
<tr>
<td><code class="prettyprint">replayInterval</code></td>
<td>integer</td>
<td>Delay between each replayed requests, in milliseconds</td>
<td><code class="prettyprint">10</code></td>
</tr>
<tr>
<td><code class="prettyprint">reconnectionDelay</code></td>
<td>integer</td>
<td>number of milliseconds between reconnection attempts</td>
<td><code class="prettyprint">1000</code></td>
</tr>
<tr>
<td><code class="prettyprint">sslConnection</code></td>
<td>boolean</td>
<td>Switch Kuzzle connection to SSL mode</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">wsPort</code></td>
<td>integer</td>
<td>(Javascript SDK only) Kuzzle network port for websocket</td>
<td>7513</td>
</tr>
</tbody></table>

<p><strong>Notes:</strong></p>

<ul>
<li>the <code class="prettyprint">offlineMode</code> option only accepts the <code class="prettyprint">manual</code> and <code class="prettyprint">auto</code> values</li>
<li>the Javascript SDK accepts <code class="prettyprint">ioPort</code> and <code class="prettyprint">wsPort</code> options instead of the <code class="prettyprint">port</code> one. This is because this SDK supports 2 network protocols to ensure maximum performances AND compatibility depending on browsers capabilities</li>
</ul>

<h3 id="callback-response">Callback response</h3>

<p>If the connection succeeds, resolves to the <code class="prettyprint">Kuzzle</code> object itself.
If the <code class="prettyprint">connect</code> option is set to <code class="prettyprint">manual</code>, the callback will be called after the <code class="prettyprint">connect</code> method is resolved.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">autoQueue</code></td>
<td>boolean</td>
<td>Automatically queue all requests during offline mode</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">autoReconnect</code></td>
<td>boolean</td>
<td>Automatically reconnect after a connection loss</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">autoReplay</code></td>
<td>boolean</td>
<td>Automatically replay queued requests on a <code class="prettyprint">reconnected</code> event</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">autoResubscribe</code></td>
<td>boolean</td>
<td>Automatically renew all subscriptions on a <code class="prettyprint">reconnected</code> event</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">defaultIndex</code></td>
<td>string</td>
<td>Kuzzle&rsquo;s default index to use</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>JSON object</td>
<td>Common headers for all sent documents.</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">host</code></td>
<td>string</td>
<td>Target Kuzzle host name/address</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">ioPort</code></td>
<td>integer</td>
<td>(Javascript SDK only) Kuzzle network port for socket.io</td>
<td>7512</td>
</tr>
<tr>
<td><code class="prettyprint">jwtToken</code></td>
<td>string</td>
<td>Token used in requests for authentication.</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Common metadata, will be sent to all future requests</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">offlineQueue</code></td>
<td>JSON object</td>
<td>Contains the queued requests during offline mode</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">offlineQueueLoader</code></td>
<td>function</td>
<td>Called before dequeuing requests after exiting offline mode, to add items at the beginning of the offline queue</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">port</code></td>
<td>integer</td>
<td>(All SDKs except Javascript) Kuzzle network port</td>
<td>7512</td>
</tr>
<tr>
<td><code class="prettyprint">queueFilter</code></td>
<td>function</td>
<td>Called during offline mode. Takes a request object as arguments and returns a boolean, indicating if a request can be queued</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">queueMaxSize</code></td>
<td>integer</td>
<td>Number of maximum requests kept during offline mode</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">queueTTL</code></td>
<td>integer</td>
<td>Time a queued request is kept during offline mode, in milliseconds</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">replayInterval</code></td>
<td>integer</td>
<td>Delay between each replayed requests</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">reconnectionDelay</code></td>
<td>integer</td>
<td>number of milliseconds between reconnection attempts</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">wsPort</code></td>
<td>integer</td>
<td>(Javascript SDK only) Kuzzle network port for websocket</td>
<td>7513</td>
</tr>
</tbody></table>

<p><strong>Notes:</strong></p>

<ul>
<li>if <code class="prettyprint">connect</code> is set to <code class="prettyprint">manual</code>, the <code class="prettyprint">connect</code> method will have to be called manually</li>
<li>the kuzzle instance will automatically queue all requests, and play them automatically once a first connection is established, regardless of the <code class="prettyprint">connect</code> or offline mode option values.</li>
<li>multiple methods allow passing specific <code class="prettyprint">metadata</code>. These <code class="prettyprint">metadata</code> will be merged with the global Kuzzle object <code class="prettyprint">metadata</code> when sending the request, with the request specific <code class="prettyprint">metadata</code> taking priority over the global ones.</li>
<li>the <code class="prettyprint">queueFilter</code> property is a function taking a JSON object as an argument. This object is the request sent to Kuzzle, following the <a href="/api-reference/#query-syntax">Kuzzle API</a> format</li>
<li>if <code class="prettyprint">queueTTL</code> is set to <code class="prettyprint">0</code>, requests are kept indefinitely</li>
<li>The offline buffer acts like a FIFO queue, meaning that if the <code class="prettyprint">queueMaxSize</code> limit is reached, older requests are discarded to make room for new requests</li>
<li>if <code class="prettyprint">queueMaxSize</code> is set to <code class="prettyprint">0</code>, an unlimited number of requests is kept until the buffer is flushed</li>
<li>the <code class="prettyprint">offlineQueueLoader</code> must be set with a function, taking no argument, and returning an array of objects containing a <code class="prettyprint">query</code> member with a Kuzzle query to be replayed, and an optional <code class="prettyprint">cb</code> member with the corresponding callback to invoke with the query result</li>
<li>the <code class="prettyprint">host</code> and <code class="prettyprint">port</code> properties can be changed, but it will only be in effect at the next <code class="prettyprint">connect</code> call</li>
<li>the Javascript SDK accepts <code class="prettyprint">ioPort</code> and <code class="prettyprint">wsPort</code> options instead of the <code class="prettyprint">port</code> one. This is because this SDK supports 2 network protocols to ensure maximum performances AND compatibility depending on browsers capabilities</li>
</ul>

<h2 id="offline-mode">Offline mode</h2>

<p>Working with an unstable network connection implies to handle what an application should be doing while being offline.<br>
Our goal is to provide our users with the right tools to handle such situations.</p>

<p><strong>There are two ways to handle a network disconnection</strong></p>

<ul>
<li>Stop all further communication with Kuzzle and invalidate the current instance and all its children. The application will have to manually instantiate a new Kuzzle object once the network has recovered. To do so, simply pass the <code class="prettyprint">autoReconnect</code> option to <code class="prettyprint">false</code> when starting a new Kuzzle instance.</li>
<li>Reconnect automatically to Kuzzle when possible, and enter <em>offline mode</em>. This is the default behavior.</li>
</ul>

<p>Offline mode simply refers to the time between a <code class="prettyprint">disconnected</code> and a <code class="prettyprint">reconnected</code> event.</p>

<p><strong>Handling subscriptions</strong></p>

<p>During offline mode, all subscriptions are kept indefinitely, with no maximum subscriptions retained.</p>

<p>By default, upon reconnection, all subscription are renewed. This behavior can be changed by setting the <code class="prettyprint">autoResubscribe</code> to <code class="prettyprint">false</code>. In that case, each subscription must be renewed manually using the <code class="prettyprint">Room.renew</code> method.</p>

<p><strong>Queuing requests while offline</strong></p>

<p>Requests can be queued while being offline, to be replayed once the network connection has been reestablished.<br>
By default, there is no request queuing.</p>

<p>You can:</p>

<ul>
<li>Queue all requests automatically when going offline by setting the <code class="prettyprint">autoQueue</code> option to <code class="prettyprint">true</code></li>
<li>Start and stop queuing manually, by using the <code class="prettyprint">startQueuing</code> and <code class="prettyprint">stopQueuing</code> methods</li>
</ul>

<p>The queue itself can be configured using the <code class="prettyprint">queueTTL</code> and <code class="prettyprint">queueMaxSize</code> options.</p>

<p><strong>Filter requests to be queued</strong></p>

<p>After request queuing is activated, by default, all requests are queued.</p>

<p>You can decide to filter some of these requests with the <code class="prettyprint">queueFilter</code> property. This property must be set with a function taking the request to be queued as an argument, and it must return a boolean telling the Kuzzle SDK if the request can be queued or not.</p>

<p>Additionally, almost all methods accept a <code class="prettyprint">queuable</code> option. If set to <code class="prettyprint">false</code>, the request will be discarded if the SDK is disconnected, and it will be played immediately with no queuing otherwise. This option bypasses the <code class="prettyprint">queueFilter</code> property.</p>

<p><strong>Handling network reconnection</strong></p>

<p>Once a <code class="prettyprint">reconnected</code> event is fired, you may replay the content of the queue with the <code class="prettyprint">replayQueue</code> method. Or you can let the SDK replay it automatically upon reconnection, by setting the <code class="prettyprint">autoReplay</code> option to <code class="prettyprint">true</code>.  </p>

<p>Requests are sent to Kuzzle with the <code class="prettyprint">replayInterval</code> delay between each one of them.</p>

<p>Requests submitted while replaying the queue are delayed until the queue is empty, to ensure all requests are played in the right order.</p>

<aside class="warning">
Setting <code>autoReplay</code> to <code>true</code> when using user authentication should generally be avoided.<br/>
When leaving offline-mode, the JWT Token validity is verified. If it has expired, the token will be removed and a <code>jwtTokenExpired</code> event will be fired.<br/>
If <code>autoReplay</code> is set, then all pending requests will be automatically played as an anonymous user.
</aside>

<p><strong>Taking control of the offline queue</strong></p>

<p>You can be notified about what&rsquo;s going on about the offline queue, with the <code class="prettyprint">offlineQueuePush</code> and the <code class="prettyprint">offlineQueuePop</code> events.  </p>

<p>The <code class="prettyprint">offlineQueuePush</code> event is fired whenever a request is queued. It provides to its listeners an object containing a <code class="prettyprint">query</code> property, describing the queued request, and an optional <code class="prettyprint">cb</code> property containing the corresponding callback, if any.</p>

<p>The <code class="prettyprint">offlineQueuePop</code> event is fired whenever a request has been removed from the queue, either because the queue limits have been reached, or because the request has been replayed. It provides the removed request to its listeners.</p>

<p>The <code class="prettyprint">offlineQueueLoader</code> property allows loading requests to the queue, <strong>before any previously queued request</strong>. It is invoked every time the SDK starts dequeuing requests.<br>
This property must be set with a function returning an array of objects with the following accessible properties: a <code class="prettyprint">query</code> property, containing the request to be replayed, and an optional <code class="prettyprint">cb</code> property pointing to the callback to invoke after the completion of the request.</p>

<p>Finally, if the provided methods don&rsquo;t give you enough control over the offline queue, you can access and edit the queue directly with the <code class="prettyprint">offlineQueue</code> property.</p>

<p><strong>Automatic offline-mode</strong></p>

<p>You can set the <code class="prettyprint">offlineMode</code> option to <code class="prettyprint">auto</code>. This configures the offline mode behavior with the following options:</p>

<ul>
<li><code class="prettyprint">autoReconnect</code> = <code class="prettyprint">true</code></li>
<li><code class="prettyprint">autoQueue</code> = <code class="prettyprint">true</code></li>
<li><code class="prettyprint">autoReplay</code> = <code class="prettyprint">true</code></li>
<li><code class="prettyprint">autoResubscribe</code> = <code class="prettyprint">true</code></li>
</ul>

<h2 id="event-handling">Event Handling</h2>

<p>The Kuzzle object listens to global events fired by Kuzzle. To subscribe or unsubscribe on these events, simply plug a callback function to the event you want to act upon, using the functions <code class="prettyprint">addListener</code> and <code class="prettyprint">removeListener</code>.</p>

<p>Here is the list of these special events:</p>

<table><thead>
<tr>
<th>Event Name</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">connected</code></td>
<td>Fired when the SDK has successfully connected to Kuzzle</td>
</tr>
<tr>
<td><code class="prettyprint">disconnected</code></td>
<td>Fired when the current session has been unexpectedly disconnected</td>
</tr>
<tr>
<td><code class="prettyprint">error</code></td>
<td>Fired when the SDK has failed to connect to Kuzzle. Does not trigger offline mode.</td>
</tr>
<tr>
<td><code class="prettyprint">jwtTokenExpired</code></td>
<td>Fired when Kuzzle rejected a request because the authentication token expired.<br/>Provides the request and its associated callback to its listeners</td>
</tr>
<tr>
<td><code class="prettyprint">loginAttempt</code></td>
<td>Fired when a login attempt completes, either with a success or a failure result.<br/>Provides a JSON object with the login status to its listeners (see the <code class="prettyprint">login</code> method documentation)</td>
</tr>
<tr>
<td><code class="prettyprint">offlineQueuePop</code></td>
<td>Fired whenever a request is removed from the offline queue. <br/>Provides the removed request to its listeners</td>
</tr>
<tr>
<td><code class="prettyprint">offlineQueuePush</code></td>
<td>Fired whenever a request is added to the offline queue.<br/>Provides to its listeners an object containing a <code class="prettyprint">query</code> property, describing the queued request, and an optional <code class="prettyprint">cb</code> property containing the corresponding callback</td>
</tr>
<tr>
<td><code class="prettyprint">queryError</code></td>
<td>Fired whenever Kuzzle responds with an error</td>
</tr>
<tr>
<td><code class="prettyprint">reconnected</code></td>
<td>Fired when the current session has reconnected to Kuzzle after a disconnection, and only if <code class="prettyprint">autoReconnect</code> is set to <code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<p><strong>Note:</strong> listeners are called in the order of their insertion.</p>

<h2 id="addlistener">addListener</h2>
<pre class="highlight javascript"><code>  <span class="kd">var</span> <span class="nx">listenerId</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="s1">'connected'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">room</span><span class="p">,</span> <span class="nx">subscription</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Actions to perform when receiving a 'subscribed' global event</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">String</span> <span class="n">listenerId</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">addListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">connected</span><span class="o">,</span> <span class="k">new</span> <span class="n">EventListener</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">trigger</span><span class="o">(</span><span class="n">Object</span><span class="o">...</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Actions to perform when receiving a 'subscribed' global event</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">addListener</span><span class="p">(</span><span class="s1">'jwtTokenExpired'</span><span class="p">,</span> <span class="k">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">// Actions to perform when receiving a 'jwtTokenExpired' global event
</span><span class="p">});</span>

</code></pre>

<p>Adds a listener to a Kuzzle global event. When an event is fired, listeners are called in the order of their insertion.</p>

<aside class="notice">
The ID returned by this function is required if you want to remove this listener later.
</aside>

<h3 id="addlistener-event-listener">addListener(event, listener)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">event</code></td>
<td>string</td>
<td>One of the event described in the <code class="prettyprint">Event Handling</code> section of this documentation</td>
</tr>
<tr>
<td><code class="prettyprint">listener</code></td>
<td>function</td>
<td>The function to call each time one of the registered event is fired</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns a <code class="prettyprint">string</code> containing an unique listener ID.</p>

<h2 id="checktoken">checkToken</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">checkToken</span><span class="p">(</span><span class="nx">token</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">checkTokenPromise</span><span class="p">(</span><span class="nx">token</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">checkToken</span><span class="o">(</span><span class="s">"some jwt token"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">TokenValidity</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">TokenValidity</span> <span class="n">tokenInfo</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">tokenInfo</span><span class="o">.</span><span class="na">isValid</span><span class="o">())</span> <span class="o">{</span>
      <span class="c1">// tokenInfo.getExpiresAt() returns the expiration timestamp</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
      <span class="c1">// tokenInfo.getState() returns the invalidity reason</span>
    <span class="o">}</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">checkToken</span><span class="p">(</span><span class="s1">'some jwt token'</span><span class="p">);</span>

<span class="cm">/*
$result = [
  'expiresAt' =&gt; 1468257834099, //timestamp in milliseconds
  'valid' =&gt; true
];
*/</span>
</code></pre>

<blockquote>
<p>Callback response if the token is valid:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"expiresAt"</span><span class="p">:</span><span class="w"> </span><span class="mi">1454588077399</span><span class="p">,</span><span class="w">
  </span><span class="nt">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>Callback response if the token is invalid:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"valid"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&lt;invalidity reason&gt;"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Checks the validity of a JSON Web Token.</p>

<h3 id="checktoken-token-callback">checkToken(token, callback)</h3>

<aside class="notice">
This method is non-queuable, meaning that during offline mode, it will be discarded and the callback will be called with an error.
</aside>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">token</code></td>
<td>string</td>
<td>The token to check</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> this method sends an unauthenticated API call to Kuzzle, meaning it ignores the JWT Token property, even if it has been set.</p>

<h3 id="callback-response">Callback response</h3>

<p>A JSON object with a <code class="prettyprint">valid</code> boolean property.<br>
If the token is valid, a <code class="prettyprint">expiresAt</code> property is set with the expiration timestamp. If not, a <code class="prettyprint">state</code> property is set explaining why the token is invalid.</p>

<h2 id="collection">collection</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">collection</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="c1">// or using a default index:</span>
<span class="kd">var</span>
  <span class="nx">kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="p">{</span><span class="na">defaultIndex</span><span class="p">:</span> <span class="s1">'index'</span><span class="p">});</span>

<span class="nx">collection</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Collection</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">);</span>

<span class="c1">// or using a default index:</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">setDefaultIndex</span><span class="o">(</span><span class="s">"index"</span><span class="o">);</span>
<span class="n">Collection</span> <span class="n">collection</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="c1">// or using a default index:
</span><span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">'defaultIndex'</span> <span class="o">=&gt;</span> <span class="s1">'some index'</span>
<span class="p">]);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>
</code></pre>

<p>Instantiates a new Collection object.</p>

<h3 id="collection-collection-index">collection(collection, [index])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>The name of the data collection you want to manipulate</td>
</tr>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td>The name of the index containing the data collection</td>
</tr>
</tbody></table>

<p>If no <code class="prettyprint">index</code> is provided, the factory will take the default index set in the main Kuzzle instance. If no default index has been set, an error is thrown.</p>

<p>The <code class="prettyprint">index</code> argument takes precedence over the default index.</p>

<h3 id="return-value">Return value</h3>

<p>Returns a <code class="prettyprint">Collection</code> object.</p>

<h2 id="connect">connect</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">connect</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">connect</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Connects to the Kuzzle instance using the provided <code class="prettyprint">host</code> in the constructor.
Has no effect if <code class="prettyprint">connect</code> is set to <code class="prettyprint">auto</code>, unless <code class="prettyprint">disconnect</code> has been called first.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>If a callback has been provided to the <code class="prettyprint">Kuzzle</code> constructor, it will be called with the <code class="prettyprint">Kuzzle</code> instance once successfully connected</p>

<h2 id="disconnect">disconnect</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">disconnect</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Closes the current connection.</p>

<h2 id="flushqueue">flushQueue</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">flushQueue</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">flushQueue</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Empties the offline queue without replaying it.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="getallstatistics">getAllStatistics</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getAllStatistics</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">stats</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// loop through all returned frames</span>
  <span class="p">});</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">getAllStatisticsPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">stats</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">stats</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">frame</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// loop through all returned frames</span>
    <span class="p">});</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">getAllStatistics</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONArray</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONArray</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// loop through all returned frames</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">};</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$stats</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getAllStatistics</span><span class="p">();</span>

<span class="k">foreach</span><span class="p">(</span><span class="nv">$stats</span> <span class="k">as</span> <span class="nv">$frame</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// loop through all returned frames
</span><span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response example:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"mqtt"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110641308"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110642308"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110643308"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span></code></pre>

<p>Kuzzle monitors active connections, and ongoing/completed/failed requests.<br>
This method returns all available statistics from Kuzzle.</p>

<h3 id="getallstatistics-options-callback">getAllStatistics([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>The response is an array of JSON objects, each one of them being a statistic frame.</p>

<h2 id="getautorefresh">getAutoRefresh</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (node.js or browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getAutoRefresh</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">autoRefresh</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">autoRefresh</span><span class="p">);</span>     <span class="c1">// true|false</span>
<span class="p">});</span>

<span class="c1">// Using promises (node.js)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">getAutoRefreshPromise</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">autoRefresh</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">autoRefresh</span><span class="p">);</span>   <span class="c1">// true|false</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">getAutoRefresh</span><span class="o">(</span><span class="s">"myIndex"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Boolean</span> <span class="n">autoRefresh</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// autoRefresh var contains the autoRefresh status of myIndex.</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getAutoRefresh</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">);</span>

<span class="c1">// $result = true | false
</span></code></pre>

<p>The <code class="prettyprint">autoRefresh</code> flag, when set to true, will make Kuzzle perform a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a> request
immediately after each write request, forcing the documents to be immediately visible to search.</p>

<p>The <code class="prettyprint">getAutoRefresh</code> function returns the current <code class="prettyprint">autoRefresh</code> status for the given index.</p>

<aside class="left warning">
    <p>
        A refresh operation comes with some performance costs.
    </p>
    <p>
        While forcing the autoRefresh can be convenient on a development or test environmnent, it is advised to avoid
        using it on production or at least to carefully monitor its implications before using it.
    </p>
</aside>

<h4 id="getautorefresh-index-options-callback">getAutoRefresh([index], [options], callback)</h4>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td>Optional index to query. If no set, defaults to <a href="#properties">Kuzzle.defaultIndex</a></td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="callback-response">Callback response</h4>

<p>The response is a boolean reflecting the index <code class="prettyprint">autoRefresh</code>status.</p>

<h2 id="getjwttoken">getJwtToken</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">jwtToken</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getJwtToken</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">String</span> <span class="n">jwtToken</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">getJwtToken</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="c1">// ...
</span><span class="nv">$token</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getJwtToken</span><span class="p">();</span>
</code></pre>

<p>Get internal jwtToken used to request kuzzle.</p>

<h3 id="getjwttoken">getJwtToken()</h3>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">jwtToken</code> property to export previous kuzzle logged connection.</p>

<h2 id="getmyrights">getMyRights</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">getMyRights</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a JSON object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">getMyRightsPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a JSON object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">getMyRights</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">rights</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// result is a JSON object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getMyRights</span><span class="p">();</span>

<span class="c1">// $result is an array
</span></code></pre>

<blockquote>
<p>Callback response example:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="na">controller</span><span class="p">:</span> <span class="s1">'my-controller'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'my-action'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="na">collection</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="s1">'allowed'</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">controller</span><span class="p">:</span> <span class="s1">'another-controller'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'my-index'</span><span class="p">,</span> <span class="na">collection</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="s1">'conditional'</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre>

<p>Gets the rights of the current user</p>

<h4 id="getmyrights-options-callback">getMyRights([options], callback)</h4>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="callback-response">Callback response</h4>

<p>Resolves to a <code class="prettyprint">JSON</code> object.</p>

<h2 id="getserverinfo">getServerInfo</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getServerInfo</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getServerInfoPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">infos</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...  </span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">getServerInfo</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle success</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getServerInfo</span><span class="p">();</span>

<span class="c1">// $result is an array
</span></code></pre>

<blockquote>
<p>Callback response example:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"kuzzle"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"api"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"routes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"admin"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"deleteCollection"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"putMapping"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"getMapping"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"getStats"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"getLastStats"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"getAllStats"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"truncateCollection"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"putRole"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"deleteIndexes"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"createIndex"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"deleteIndex"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"removeRooms"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"auth"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"login"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"bulk"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"import"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"read"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"search"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"get"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"count"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"listCollections"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"now"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"listIndexes"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"serverInfo"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"subscribe"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"on"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"join"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"off"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"count"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"list"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"write"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"create"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"publish"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"createOrUpdate"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"update"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"delete"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"deleteByQuery"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"createCollection"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"memoryUsed"</span><span class="p">:</span><span class="w"> </span><span class="mi">99901440</span><span class="p">,</span><span class="w">
    </span><span class="nt">"nodeVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"v4.2.1"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"kuzzle-plugin-auth-passport-local"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"activated"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hooks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"auth:loadStrategies"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kuzzle-plugin-auth-passport-local"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"kuzzle-plugin-logger"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"activated"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hooks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"log:silly"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"log:verbose"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"log:info"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"log:debug"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"log:warn"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"log:error"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"data:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"subscription:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"websocket:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"prepare:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"cleanDb:done"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"cleanDb:error"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"server:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"rabbit:started"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"rabbit:error"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"rabbit:stopped"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"internalBroker:*"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"room:new"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"room:remove"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"workerGroup:loaded"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"profiling:*"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kuzzle-plugin-logger"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.6"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"kuzzle-plugin-socketio"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"activated"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="nt">"hooks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"protocol:broadcast"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"protocol:joinChannel"</span><span class="p">,</span><span class="w">
          </span><span class="s2">"protocol:leaveChannel"</span><span class="w">
        </span><span class="p">],</span><span class="w">
        </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"kuzzle-plugin-socketio"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0.4"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"system"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"cpus"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intel(R) Core(TM) i5-4310M CPU @ 2.70GHz"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"speed"</span><span class="p">:</span><span class="w"> </span><span class="mi">800</span><span class="p">,</span><span class="w">
          </span><span class="nt">"times"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"idle"</span><span class="p">:</span><span class="w"> </span><span class="mi">8859265400</span><span class="p">,</span><span class="w">
            </span><span class="nt">"irq"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="p">,</span><span class="w">
            </span><span class="nt">"nice"</span><span class="p">:</span><span class="w"> </span><span class="mi">4325300</span><span class="p">,</span><span class="w">
            </span><span class="nt">"sys"</span><span class="p">:</span><span class="w"> </span><span class="mi">115447100</span><span class="p">,</span><span class="w">
            </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="mi">497028200</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intel(R) Core(TM) i5-4310M CPU @ 2.70GHz"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"speed"</span><span class="p">:</span><span class="w"> </span><span class="mi">2701</span><span class="p">,</span><span class="w">
          </span><span class="nt">"times"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"idle"</span><span class="p">:</span><span class="w"> </span><span class="mi">8848628800</span><span class="p">,</span><span class="w">
            </span><span class="nt">"irq"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
            </span><span class="nt">"nice"</span><span class="p">:</span><span class="w"> </span><span class="mi">3648100</span><span class="p">,</span><span class="w">
            </span><span class="nt">"sys"</span><span class="p">:</span><span class="w"> </span><span class="mi">115458300</span><span class="p">,</span><span class="w">
            </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="mi">495154300</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intel(R) Core(TM) i5-4310M CPU @ 2.70GHz"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"speed"</span><span class="p">:</span><span class="w"> </span><span class="mi">1300</span><span class="p">,</span><span class="w">
          </span><span class="nt">"times"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"idle"</span><span class="p">:</span><span class="w"> </span><span class="mi">8875594600</span><span class="p">,</span><span class="w">
            </span><span class="nt">"irq"</span><span class="p">:</span><span class="w"> </span><span class="mi">4200</span><span class="p">,</span><span class="w">
            </span><span class="nt">"nice"</span><span class="p">:</span><span class="w"> </span><span class="mi">3956800</span><span class="p">,</span><span class="w">
            </span><span class="nt">"sys"</span><span class="p">:</span><span class="w"> </span><span class="mi">98348100</span><span class="p">,</span><span class="w">
            </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="mi">538083800</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="p">{</span><span class="w">
          </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intel(R) Core(TM) i5-4310M CPU @ 2.70GHz"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"speed"</span><span class="p">:</span><span class="w"> </span><span class="mi">2701</span><span class="p">,</span><span class="w">
          </span><span class="nt">"times"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"idle"</span><span class="p">:</span><span class="w"> </span><span class="mi">8801022600</span><span class="p">,</span><span class="w">
            </span><span class="nt">"irq"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
            </span><span class="nt">"nice"</span><span class="p">:</span><span class="w"> </span><span class="mi">3946300</span><span class="p">,</span><span class="w">
            </span><span class="nt">"sys"</span><span class="p">:</span><span class="w"> </span><span class="mi">97387200</span><span class="p">,</span><span class="w">
            </span><span class="nt">"user"</span><span class="p">:</span><span class="w"> </span><span class="mi">552344400</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">}</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="nt">"memory"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"free"</span><span class="p">:</span><span class="w"> </span><span class="mi">1651486720</span><span class="p">,</span><span class="w">
        </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">16729739264</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"uptime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"161016.824s"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.9.2"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"services"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"internalCache"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"memoryPeak"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.88M"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"memoryUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.88M"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"mode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"standalone"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"redis"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3.0.2"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"readEngine"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"api"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.7"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"lucene"</span><span class="p">:</span><span class="w"> </span><span class="s2">"4.10.4"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"nodes"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"client"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"data_only"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"master_data"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
          </span><span class="nt">"master_only"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
          </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"fs"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"available"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5.5gb"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"available_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">5996474368</span><span class="p">,</span><span class="w">
          </span><span class="nt">"free"</span><span class="p">:</span><span class="w"> </span><span class="s2">"7.4gb"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"free_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">8013250560</span><span class="p">,</span><span class="w">
          </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"36.5gb"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"total_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">39237341184</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"jvm"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"max_uptime"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.9d"</span><span class="p">,</span><span class="w">
          </span><span class="nt">"max_uptime_in_millis"</span><span class="p">:</span><span class="w"> </span><span class="mi">171087444</span><span class="p">,</span><span class="w">
          </span><span class="nt">"mem"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"heap_max"</span><span class="p">:</span><span class="w"> </span><span class="s2">"990.7mb"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"heap_max_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">1038876672</span><span class="p">,</span><span class="w">
            </span><span class="nt">"heap_used"</span><span class="p">:</span><span class="w"> </span><span class="s2">"51.8mb"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"heap_used_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">54394592</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"threads"</span><span class="p">:</span><span class="w"> </span><span class="mi">75</span><span class="p">,</span><span class="w">
          </span><span class="nt">"versions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
              </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.8.0_66-internal"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vm_name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OpenJDK 64-Bit Server VM"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vm_vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Oracle Corporation"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vm_version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"25.66-b01"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">]</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"os"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"available_processors"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
          </span><span class="nt">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
            </span><span class="p">{</span><span class="w">
              </span><span class="nt">"cache_size"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3kb"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"cache_size_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">3072</span><span class="p">,</span><span class="w">
              </span><span class="nt">"cores_per_socket"</span><span class="p">:</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w">
              </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
              </span><span class="nt">"mhz"</span><span class="p">:</span><span class="w"> </span><span class="mi">2701</span><span class="p">,</span><span class="w">
              </span><span class="nt">"model"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Core(TM) i5-4310M CPU @ 2.70GHz"</span><span class="p">,</span><span class="w">
              </span><span class="nt">"total_cores"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
              </span><span class="nt">"total_sockets"</span><span class="p">:</span><span class="w"> </span><span class="mi">4</span><span class="p">,</span><span class="w">
              </span><span class="nt">"vendor"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Intel"</span><span class="w">
            </span><span class="p">}</span><span class="w">
          </span><span class="p">],</span><span class="w">
          </span><span class="nt">"mem"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="s2">"15.5gb"</span><span class="p">,</span><span class="w">
            </span><span class="nt">"total_in_bytes"</span><span class="p">:</span><span class="w"> </span><span class="mi">16729739264</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"plugins"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
        </span><span class="nt">"process"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"cpu"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"percent"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
          </span><span class="p">},</span><span class="w">
          </span><span class="nt">"open_file_descriptors"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"avg"</span><span class="p">:</span><span class="w"> </span><span class="mi">190</span><span class="p">,</span><span class="w">
            </span><span class="nt">"max"</span><span class="p">:</span><span class="w"> </span><span class="mi">190</span><span class="p">,</span><span class="w">
            </span><span class="nt">"min"</span><span class="p">:</span><span class="w"> </span><span class="mi">190</span><span class="w">
          </span><span class="p">}</span><span class="w">
        </span><span class="p">},</span><span class="w">
        </span><span class="nt">"versions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
          </span><span class="s2">"1.5.2"</span><span class="w">
        </span><span class="p">]</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="nt">"spaceUsed"</span><span class="p">:</span><span class="w"> </span><span class="s2">"14.5kb"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"elasticsearch"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.5.2"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Retrieves information about Kuzzle, its plugins and active services.</p>

<h3 id="getserverinfo-options-callback">getServerInfo([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a JSON object containing server information.</p>

<h2 id="getstatistics">getStatistics</h2>

<blockquote>
<p>Without argument, retrieves the last statistic frame in an array:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getStatistics</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">getStatisticsPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">stats</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getStatistics</span><span class="p">();</span>

<span class="c1">// $result is an array
</span></code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"mqtt"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110641308"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span></code></pre>

<blockquote>
<p>When providing a timestamp, retrieves all frames recorded after that timestamp:</p>
</blockquote>
<pre class="highlight javascript"><code><span class="c1">// Date can be either in ISO format or a timestamp (utc, in milliseconds)</span>
<span class="kd">var</span> <span class="nx">ts</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="s1">'2015-10-26T12:19:10.213Z'</span><span class="p">);</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">getStatistics</span><span class="p">(</span><span class="nx">ts</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">getStatisticsPromise</span><span class="p">(</span><span class="nx">ts</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">stats</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// Date can be either in ISO format or a timestamp (utc, in milliseconds)</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">getStatistics</span><span class="o">(</span><span class="s">"2015-11-15T13:36:45.558Z"</span><span class="o">,</span> <span class="k">new</span> <span class="n">KuzzleResponseListener</span><span class="o">&lt;</span><span class="n">JSONArray</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONArray</span> <span class="n">results</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">};</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="c1">// Date can be either in ISO format or a timestamp (utc, in milliseconds)
</span><span class="nv">$date</span> <span class="o">=</span> <span class="nb">time</span><span class="p">()</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">;</span>
<span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">getStatistics</span><span class="p">(</span><span class="nv">$date</span><span class="p">);</span>

<span class="c1">// $result is an array
</span></code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"mqtt"</span><span class="p">:</span><span class="w"> </span><span class="mi">37</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">17</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110641308"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">34</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110642308"</span><span class="w"> </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w"> </span><span class="nt">"connections"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"ongoingRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"rest"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"completedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"socketio"</span><span class="p">:</span><span class="w"> </span><span class="mi">40</span><span class="w"> </span><span class="p">},</span><span class="w">
    </span><span class="nt">"failedRequests"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1453110643308"</span><span class="w"> </span><span class="p">}]</span><span class="w">
</span></code></pre>

<p>Kuzzle monitors active connections, and ongoing/completed/failed requests.<br>
This method allows getting either the last statistics frame, or a set of frames starting from a provided timestamp.</p>

<h3 id="getstatistics-timestamp-options-callback">getStatistics([timestamp], [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">timestamp</code></td>
<td>Epoch time</td>
<td>Optional starting time from which the frames are to be retrieved</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<p><strong>Note:</strong> Kuzzle statistics are cleaned up regularly. If the timestamp is set too far in the past, then this method will return all available statistics.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an <code class="prettyprint">array</code> containing one or more statistics frame(s), as JSON objects.</p>

<h2 id="listcollections">listCollections</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">listCollections</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'stored'</span><span class="p">,</span> <span class="na">from</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">size</span><span class="p">:</span> <span class="mi">42</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">collections</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">listCollectionsPromise</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'stored'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">collections</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">listCollections</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$collections</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">listCollections</span><span class="p">(</span><span class="s1">'index'</span><span class="p">,</span> <span class="p">[</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'stored'</span><span class="p">,</span>
  <span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">'size'</span> <span class="o">=&gt;</span> <span class="mi">42</span>
<span class="p">]);</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime_1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime_2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime_..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime_n"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"realtime"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored_1"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored_2"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored_..."</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored"</span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored_n"</span><span class="p">,</span><span class="w"> </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"stored"</span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Retrieves the list of known data collections contained in a specified index.</p>

<h3 id="listcollections-index-options-callback">listCollections([index], [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td>Index containing the collections to be listed</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">from</code></td>
<td>integer</td>
<td>Determines the starting point of the pagination. By default, start at the beggining</td>
<td><code class="prettyprint">0</code></td>
</tr>
<tr>
<td><code class="prettyprint">size</code></td>
<td>integer</td>
<td>Determines the size of the returned result set. By default, no limit is applied</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
<tr>
<td><code class="prettyprint">type</code></td>
<td>string</td>
<td>Get either <code class="prettyprint">stored</code> collections or <code class="prettyprint">realtime</code> ones. By default, list <code class="prettyprint">all</code> collections</td>
<td><code class="prettyprint">all</code></td>
</tr>
</tbody></table>

<p>If no <code class="prettyprint">index</code> argument is provided, the <code class="prettyprint">defaultIndex</code> property is used. If no default index is found, this method throws an error.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">JSON object</code> containing the list of stored and/or realtime collections on the provided index.</p>

<h2 id="listindexes">listIndexes</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">listIndexes</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">indexes</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">listIndexesPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">indexes</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">listIndexes</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$indexes</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">listIndexes</span><span class="p">();</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"index"</span><span class="p">,</span><span class="w"> </span><span class="s2">"another index"</span><span class="p">,</span><span class="w"> </span><span class="s2">"..."</span><span class="p">]</span><span class="w">
</span></code></pre>

<p>Retrieves the list of indexes stored in Kuzzle.</p>

<h3 id="listindexes-options-callback">listIndexes([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>The response is an <code class="prettyprint">array</code> of index names.</p>

<h2 id="login">login</h2>

<aside class="notice">
This method is non-queuable, meaning that during offline mode, it will be discarded and the callback will be called with an error.
</aside>
<pre class="highlight javascript"><code><span class="c1">// Expiration time is expressed as a string following the</span>
<span class="c1">// time conversion library: https://www.npmjs.com/package/ms</span>
 <span class="kd">var</span> <span class="nx">expiresIn</span> <span class="o">=</span> <span class="s2">"1h"</span><span class="p">;</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="s2">"local"</span><span class="p">,</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span> <span class="s2">"username"</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="s2">"password"</span><span class="p">},</span> <span class="nx">expiresIn</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">loginPromise</span><span class="p">(</span><span class="s2">"local"</span><span class="p">,</span> <span class="p">{</span><span class="na">username</span><span class="p">:</span> <span class="s2">"username"</span><span class="p">,</span> <span class="na">password</span><span class="p">:</span> <span class="s2">"password"</span><span class="p">},</span> <span class="nx">expiresIn</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">credentials</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"username"</span><span class="o">,</span> <span class="s">"John Doe"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"my secret password"</span><span class="o">);</span>

<span class="n">kuzzle</span><span class="o">.</span><span class="na">login</span><span class="o">(</span><span class="s">"local"</span><span class="o">,</span> <span class="n">credentials</span><span class="o">,</span> <span class="mi">30000</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="c1">// Expiration time is expressed as a string following the
// time conversion library: https://www.npmjs.com/package/ms
</span><span class="nv">$expiresIn</span> <span class="o">=</span> <span class="s2">"1h"</span><span class="p">;</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">login</span><span class="p">(</span><span class="s1">'local'</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">'username'</span> <span class="o">=&gt;</span> <span class="s1">'myusername'</span><span class="p">,</span>
    <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span>
  <span class="p">],</span> <span class="nv">$expiresIn</span><span class="p">);</span>

  <span class="c1">// ...
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Handle error
</span><span class="p">}</span>
</code></pre>

<p>Log a user according to a strategy and credentials.</p>

<p>If the Kuzzle response contains a JWT Token, the SDK token is set and the <code class="prettyprint">loginAttempt</code> event is fired immediately with the following object:<br>
<code class="prettyprint">{ success: true }</code><br>
This is the case, for instance, with the <code class="prettyprint">local</code> authentication strategy.</p>

<p>If the request succeeds but there is no token, then it means that the chosen strategy is a two-steps authentication method, like OAUTH. In that case, the <code class="prettyprint">loginAttempt</code> event is <strong>not</strong> fired. To complete the login attempt, the <code class="prettyprint">setJwtToken</code> method must be called either with a token or with an appropriate Kuzzle response.</p>

<p>If the login attempt fails, the <code class="prettyprint">loginAttempt</code> event is fired with the following response:<br>
<code class="prettyprint">{ success: false, error: &#39;error message&#39; }</code></p>

<h3 id="login-strategy-credentials-expiresin-callback">login(strategy, [credentials], [expiresIn], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">strategy</code></td>
<td>string</td>
<td>Authentication strategy (local, facebook, github, &hellip;)</td>
</tr>
<tr>
<td><code class="prettyprint">credentials</code></td>
<td>JSON object</td>
<td>Optional login credentials, depending on the strategy</td>
</tr>
<tr>
<td><code class="prettyprint">expiresIn</code></td>
<td>&lt;varies&gt;</td>
<td>Login expiration time</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback handling the response</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> If the <code class="prettyprint">expiresIn</code> argument is not set, the default token expiration value will be taken from the Kuzzle server configuration.</p>

<p>By default, kuzzle embed the plugin <a href="https://github.com/kuzzleio/kuzzle-plugin-auth-passport-local">kuzzle-plugin-auth-passport-local</a> which provide <code class="prettyprint">local</code> stored password authentication strategy.
This strategy require <code class="prettyprint">username</code> and <code class="prettyprint">password</code> as <code class="prettyprint">credentials</code></p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a JSON object containing the Kuzzle response.</p>

<h2 id="logout">logout</h2>

<aside class="notice">
This method is non-queuable, meaning that during offline mode, it will be discarded and the callback will be called with an error.
</aside>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">logout</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">logoutPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">logout</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Void</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">logout</span><span class="p">();</span>
  <span class="c1">// everything went fine
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Logs the user out.</p>

<h3 id="logout-callback">logout([callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback handling the response</td>
</tr>
</tbody></table>

<p>This method empties the <code class="prettyprint">jwtToken</code> property</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the <code class="prettyprint">Kuzzle</code> object itself once the logout process is complete, either successfully or not.<br>
The <code class="prettyprint">Kuzzle</code> object will unset the property <code class="prettyprint">jwtToken</code> if the user is successfully logged out.</p>

<h2 id="memorystorage">memoryStorage</h2>

<p>A <code class="prettyprint">MemoryStorage</code> singleton.</p>

<h2 id="now">now</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">now</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// 'res' contains the Kuzzle timestamp (utc, in milliseconds)</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">nowPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// 'res' contains the Kuzzle timestamp (utc, in milliseconds)</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">now</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Date</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Date</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 'object' contains the Kuzzle timestamp (utc, in milliseconds)</span>
  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$kuzzleTime</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">now</span><span class="p">();</span>

<span class="c1">// $kuzzleTime instanceof DateTime
</span></code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="mi">1447151167622</span><span class="w">
</span></code></pre>

<p>Retrieves the current Kuzzle time.</p>

<h3 id="now-options-callback">now([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Returns a <code class="prettyprint">integer</code> containing the current Kuzzle time, encoded as an UTC Epoch time in milliseconds.</p>

<h2 id="query">query</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="na">controller</span><span class="p">:</span> <span class="s1">'document'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'search'</span><span class="p">},</span> <span class="p">{</span><span class="na">match</span><span class="p">:</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'this is a test'</span> <span class="p">}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">queryPromise</span><span class="p">({</span><span class="na">controller</span><span class="p">:</span> <span class="s1">'document'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'search'</span><span class="p">},</span> <span class="p">{</span><span class="na">match</span><span class="p">:</span> <span class="p">{</span> <span class="na">message</span><span class="p">:</span> <span class="s1">'this is a test'</span> <span class="p">}})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">QueryArgs</span> <span class="n">args</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QueryArgs</span><span class="o">();</span>
<span class="n">args</span><span class="o">.</span><span class="na">controller</span> <span class="o">=</span> <span class="s">"document"</span><span class="o">;</span>
<span class="n">args</span><span class="o">.</span><span class="na">action</span> <span class="o">=</span> <span class="s">"search"</span><span class="o">;</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">query</span><span class="o">(</span><span class="n">args</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(),</span> <span class="k">new</span> <span class="n">OnQueryDoneListener</span><span class="o">()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle error</span>
  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$queryArgs</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controller'</span> <span class="o">=&gt;</span> <span class="s1">'document'</span><span class="p">,</span>
  <span class="s1">'action'</span> <span class="o">=&gt;</span> <span class="s1">'search'</span>
<span class="p">];</span>

<span class="nv">$query</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'filter'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'equals'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">query</span><span class="p">(</span><span class="nv">$queryArgs</span><span class="p">,</span> <span class="nv">$query</span><span class="p">);</span>
  <span class="c1">// var_dump($response['result']['hits']);
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w"> </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"_shards"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"failed"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"successful"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
    </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"search"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"foo"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"read"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"hits"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">
      </span><span class="nt">"max_score"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
      </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bf87b930-7c02-11e5-ab10-dfa9e9fd2e07"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"timed_out"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
    </span><span class="nt">"took"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<aside class="warning">
This is a low-level method, exposed to allow advanced SDK users to bypass high-level methods.<br/>
Check the Kuzzle API Reference available <a href="/api-reference">here</a>
</aside>

<p>Base method used to send queries to Kuzzle, following the <a href="/api-reference">API Reference</a></p>

<h3 id="query-queryargs-query-options-callback">query(queryArgs, query, [options], [callback])</h3>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queryArgs</code></td>
<td>JSON object</td>
<td>Query base arguments</td>
</tr>
<tr>
<td><code class="prettyprint">query</code></td>
<td>JSON object</td>
<td>Query to execute</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Expected <code class="prettyprint">queryArgs</code> content:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Required?</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">controller</code></td>
<td>string</td>
<td>API Controller argument</td>
<td>required</td>
</tr>
<tr>
<td><code class="prettyprint">action</code></td>
<td>string</td>
<td>API Controller action</td>
<td>required</td>
</tr>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td>Index concerned by the action</td>
<td>optional</td>
</tr>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>Data collection concerned by the action</td>
<td>optional</td>
</tr>
</tbody></table>

<p>Available <code class="prettyprint">options</code>:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">JSON object</code> containing the raw Kuzzle response.</p>

<h2 id="refreshindex">refreshIndex</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">refreshIndex</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">refreshIndex</span><span class="o">(</span><span class="s">"myIndex"</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">refreshIndex</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>When writing or deleting documents in Kuzzle&rsquo;s database layer, the update needs to be indexed before being reflected
in the search index.<br>
By default, this operation can take up to 1 second.</p>

<p>Given an index, the <code class="prettyprint">refresh</code> action forces a <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a>,
 on it, making the documents visible to search immediately.</p>

<aside class="left warning">
    A refresh operation comes with some performance costs.<br>
    <br>
    From <a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api">elasticsearch documentation</a>:
    <div class="quote">
    &ldquo;While a refresh is much lighter than a commit, it still has a performance cost. A manual refresh can be useful when writing tests, but don’t do a manual refresh every time you index a document in production; it will hurt your performance. Instead, your application needs to be aware of the near real-time nature of Elasticsearch and make allowances for it.&rdquo;
    </div>
</aside>

<h4 id="refreshindex-index-options-callback">refreshIndex([index], [options], [callback])</h4>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td><em>Optional</em>. The index to refresh. If not set, defaults to <a href="#properties">kuzzle.defaultIndex</a>.</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td><em>Optional</em>. Callback handling the response.</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not)queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h4 id="callback-response">Callback response</h4>

<p>The response is a JSON structure matching the response from Elasticsearch.</p>

<h2 id="removealllisteners">removeAllListeners</h2>
<pre class="highlight javascript"><code><span class="c1">// Removes all listeners on the "unsubscribed" global event</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">'disconnected'</span><span class="p">);</span>

<span class="c1">// Removes all listeners on all global events</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">removeAllListeners</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// Removes all listeners on the "unsubscribed" global event</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">removeAllListeners</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">disconnected</span><span class="o">);</span>

<span class="c1">// Removes all listeners on all global events</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">removeAllListeners</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="c1">// Removes all listeners on the "jwtTokenExpired" global event
</span><span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">removeAllListeners</span><span class="p">(</span><span class="s1">'jwtTokenExpired'</span><span class="p">);</span>

<span class="c1">// Removes all listeners on all global events
</span><span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">removeAllListeners</span><span class="p">();</span>
</code></pre>

<p>Removes all listeners, either from a specific event or from all events</p>

<h3 id="removealllisteners-event">removeAllListeners([event])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">event</code></td>
<td>string</td>
<td>One of the event described in the <code class="prettyprint">Event Handling</code> section of this documentation</td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="removelistener">removeListener</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="s1">'disconnected'</span><span class="p">,</span> <span class="nx">listenerId</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">removeListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">disconnected</span><span class="o">,</span> <span class="s">"listenerId"</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">removeListener</span><span class="p">(</span><span class="s1">'jwtTokenExpired'</span><span class="p">,</span> <span class="nv">$listenerId</span><span class="p">);</span>
</code></pre>

<p>Removes a listener from an event.</p>

<h3 id="removelistener-event-listenerid">removeListener(event, listenerID)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">event</code></td>
<td>string</td>
<td>One of the event described in the <code class="prettyprint">Event Handling</code> section of this documentation</td>
</tr>
<tr>
<td><code class="prettyprint">listenerID</code></td>
<td>string</td>
<td>The ID returned by <code class="prettyprint">addListener</code></td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="replayqueue">replayQueue</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">replayQueue</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">replayQueue</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Replays the requests queued during offline mode. Works only if the SDK is not in a <code class="prettyprint">disconnected</code> state, and if the <code class="prettyprint">autoReplay</code> option is set to <code class="prettyprint">false</code>.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="security">security</h2>

<p>A <code class="prettyprint">Security</code> singleton.</p>

<h2 id="setautorefresh">setAutoRefresh</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">setAutoRefresh</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">setAutoRefresh</span><span class="o">(</span><span class="s">"myIndex"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">setAutoRefresh</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>

<p>The <code class="prettyprint">autoRefresh</code> flag, when set to true, will make Kuzzle perform a
<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/near-real-time.html#refresh-api"><code class="prettyprint">refresh</code></a> request
immediately after each write request, forcing the documents to be immediately visible to search.</p>

<p>Given an index, the <code class="prettyprint">setAutoRefresh</code> function updates its <code class="prettyprint">autoRefresh</code> status.</p>

<aside class="left warning">
    <p>
        A refresh operation comes with some performance costs.
    </p>
    <p>
        While forcing the autoRefresh can be convenient on a development or test environmnent, it is advised to avoid
        using it on production or at least to carefully monitor its implications before using it.
    </p>
</aside>

<h4 id="setautorefresh-index-autorefresh-options-callback">setAutoRefresh([index], autoRefresh, [options], [callback])</h4>

<table><thead>
<tr>
<th>Argument</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td><em>Optional</em> The index to set the <code class="prettyprint">autoRefresh</code> for. If not set, defaults to <a href="#properties">kuzzle.defaultIndex</a>.</td>
</tr>
<tr>
<td><code class="prettyprint">autoRefresh</code></td>
<td>boolean</td>
<td>The value to set for the <code class="prettyprint">autoRefresh</code> setting.</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td><em>Optional</em> Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Makr this request as (non)queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h4 id="callback-response">Callback response</h4>

<p>The response is a boolean reflecting the new <code class="prettyprint">autoRefresh</code> status.</p>

<h2 id="setdefaultindex">setDefaultIndex</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">setDefaultIndex</span><span class="p">(</span><span class="s1">'index'</span><span class="p">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">setDefaultIndex</span><span class="p">(</span><span class="s1">'myIndex'</span><span class="p">);</span>
</code></pre>

<p>Set the default data index. Has the same effect than the <code class="prettyprint">defaultIndex</code> constructor option.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="updateself">updateSelf</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Jonas'</span>
<span class="p">};</span>


<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">updateSelf</span><span class="p">(</span><span class="nx">newContent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedUser</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">updateSelfPromise</span><span class="p">(</span><span class="nx">newContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedUser</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"My Name Is"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Jonas"</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">updateSelf</span><span class="o">(</span><span class="n">newContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$newContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Jonas'</span>
<span class="p">];</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$updatedUser</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">updateSelf</span><span class="p">(</span><span class="nv">$newContent</span><span class="p">);</span>
  <span class="c1">// $updatedUser instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<h4 id="updateself-content-options-callback">updateSelf(content, [options], [callback])</h4>

<p>Performs a partial update on the current user.</p>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain javascript object representing the user</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h4 id="callback-response">Callback response</h4>

<p>Resolves to the updated user plain object.</p>

<h2 id="setheaders">setHeaders</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">setHeaders</span><span class="p">({</span><span class="na">someContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"someContent"</span><span class="o">,</span> <span class="s">"someValue"</span><span class="o">);</span>

<span class="n">kuzzle</span><span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="n">headers</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$newHeaders</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'someContent'</span> <span class="o">=&gt;</span> <span class="s1">'someValue'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">(</span><span class="nv">$newHeaders</span><span class="p">);</span>
</code></pre>

<p>This is a helper function returning itself, allowing to easily chain calls.</p>

<h3 id="setheaders-content-replace">setHeaders(content, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="setjwttoken">setJwtToken</h2>
<pre class="highlight javascript"><code><span class="c1">// Directly with a JWT Token</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">setJwtToken</span><span class="p">(</span><span class="s1">'some jwt token'</span><span class="p">);</span>

<span class="cm">/*
 Or with a Kuzzle response.
 For instance, the final OAUTH2 response is obtained with a redirection from Kuzzle,
 and it can be provided to this method directly
 */</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">setJwtToken</span><span class="p">(</span><span class="nx">authenticationResponse</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// Directly with a JWT Token</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">setJwtToken</span><span class="o">(</span><span class="s">"some jwt token"</span><span class="o">);</span>

<span class="cm">/*
 Or with a Kuzzle response.
 For instance, the final OAUTH2 response is obtained with a redirection from Kuzzle,
 and it can be provided to this method directly.

 Here, "authenticationResponse" is an instance of JSONObject
 */</span>
<span class="n">kuzzle</span><span class="o">.</span><span class="na">setJwtToken</span><span class="o">(</span><span class="n">authenticationResponse</span><span class="o">)</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="c1">// Directly with a JWT Token
</span><span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">setJwtToken</span><span class="p">(</span><span class="s1">'some jwt token'</span><span class="p">);</span>


<span class="cm">/*
 Or with a Kuzzle response.
 For instance, the final OAUTH2 response is obtained with a redirection from Kuzzle,
 and it can be provided to this method directly
 */</span>
 <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">setJwtToken</span><span class="p">(</span><span class="nv">$authenticationResponse</span><span class="p">);</span>
</code></pre>

<p>Sets the internal JWT token which will be used to request kuzzle.</p>

<p>If the provided token is correct, a <code class="prettyprint">loginAttempt</code> event is fired with the following object:<br>
<code class="prettyprint">{ success: true }</code></p>

<p>If not, the <code class="prettyprint">loginAttempt</code> event is fired with the following response:<br>
<code class="prettyprint">{ success: false, error: &#39;error message&#39; }</code></p>

<h3 id="setjwttoken-jwttoken">setJwtToken(jwtToken)</h3>

<h3 id="setjwttoken-kuzzleresponse">setJwtToken(kuzzleResponse)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">jwtToken</code></td>
<td>string</td>
<td>Previously generated JSON Web Token</td>
</tr>
<tr>
<td><code class="prettyprint">kuzzleResponse</code></td>
<td>JSON object</td>
<td>Final Kuzzle response from a 2-steps authentication process</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="unsetjwttoken">unsetJwtToken</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">unsetJwtToken</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">unsetJwtToken</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">unsetJwtToken</span><span class="p">();</span>
</code></pre>

<p>Unsets the internal JWT token used for authentication, and stops all existing subscriptions</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="startqueuing">startQueuing</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">startQueuing</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">startQueuing</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Starts the requests queuing. Works only during offline mode, and if the <code class="prettyprint">autoQueue</code> option is set to <code class="prettyprint">false</code>.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="stopqueuing">stopQueuing</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">stopQueuing</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">stopQueuing</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Stops the requests queuing. Works only during offline mode, and if the <code class="prettyprint">autoQueue</code> option is set to <code class="prettyprint">false</code>.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Kuzzle</code> object to allow chaining.</p>

<h2 id="whoami">whoAmI</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">whoAmI</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// "result" is a User object</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span><span class="p">.</span><span class="nx">whoAmIPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// "res" is a User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">whoAmI</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">myself</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$me</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">whoAmI</span><span class="p">();</span>
  <span class="c1">// $me instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves current user object.</p>

<h3 id="whoami-callback">whoAmI(callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>An instantiated <code class="prettyprint">User</code> object.</p>

            <h1 id="collection">Collection</h1>

<p>In Kuzzle, you manipulate documents and subscriptions, both related to data collections.</p>

<p>A data collection is a set of data managed by Kuzzle. It acts like a data table for persistent documents, or like a room for pub/sub messages.</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">dataCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nx">kuzzle</span><span class="p">,</span> <span class="s2">"my-collection"</span><span class="p">,</span> <span class="s2">"my-index"</span><span class="p">)</span>
</code></pre>
<pre class="highlight java"><code>  <span class="n">Collection</span> <span class="n">myCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Collection</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">,</span> <span class="s">"my-collection"</span><span class="o">,</span> <span class="s">"my-index"</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Collection</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Collection</span><span class="p">(</span><span class="nv">$kuzzle</span><span class="p">,</span> <span class="s1">'my-collection'</span><span class="p">,</span> <span class="s1">'my-index'</span><span class="p">);</span>
</code></pre>

<h3 id="collection-kuzzle-collection-index">Collection(kuzzle, collection, index)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">kuzzle</code></td>
<td>object</td>
<td>Kuzzle object</td>
</tr>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>The name of the data collection you want to manipulate</td>
</tr>
<tr>
<td><code class="prettyprint">index</code></td>
<td>string</td>
<td>Name of the index containing the data collection</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> It&rsquo;s recommended to instantiate a Collection object by calling <a href="#collection">Kuzzle.collection</a> rather than using the constructor directly</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">kuzzle</code></td>
<td>object</td>
<td>linked kuzzle instance</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">index</code></td>
<td>object</td>
<td>Name of the index containing the data collection</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>The name of the data collection handled by this instance</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>object</td>
<td>Headers for all sent documents.</td>
<td>get/set</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> the <code class="prettyprint">headers</code> property is inherited from the main <code class="prettyprint">Kuzzle</code> object and can be overrided</p>

<h2 id="collectionmapping">collectionMapping</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">dataMapping</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">collectionMapping</span><span class="p">({</span><span class="na">someField</span><span class="p">:</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'analyzed'</span><span class="p">}})</span>
  <span class="p">.</span><span class="nx">apply</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">CollectionMapping</span> <span class="n">dataMapping</span> <span class="o">=</span> <span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">collectionMapping</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"someFiled"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"analyzed"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">apply</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="nv">$mapping</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'someField'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'string'</span><span class="p">,</span>
    <span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'analyzed'</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$dataMapping</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">collectionMapping</span><span class="p">(</span><span class="nv">$mapping</span><span class="p">);</span>

  <span class="c1">// $dataMapping instanceof DataMapping
</span>  <span class="nv">$dataMapping</span><span class="o">-&gt;</span><span class="na">apply</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Creates a new <code class="prettyprint">CollectionMapping</code> object, using its constructor.</p>

<h3 id="collectionmapping-mapping">collectionMapping([mapping])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">mapping</code></td>
<td>JSON Object</td>
<td>Optional mapping</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the newly created <code class="prettyprint">CollectionMapping</code> object.</p>

<h2 id="count">count</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">count</span><span class="p">({},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
 <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">countPromise</span><span class="p">({})</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// ...</span>
 <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Integer</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle success</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">(</span><span class="nv">$filters</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="mi">12</span><span class="w">
</span></code></pre>

<aside class="notice">There is a small delay between documents creation and their existence in our search layer, usually a couple of seconds. That means that a document that was just been created won&rsquo;t be returned by this function</aside>

<p>Returns the number of documents matching the provided set of filters.</p>

<h3 id="count-filters-options-callback">count(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td>Filters in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/query-dsl.html">ElasticSearch Query DSL</a> format</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the matched documents count as a <code class="prettyprint">integer</code>.</p>

<h2 id="create">create</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback called once the create operation has completed</span>
    <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
 <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">createPromise</span><span class="p">()</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// promise resolved once the create operation has completed</span>
   <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
 <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// callback called once the create operation has completed</span>
      <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"cf1fc8b4-fd87-46c3-b0a2-3d9d2fb7d401"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"write"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"createCollection"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"newly created collection"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"done"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"scope"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Create a new empty data collection, with no associated mapping.</p>

<h3 id="create-options-callback">create([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">JSON object</code> containing the raw Kuzzle response.</p>

<h2 id="createdocument">createDocument</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">createDocument</span><span class="p">(</span><span class="s1">'foobar'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">},</span> <span class="p">{</span><span class="na">updateIfExist</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback called once the create action has been completed</span>
    <span class="c1">// =&gt; the result is a Document object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
 <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">createDocumentPromise</span><span class="p">(</span><span class="s1">'foobar'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">},</span> <span class="p">{</span><span class="na">updateIfExist</span><span class="p">:</span> <span class="kc">true</span><span class="p">})</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// promise resolved once the create action has been completed</span>
   <span class="c1">// =&gt; the result is a Document object</span>
 <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Document</span> <span class="n">myDocument</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="n">collection</span><span class="o">);</span>
<span class="n">myDocument</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">);</span>
<span class="n">myDocument</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="s">"content"</span><span class="o">,</span> <span class="s">"bar"</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">createDocument</span><span class="o">(</span><span class="n">myDocument</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// callback called once the create action has been completed</span>
      <span class="c1">// =&gt; the result is a Document object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">createDocument</span><span class="p">(</span><span class="nv">$documentContent</span><span class="p">,</span> <span class="nv">$documentId</span><span class="p">);</span>

  <span class="c1">// $document instanceof Document
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Create a new document in Kuzzle.</p>

<h3 id="createdocument-document-options-callback">createDocument(Document, [options], [callback])</h3>

<h3 id="createdocument-id-content-options-callback">createDocument([id], content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Document</code></td>
<td>object</td>
<td>Document object</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Optional document identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Content of the document to create</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the peristence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
<tr>
<td><code class="prettyprint">updateIfExist</code></td>
<td>boolean</td>
<td>If the same document already exists: throw an error if sets to <code class="prettyprint">false</code>. Update the existing document otherwise</td>
<td><code class="prettyprint">false</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Document</code> object containing the newly created document.</p>

<h2 id="delete">delete</h2>

<aside class="warning">
Since the 2.0 version, ElasticSearch <a href="https://www.elastic.co/guide/en/elasticsearch/reference/2.4/breaking_20_mapping_changes.html#_types_may_no_longer_be_deleted">removed the ability to delete a Type</a>, which is used internally by Kuzzle to store its collections.<br>
<br>
As such, it is not possible to delete a collection from Kuzzle either. You can still delete all the documents that belong to a collection but if you need to delete the collection mapping, you will need to use a new index.
</aside>

<h2 id="deletedocument">deleteDocument</h2>
<pre class="highlight javascript"><code><span class="c1">// Deleting one document using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">deleteDocument</span><span class="p">(</span><span class="s1">'document unique ID'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback called once the delete action has been completed</span>
  <span class="p">});</span>

<span class="c1">// Deleting one document using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">deleteDocumentPromise</span><span class="p">(</span><span class="s1">'document unique ID'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// promises resolved once the delete action has been completed</span>
  <span class="p">});</span>

<span class="c1">// Deleting multiple documents using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">deleteDocument</span><span class="p">({</span><span class="na">filter</span><span class="p">:</span> <span class="p">{</span><span class="na">equals</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">}}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback called once the delete with query has been completed</span>
  <span class="p">});</span>

<span class="c1">// Deleting multiple documents using promises (NodeJS)</span>
 <span class="nx">kuzzle</span>
 <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">deleteDocumentPromise</span><span class="p">({</span><span class="na">filter</span><span class="p">:</span> <span class="p">{</span><span class="na">equals</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">}}})</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// promise resolved once the delete by query has been completed</span>
 <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// Deleting one document</span>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">deleteDocument</span><span class="o">(</span><span class="s">"document unique ID"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// The resulting string contains the deleted document ID</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>

<span class="c1">// Deleting multiple documents</span>
<span class="n">JSONObject</span> <span class="n">equalsFilter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"filter"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"equals"</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"foo"</span><span class="o">)</span>
  <span class="o">));</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">deleteDocument</span><span class="o">(</span><span class="n">equalsFilter</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">[]&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// The resulting object contains the list of deleted document IDs</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="c1">// Deleting one document
</span><span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">deleteDocument</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

<span class="c1">// Deleting multiple documents
</span><span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'filter'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'equals'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span><span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">deleteDocument</span><span class="p">(</span><span class="nv">$filters</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">[</span><span class="w"> </span><span class="s2">"AVCoeBkimsySTKTfa8AX"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span></code></pre>

<aside class="notice">
There is a small delay between documents creation and their existence in our search layer, usually a couple of seconds. That means that a document that was just been created won&rsquo;t be deleted by the filtered version of this function
</aside>

<p>Delete either a stored document, or all stored documents matching search filters.</p>

<h3 id="deletedocument-documentid-options-callback">deleteDocument(documentId, [options], [callback])</h3>

<h3 id="deletedocument-filters-options-callback">deleteDocument(filters, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">documentId</code></td>
<td>string</td>
<td>Unique document identifier</td>
</tr>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON object</td>
<td>Filters in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/query-dsl.html">ElasticSearch Query DSL</a> format</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the peristence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an <code class="prettyprint">array</code> containing the deleted document IDs.</p>

<h2 id="document">document</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nb">document</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nb">document</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="p">{</span><span class="na">some</span><span class="p">:</span> <span class="s1">'content'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">save</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">document</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"some"</span><span class="o">,</span> <span class="s">"content"</span><span class="o">))</span>
  <span class="o">.</span><span class="na">save</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>
<span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">document</span><span class="p">(</span><span class="nv">$documentId</span><span class="p">,</span> <span class="nv">$documentContent</span><span class="p">);</span>

<span class="c1">// $document instanceof Document
</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Creates a new <code class="prettyprint">Document</code> object, using its constructor.</p>

<h3 id="document-id-content">document([id], [content])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Optional document unique ID</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Optional document content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the newly created <code class="prettyprint">Document</code> object.</p>

<h2 id="fetchdocument">fetchDocument</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">fetchDocument</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">fetchDocumentPromise</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetchDocument</span><span class="o">(</span><span class="s">"documentId"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// result is a Document object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">fetchDocument</span><span class="p">(</span><span class="nv">$documentId</span><span class="p">);</span>

  <span class="c1">// $document instanceof Document
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves a single stored document using its unique document ID.</p>

<h3 id="fetchdocument-documentid-options-callback">fetchDocument(documentId, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">documentId</code></td>
<td>string</td>
<td>Unique document identifier</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Document</code> object.</p>

<h2 id="fetchalldocuments">fetchAllDocuments</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">fetchAllDocuments</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is an object containing the total number of documents</span>
    <span class="c1">// and an array of Document objects</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">fetchAllDocumentsPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is an object containing the total number of documents</span>
    <span class="c1">// and an array of Document objects</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">fetchAllDocuments</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">DocumentList</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">DocumentList</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// result is an object containing the total number of documents</span>
      <span class="c1">// and an array of Document objects</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Document</span> <span class="n">doc</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">getDocuments</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Get documents</span>
      <span class="o">}</span>

      <span class="n">result</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span> <span class="c1">// return total of documents returned</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Util\SearchResult</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">fetchAllDocuments</span><span class="p">();</span>

  <span class="c1">// $result instanceof SearchResult
</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getDocuments</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$document</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $result instanceof Document
</span>  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w"> </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nt">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;Document&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;Document&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;Document&gt;</span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Retrieves all documents stored in this data collection.</p>

<h3 id="fetchalldocuments-options-callback">fetchAllDocuments([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">from</code></td>
<td>integer</td>
<td>Upper bounds for paginated results.</td>
<td><code class="prettyprint">0</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">size</code></td>
<td>integer</td>
<td>Lower bounds for paginated results.</td>
<td><code class="prettyprint">10</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an object containing:</p>

<ul>
<li>the total number of retrieved documents</li>
<li>a <code class="prettyprint">array</code> of <code class="prettyprint">Document</code> objects</li>
</ul>

<h2 id="getmapping">getMapping</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getMapping</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a CollectionMapping object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getMappingPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a CollectionMapping object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">getMapping</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">CollectionMapping</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">CollectionMapping</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// result is a CollectionMapping object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$mapping</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">getMapping</span><span class="p">();</span>

  <span class="c1">// $mapping instanceof DataMapping
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves the current mapping of this collection.</p>

<h3 id="getmapping-options-callback">getMapping([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">CollectionMapping</code> object.</p>

<h2 id="publishmessage">publishMessage</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">publishMessage</span><span class="p">({</span><span class="na">foo</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">,</span> <span class="na">baz</span><span class="p">:</span> <span class="s1">'qux'</span><span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">message</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"some"</span><span class="o">,</span> <span class="s">"content"</span><span class="o">);</span>
<span class="n">JSONObject</span> <span class="n">metadata</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"metadata"</span><span class="o">,</span> <span class="s">"are volatile information"</span><span class="o">);</span>
<span class="n">Options</span> <span class="n">opts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Options</span><span class="o">().</span><span class="na">setMetadata</span><span class="o">(</span><span class="n">metadata</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">publish</span><span class="o">(</span><span class="n">message</span><span class="o">,</span> <span class="n">opts</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$message</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">publishMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Publish a realtime message</p>

<h3 id="publishmessage-document-options-callback">publishMessage(Document, [options], [callback])</h3>

<h3 id="publishmessage-content-options-callback">publishMessage(content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Document</code></td>
<td>object</td>
<td>Document object</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Content of the document to publish</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a raw Kuzzle response in JSON format.</p>

<h2 id="replacedocument">replaceDocument</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">replaceDocument</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">replaceDocumentPromise</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="s">"new"</span><span class="o">,</span> <span class="s">"document content"</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">replaceDocument</span><span class="o">(</span><span class="s">"documentId"</span><span class="o">,</span> <span class="n">newContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">replaceDocument</span><span class="p">(</span><span class="nv">$documentId</span><span class="p">,</span> <span class="nv">$documentContent</span><span class="p">);</span>

  <span class="c1">// $document instanceof Document
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Replace an existing document with a new one.</p>

<h3 id="replacedocument-documentid-content-options-callback">replaceDocument(documentId, content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">documentId</code></td>
<td>string</td>
<td>Unique document identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Content of the document to create</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the peristence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an updated <code class="prettyprint">Document</code> object.</p>

<h2 id="room">room</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">room</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">renew</span><span class="p">({</span><span class="na">in</span><span class="p">:</span> <span class="p">{</span><span class="na">field</span><span class="p">:</span> <span class="p">[</span><span class="s1">'some'</span><span class="p">,</span> <span class="s1">'new'</span><span class="p">,</span> <span class="s1">'filter'</span><span class="p">]}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// handle notifications</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
    <span class="k">new</span> <span class="n">JSONObject</span><span class="o">(</span><span class="s">"field"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"some"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"filter"</span><span class="o">)</span>
      <span class="o">)</span>
  <span class="o">);</span>

<span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">room</span><span class="o">()</span>
  <span class="o">.</span><span class="na">renew</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">NotificationResponse</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NotificationResponse</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// handle notifications</span>
      <span class="o">}</span>

      <span class="nd">@Override</span>
      <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle notifications error</span>
      <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Creates a new <code class="prettyprint">Room</code> object, using its constructor.</p>

<h3 id="room-options">room([options])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>object</td>
<td>Subscription configuration</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the newly created <code class="prettyprint">Room</code> object.</p>

<h2 id="search">search</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">and</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">in</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">status</span><span class="p">:</span> <span class="p">[</span><span class="s1">'idle'</span><span class="p">,</span> <span class="s1">'wantToHire'</span><span class="p">,</span> <span class="s1">'toHire'</span><span class="p">,</span> <span class="s1">'riding'</span><span class="p">],</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">in</span><span class="p">:{</span>
          <span class="na">type</span><span class="p">:</span> <span class="p">[</span><span class="s1">'cab'</span><span class="p">]</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">geo_distance</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">distance</span><span class="p">:</span> <span class="s1">'10km'</span><span class="p">,</span>
          <span class="na">pos</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">lat</span><span class="p">:</span> <span class="s1">'48.8566140'</span><span class="p">,</span> <span class="na">lon</span><span class="p">:</span> <span class="s1">'2.352222'</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">},</span>
  <span class="na">aggregations</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">aggs_name</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">terms</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">field</span><span class="p">:</span> <span class="s2">"field_name"</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">filter</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nb">document</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">});</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">searchPromise</span><span class="p">({})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">res</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">documents</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nb">document</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">toString</span><span class="p">());</span>
    <span class="p">});</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"filter"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"and"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"idle"</span><span class="o">)</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"wantToHire"</span><span class="o">)</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"toHire"</span><span class="o">)</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"riding"</span><span class="o">)</span>
          <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"cab"</span><span class="o">))</span>
        <span class="o">)</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"geo_distance"</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"distance"</span><span class="o">,</span> <span class="s">"10km"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span>
              <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
                <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lat"</span><span class="o">,</span> <span class="s">"48.8566140"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lon"</span><span class="o">,</span> <span class="s">"2.352222"</span><span class="o">)</span>
            <span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"aggregations"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"aggs_name"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"terms"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"field"</span><span class="o">,</span> <span class="s">"field_name"</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">search</span><span class="o">(</span><span class="n">userFilter</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">DocumentList</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">DocumentList</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
      <span class="k">for</span> <span class="o">(</span><span class="n">Document</span> <span class="n">doc</span> <span class="o">:</span> <span class="n">result</span><span class="o">.</span><span class="na">getDocuments</span><span class="o">())</span> <span class="o">{</span>
        <span class="c1">// Get documents</span>
      <span class="o">}</span>

      <span class="n">result</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span> <span class="c1">// return total of documents returned</span>

      <span class="n">result</span><span class="o">.</span><span class="na">getAggregations</span><span class="o">():</span> <span class="c1">// return a JSONObject representing the aggregations response</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Util\SearchResult</span><span class="p">;</span>

<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'filter'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'and'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s1">'in'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'idle'</span><span class="p">,</span> <span class="s1">'wantToHire'</span><span class="p">,</span> <span class="s1">'toHire'</span><span class="p">,</span> <span class="s1">'riding'</span><span class="p">],</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s1">'in'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'cab'</span><span class="p">]</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s1">'geo_distance'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'distance'</span> <span class="o">=&gt;</span> <span class="s1">'10km'</span><span class="p">,</span>
          <span class="s1">'pos'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'lat'</span> <span class="o">=&gt;</span> <span class="s1">'48.8566140'</span><span class="p">,</span>
            <span class="s1">'lon'</span> <span class="o">=&gt;</span> <span class="s1">'2.352222'</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">],</span>
  <span class="s1">'aggregations'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'aggs_name'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'terms'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'field_name'</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$searchResult</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">search</span><span class="p">(</span><span class="nv">$filters</span><span class="p">);</span>

  <span class="c1">// $searchResult instanceof SearchResult
</span>  <span class="nv">$searchResult</span><span class="o">-&gt;</span><span class="na">getTotal</span><span class="p">();</span>

  <span class="k">foreach</span><span class="p">(</span><span class="nv">$searchResult</span><span class="o">-&gt;</span><span class="na">getDocuments</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$document</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $document instanceof Document
</span>  <span class="p">}</span>

  <span class="c1">// return an array representing the aggregations response
</span>  <span class="nv">$searchResult</span><span class="o">-&gt;</span><span class="na">getAggregations</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w"> </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w">
  </span><span class="nt">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="err">&lt;Document&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;Document&gt;</span><span class="p">,</span><span class="w"> </span><span class="err">&lt;Document&gt;</span><span class="p">],</span><span class="w">
  </span><span class="nt">"aggregations"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"aggs_name"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="nt">"aggregation"</span><span class="p">:</span><span class="w"> </span><span class="s2">"object"</span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<aside class="notice">
There is a small delay between documents creation and their existence in our search layer, usually a couple of seconds. That means that a document that was just been created won&rsquo;t be returned by this function
</aside>

<p>Executes a search on the data collection.</p>

<h3 id="search-filters-options-callback">search(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON object</td>
<td>Filters in <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/query-dsl.html">ElasticSearch Query DSL</a> format</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">JSON object</code> containing:</p>

<ul>
<li>the total number of matched documents</li>
<li>an <code class="prettyprint">array</code> of <code class="prettyprint">Document</code> objects</li>
<li>an <code class="prettyprint">array</code> of <code class="prettyprint">aggregations</code> objects if some are provided in the request (see the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.0/search-aggregations.html">Elasticsearch documentation</a> for more details)</li>
</ul>

<h2 id="setheaders">setHeaders</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">setHeaders</span><span class="p">({</span>
    <span class="na">someContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">,</span>
    <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span> <span class="na">someMetaData</span><span class="p">:</span> <span class="p">[</span><span class="s1">'with'</span><span class="p">,</span> <span class="s1">'some'</span><span class="p">,</span> <span class="s1">'values'</span><span class="p">]}</span>
  <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"someContent"</span><span class="o">,</span> <span class="s">"someValue"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"metadata"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"someMetaData"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"with"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"some"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"values"</span><span class="o">)</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$headers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'someContent'</span> <span class="o">=&gt;</span> <span class="s1">'someValue'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>
<span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">(</span><span class="nv">$headers</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>

<p>This is a helper function returning itself, allowing to easily set headers while chaining calls.</p>

<h3 id="setheaders-content-replace">setHeaders(content, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h2 id="subscribe">subscribe</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span><span class="na">equals</span><span class="p">:</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// called each time a new notification on this filter is received</span>
    <span class="c1">// check the Room/Notifications section of this documentation</span>
    <span class="c1">// to get notification examples</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">onDone</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">roomObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handles the subscription result. Can be chained.</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"and"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"idle"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"wantToHire"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"toHire"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"riding"</span><span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"cab"</span><span class="o">))</span>
      <span class="o">)</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"geo_distance"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"distance"</span><span class="o">,</span> <span class="s">"10km"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lat"</span><span class="o">,</span> <span class="s">"48.8566140"</span><span class="o">)</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lon"</span><span class="o">,</span> <span class="s">"2.352222"</span><span class="o">)</span>
          <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="n">filter</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">NotificationResponse</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NotificationResponse</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// called each time a new notification on this filter is received</span>

      <span class="c1">// check the Room/Notifications section of this documentation</span>
      <span class="c1">// to get notification examples</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">onDone</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Room</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Room</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle subscription success</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle subscription error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Subscribes to this data collection with a set of filters.</p>

<aside class="notice">
To subscribe to the entire data collection, simply provide an empty filter.
</aside>

<h3 id="subscribe-filters-options-callback">subscribe(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td><a href="/real-time-filters">Filters</a></td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>object</td>
<td>(Optional) Subscription configuration. Passed to the Room constructor.</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback to call every time a notification is received on this subscription</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns an object exposing the following method:<br>
  <code class="prettyprint">onDone(callback)</code></p>

<p>The <code class="prettyprint">callback</code> argument is called when the subscription ends, either successfully or with an error.</p>

<h2 id="truncate">truncate</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">truncate</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// callback called once the truncate operation has completed</span>
    <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS only)</span>
<span class="nx">kuzzle</span>
 <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
 <span class="p">.</span><span class="nx">truncatePromise</span><span class="p">()</span>
 <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
   <span class="c1">// promise resolved once the truncate operation has completed</span>
   <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
 <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">truncate</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// callback called once the truncate operation has completed</span>
      <span class="c1">// =&gt; the result is a JSON object containing the raw Kuzzle response</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">truncate</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8fdc0efb-6fc7-427d-a3a1-fd8cf5eabc20"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"admin"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"truncateCollection"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name of the truncated collection"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name of the index containing the truncated collection"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"done"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nt">"acknowledged"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Truncate the data collection, removing all stored documents but keeping all associated mappings.</p>

<p>This method is a lot faster than removing all documents using a query.</p>

<h3 id="truncate-options-callback">truncate([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">JSON object</code> containing the raw Kuzzle response.</p>

<h2 id="updatedocument">updateDocument</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">updateDocument</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">updateDocumentPromise</span><span class="p">(</span><span class="s1">'documentId'</span><span class="p">,</span> <span class="p">{</span><span class="na">title</span><span class="p">:</span> <span class="s1">'foo'</span><span class="p">,</span> <span class="na">content</span><span class="p">:</span> <span class="s1">'bar'</span><span class="p">})</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Document object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newTitle</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"a shiny new title"</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">collection</span><span class="o">(</span><span class="s">"collection"</span><span class="o">,</span> <span class="s">"index"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">updateDocument</span><span class="o">(</span><span class="s">"documentId"</span><span class="o">,</span> <span class="n">newTitle</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// result is an updated Document object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'newField'</span> <span class="o">=&gt;</span> <span class="s1">'foo'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">updateDocument</span><span class="p">(</span><span class="nv">$documentId</span><span class="p">,</span> <span class="nv">$documentContent</span><span class="p">);</span>

  <span class="c1">// $document instanceof Document
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Update parts of a document, by replacing some fields or adding new ones.
Note that you cannot remove fields this way: missing fields will simply be left unchanged.</p>

<h3 id="updatedocument-documentid-content-options-callback">updateDocument(documentId, content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">documentId</code></td>
<td>string</td>
<td>Unique document identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Content of the document to create</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the persistence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Collection</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an up-to-date <code class="prettyprint">Document</code> object.</p>

            <h1 id="collectionmapping">CollectionMapping</h1>

<p>When creating a new data collection in the persistent data storage layer, Kuzzle uses a default mapping.
It means that, by default, you won&rsquo;t be able to exploit the full capabilities of our persistent data storage layer (currently handled by <a href="https://www.elastic.co/products/elasticsearch">ElasticSearch</a>), and your searches may suffer from below-average performances, depending on the amount of data you stored in a collection and the complexity of your database.</p>

<p>The CollectionMapping object allow to get the current mapping of a data collection and to modify it if needed.</p>

<aside class="notice">
Once a field mapping has been set, it cannot be removed without reconstructing the data collection.
</aside>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 CollectionMapping objects are returned by the method
 Collection.getMapping

 You may also use the Collection.collectionMapping() method:
 */</span>
<span class="kd">var</span> <span class="nx">mapping</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">).</span><span class="nx">collectionMapping</span><span class="p">();</span>

<span class="nx">mapping</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">).</span><span class="nx">collectionMapping</span><span class="p">(</span><span class="nx">mapping</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">CollectionMapping</span> <span class="n">dataMapping</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollectionMapping</span><span class="o">(</span><span class="n">dataCollection</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">mapping</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">JSONObject</span> <span class="n">type</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">type</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">);</span>
<span class="n">mapping</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">,</span> <span class="n">type</span><span class="o">);</span>

<span class="n">CollectionMapping</span> <span class="n">dataMapping</span> <span class="o">=</span> <span class="k">new</span> <span class="n">CollectionMapping</span><span class="o">(</span><span class="n">dataCollection</span><span class="o">,</span> <span class="n">mapping</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="nv">$mapping</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'someField'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'string'</span><span class="p">,</span>
    <span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'analyzed'</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="nv">$dataMapping</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">collectionMapping</span><span class="p">(</span><span class="nv">$mapping</span><span class="p">);</span>
<span class="c1">// $dataMapping instanceof DataMapping
</span></code></pre>

<h3 id="collectionmapping-collection-mapping">CollectionMapping(Collection, [mapping])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Collection</code></td>
<td>JSON Object</td>
<td>An instantiated Collection object</td>
</tr>
<tr>
<td><code class="prettyprint">mapping</code></td>
<td>JSON Object</td>
<td>Optional mapping</td>
</tr>
</tbody></table>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>JSON Object</td>
<td>Common headers for all sent documents.</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">mapping</code></td>
<td>object</td>
<td>Easy-to-understand list of mappings per field</td>
<td>get/set</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> the <code class="prettyprint">headers</code> property is inherited from the provided <code class="prettyprint">Collection</code> object and can be overrided</p>

<h2 id="apply">apply</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">dataMapping</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called once the mapping action has been completed</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">dataMapping</span><span class="p">.</span><span class="nx">applyPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// resolved once the mapping action has been completed</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">dataMapping</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">CollectionMapping</span><span class="o">&gt;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">CollectionMapping</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// called once the mapping action has been completed</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Handle error</span>
   <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $dataMapping DataMapping
 */</span>
<span class="nv">$dataMapping</span><span class="o">-&gt;</span><span class="na">apply</span><span class="p">();</span>
</code></pre>

<p>Applies the new mapping to the data collection.</p>

<h3 id="apply-options-callback">apply([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">CollectionMapping</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to this updated <code class="prettyprint">CollectionMapping</code> object.</p>

<h2 id="refresh">refresh</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS &amp; Web Browser)</span>
<span class="nx">dataMapping</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called once the mapping has been retrieved from Kuzzle</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">dataMapping</span><span class="p">.</span><span class="nx">refreshPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// resolved once the mapping has been retrieved from Kuzzle</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">dataMapping</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">CollectionMapping</span><span class="o">&gt;()</span> <span class="o">{</span>
   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">CollectionMapping</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// called once the mapping has been retrieved from Kuzzle</span>
   <span class="o">}</span>

   <span class="nd">@Override</span>
   <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// Handle error</span>
   <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $dataMapping DataMapping
 */</span>
<span class="nv">$dataMapping</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
</code></pre>

<p>Instantiates a new CollectionMapping object with an up-to-date content.</p>

<h3 id="refresh-options-callback">refresh([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to this updated <code class="prettyprint">CollectionMapping</code> object.</p>

<h2 id="set">set</h2>
<pre class="highlight javascript"><code><span class="nx">dataMapping</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">'field'</span><span class="p">,</span> <span class="p">{</span><span class="na">type</span><span class="p">:</span> <span class="s1">'string'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'analyzed'</span><span class="p">,</span> <span class="na">null_value</span><span class="p">:</span> <span class="s1">''</span><span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">mapping</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">mapping</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="s">"string"</span><span class="o">);</span>
<span class="n">mapping</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"analyzed"</span><span class="o">);</span>
<span class="n">mapping</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"null_value"</span><span class="o">,</span> <span class="s">""</span><span class="o">);</span>

<span class="n">dataMapping</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="s">"field"</span><span class="o">,</span> <span class="n">mapping</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$field</span> <span class="o">=</span> <span class="s1">'field'</span><span class="p">;</span>
<span class="nv">$mapping</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="s1">'string'</span><span class="p">,</span>
  <span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'analyzed'</span><span class="p">,</span>
  <span class="s1">'null_value'</span> <span class="o">=&gt;</span> <span class="s1">''</span>
<span class="p">];</span>

<span class="sd">/**
 * @var $dataMapping DataMapping
 */</span>
<span class="nv">$dataMapping</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="nv">$field</span><span class="p">,</span> <span class="nv">$mapping</span><span class="p">);</span>
</code></pre>

<aside class="notice">Changes made by this function won&rsquo;t be applied until you call the <code>apply</code> method</aside>

<p>Adds or updates a field mapping.</p>

<h3 id="set-field-mapping">set(field, mapping)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">field</code></td>
<td>string</td>
<td>Name of the field from which the mapping is to be added or updated</td>
</tr>
<tr>
<td><code class="prettyprint">mapping</code></td>
<td>JSON Object</td>
<td>Mapping for this field, following the <a href="https://www.elastic.co/guide/en/elasticsearch/reference/1.7/mapping.html">Elasticsearch Mapping format</a></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">CollectionMapping</code> object to allow chaining.</p>

<h2 id="setheaders">setHeaders</h2>
<pre class="highlight javascript"><code><span class="nx">dataMapping</span><span class="p">.</span><span class="nx">setHeaders</span><span class="p">({</span><span class="na">someContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">headers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"someContent"</span><span class="o">,</span> <span class="s">"someValue"</span><span class="o">);</span>
<span class="n">dataMapping</span><span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="n">headers</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\DataMapping</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$headers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'someContent'</span> <span class="o">=&gt;</span> <span class="s1">'someValue'</span>
<span class="p">];</span>

<span class="sd">/**
 * @var $dataMapping DataMapping
 */</span>
<span class="nv">$dataMapping</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">(</span><span class="nv">$headers</span><span class="p">);</span>
</code></pre>

<p>This is a helper function returning itself, allowing to easily chain calls.</p>

<h3 id="setheaders-content-replace">setHeaders(content, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">CollectionMapping</code> object to allow chaining.</p>

            <h1 id="document">Document</h1>

<p>Kuzzle handles documents, either as realtime messages or as stored documents. Document is the object representation of one of these documents.</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 Document objects are returned by various Collection methods.

 You may also use the Collection.document() method:
 */</span>
<span class="kd">var</span> <span class="nb">document</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">).</span><span class="nb">document</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>

<span class="nb">document</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nb">document</span><span class="p">({</span><span class="na">content</span><span class="p">:</span> <span class="s1">'some content'</span><span class="p">});</span>

<span class="nb">document</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nb">document</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="p">{</span><span class="na">content</span><span class="p">:</span> <span class="s1">'some content'</span><span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="n">collection</span><span class="o">);</span>

<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="n">collection</span><span class="o">,</span> <span class="s">"id"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">content</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"content"</span><span class="o">,</span> <span class="s">"some content"</span><span class="o">);</span>
<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="n">collection</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>

<span class="n">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Document</span><span class="o">(</span><span class="n">collection</span><span class="o">,</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">content</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="nv">$documentId</span> <span class="o">=</span> <span class="s1">'foobar'</span><span class="p">;</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="s1">'foo'</span><span class="p">,</span>
  <span class="s1">'content'</span> <span class="o">=&gt;</span> <span class="s1">'bar'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$dataCollection</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">);</span>

<span class="c1">// You can use the factory embeded in DataCollection object
</span><span class="nv">$document</span> <span class="o">=</span> <span class="nv">$dataCollection</span><span class="o">-&gt;</span><span class="na">document</span><span class="p">(</span><span class="nv">$documentId</span><span class="p">,</span> <span class="nv">$documentContent</span><span class="p">);</span>

<span class="c1">// or directly with public constructor
</span><span class="nv">$document</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Document</span><span class="p">(</span><span class="nv">$dataCollection</span><span class="p">,</span> <span class="nv">$documentId</span><span class="p">,</span> <span class="nv">$documentContent</span><span class="p">);</span>
</code></pre>

<h3 id="document-collection-documentid-content">Document(Collection, [documentId], [content])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Collection</code></td>
<td>object</td>
<td>An instantiated Collection object</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Initializes this document with the provided content</td>
</tr>
<tr>
<td><code class="prettyprint">documentId</code></td>
<td>string</td>
<td>ID of an existing document.</td>
</tr>
</tbody></table>

<p><strong>Note:</strong>  this constructor won&rsquo;t make any call to Kuzzle. When providing only a document ID, the <code class="prettyprint">refresh</code> method should be called to retrieve the corresponding document content.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>The data collection associated to this document</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>The content of the document</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>JSON Object</td>
<td>Common headers for all sent documents.</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique document identifier</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">version</code></td>
<td>integer</td>
<td>Current document version</td>
<td>get</td>
</tr>
</tbody></table>

<p><strong>Notes:</strong>  </p>

<ul>
<li>setting a new value to the <code class="prettyprint">content</code> property is equivalent to calling <code class="prettyprint">setContent(data, false)</code></li>
<li>setting a new value to the <code class="prettyprint">id</code> property will force this value for this document</li>
<li>the <code class="prettyprint">headers</code> property is inherited from the provided <code class="prettyprint">Collection</code> object and can be overrided</li>
</ul>

<h2 id="delete">delete</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nb">document</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called once the delete action has been completed</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">deletePromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// called once the delete action has been completed</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">document</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// called once the delete action has been completed</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $document Document
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Deletes this document in Kuzzle.</p>

<h3 id="delete-options-callback">delete([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the persistence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the deleted document ID</p>

<h2 id="publish">publish</h2>
<pre class="highlight javascript"><code><span class="nb">document</span><span class="p">.</span><span class="nx">publish</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">document</span><span class="o">.</span><span class="na">publish</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $document Document
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">publish</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Publishes the content of this document as a real-time message.</p>

<h3 id="publish-options">publish([options])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Document</code> object to allow chaining.</p>

<h2 id="refresh">refresh</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">refresh</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called once the refresh action has been completed</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">refreshPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// called once the refresh action has been completed</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">document</span><span class="o">.</span><span class="na">refresh</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// called once the refresh action has been completed</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $document Document
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span> <span class="o">=</span> <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Creates a new <code class="prettyprint">Document</code> object with the last version of this document stored in Kuzzle.</p>

<h3 id="refresh-options-callback">refresh([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a new <code class="prettyprint">Document</code> object containing the last document version.</p>

<h2 id="save">save</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called once the save action has been completed</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">savePromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// called once the save action has been completed</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">document</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Document</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Document</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// called once the save action has been completed</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="sd">/**
 * @var $document Document
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$document</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Saves this document into Kuzzle.</p>

<p>If this is a new document, this function will create it in Kuzzle and the <code class="prettyprint">id</code> property will be made available.<br>
Otherwise, this method will replace the latest version of this document in Kuzzle by the current content of this object.</p>

<h3 id="save-options-callback">save([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">refresh</code></td>
<td>string</td>
<td>If set to <code class="prettyprint">wait_for</code>, Kuzzle will wait the persistence layer indexation to return (available with Elasticsearch 5.x and above)</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Document</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to this <code class="prettyprint">Document</code> object once the document has been saved.</p>

<h2 id="setcontent">setContent</h2>
<pre class="highlight javascript"><code><span class="nb">document</span><span class="p">.</span><span class="nx">setContent</span><span class="p">({</span><span class="na">newContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">content</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"content"</span><span class="o">,</span> <span class="s">"some content"</span><span class="o">);</span>

<span class="n">document</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">content</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$documentContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'field'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span>
<span class="p">];</span>

<span class="sd">/**
 * @var $document Document
 */</span>
<span class="nv">$document</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$documentContent</span><span class="p">);</span>
</code></pre>

<aside class="notice">
Changes made by this function won&rsquo;t be applied until the <code>save</code> method is called
</aside>

<p>Replaces the current content with new data.<br>
This is a helper function returning itself, allowing to easily chain calls.</p>

<h3 id="setcontent-data-replace">setContent(data, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">data</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Document</code> object to allow chaining.</p>

<h2 id="setheaders">setHeaders</h2>
<pre class="highlight javascript"><code><span class="nb">document</span><span class="p">.</span><span class="nx">setHeaders</span><span class="p">({</span><span class="na">someContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"someContent"</span><span class="o">,</span> <span class="s">"someValue"</span><span class="o">);</span>

<span class="n">document</span><span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="n">headers</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Document</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$headers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'header'</span> <span class="o">=&gt;</span> <span class="s1">'value'</span>
<span class="p">];</span>

<span class="sd">/**
 * @var $document Document
 */</span>
<span class="nv">$document</span><span class="o">-&gt;</span><span class="na">setHeaders</span><span class="p">(</span><span class="nv">$headers</span><span class="p">);</span>
</code></pre>

<p>This is a helper function returning itself, allowing to easily chain calls.</p>

<h3 id="setheaders-content-replace">setHeaders(content, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Document</code> object to allow chaining.</p>

<h2 id="subscribe">subscribe</h2>
<pre class="highlight javascript"><code><span class="nb">document</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// called each time a change occurs on this document</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">onDone</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">roomObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handles the subscription result</span>
  <span class="p">});</span>

<span class="nb">document</span>
  <span class="p">.</span><span class="nx">subscribe</span><span class="p">({</span><span class="na">subscribeToSelf</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span> <span class="na">myId</span><span class="p">:</span> <span class="s1">'someId'</span><span class="p">}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">notification</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// called each time a change occurs on this document</span>
  <span class="p">})</span>
  <span class="p">.</span><span class="nx">onDone</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">roomObject</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handles the subscription result</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="na">subscribe</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">NotificationResponse</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NotificationResponse</span> <span class="n">object</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// called each time a change occurs on this document</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle error</span>
    <span class="o">}</span>
  <span class="o">})</span>
  <span class="o">.</span><span class="na">onDone</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Room</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Room</span> <span class="n">response</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle subscription success</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Handle subscription error</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Listens to changes occuring on this document.
Throws an error if this document has not yet been created in Kuzzle.</p>

<h3 id="subscribe-options-callback">subscribe([options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>object</td>
<td>Subscription configuration. Passed to the Room constructor.</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback that will be called each time a change has been detected on this document</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns an object exposing the following method:<br>
  <code class="prettyprint">onDone(callback)</code></p>

<p>The <code class="prettyprint">callback</code> argument is called when the subscription ends, either successfully or with an error.</p>

            <h1 id="memorystorage">MemoryStorage</h1>

<p>Kuzzle&rsquo;s memory storage is a separate data store from the database layer.
It is internally based on Redis. You can access most of Redis functions (all lowercased), except:</p>

<ul>
<li>cluster based functions</li>
<li>script based functions</li>
<li>cursors functions</li>
</ul>

<p>Here is the list of non implemented commands:</p>

<p><code class="prettyprint">client</code>
<code class="prettyprint">cluster</code>
<code class="prettyprint">config</code>
<code class="prettyprint">debug</code>
<code class="prettyprint">echo</code>
<code class="prettyprint">eval</code>
<code class="prettyprint">evalsha</code>
<code class="prettyprint">flushall</code>
<code class="prettyprint">migrate</code>
<code class="prettyprint">monitor</code>
<code class="prettyprint">move</code>
<code class="prettyprint">psubscribe</code>
<code class="prettyprint">pubsub</code>
<code class="prettyprint">punsubscribe</code>
<code class="prettyprint">quit</code>
<code class="prettyprint">readonly</code>
<code class="prettyprint">readwrite</code>
<code class="prettyprint">role</code>
<code class="prettyprint">script</code>
<code class="prettyprint">select</code>
<code class="prettyprint">shutdown</code>
<code class="prettyprint">slaveof</code>
<code class="prettyprint">slowlog</code>
<code class="prettyprint">subscribe</code>
<code class="prettyprint">sync</code>
<code class="prettyprint">unsubscribe</code>
<code class="prettyprint">scan</code>
<code class="prettyprint">sscan</code>
<code class="prettyprint">hscan</code>
<code class="prettyprint">zscan</code></p>

<p>You can find a list of all redis command at: <a href="http://redis.io/commands">http://redis.io/commands</a></p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructor is not exposed in the JS/Node SDK. You may get the instantiated
 MemoryStorage object by calling Kuzzle.memoryStorage
 */</span>
<span class="kd">var</span> <span class="nx">memoryStorage</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">memoryStorage</span><span class="p">;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// using the static instance</span>
<span class="n">MemoryStorage</span> <span class="n">memoryStorage</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">memoryStorage</span><span class="o">;</span>

<span class="c1">// or instantiating a new MemoryStorage object</span>
<span class="n">MemoryStorage</span> <span class="n">memoryStorage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MemoryStorage</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\MemoryStorage</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="c1">// using the static instance
</span><span class="nv">$memoryStorage</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">memoryStorage</span><span class="p">();</span>

<span class="c1">// or instantiating a new MemoryStorage object
</span><span class="nv">$memoryStorage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MemoryStorage</span><span class="p">(</span><span class="nv">$kuzzle</span><span class="p">);</span>
</code></pre>

<h2 id="example">Example</h2>

<p>Here is an example with the <code class="prettyprint">ping</code> command.</p>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">memoryStorage</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">memoryStorage</span><span class="p">;</span>

<span class="nx">memoryStorage</span><span class="p">.</span><span class="nx">ping</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// Handle result</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// using the static instance</span>
<span class="n">MemoryStorage</span> <span class="n">memoryStorage</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">memoryStorage</span><span class="o">;</span>

<span class="n">memoryStorage</span><span class="o">.</span><span class="na">setListener</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">result</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle success</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// Handle error</span>
    <span class="o">}</span>

<span class="o">});</span>
<span class="n">memoryStorage</span><span class="o">.</span><span class="na">ping</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$memoryStorage</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">memoryStorage</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$memoryStorage</span><span class="o">-&gt;</span><span class="na">ping</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>

</code></pre>

            <h1 id="room">Room</h1>

<p>This object is the result of a subscription request, allowing to manipulate the subscription itself.</p>

<p>In Kuzzle, you don&rsquo;t exactly subscribe to a room or a topic but, instead, you subscribe to documents.<br>
What it means is that, to subscribe, you provide to Kuzzle a set of matching filters. Of course, providing an empty filter results in subscribing to all changes occurring on a data collection, emulating the behavior of a traditional topic.</p>

<p>Once you have subscribed, depending on the subscription configuration you provided, you may receive the following notifications:</p>

<ul>
<li>a pub/sub message matches your criteria (real-time)</li>
<li>a matching document is about to be created or deleted (real-time)</li>
<li>a matching document is created, updated or deleted (once the change is effective in the database)</li>
<li>a user enters or leaves the room</li>
</ul>

<p>You may subscribe multiple times to the same room, with identical or different subscription parameters, and with different callbacks. This allow dispatching notifications across the right parts of your application, instead of having to maintain an all-purpose notification consumer (but you can do that, too).</p>

<h2 id="notifications">Notifications</h2>

<blockquote>
<p>Document notification example:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"bc41ced6-38fc-42b9-8fd5-22ae0774aac2"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name of the controller that generated the notification"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"name of the action that generated the notification"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"collection name"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"index"</span><span class="p">:</span><span class="w"> </span><span class="s2">"index name"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="nt">"state"</span><span class="p">:</span><span class="w"> </span><span class="s2">"done"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"in"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"_source"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"message content"</span><span class="p">:</span><span class="w"> </span><span class="s2">"this is an example"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<blockquote>
<p>User notification example:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"error"</span><span class="p">:</span><span class="w"> </span><span class="kc">null</span><span class="p">,</span><span class="w">
  </span><span class="nt">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="p">,</span><span class="w">
  </span><span class="nt">"roomId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID of the room concerned by this notification"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"requestId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5897cd2f-a8a2-40b2-aa43-b31898172008"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"controller"</span><span class="p">:</span><span class="w"> </span><span class="s2">"subscribe"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"action"</span><span class="p">:</span><span class="w"> </span><span class="s2">"on"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"protocol"</span><span class="p">:</span><span class="w"> </span><span class="s2">"protocol used by the notifying user"</span><span class="p">,</span><span class="w">
  </span><span class="nt">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="mi">1453193069592</span><span class="p">,</span><span class="w">
  </span><span class="nt">"metadata"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"optional"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user informations"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="nt">"result"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nt">"roomId"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ID of the room concerned by this notification"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">42</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To subscribe, you must provide a callback that will be called each time a new notification is received.</p>

<p>On the right panel you can see a document and a user notification examples.</p>

<h3 id="document-notification-rundown">Document notification rundown</h3>

<table><thead>
<tr>
<th>Notification field</th>
<th>Type</th>
<th>Description</th>
<th>Possible values</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">result._source</code></td>
<td>JSON object</td>
<td>Content of the document or real-time message that generated the notification</td>
<td></td>
</tr>
<tr>
<td><code class="prettyprint">scope</code></td>
<td>string</td>
<td>Indicates if the document enters or exits the subscription scope</td>
<td><code class="prettyprint">in</code>, <code class="prettyprint">out</code></td>
</tr>
<tr>
<td><code class="prettyprint">state</code></td>
<td>string</td>
<td>Tells if the document is about to be changed, or if the change is effective</td>
<td><code class="prettyprint">pending</code>, <code class="prettyprint">done</code></td>
</tr>
</tbody></table>

<h3 id="user-notification-rundown">User notification rundown</h3>

<table><thead>
<tr>
<th>Notification field</th>
<th>Type</th>
<th>Description</th>
<th>Possible values</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">action</code></td>
<td>string</td>
<td>Indicates if the user enters or leaves the subscribed room</td>
<td><code class="prettyprint">on</code>, <code class="prettyprint">off</code></td>
</tr>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON object</td>
<td>If provided during subscription, contains application specific informations</td>
<td></td>
</tr>
<tr>
<td><code class="prettyprint">result.count</code></td>
<td>integer</td>
<td>Updated number of users subscribing to this room</td>
<td></td>
</tr>
</tbody></table>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 Room objects are returned by Collection.subscribe and
 Document.subscribe methods.

 You may also use the Collection.room() method:
 */</span>
<span class="kd">var</span> <span class="nx">room</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">).</span><span class="nx">room</span><span class="p">();</span>

<span class="nx">room</span> <span class="o">=</span> <span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">collection</span><span class="p">(</span><span class="s1">'collection'</span><span class="p">,</span> <span class="s1">'index'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">room</span><span class="p">({</span><span class="na">subscribeToSelf</span><span class="p">:</span> <span class="kc">false</span><span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Room</span><span class="o">(</span><span class="n">dataCollection</span><span class="o">);</span>

<span class="n">RoomOptions</span> <span class="n">options</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RoomOptions</span><span class="o">().</span><span class="na">setSubscribeToSelf</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">Room</span> <span class="n">room</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Room</span><span class="o">(</span><span class="n">dataCollection</span><span class="o">,</span> <span class="n">options</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Creates a Room object.</p>

<h3 id="room-collection-options">Room(Collection, [options])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Collection</code></td>
<td>object</td>
<td>an instantiated Kuzzle Collection object</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>object</td>
<td>Optional subscription configuration</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td><code class="prettyprint">null</code></td>
</tr>
<tr>
<td><code class="prettyprint">scope</code></td>
<td>string</td>
<td>Filter document notifications depending on their scope status. You may receive entering documents (scope: <code class="prettyprint">in</code>), leaving documents (scope: <code class="prettyprint">out</code>), all documents changes (scope: <code class="prettyprint">all</code>) or filter these notifications completely (scope: <code class="prettyprint">none</code>). This filter does not affect pub/sub messages or user events.</td>
<td><code class="prettyprint">all</code></td>
</tr>
<tr>
<td><code class="prettyprint">state</code></td>
<td>string</td>
<td>Filter document notifications depending on the state of the modifying request. You may receive real-time notifications when a document is about to be changed (state: <code class="prettyprint">pending</code>), or be notified when the change has been fully written in the database (state: <code class="prettyprint">done</code>), or both (state: <code class="prettyprint">all</code>). This filter does not affect pub/sub messages or user events.</td>
<td><code class="prettyprint">done</code></td>
</tr>
<tr>
<td><code class="prettyprint">subscribeToSelf</code></td>
<td>boolean</td>
<td>(Don&rsquo;t) subscribe to notifications fired as a consequence of our own queries</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">users</code></td>
<td>string</td>
<td>Filter notifications fired upon a user entering the room (user: <code class="prettyprint">in</code>), leaving the room (user: <code class="prettyprint">out</code>), or both (user: <code class="prettyprint">all</code>). Setting this variable to <code class="prettyprint">none</code> prevents receiving these notifications</td>
<td><code class="prettyprint">none</code></td>
</tr>
</tbody></table>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>string</td>
<td>The subscribed data collection</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON object</td>
<td>The current set of filters of this room</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">headers</code></td>
<td>JSON Object</td>
<td>Common headers for all sent documents.</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">metadata</code></td>
<td>JSON Object</td>
<td>Additional information passed to notifications to other users</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">subscribeToSelf</code></td>
<td>boolean</td>
<td>(Don&rsquo;t) subscribe to notifications fired as a consequence of our own queries</td>
<td>get/set</td>
</tr>
<tr>
<td><code class="prettyprint">roomId</code></td>
<td>string</td>
<td>Unique room identifier</td>
<td>get</td>
</tr>
</tbody></table>

<p><strong>Notes:</strong></p>

<ul>
<li>the <code class="prettyprint">headers</code> property is inherited from the provided <code class="prettyprint">Collection</code> object and can be overridden</li>
<li>updating the <code class="prettyprint">metadata</code> property takes effect after <code class="prettyprint">renew</code> is called</li>
<li>by default, the global Kuzzle <code class="prettyprint">metadata</code> properties are sent along with the subscription request. If a <code class="prettyprint">metadata</code> option is provided during subscription, it will be merged with the global <code class="prettyprint">metadata</code> for the subscription only. In case of conflicts, subscription <code class="prettyprint">metadata</code> take priority over the global <code class="prettyprint">metadata</code>.</li>
</ul>

<h2 id="count">count</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">room</span><span class="p">.</span><span class="nx">count</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">room</span><span class="p">.</span><span class="nx">countPromise</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">room</span><span class="o">.</span><span class="na">count</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;()</span> <span class="o">{</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Integer</span> <span class="n">result</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
   <span class="c1">//  ...</span>
 <span class="o">}</span>

 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
   <span class="c1">// Handle error</span>
 <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<blockquote>
<p>Callback response</p>
</blockquote>
<pre class="highlight json"><code><span class="mi">1</span><span class="w">
</span></code></pre>

<p>Return the number of subscribers on that room</p>

<h3 id="count-callback">count(callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">integer</code> containing the number of users subscribing to this room.</p>

<h2 id="renew">renew</h2>
<pre class="highlight javascript"><code><span class="nx">room</span><span class="p">.</span><span class="nx">renew</span><span class="p">({</span><span class="na">in</span><span class="p">:</span> <span class="p">{</span><span class="na">field</span><span class="p">:</span> <span class="p">[</span><span class="s1">'some'</span><span class="p">,</span> <span class="s1">'new'</span><span class="p">,</span> <span class="s1">'filter'</span><span class="p">]}},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// called each time a change is detected on documents matching this filter</span>

  <span class="c1">// check the Room/Notifications section of this documentation</span>
  <span class="c1">// to get notification examples</span>
<span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// handles the subscription result</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"and"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"status"</span><span class="o">,</span>
          <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"idle"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"wantToHire"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"toHire"</span><span class="o">)</span>
            <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"riding"</span><span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"in"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"type"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"cab"</span><span class="o">))</span>
      <span class="o">)</span>
    <span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span>
      <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"geo_distance"</span><span class="o">,</span>
        <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"distance"</span><span class="o">,</span> <span class="s">"10km"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span>
            <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lat"</span><span class="o">,</span> <span class="s">"48.8566140"</span><span class="o">)</span>
              <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lon"</span><span class="o">,</span> <span class="s">"2.352222"</span><span class="o">)</span>
          <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">room</span><span class="o">.</span><span class="na">renew</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">NotificationResponse</span><span class="o">&gt;()</span> <span class="o">{</span>
 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">NotificationResponse</span> <span class="n">result</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
   <span class="c1">// called each time a change is detected on documents matching this filter</span>

   <span class="c1">// check the Room/Notifications section of this documentation</span>
   <span class="c1">// to get notification examples</span>
 <span class="o">}</span>

 <span class="nd">@Override</span>
 <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
   <span class="c1">// Handle error</span>
 <span class="o">}</span>
<span class="o">},</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Room</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="c1">// Handle the subscription result</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Renew the subscription. Force a new subscription using the same filters if no new ones are provided.
Unsubscribes first if this Room object was already listening to events.</p>

<h3 id="renew-filters-notificationcallback-subscriptioncallback">renew([filters], notificationCallback, subscriptionCallback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td><a href="/real-time-filters/">Filters</a></td>
</tr>
<tr>
<td><code class="prettyprint">notificationCallback</code></td>
<td>function</td>
<td>Function called each time a notification is received</td>
</tr>
<tr>
<td><code class="prettyprint">subscriptionCallback</code></td>
<td>function</td>
<td>Function called with the subscription result</td>
</tr>
</tbody></table>

<h2 id="setheaders">setHeaders</h2>
<pre class="highlight javascript"><code><span class="nx">room</span><span class="p">.</span><span class="nx">setHeaders</span><span class="p">({</span><span class="na">someContent</span><span class="p">:</span> <span class="s1">'someValue'</span><span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">headers</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">();</span>
<span class="n">headers</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"someContent"</span><span class="o">,</span> <span class="s">"someValue"</span><span class="o">);</span>
<span class="n">room</span><span class="o">.</span><span class="na">setHeaders</span><span class="o">(</span><span class="n">headers</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<blockquote>
<p>Returns itself</p>
</blockquote>

<p>This is a helper function returning itself, allowing to easily chain calls.</p>

<h3 id="setheaders-content-replace">setHeaders(content, [replace])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New content</td>
</tr>
<tr>
<td><code class="prettyprint">replace</code></td>
<td>boolean</td>
<td>true: replace the current content with the provided data, false: merge it</td>
</tr>
</tbody></table>

<p><strong>Note:</strong> by default, the <code class="prettyprint">replace</code> argument is set to <code class="prettyprint">false</code></p>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Room</code> object to allow chaining.</p>

<h2 id="unsubscribe">unsubscribe</h2>
<pre class="highlight javascript"><code><span class="nx">room</span><span class="p">.</span><span class="nx">unsubscribe</span><span class="p">();</span>
</code></pre>
<pre class="highlight java"><code><span class="n">room</span><span class="o">.</span><span class="na">unsubscribe</span><span class="o">();</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="c1">// not implemented (this SDK uses HTTP and is thus stateless)
</span></code></pre>

<p>Cancels the current subscription.</p>

<h3 id="return-value">Return value</h3>

<p>Returns this <code class="prettyprint">Room</code> object to allow chaining.</p>

            <h1 id="security">Security</h1>

<p>The Security component lets you handle users permissions in Kuzzle.</p>

<p>Please refer to our <a href="/guide/#permissions">Kuzzle permissions guide</a> for more information.</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructor is not exposed in the JS/Node SDK. You may get the instantiated
 Security object by calling Kuzzle.security
 */</span>
<span class="kd">var</span> <span class="nx">kuzzleSecurity</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">;</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// using the static instance</span>
<span class="n">Security</span> <span class="n">security</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">;</span>

<span class="c1">// or instantiating a new Security object</span>
<span class="n">Security</span> <span class="n">security</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Security</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Security</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="c1">// using the static instance
</span><span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="c1">// or instantiating a new Security object
</span><span class="nv">$security</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Security</span><span class="p">(</span><span class="nv">$kuzzle</span><span class="p">);</span>
</code></pre>

<h3 id="security-kuzzle">Security(Kuzzle)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Kuzzle</code></td>
<td>object</td>
<td>An instantiated <code class="prettyprint">Kuzzle</code> object</td>
</tr>
</tbody></table>

<h2 id="properties">Properties</h2>

<p>There are no exposed properties for this object.</p>

<h2 id="createrole">createRole</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">roleDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"*"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"*"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// You can chose to replace the given role if already exists</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">replaceIfExist</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createRole</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createRolePromise</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">Options</span> <span class="n">opts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Options</span><span class="o">().</span><span class="na">setReplaceIfExist</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">createRole</span><span class="o">(</span><span class="s">"myrole"</span><span class="o">,</span> <span class="n">roleDefinition</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// the result is an instantiated Role object</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">})</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">createRole</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">,</span> <span class="nv">$roleDefinition</span><span class="p">);</span>

  <span class="c1">// $role instanceof Role
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// error occurred
</span><span class="p">}</span>
</code></pre>

<p>Create a new role in Kuzzle.</p>

<aside class="notice">
There is a small delay between role creation and their creation in our search layer, usually a couple of seconds.
That means that a role that was just been created will not be returned by <code>searchRole</code> function
</aside>

<h3 id="createrole-id-content-options-callback">createRole(id, content, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the role</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">replaceIfExist</code></td>
<td>boolean</td>
<td>If the same role already exists: throw an error if sets to false. Replace the existing role otherwise</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Role</code> object.</p>

<h2 id="createprofile">createProfile</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profileDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="c1">// You can chose to replace the given profile if already exists</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">replaceIfExist</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="nx">profileDefinition</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createProfilePromise</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="nx">profileDefinition</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">role1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">role2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="n">JSONObject</span> <span class="n">profileDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">role1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">role2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">Options</span> <span class="n">opts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Options</span><span class="o">().</span><span class="na">setReplaceIfExist</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">createProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="n">profileDefinition</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>
<span class="nv">$profileDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'myRole'</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'anonymous'</span><span class="p">,</span>
      <span class="s1">'restrictedTo'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'my-second-index'</span><span class="p">,</span> <span class="s1">'collection'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'my-collection'</span><span class="p">]]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">createProfile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">,</span> <span class="nv">$profileDefinition</span><span class="p">);</span>

  <span class="c1">// $profile instanceof Profile
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Create a new profile in Kuzzle.</p>

<aside class="notice">
There is a small delay between profile creation and their creation in our search layer, usually a couple of seconds.
That means that a profile that was just been created will not be returned by <code>searchProfiles</code> function
</aside>

<h3 id="createprofile-id-content-options-callback">createProfile(id, content, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the profile</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">replaceIfExist</code></td>
<td>boolean</td>
<td>If the same profile already exists: throw an error if sets to false. Replace the existing profile otherwise</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Profile</code> object.</p>

<h2 id="createuser">createUser</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">userContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// A "profile" field is required to bind a user to an existing profile</span>
  <span class="na">profileIds</span><span class="p">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">],</span>

  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="na">password</span><span class="p">:</span> <span class="s1">'secretPassword'</span><span class="p">,</span>

  <span class="c1">// You can also set custom fields to your user</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Doe'</span>
<span class="p">};</span>

<span class="c1">// You can chose to replace the given user if already exists</span>
<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">replaceIfExist</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>


<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createUser</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createUserPromise</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="c1">// A "profile" field is required to bind a user to an existing profile</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileIds"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"admin"</span><span class="o">))</span>
  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"secret password"</span><span class="o">)</span>
  <span class="c1">// You can also set custom fields to your user</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">);</span>

<span class="n">Options</span> <span class="n">opts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Options</span><span class="o">().</span><span class="na">setReplaceIfExist</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">createUser</span><span class="o">(</span><span class="s">"myNewUser"</span><span class="o">,</span> <span class="n">newUser</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>
<span class="nv">$userDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'profileIds'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'myProfile'</span><span class="p">],</span>
  <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span><span class="p">,</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Doe'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">createUser</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>

  <span class="c1">// $user instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Create a new user in Kuzzle.</p>

<aside class="notice">
There is a small delay between user creation and their creation in our search layer, usually a couple of seconds.
That means that a user that was just been created will not be returned by <code>searchUsers</code> function
</aside>

<h3 id="createuser-id-content-options-callback">createUser(id, content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier, will be used as username</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the user</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">replaceIfExist</code></td>
<td>boolean</td>
<td>If the same user already exists: throw an error if sets to false. Replace the existing user otherwise</td>
<td><code class="prettyprint">false</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">User</code> object.</p>

<h2 id="createrestricteduser">createRestrictedUser</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">userContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="na">password</span><span class="p">:</span> <span class="s1">'secretPassword'</span><span class="p">,</span>

  <span class="c1">// You can also set custom fields to your user</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Doe'</span>
<span class="p">};</span>


<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createRestrictedUser</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">createRestrictedUserPromise</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newUser</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"secret password"</span><span class="o">)</span>
  <span class="c1">// You can also set custom fields to your user</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">);</span>

<span class="n">Options</span> <span class="n">opts</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Options</span><span class="o">().</span><span class="na">setReplaceIfExist</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">createRestrictedUser</span><span class="o">(</span><span class="s">"myNewUser"</span><span class="o">,</span> <span class="n">newUser</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>
<span class="nv">$userDefinition</span> <span class="o">=&gt;</span> <span class="p">[</span>
  <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span><span class="p">,</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Doe'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">createRestrictedUser</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>

  <span class="c1">// $user instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Create a new restricted user in Kuzzle.
This function allows anonymous users for instance to create a &ldquo;restricted&rdquo; user with predefined rights.</p>

<aside class="notice">
There is a small delay between user creation and their creation in our search layer, usually a couple of seconds.
That means that a user that was just been created will not be returned by <code>searchUsers</code> function.
<br/>

</aside>

<h3 id="createrestricteduser-id-content-options-callback">createRestrictedUser(id, content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier, will be used as username</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the user</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">User</code> object.</p>

<h2 id="deleteprofile">deleteProfile</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteProfilePromise</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">deleteProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">profileName</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">deleteProfile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Delete profile.</p>

<aside class="notice">
There is a small delay between profile deletion and their deletion in our search layer, usually a couple of seconds.
That means that a profile that was just been delete will be returned by <code>searchProfiles</code> function
</aside>

<h3 id="deleteprofile-id-options-callback">deleteProfile(id, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier to delete</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves the profile id which has been deleted.</p>

<h2 id="deleterole">deleteRole</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteRole</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteRolePromise</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">deleteRole</span><span class="o">(</span><span class="s">"myrole"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">roleName</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">deleteRole</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Delete role.</p>

<aside class="notice">
There is a small delay between role deletion and their deletion in our search layer, usually a couple of seconds.
That means that a role that was just been delete will be returned by <code>searchRoles</code> function
</aside>

<h3 id="deleterole-id-options-callback">deleteRole(id, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier to delete</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves the role id which has been deleted.</p>

<h2 id="deleteuser">deleteUser</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteUser</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">deleteUserPromise</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">deleteUser</span><span class="o">(</span><span class="s">"myuser"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">userName</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">deleteUser</span><span class="p">(</span><span class="nv">$userId</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Delete user.</p>

<aside class="notice">
There is a small delay between user deletion and their deletion in our search layer, usually a couple of seconds.
That means that a user that has just been delete will be returned by <code>searchUsers</code> function
</aside>

<h3 id="deleteuser-id-options-callback">deleteUser(id, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier to delete</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves the user id which has been deleted.</p>

<h2 id="fetchprofile">fetchProfile</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchProfilePromise</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">fetchProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fetchProfile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">);</span>

  <span class="c1">// $profile instanceof Profile
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves a single stored profile using its unique ID.</p>

<h3 id="fetchprofile-id-options-callback">fetchProfile(id, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Profile</code> object.</p>

<h2 id="fetchrole">fetchRole</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchRole</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchRolePromise</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">fetchRole</span><span class="o">(</span><span class="s">"myrole"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fetchRole</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">);</span>

  <span class="c1">// $role instanceof Role
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves a single stored role using its unique ID.</p>

<h3 id="fetchrole-id-options-callback">fetchRole(id, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Role</code> object.</p>

<h2 id="fetchuser">fetchUser</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchUser</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">})</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">fetchUserPromise</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">})</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">fetchUser</span><span class="o">(</span><span class="s">"myuser"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">fetchUser</span><span class="p">(</span><span class="nv">$userId</span><span class="p">);</span>

  <span class="c1">// $user instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Retrieves a single stored user using its unique ID.</p>

<h3 id="fetchuser-id-options-callback">fetchUser(id, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">User</code> object.</p>

<h2 id="getuserrights">getUserRights</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">getUserRights</span><span class="p">(</span><span class="s1">'id'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a JSON object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">getUserRightsPromise</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a JSON object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">getUserRights</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">rights</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$rights</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getUserRights</span><span class="p">(</span><span class="nv">$userId</span><span class="p">);</span>

<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response example</p>
</blockquote>
<pre class="highlight javascript"><code><span class="p">[</span>
  <span class="p">{</span>
    <span class="na">controller</span><span class="p">:</span> <span class="s1">'my-controller'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'my-action'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="na">collection</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="s1">'allowed'</span>
  <span class="p">},</span>
  <span class="p">{</span>
    <span class="na">controller</span><span class="p">:</span> <span class="s1">'another-controller'</span><span class="p">,</span> <span class="na">action</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span> <span class="na">index</span><span class="p">:</span> <span class="s1">'my-index'</span><span class="p">,</span> <span class="na">collection</span><span class="p">:</span> <span class="s1">'*'</span><span class="p">,</span>
    <span class="na">value</span><span class="p">:</span> <span class="s1">'conditional'</span>
  <span class="p">}</span>
<span class="p">]</span>
</code></pre>

<p>Gets the rights of the currently logged user.</p>

<h4 id="getuserrights-id-options-callback">getUserRights(id, [options], callback)</h4>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>String</td>
<td>Id of the user</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h4 id="callback-response">Callback response</h4>

<p>Resolves to a <code class="prettyprint">JSON</code> object.</p>

<h2 id="isactionallowed">isActionAllowed</h2>
<pre class="highlight javascript"><code><span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">getMyRights</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rights</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">isActionAllowed</span><span class="p">(</span><span class="nx">rights</span><span class="p">,</span> <span class="s1">'read'</span><span class="p">,</span> <span class="s1">'get'</span><span class="p">,</span> <span class="s1">'index1'</span><span class="p">,</span> <span class="s1">'collection1'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">getMyRights</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">JSONArray</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">JSONArray</span> <span class="n">rights</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Rights</span> <span class="n">rights</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">isActionAllowed</span><span class="o">(</span><span class="n">rights</span><span class="o">,</span> <span class="s">"read"</span><span class="o">,</span> <span class="s">"get"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">,</span> <span class="s">"collection1"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>
     <span class="c1">// ...</span>
    <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Security</span><span class="p">;</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$rights</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">getMyRights</span><span class="p">();</span>

  <span class="k">switch</span> <span class="p">(</span><span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">isActionAllowed</span><span class="p">(</span><span class="nv">$rights</span><span class="p">,</span> <span class="s1">'read'</span><span class="p">,</span> <span class="s1">'get'</span><span class="p">,</span> <span class="s1">'index1'</span><span class="p">,</span> <span class="s1">'collection1'</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">case</span> <span class="nx">Security</span><span class="o">::</span><span class="na">ACTION_ALLOWED</span><span class="o">:</span>
      <span class="c1">// code...
</span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Security</span><span class="o">::</span><span class="na">ACTION_DENIED</span><span class="o">:</span>
      <span class="c1">// code...
</span>      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="nx">Security</span><span class="o">::</span><span class="na">ACTION_CONDITIONAL</span><span class="o">:</span>
      <span class="c1">// code...
</span>      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Tells whether an action is allowed, denied or conditional based on the rights provided as the first argument.
- <code class="prettyprint">allowed</code> is returned when an action is authorized without condition
- <code class="prettyprint">conditional</code> is returned when the authorization depends on a closure
- <code class="prettyprint">denied</code> is returned when the action is forbidden
An action is defined as a couple of action and controller (mandatory), plus an index and a collection(optional).</p>

<aside class="notice">
You can get the rights from Kuzzle by using <a href="#getUserRights">`Security.getUserRights`</a> and <a href="#getMyRights">`Security.getMyRights`</a>.
</aside>

<h4 id="isactionallowed-rights-controller-action-index-collection">isActionAllowed(rights, controller, action, index, collection)</h4>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">rights</code></td>
<td>JSON array</td>
<td>Rights list</td>
</tr>
<tr>
<td><code class="prettyprint">controller</code></td>
<td>String</td>
<td>The controller</td>
</tr>
<tr>
<td><code class="prettyprint">action</code></td>
<td>String</td>
<td>The action</td>
</tr>
<tr>
<td><code class="prettyprint">index</code></td>
<td>String</td>
<td>The index</td>
</tr>
<tr>
<td><code class="prettyprint">collection</code></td>
<td>String</td>
<td>The collection</td>
</tr>
</tbody></table>

<h4 id="return-value">Return value</h4>

<p>Returns either <code class="prettyprint">allowed</code>, <code class="prettyprint">denied</code> or <code class="prettyprint">conditional</code>.</p>

<h2 id="profile">profile</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profileDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">profile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="nx">profileDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">policy2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="n">JSONObject</span> <span class="n">profileDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">Profile</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">profile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="n">profileDefinition</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>
<span class="nv">$profileDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'myRole'</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'anonymous'</span><span class="p">,</span>
      <span class="s1">'restrictedTo'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'my-second-index'</span><span class="p">,</span> <span class="s1">'collection'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'my-collection'</span><span class="p">]]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">profile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">,</span> <span class="nv">$profileDefinition</span><span class="p">);</span>

<span class="c1">// $profile instanceof Profile
</span></code></pre>

<p>Instantiate a new Profile object.</p>

<h3 id="profile-id-content">profile(id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Profile content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object.</p>

<h2 id="role">role</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">roleDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"*"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"*"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">role</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">role</span><span class="p">(</span><span class="s1">'role'</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">role</span><span class="o">(</span><span class="s">"myrole"</span><span class="o">,</span> <span class="n">roleDefinition</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="nv">$role</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">role</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">,</span> <span class="nv">$roleDefinition</span><span class="p">);</span>

<span class="c1">// $role instanceof Role
</span></code></pre>

<p>Instantiate a new <code class="prettyprint">Role</code> object.</p>

<h3 id="role-id-content">role(id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Role content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Role</code> object.</p>

<h2 id="searchprofiles">searchProfiles</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">// filter can contains an array `roles` with a list of role id</span>
  <span class="na">policies</span><span class="p">:</span>  <span class="p">[</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="s1">'admin'</span><span class="p">],</span>
  <span class="c1">// filter can handler pagination with properties `from` and `size`</span>
  <span class="na">from</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">size</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchProfiles</span><span class="p">(</span><span class="nx">filters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchProfilesPromise</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filters</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="c1">// filter can contains a "roles" array with a list of role IDs</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"myrole"</span><span class="o">,</span> <span class="s">"admin"</span><span class="o">))</span>
  <span class="c1">// search results can be paginated</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"from"</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"size"</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">searchProfiles</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">SecurityDocumentList</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">SecurityDocumentList</span> <span class="n">profiles</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Contains a profiles list</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span> <span class="o">:</span> <span class="n">profiles</span><span class="o">.</span><span class="na">getDocuments</span><span class="o">())</span> <span class="o">{</span>

      <span class="o">}</span>

      <span class="c1">// And the total number of profiles, regardless of pagination</span>
      <span class="n">profiles</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>

</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Util\ProfilesSearchResult</span><span class="p">;</span>

<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'admin'</span><span class="p">,</span>
      <span class="s1">'myrole'</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$options</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span>
  <span class="s1">'size'</span> <span class="o">=&gt;</span> <span class="mi">1</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">searchProfiles</span><span class="p">(</span><span class="nv">$filters</span><span class="p">,</span> <span class="nv">$options</span><span class="p">);</span>

  <span class="c1">// $result instanceof ProfilesSearchResult
</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getProfiles</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$profile</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $profile instanceof Profile
</span>  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">124</span><span class="p">,</span><span class="w">
  </span><span class="nt">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">array</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">Profile</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Executes a search on profiles according to a filter</p>

<h3 id="searchprofiles-filters-options-callback">searchProfiles(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td>List of filters to retrieves roles</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">from</code></td>
<td>number</td>
<td>Starting offset</td>
<td><code class="prettyprint">0</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">size</code></td>
<td>integer</td>
<td>Number of hits to return</td>
<td><code class="prettyprint">20</code></td>
</tr>
</tbody></table>

<p>Available filters:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">roles</code></td>
<td>array</td>
<td>Contains an array <code class="prettyprint">roles</code> with a list of role id</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a JSON Object</p>

<h2 id="searchusers">searchUsers</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">filter</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">and</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
        <span class="na">terms</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">profileIds</span><span class="p">:</span> <span class="p">[</span><span class="s1">'anonymous'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">],</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="p">{</span>
        <span class="na">geo_distance</span><span class="p">:</span> <span class="p">{</span>
          <span class="na">distance</span><span class="p">:</span> <span class="s1">'10km'</span><span class="p">,</span>
          <span class="na">pos</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">lat</span><span class="p">:</span> <span class="s1">'48.8566140'</span><span class="p">,</span> <span class="na">lon</span><span class="p">:</span> <span class="s1">'2.352222'</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchUsers</span><span class="p">(</span><span class="nx">filters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchUsersPromise</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"filter"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"and"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"terms"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileIds"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"anonymous"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"default"</span><span class="o">))</span>
      <span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"geo_distance"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"distance"</span><span class="o">,</span> <span class="s">"10km"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"pos"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lat"</span><span class="o">,</span> <span class="s">"48.8566140"</span><span class="o">)</span>
          <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lon"</span><span class="o">,</span> <span class="s">"2.352222"</span><span class="o">)</span>
        <span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">searchUsers</span><span class="o">(</span><span class="n">filters</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">SecurityDocumentList</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">SecurityDocumentList</span> <span class="n">users</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// users.getDocuments() returns an users list</span>
      <span class="k">for</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span> <span class="o">:</span> <span class="n">users</span><span class="o">.</span><span class="na">getDocuments</span><span class="o">())</span> <span class="o">{</span>

      <span class="o">}</span>

      <span class="c1">// users.getTotal() returns the number of matched users, regardless of pagination</span>
      <span class="n">users</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Util\UsersSearchResult</span><span class="p">;</span>

<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'filter'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'and'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="p">[</span>
        <span class="s1">'terms'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'profileIds'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'anonymous'</span><span class="p">,</span> <span class="s1">'default'</span><span class="p">],</span>
        <span class="p">]</span>
      <span class="p">],</span>
      <span class="p">[</span>
        <span class="s1">'geo_distance'</span> <span class="o">=&gt;</span> <span class="p">[</span>
          <span class="s1">'distance'</span> <span class="o">=&gt;</span> <span class="s1">'10km'</span><span class="p">,</span>
          <span class="s1">'pos'</span> <span class="o">=&gt;</span> <span class="p">[</span>
            <span class="s1">'lat'</span> <span class="o">=&gt;</span> <span class="s1">'48.8566140'</span><span class="p">,</span>
            <span class="s1">'lon'</span> <span class="o">=&gt;</span> <span class="s1">'2.352222'</span>
          <span class="p">]</span>
        <span class="p">]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">searchUsers</span><span class="p">(</span><span class="nv">$filters</span><span class="p">);</span>

  <span class="c1">// $result instanceof UsersSearchResult
</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getUsers</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $user instanceof User
</span>  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">124</span><span class="p">,</span><span class="w">
  </span><span class="nt">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">array</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">User</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Executes a search on users according to a filter</p>

<h3 id="searchusers-filters-options-callback">searchUsers(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td><a href="/real-time-filters/">Filters</a></td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a JSON Object</p>

<h2 id="searchroles">searchRoles</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">filters</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">// filter can contains an array `controllers` with a list of controller name</span>
  <span class="na">controllers</span><span class="p">:</span>  <span class="p">[</span><span class="s1">'read'</span><span class="p">,</span> <span class="s1">'write'</span><span class="p">],</span>
  <span class="c1">// filter can handler pagination with properties `from` and `size`</span>
  <span class="na">from</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
  <span class="na">size</span><span class="p">:</span> <span class="mi">10</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchRoles</span><span class="p">(</span><span class="nx">filters</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">searchRolesPromise</span><span class="p">(</span><span class="nx">filters</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a JSON Object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">filter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"read"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"write"</span><span class="o">)</span>
  <span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"from"</span><span class="o">,</span> <span class="mi">0</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"size"</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>


<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">searchRoles</span><span class="o">(</span><span class="n">filter</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">SecurityDocumentList</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">SecurityDocumentList</span> <span class="n">roles</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// roles.getDocuments() returns a roles list</span>
      <span class="k">for</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span> <span class="o">:</span> <span class="n">roles</span><span class="o">.</span><span class="na">getDocuments</span><span class="o">())</span> <span class="o">{</span>

      <span class="o">}</span>

      <span class="c1">// roles.getTotal() returns the number of matched roles, regardless of pagination</span>
      <span class="n">roles</span><span class="o">.</span><span class="na">getTotal</span><span class="o">();</span>
    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Util\RolesSearchResult</span><span class="p">;</span>

<span class="nv">$filters</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'read'</span><span class="p">,</span>
    <span class="s1">'write'</span>
  <span class="p">],</span>
  <span class="s1">'size'</span> <span class="o">=&gt;</span> <span class="mi">10</span><span class="p">,</span>
  <span class="s1">'from'</span> <span class="o">=&gt;</span> <span class="mi">0</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$result</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">searchRoles</span><span class="p">(</span><span class="nv">$filters</span><span class="p">);</span>

  <span class="c1">// $result instanceof RolesSearchResult
</span>
  <span class="k">foreach</span><span class="p">(</span><span class="nv">$result</span><span class="o">-&gt;</span><span class="na">getRoles</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$role</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// $role instanceof Role
</span>  <span class="p">}</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>Callback response:</p>
</blockquote>
<pre class="highlight json"><code><span class="p">{</span><span class="w">
  </span><span class="nt">"total"</span><span class="p">:</span><span class="w"> </span><span class="mi">124</span><span class="p">,</span><span class="w">
  </span><span class="nt">"documents"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="err">//</span><span class="w"> </span><span class="err">array</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">Role</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>Executes a search on roles according to a filter</p>

<h3 id="searchroles-filters-options-callback">searchRoles(filters, [options], callback)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">filters</code></td>
<td>JSON Object</td>
<td>List of filters to retrieves roles</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">from</code></td>
<td>number</td>
<td>Starting offset</td>
<td><code class="prettyprint">0</code></td>
</tr>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
<tr>
<td><code class="prettyprint">size</code></td>
<td>number</td>
<td> Number of hits to return</td>
<td><code class="prettyprint">20</code></td>
</tr>
</tbody></table>

<p>Available filters:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">indexes</code></td>
<td>array</td>
<td>List of indexes id related to the searched role</td>
<td><code class="prettyprint">undefined</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a JSON Object</p>

<h2 id="updateprofile">updateProfile</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateProfile</span><span class="p">(</span><span class="s2">"profile ID"</span><span class="p">,</span> <span class="nx">newContent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedProfile</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateProfilePromise</span><span class="p">(</span><span class="s2">"profile ID"</span><span class="p">,</span> <span class="nx">newContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedProfile</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">policy2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">updateProfile</span><span class="o">(</span><span class="s">"profile ID"</span><span class="o">,</span> <span class="n">newContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>
<span class="nv">$profileDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'myRole'</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'anonymous'</span><span class="p">,</span>
      <span class="s1">'restrictedTo'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'my-second-index'</span><span class="p">,</span> <span class="s1">'collection'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'my-collection'</span><span class="p">]]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">updateProfile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">,</span> <span class="nv">$profileDefinition</span><span class="p">);</span>

  <span class="c1">// $profile instanceof Profile
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<h4 id="updateprofile-id-content-options-callback">updateProfile(id, content, [options], [callback])</h4>

<p>Performs a partial update on an existing profile.</p>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the profile</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an updated <code class="prettyprint">Profile</code> object</p>

<h2 id="updaterole">updateRole</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">roleDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"read"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"get"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateRole</span><span class="p">(</span><span class="s2">"role ID"</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedRole</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateRolePromise</span><span class="p">(</span><span class="s2">"profile ID"</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedRole</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">updateRole</span><span class="o">(</span><span class="s">"Role ID"</span><span class="o">,</span> <span class="n">roleDefinition</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Role</span> <span class="n">role</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">updateRole</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">,</span> <span class="nv">$roleDefinition</span><span class="p">);</span>

  <span class="c1">// $role instanceof Role
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<h4 id="updaterole-id-content-options-callback">updateRole(id, content, [options], [callback])</h4>

<p>Performs a partial update on an existing role.</p>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the role</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an updated <code class="prettyprint">Role</code> object</p>

<h2 id="updateuser">updateUser</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Jonas'</span>
<span class="p">};</span>


<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateUser</span><span class="p">(</span><span class="s2">"User ID"</span><span class="p">,</span> <span class="nx">newContent</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedUser</span><span class="p">)</span> <span class="p">{</span>

  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">kuzzle</span>
  <span class="p">.</span><span class="nx">security</span>
  <span class="p">.</span><span class="nx">updateUserPromise</span><span class="p">(</span><span class="s2">"User ID"</span><span class="p">,</span> <span class="nx">newContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedUser</span> <span class="o">=&gt;</span> <span class="p">{</span>

  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"My Name Is"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Jonas"</span><span class="o">);</span>

<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">updateUser</span><span class="o">(</span><span class="s">"User ID"</span><span class="o">,</span> <span class="n">newContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>
<span class="nv">$userDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Jonas'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">updateUser</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>

  <span class="c1">// $user instanceof User
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<h4 id="updateuser-id-content-options-callback">updateUser(id, content, [options], [callback])</h4>

<p>Performs a partial update on an existing user.</p>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>A plain JSON object representing the user</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>string</td>
<td>(Optional) Optional arguments</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Filter</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Security</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to an updated <code class="prettyprint">User</code> object</p>

<h2 id="user">user</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">userContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="c1">// A "profileIds" field is required to bind a user to an existing profile</span>
  <span class="na">profileIds</span><span class="p">:</span> <span class="p">[</span><span class="s1">'some profile'</span><span class="p">],</span>

  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="na">password</span><span class="p">:</span> <span class="s1">'secretPassword'</span><span class="p">,</span>

  <span class="c1">// You can also set custom fields to your user</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Doe'</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">user</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">userContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="c1">// A "profileIds" field is required to bind a user to an existing profile</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileIds"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="err">'</span><span class="n">someProfile</span><span class="err">'</span><span class="o">))</span>
    <span class="c1">// The "local" authentication strategy requires a password</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"a password"</span><span class="o">)</span>
    <span class="c1">// You can also set custom fields to your user</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">);</span>

<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">user</span><span class="o">(</span><span class="s">"userId"</span><span class="o">,</span> <span class="n">userContent</span><span class="o">);</span>  
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>
<span class="nv">$userDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">// A "profileIds" field is required to bind a user to an existing profile
</span>  <span class="s1">'profileIds'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'myProfile'</span><span class="p">],</span>
  <span class="c1">// The "local" authentication strategy requires a password
</span>  <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span><span class="p">,</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Doe'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>
<span class="c1">// $user instanceof User
</span></code></pre>

<p>Instantiates a new User object.</p>

<h3 id="user-id-content">user(id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>User content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object.</p>

            <h1 id="role">~ Role</h1>

<p>Role is the object representation of a set of right policies.</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 Role objects are returned by Security.role method:
 */</span>
<span class="kd">var</span> <span class="nx">roleDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"*"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"*"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">role</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">role</span><span class="p">(</span><span class="s1">'myrole'</span><span class="p">,</span> <span class="nx">roleDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">Role</span> <span class="n">role</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Role</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">,</span> <span class="s">"role ID"</span><span class="o">,</span> <span class="n">roleDefinition</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Role</span><span class="p">;</span>

<span class="nv">$roleId</span> <span class="o">=</span> <span class="s1">'myRole'</span><span class="p">;</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="c1">// Using the Security factory:
</span><span class="nv">$role</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">role</span><span class="p">(</span><span class="nv">$roleId</span><span class="p">,</span> <span class="nv">$roleDefinition</span><span class="p">);</span>

<span class="c1">// Or directly with the constructor:
</span><span class="nv">$role</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Role</span><span class="p">(</span><span class="nv">$security</span><span class="p">,</span> <span class="nv">$roleId</span><span class="p">,</span> <span class="nv">$roleDefinition</span><span class="p">);</span>
</code></pre>

<p>Instantiates a new <code class="prettyprint">Role</code> object.</p>

<h3 id="role-security-id-content">Role(Security, id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Security</code></td>
<td>Security</td>
<td>An instantiated Security object</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique role identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Role content</td>
</tr>
</tbody></table>

<p><strong>Note:</strong>  this constructor won&rsquo;t make any call to Kuzzle.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Role</code> object.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Raw role content</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
<td>get</td>
</tr>
</tbody></table>

<h2 id="delete">delete</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">role</span><span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">deletedId</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">role</span><span class="p">.</span><span class="nx">deletePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">deletedId</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">role</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">deletedId</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Role</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $role Role
 */</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// error occurred
</span><span class="p">}</span>
</code></pre>

<p>Deletes the role from Kuzzle&rsquo;s database layer.</p>

<h3 id="delete-options-callback">delete([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the id of the deleted role.</p>

<h2 id="save">save</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">role</span>
  <span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">role</span>
  <span class="p">.</span><span class="nx">savePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Role object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">role</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Role</span> <span class="n">savedRole</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Role</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $role Role
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$role</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

  <span class="c1">// $role instanceof Role
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// error occured
</span><span class="p">}</span>
</code></pre>

<p>Creates or replaces the role in Kuzzle&rsquo;s database layer.</p>

<h3 id="save-options-callback">save([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Role</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Role</code> object.</p>

<h2 id="setcontent">setContent</h2>

<aside class="note">
Updating a role content will have no impact until the <code>save</code> method is called
</aside>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">roleDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"*"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"*"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">role</span> <span class="o">=</span> <span class="nx">role</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">roleDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"*"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">role</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">roleDefinition</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Role</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'*'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="cm">/*
 * @var $role Role
 */</span>
<span class="nv">$role</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$roleDefinition</span><span class="p">);</span>
</code></pre>

<p>Replaces the content of the <code class="prettyprint">Role</code> object.</p>

<h3 id="setcontent-data">setContent(data)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">data</code></td>
<td>JSON Object</td>
<td>Role content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Role</code> object.</p>

<h2 id="update">update</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">updateContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">controllers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"document"</span><span class="p">:</span> <span class="p">{</span>
      <span class="nl">actions</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">"get"</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">role</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedRole</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// the updatedRole variable is the updated Role object</span>
<span class="p">})</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">role</span>
  <span class="p">.</span><span class="nx">updatePromise</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedRole</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// the updatedRole variable is the updated Role object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">roleDefinition</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"controllers"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"document"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"actions"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"get"</span><span class="o">,</span> <span class="kc">true</span><span class="o">)</span>
      <span class="o">)</span>
    <span class="o">)</span>
  <span class="o">)</span>
<span class="o">);</span>

<span class="n">role</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">roleDefinition</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Role</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Role</span> <span class="n">updatedRole</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Role</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$roleDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'controllers'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">'document'</span> <span class="o">=&gt;</span> <span class="p">[</span>
      <span class="s1">'actions'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">'get'</span> <span class="o">=&gt;</span> <span class="kc">true</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="cm">/*
 * @var $role Role
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$role</span> <span class="o">=</span> <span class="nv">$role</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$roleDefinition</span><span class="p">);</span>

  <span class="c1">// $role instanceof Role
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// error occured
</span><span class="p">}</span>
</code></pre>

<p>Updates the role object Kuzzle&rsquo;s database layer.</p>

<aside class="warning">
  <p>
    Unlike a regular document update, this method will replace the whole role definition under the indexes node by the <code>updateContent</code> parameter.<br>
    In other words, you always need to provide the complete role definition in the <code>updateContent</code> object.
  </p>
  <p>
    This method has the same effect as calling <a href="#setContent"><code>setContent</code></a> followed by the <a href="#save"><code>save</code></a> method.
  </p>
</aside>

<p>To get more information on Kuzzle permissions, please refer to our <a href="/guide/#permissions">Kuzzle Permissions guide</a>.</p>

<h3 id="update-content-options-callback">update(content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>New role content</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Role</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the updated version of this object</p>

            <h1 id="profile">~ Profile</h1>

<p>Profile is the object representation of a profile, which is a set of one or many Role objects.</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 Profile objects are returned by Security.profile method:
 */</span>
<span class="kd">var</span> <span class="nx">profileDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">role</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">profile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="nx">profileDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">policy2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>
<span class="n">JSONObject</span> <span class="n">roles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">Profile</span> <span class="n">profile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Profile</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">,</span> <span class="s">"profileId"</span><span class="o">,</span> <span class="n">roles</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="nv">$profileId</span> <span class="o">=</span> <span class="s1">'myProfile'</span><span class="p">;</span>
<span class="nv">$profileDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'myRole'</span>
    <span class="p">],</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'anonymous'</span><span class="p">,</span>
      <span class="s1">'restrictedTo'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'my-second-index'</span><span class="p">,</span> <span class="s1">'collection'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'my-collection'</span><span class="p">]]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>


<span class="c1">// Using the Security factory:
</span><span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">profile</span><span class="p">(</span><span class="nv">$profileId</span><span class="p">,</span> <span class="nv">$profileDefinition</span><span class="p">);</span>

<span class="c1">// Or directly with the constructor:
</span><span class="nv">$profile</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Profile</span><span class="p">(</span><span class="nv">$security</span><span class="p">,</span> <span class="nv">$profileId</span><span class="p">,</span> <span class="nv">$profileDefinition</span><span class="p">);</span>
</code></pre>

<p>Instantiates a new <code class="prettyprint">Profile</code> object.</p>

<h3 id="profile-security-id-content">Profile(Security, id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Security</code></td>
<td>Security</td>
<td>An instantiated Security object</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Profile content</td>
</tr>
</tbody></table>

<p><strong>Note:</strong>  this constructor won&rsquo;t make any call to Kuzzle.</p>

<h3 id="return-value">Return value</h3>

<p>Returns to the <code class="prettyprint">Profile</code> object.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Raw profile content</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
<td>get</td>
</tr>
</tbody></table>

<h2 id="addpolicy">addPolicy</h2>
<pre class="highlight javascript"><code><span class="nx">profile</span><span class="p">.</span><span class="nx">addPolicy</span><span class="p">({</span>
  <span class="s1">'roleId'</span><span class="p">:</span> <span class="s1">'some role id'</span><span class="p">,</span>
  <span class="s1">'restrictedTo'</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span>
<span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"some role id"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">profile</span><span class="o">.</span><span class="na">addPolicy</span><span class="o">(</span><span class="n">policy</span><span class="o">);</span>

<span class="c1">// you may also add a role ID directly</span>
<span class="n">profile</span><span class="o">.</span><span class="na">addPolicy</span><span class="o">(</span><span class="s">"some role id"</span><span class="o">);</span>
</code></pre>

<p>Adds a role to the profile.</p>

<aside class="note">
Updating a profile will have no impact until the <code>save</code> method is called
</aside>

<h3 id="addpolicy-id">addPolicy(id)</h3>

<h3 id="addpolicy-policy">addPolicy(policy)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique id corresponding to the new associated role</td>
</tr>
<tr>
<td><code class="prettyprint">policy</code></td>
<td>JSON Object</td>
<td>policy instance corresponding to the new associated role and its restrictions</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object to allow chaining calls.</p>

<h2 id="delete">delete</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">profile</span>
  <span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is the id of deleted profile</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">profile</span>
  <span class="p">.</span><span class="nx">deletePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is the id of deleted profile</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">profile</span>
  <span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">deleteId</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

    <span class="o">}</span>
  <span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $profile Profile
 */</span>
<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span><span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Deletes this profile from Kuzzle.</p>

<h3 id="delete-options-callback">delete([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the id of the deleted profile.</p>

<h2 id="getpolicies">getPolicies</h2>
<pre class="highlight javascript"><code><span class="k">for</span> <span class="p">(</span><span class="nx">policy</span> <span class="nx">of</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">getPolicies</span><span class="p">())</span> <span class="p">{</span>
  <span class="c1">// policy is a JSON object</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight java"><code><span class="k">for</span><span class="o">(</span><span class="n">JSONArray</span> <span class="n">policy</span> <span class="o">:</span> <span class="n">profile</span><span class="o">.</span><span class="na">getPolicies</span><span class="o">())</span> <span class="o">{</span>
  <span class="c1">// policy is a JSON object</span>
<span class="o">}</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Kuzzle\Security\Policy</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $profile Profile
 */</span>
<span class="k">foreach</span><span class="p">(</span><span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">getPolicies</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$policy</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// $policy instanceof Policy
</span><span class="p">}</span>
</code></pre>

<p>Returns this profile associated roles.</p>

<h3 id="return-value">Return value</h3>

<p>An array of associated roles</p>

<h2 id="save">save</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profileDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">profile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="nx">profileDefinition</span><span class="p">);</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">profile</span>
  <span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">profile</span>
  <span class="p">.</span><span class="nx">savePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">result</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a Profile object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">policy2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">roles</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">Profile</span> <span class="n">profile</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">profile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="n">roles</span><span class="o">);</span>

<span class="n">profile</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">savedProfile</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Overrid</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $profile Profile
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>

  <span class="c1">// $profile instanceof Profile
</span><span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Creates or replaces the profile in Kuzzle.</p>

<aside class="warning">
Saving the object will rise an error if the bound roles have not been previously created in Kuzzle.
</aside>

<h3 id="save-options-callback">save([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">Profile</code> object.</p>

<h2 id="setcontent">setContent</h2>

<aside class="note">
Updating a profile will have no impact until the <code>save</code> method is called
</aside>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">fetchProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">profileDefinition</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'default'</span><span class="p">,</span> <span class="na">restrictedTo</span><span class="p">:</span> <span class="p">[{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index1'</span><span class="p">},</span> <span class="p">{</span><span class="na">index</span><span class="p">:</span> <span class="s1">'index2'</span><span class="p">,</span> <span class="na">collections</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">]</span> <span class="p">}</span> <span class="p">]</span> <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="nx">profile</span> <span class="o">=</span> <span class="nx">profile</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">profileDefinition</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">policy2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"default"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"restrictedTo"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index1"</span><span class="o">))</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"index"</span><span class="o">,</span> <span class="s">"index2"</span><span class="o">)</span>
      <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"collections"</span><span class="o">,</span><span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"foo"</span><span class="o">).</span><span class="na">put</span><span class="o">(</span><span class="s">"bar"</span><span class="o">))</span>
    <span class="o">)</span>
  <span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">)</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">policy2</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">profile</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">newRolesList</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$profileDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'policies'</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="p">[</span>
      <span class="s1">'roleId'</span> <span class="o">=&gt;</span> <span class="s1">'anonymous'</span><span class="p">,</span>
      <span class="s1">'restrictedTo'</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="p">[</span><span class="s1">'index'</span> <span class="o">=&gt;</span> <span class="s1">'my-second-index'</span><span class="p">,</span> <span class="s1">'collection'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'my-collection'</span><span class="p">]]</span>
      <span class="p">]</span>
    <span class="p">]</span>
  <span class="p">]</span>
<span class="p">];</span>

<span class="cm">/*
 * @var $profile Role
 */</span>
<span class="nv">$profile</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$profileDefinition</span><span class="p">);</span>
</code></pre>

<p>Replaces the content of the <code class="prettyprint">Profile</code> object.</p>

<h3 id="setcontent-data">setContent(data)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">data</code></td>
<td>JSON Object</td>
<td>Profile content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object.</p>

<h2 id="setpolicies">setPolicies</h2>

<aside class="note">
Updating a profile will have no impact until the <code>save</code> method is called
</aside>
<pre class="highlight javascript"><code><span class="nx">policy</span> <span class="o">=</span> <span class="p">{</span> <span class="s2">"roleId"</span><span class="p">:</span> <span class="s2">"roleId"</span> <span class="p">};</span>

<span class="c1">// Replaces the profile policies set with the given entry.</span>
<span class="nx">profile</span><span class="p">.</span><span class="nx">setPolicies</span><span class="p">([</span><span class="nx">policy</span><span class="p">]);</span>
</code></pre>
<pre class="highlight java"><code><span class="c1">// Binding role IDs to a profile</span>
<span class="n">profile</span><span class="o">.</span><span class="na">setPolicies</span><span class="o">({</span><span class="s">"role1 ID"</span><span class="o">,</span> <span class="s">"role2 ID"</span><span class="o">,</span> <span class="s">"role3 ID"</span><span class="o">});</span>

<span class="c1">// Binding policies definition to a profile</span>
<span class="n">profile</span><span class="o">.</span><span class="na">setPolicies</span><span class="o">({</span>
  <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="err">'</span><span class="n">roleId</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">role1</span> <span class="n">ID</span><span class="err">'</span><span class="o">),</span>
  <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="err">'</span><span class="n">roleId</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">role2</span> <span class="n">ID</span><span class="err">'</span><span class="o">),</span>
  <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="err">'</span><span class="n">roleId</span><span class="err">'</span><span class="o">,</span> <span class="err">'</span><span class="n">role3</span> <span class="n">ID</span><span class="err">'</span><span class="o">)</span>
<span class="o">});</span>
</code></pre>

<p>Replaces the roles associated to the profile.</p>

<h3 id="setpolicies-array-policyids">setPolicies(Array<String> policyIDs)</h3>

<h3 id="setpolicies-array-policydefinitions">setPolicies(Array<JSONObject> policyDefinitions)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">policyIDs</code></td>
<td>array of strings</td>
<td>Policy IDs to add</td>
</tr>
<tr>
<td><code class="prettyprint">policyDefinitions</code></td>
<td>array of JSON objects</td>
<td>Policy definitions to add</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object.</p>

<h2 id="update">update</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">updateContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">policies</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">roleId</span><span class="p">:</span> <span class="s1">'myrole'</span><span class="p">},</span>
  <span class="p">]</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">profile</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedProfile</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// the updatedProfile variable is the updated Profile object</span>
<span class="p">})</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">profile</span>
  <span class="p">.</span><span class="nx">updatePromise</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedProfile</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// the updatedProfile variable is the updated Profile object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">policy1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"roleId"</span><span class="o">,</span> <span class="s">"myrole"</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">updateContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"policies"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="n">policy1</span><span class="o">));</span>

<span class="n">profile</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">updateContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">updatedProfile</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>

<p>Performs a partial content update on this object.</p>

<h3 id="update-content-options-callback">update(content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>Profile content</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">Profile</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the updated version of this object</p>

            <h1 id="user">~ User</h1>

<p>User is the object representation of an user, which is associated to a Profile object</p>

<h2 id="constructors">Constructors</h2>
<pre class="highlight javascript"><code><span class="cm">/*
 Constructors are not exposed in the JS/Node SDK.
 User objects are returned by Security.user method:
 */</span>
 <span class="kd">var</span> <span class="nx">userContent</span> <span class="o">=</span> <span class="p">{</span>
   <span class="c1">// A "profile" field is required to bind a user to an existing profile</span>
   <span class="na">profileIds</span><span class="p">:</span> <span class="p">[</span><span class="s1">'admin'</span><span class="p">],</span>

   <span class="c1">// The "local" authentication strategy requires a password</span>
   <span class="na">password</span><span class="p">:</span> <span class="s1">'secretPassword'</span><span class="p">,</span>

   <span class="c1">// You can also set custom fields to your user</span>
   <span class="na">firstname</span><span class="p">:</span> <span class="s1">'John'</span><span class="p">,</span>
   <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Doe'</span>
 <span class="p">};</span>

<span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">user</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">,</span> <span class="nx">userContent</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">userContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="c1">// A "profile" field is required to bind a user to an existing profile</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileIds"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">().</span><span class="na">put</span><span class="o">(</span><span class="s">"admin"</span><span class="o">))</span>
  <span class="c1">// The "local" authentication strategy requires a password</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"password"</span><span class="o">,</span> <span class="s">"secret password"</span><span class="o">)</span>
  <span class="c1">// You can also set custom fields to your user</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"John"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Doe"</span><span class="o">);</span>

<span class="c1">// Using the KuzzleSecurity factory:</span>
<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">.</span><span class="na">user</span><span class="o">(</span><span class="s">"user ID"</span><span class="o">,</span> <span class="n">userContent</span><span class="o">);</span>

<span class="c1">// Or directly with the constructor:</span>
<span class="n">User</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="n">User</span><span class="o">(</span><span class="n">kuzzle</span><span class="o">.</span><span class="na">security</span><span class="o">,</span> <span class="s">"user ID"</span><span class="o">,</span> <span class="n">userContent</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">\Kuzzle\Kuzzle</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">\Kuzzle\Security\User</span><span class="p">;</span>

<span class="nv">$userId</span> <span class="o">=</span> <span class="s1">'myUser'</span><span class="p">;</span>
<span class="nv">$userDefinition</span> <span class="o">=</span> <span class="p">[</span>
  <span class="c1">// A "profileIds" field is required to bind a user to an existing profile
</span>  <span class="s1">'profileIds'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'myProfile'</span><span class="p">],</span>
  <span class="c1">// The "local" authentication strategy requires a password
</span>  <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="s1">'secret'</span><span class="p">,</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'John'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Doe'</span>
<span class="p">];</span>

<span class="nv">$kuzzle</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Kuzzle</span><span class="p">(</span><span class="s1">'localhost'</span><span class="p">);</span>
<span class="nv">$security</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="p">();</span>

<span class="c1">// Using the Security factory
</span><span class="nv">$user</span> <span class="o">=</span> <span class="nv">$security</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">(</span><span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>

<span class="c1">// Or directly with the constructor:
</span><span class="nv">$user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">User</span><span class="p">(</span><span class="nv">$security</span><span class="p">,</span> <span class="nv">$userId</span><span class="p">,</span> <span class="nv">$userDefinition</span><span class="p">);</span>
</code></pre>

<p>Instantiates a new User object.</p>

<h3 id="user-security-id-content">User(Security, id, content)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">Security</code></td>
<td>Security</td>
<td>An instantiated Security object</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique user identifier</td>
</tr>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>User content</td>
</tr>
</tbody></table>

<p><strong>Note:</strong>  this constructor won&rsquo;t make any call to Kuzzle.</p>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object.</p>

<h2 id="properties">Properties</h2>

<table><thead>
<tr>
<th>Property name</th>
<th>Type</th>
<th>Description</th>
<th>get/set</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON object</td>
<td>Raw user content</td>
<td>get</td>
</tr>
<tr>
<td><code class="prettyprint">id</code></td>
<td>string</td>
<td>Unique profile identifier</td>
<td>get</td>
</tr>
</tbody></table>

<h2 id="addprofile">addProfile</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">fetchProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">profile</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Can add a profile directly with a Profile object</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">addProfile</span><span class="p">(</span><span class="nx">profile</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Or by passing an id</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">addProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code>
<span class="c1">// Updating the profile with a Profile object</span>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">fetchProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// Can add the profile directly with a Profile object</span>
      <span class="n">user</span><span class="o">.</span><span class="na">addProfile</span><span class="o">(</span><span class="n">profile</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">});</span>

<span class="c1">// Updating the profile with a profile ID</span>
<span class="n">user</span><span class="o">.</span><span class="na">addProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="o">-&gt;</span><span class="na">fetchProfile</span><span class="p">(</span><span class="s1">'myProfile'</span><span class="p">);</span>

<span class="cm">/*
 * @var $user User
 */</span>

<span class="c1">// Updating the profile with a Profile object
</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">addProfile</span><span class="p">(</span><span class="nv">$profile</span><span class="p">);</span>

<span class="c1">// Updating the profile with a profile ID
</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">addProfile</span><span class="p">(</span><span class="s1">'myProfile'</span><span class="p">);</span>
</code></pre>

<aside class="note">
Updating an user will have no impact until the <code>save</code> method is called
</aside>

<p>Replace the profile associated to the user</p>

<h3 id="addprofile-profileid">addProfile(profileId)</h3>

<h3 id="addprofile-profile">addProfile(profile)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">profileId</code></td>
<td>string</td>
<td>Profile ID</td>
</tr>
<tr>
<td><code class="prettyprint">profile</code></td>
<td>Profile</td>
<td>An instantiated Profile object</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object.</p>

<h2 id="delete">delete</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="k">delete</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is the id of deleted user</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="nx">deletePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is the id of deleted user</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">user</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">String</span> <span class="n">deletedId</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span> <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $user User
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Deletes the user in Kuzzle</p>

<h3 id="delete-options-callback">delete([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">String</code> containing the deleted user ID</p>

<h2 id="getprofiles">getProfiles</h2>
<pre class="highlight javascript"><code><span class="k">for</span> <span class="p">(</span><span class="nx">profile</span> <span class="nx">of</span> <span class="nx">user</span><span class="p">.</span><span class="nx">getProfiles</span><span class="p">())</span> <span class="p">{</span>
  <span class="c1">// profile can either be a profile ID if the object has not been hydrated,</span>
  <span class="c1">// or a Profile object otherwise</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight java"><code><span class="k">for</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span> <span class="o">:</span> <span class="n">user</span><span class="o">.</span><span class="na">getProfiles</span><span class="o">())</span> <span class="o">{</span>
  <span class="c1">// if this object has not been hydrated, the profile object has no content</span>
<span class="o">}</span>
</code></pre>

<p>Returns this user associated profiles.</p>

<h3 id="return-value">Return value</h3>

<p>Returns an array of associated profiles</p>

<h2 id="save">save</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="nx">save</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="nx">savePromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">user</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $user User
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Create or replace the user in kuzzle</p>

<aside class="warning">
Saving this object can rise an error if the associated profile is not created in Kuzzle
</aside>

<h3 id="save-options-callback">save([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">User</code> object.</p>

<h2 id="saverestricted">saveRestricted</h2>
<pre class="highlight javascript"><code><span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="nx">saveRestricted</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">user</span>
  <span class="p">.</span><span class="nx">saveRestrictedPromise</span><span class="p">()</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// result is a User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">user</span><span class="o">.</span><span class="na">saveRestricted</span><span class="o">(</span><span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">user</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $user User
 */</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">saveRestricted</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Saves this user as restricted into Kuzzle.</p>

<h3 id="saverestricted-options-callback">saveRestricted([options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>(Optional) Callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to a <code class="prettyprint">User</code> object.</p>

<h2 id="setcontent">setContent</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">fetchUser</span><span class="p">(</span><span class="s1">'myuser'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">userContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">profileIds</span><span class="p">:</span> <span class="p">[</span><span class="s1">'profileId'</span><span class="p">]</span>
<span class="p">};</span>

<span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">setContent</span><span class="p">(</span><span class="nx">userContent</span><span class="p">);</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">newContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileIds"</span><span class="o">,</span> <span class="k">new</span> <span class="n">JSONArray</span><span class="o">()</span>
    <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"profileId"</span><span class="o">)</span>
  <span class="o">);</span>

<span class="n">user</span><span class="o">.</span><span class="na">setContent</span><span class="o">(</span><span class="n">newContent</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$userContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'profileIds'</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">'profileId'</span><span class="p">]</span>
<span class="p">];</span>

<span class="cm">/*
 * @var $user User
 */</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setContent</span><span class="p">(</span><span class="nv">$userContent</span><span class="p">);</span>
</code></pre>

<aside class="note">
Updating an user will have no impact until the <code>save</code> method is called
</aside>

<p>Replaces the content of User</p>

<h3 id="setcontent-data">setContent(data)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">data</code></td>
<td>JSON Object</td>
<td>User content</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object.</p>

<h2 id="setprofiles">setProfiles</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">profile</span> <span class="o">=</span> <span class="nx">kuzzle</span><span class="p">.</span><span class="nx">security</span><span class="p">.</span><span class="nx">fetchProfile</span><span class="p">(</span><span class="s1">'myprofile'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">profile</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Can set the profiles directly with a Profile object</span>
  <span class="nx">user</span><span class="p">.</span><span class="nx">setProfiles</span><span class="p">([</span><span class="nx">profile</span><span class="p">]);</span>
<span class="p">});</span>

<span class="c1">// Or by passing their ids</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">setProfiles</span><span class="p">([</span><span class="s1">'myprofile'</span><span class="p">]);</span>
</code></pre>
<pre class="highlight java"><code>
<span class="c1">// Updating the profile with a Profile object</span>
<span class="n">kuzzle</span>
  <span class="o">.</span><span class="na">security</span>
  <span class="o">.</span><span class="na">fetchProfile</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">,</span> <span class="n">opts</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;()</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">Profile</span> <span class="n">profile</span><span class="o">)</span> <span class="o">{</span>

      <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;</span> <span class="n">profileIds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">Profile</span><span class="o">&gt;();</span>
      <span class="n">profileIds</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">profile</span><span class="o">);</span>

      <span class="n">user</span><span class="o">.</span><span class="na">setProfiles</span><span class="o">(</span><span class="n">profileIds</span><span class="o">);</span>

    <span class="o">}</span>
  <span class="o">});</span>

<span class="c1">// Updating the profile with a profile ID</span>
<span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">profileIds</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;();</span>
<span class="n">profileIds</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"myprofile"</span><span class="o">);</span>

<span class="n">user</span><span class="o">.</span><span class="na">setProfiles</span><span class="o">(</span><span class="n">profileIds</span><span class="o">);</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\Profile</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="nv">$profile</span> <span class="o">=</span> <span class="nv">$kuzzle</span><span class="o">-&gt;</span><span class="na">security</span><span class="o">-&gt;</span><span class="na">fetchProfile</span><span class="p">(</span><span class="s1">'myProfile'</span><span class="p">);</span>

<span class="cm">/*
 * @var $user User
 */</span>

<span class="c1">// Updating the profile with a Profile object
</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setProfiles</span><span class="p">([</span><span class="nv">$profile</span><span class="p">]);</span>

<span class="c1">// Updating the profile with a profile ID
</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">setProfiles</span><span class="p">([</span><span class="s1">'myProfile'</span><span class="p">]);</span>
</code></pre>

<aside class="note">
Updating an user will have no impact until the <code>save</code> method is called
</aside>

<p>Replace the profile associated to the user</p>

<h3 id="setprofiles-profileids">setProfiles(profileIds)</h3>

<h3 id="setprofiles-profiles">setProfiles(profiles)</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">profileIds</code></td>
<td>array of strings</td>
<td>List of profile IDs</td>
</tr>
<tr>
<td><code class="prettyprint">profiles</code></td>
<td>array of Profile objects</td>
<td>An array of instantiated Profile objects</td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object.</p>

<h2 id="update">update</h2>
<pre class="highlight javascript"><code><span class="kd">var</span> <span class="nx">updateContent</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">firstname</span><span class="p">:</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="na">lastname</span><span class="p">:</span> <span class="s1">'Jonas'</span>
<span class="p">};</span>

<span class="c1">// Using callbacks (NodeJS or Web Browser)</span>
<span class="nx">user</span><span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">updatedUser</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// the updatedUser variable is the updated User object</span>
<span class="p">})</span>

<span class="c1">// Using promises (NodeJS)</span>
<span class="nx">role</span>
  <span class="p">.</span><span class="nx">updatePromise</span><span class="p">(</span><span class="nx">updateContent</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">updatedUser</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// the updatedUser variable is the updated User object</span>
  <span class="p">});</span>
</code></pre>
<pre class="highlight java"><code><span class="n">JSONObject</span> <span class="n">updateContent</span> <span class="o">=</span> <span class="k">new</span> <span class="n">JSONObject</span><span class="o">()</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"firstname"</span><span class="o">,</span> <span class="s">"My Name Is"</span><span class="o">)</span>
  <span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"lastname"</span><span class="o">,</span> <span class="s">"Jonas"</span><span class="o">);</span>

<span class="n">user</span><span class="o">.</span><span class="na">update</span><span class="o">(</span><span class="n">updateContent</span><span class="o">,</span> <span class="k">new</span> <span class="n">ResponseListener</span><span class="o">&lt;</span><span class="n">User</span><span class="o">&gt;()</span> <span class="o">{</span>
  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onSuccess</span><span class="o">(</span><span class="n">User</span> <span class="n">updatedUser</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="n">onError</span><span class="o">(</span><span class="n">JSONObject</span> <span class="n">error</span><span class="o">)</span> <span class="o">{</span>

  <span class="o">}</span>
<span class="o">});</span>
</code></pre>
<pre class="highlight php"><code><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Kuzzle\Security\User</span><span class="p">;</span>

<span class="c1">// ...
</span>
<span class="cm">/*
 * @var $user User
 */</span>

<span class="nv">$userContent</span> <span class="o">=</span> <span class="p">[</span>
  <span class="s1">'firstname'</span> <span class="o">=&gt;</span> <span class="s1">'My Name Is'</span><span class="p">,</span>
  <span class="s1">'lastname'</span> <span class="o">=&gt;</span> <span class="s1">'Jonas'</span>
<span class="p">];</span>

<span class="k">try</span> <span class="p">{</span>
  <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">(</span><span class="nv">$userContent</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">catch</span> <span class="p">(</span><span class="nx">ErrorException</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>

<span class="p">}</span>
</code></pre>

<p>Performs a partial content update on this object.</p>

<h3 id="update-content-options-callback">update(content, [options], [callback])</h3>

<table><thead>
<tr>
<th>Arguments</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">content</code></td>
<td>JSON Object</td>
<td>User content</td>
</tr>
<tr>
<td><code class="prettyprint">options</code></td>
<td>JSON Object</td>
<td>Optional parameters</td>
</tr>
<tr>
<td><code class="prettyprint">callback</code></td>
<td>function</td>
<td>Optional callback handling the response</td>
</tr>
</tbody></table>

<p>Available options:</p>

<table><thead>
<tr>
<th>Option</th>
<th>Type</th>
<th>Description</th>
<th>Default</th>
</tr>
</thead><tbody>
<tr>
<td><code class="prettyprint">queuable</code></td>
<td>boolean</td>
<td>Mark this request as (not) queuable</td>
<td><code class="prettyprint">true</code></td>
</tr>
</tbody></table>

<h3 id="return-value">Return value</h3>

<p>Returns the <code class="prettyprint">User</code> object to allow chaining.</p>

<h3 id="callback-response">Callback response</h3>

<p>Resolves to the updated version of this object</p>

        </div>
        <div class="dark-box">
            <div class="lang-selector">
                <a href="#" data-language-name="javascript">Javascript</a>
                <a href="#" data-language-name="java">Android</a>
                <a href="#" data-language-name="php">PHP</a>
            </div>
        </div>
      </div>
    </div>
    <script>
      ((window.gitter = {}).chat = {}).options = {
        room: 'kuzzleio/kuzzle'
      };
    </script>
    <script src="https://sidecar.gitter.im/dist/sidecar.v1.js" async defer></script>
    <script type="text/javascript">
      (function(i, s, o, g, r, a, m) {
          i['GoogleAnalyticsObject'] = r;
          i[r] = i[r] || function() {
                  (i[r].q = i[r].q || []).push(arguments)
              }, i[r].l = 1 * new Date();
          a = s.createElement(o),
              m = s.getElementsByTagName(o)[0];
          a.async = 1;
          a.src = g;
          m.parentNode.insertBefore(a, m)
      })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

      ga('create', 'UA-67035328-1', 'auto');
      ga('send', 'pageview');


      (function() {
        var
          r,
          version;

        r = /\/v\/([^/]+)(?:\/[^/]+\.html?)?$/.exec(window.location.pathname);

        if (r) {
          version = r[1];
          $('#version-selector option[value="/v/' + version + '"]').prop('selected', true);
        }

        $('#version-selector').change(function (e) {
          var
            versionPath = $('#version-selector option:selected').val();
          window.location = window.location.pathname
            .replace(/\/v\/([^/]+)(\/[^/]+\.html?)?$/, '\2')
            + versionPath
            +'#' + window.location.hash;
        });
      })();
    </script>
  </body>
</html>
