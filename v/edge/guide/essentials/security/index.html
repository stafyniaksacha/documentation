<!doctype html><html><head><meta http-equiv=Content-Type content="text/html; charset=utf-8"><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=msapplication-TileColor content=#FFFFFF><meta name=msapplication-TileImage content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/mstile-144x144.png><meta name=msapplication-square70x70logo content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/mstile-70x70.png><meta name=msapplication-square150x150logo content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/mstile-150x150.png><meta name=msapplication-wide310x150logo content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/mstile-310x150.png><meta name=msapplication-square310x310logo content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/mstile-310x310.png><meta name=google-site-verification content=luspUdq52gkUU0FFChQ2xmeXSs5HDafpARQ7fVXVBp4><meta itemprop=name content=Security><meta itemprop=image content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/favicon-196x196.png><meta name=twitter:card value=summary><meta name=twitter:site content=@kuzzleio><meta name=twitter:title content=Security><meta name=twitter:creator content=@kuzzleio><meta name=twitter:image content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/favicon-196x196.png><meta property=og:title content=Security><meta property=og:type content=article><meta property=og:site_name content=""><meta property=og:image content=https://stafyniaksacha.github.io/documentation/v/edge/assets/images/favicon/favicon-96x96.png><meta property=article:published_time content=2017-05-21T16:29:24.055Z><meta property=article:modified_time content=2017-05-21T16:29:24.055Z><meta property=article:section content=Guide><meta property=article:tag content=Essentials><link rel=apple-touch-icon-precomposed sizes=57x57 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-57x57.png><link rel=apple-touch-icon-precomposed sizes=114x114 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-114x114.png><link rel=apple-touch-icon-precomposed sizes=72x72 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-72x72.png><link rel=apple-touch-icon-precomposed sizes=144x144 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-144x144.png><link rel=apple-touch-icon-precomposed sizes=60x60 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-60x60.png><link rel=apple-touch-icon-precomposed sizes=120x120 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-120x120.png><link rel=apple-touch-icon-precomposed sizes=76x76 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-76x76.png><link rel=apple-touch-icon-precomposed sizes=152x152 href=/documentation/v/edge/assets/images/favicon/apple-touch-icon-152x152.png><link rel=icon type=image/png href=/documentation/v/edge/assets/images/favicon/favicon-196x196.png sizes=196x196><link rel=icon type=image/png href=/documentation/v/edge/assets/images/favicon/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=/documentation/v/edge/assets/images/favicon/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/documentation/v/edge/assets/images/favicon/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/documentation/v/edge/assets/images/favicon/favicon-128.png sizes=128x128><link rel=stylesheet href=/documentation/v/edge/assets/font-awesome/scss/font-awesome.css><link href="//fonts.googleapis.com/css?family=Ubuntu:400,500,700" rel=stylesheet><title>Security - Essentials - Guide - Kuzzle documentation</title><link rel=stylesheet href=//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/atom-one-light.min.css><link href=/documentation/v/edge/assets/stylesheets/full/screen.css rel=stylesheet type=text/css media=screen></head><body class=index><header><div class=wrapper><div id=logo><a href=http://kuzzle.io/ >&#xA0;</a></div><a class=mobile-nav-burger href=javascript:;></a><nav><ul><li><a href=http://kuzzle.io/kuzzle-entreprise class=nav-item>product</a></li><li><a href=https://stafyniaksacha.github.io/documentation/v/edge/ class="nav-item developers active">Documentation</a><ul class=mobile-nav><li class=active><a href=/documentation/v/edge/guide><span>Guide</span></a><ul class=sub-nav><li><a href=/documentation/v/edge/guide/getting-started><span>Getting started</span></a></li><li class=active><a href=/documentation/v/edge/guide/essentials><span>Essentials</span></a></li><li><a href=/documentation/v/edge/guide/tutorial><span>Tutorial</span></a></li><li><a href=/documentation/v/edge/guide/kuzzle-depth><span>Kuzzle in depth</span></a></li></ul></li><li><a href=/documentation/v/edge/sdk-reference><span>SDK Reference</span></a></li><li><a href=/documentation/v/edge/kuzzle-dsl><span>Kuzzle DSL</span></a></li><li><a href=/documentation/v/edge/validation-reference><span>Data Validation</span></a></li><li><a href=/documentation/v/edge/api-documentation><span>API Documentation</span></a></li><li><a href=/documentation/v/edge/plugins-reference><span>Plugins Reference</span></a></li><li><a href=/documentation/v/edge/elasticsearch-cookbook><span>Elasticsearch Cookbook</span></a></li></ul></li><li><a href=http://kuzzle.io/demos-tutorials/ class=nav-item>Demos</a></li><li><a href=http://kuzzle.io/blog/ class=nav-item>Blog</a></li><li><a href=http://kuzzle.io/contact/ class=nav-item>Contact</a></li><li><a href=https://github.com/kuzzleio/kuzzle target=_blank class="nav-item github"><i class="icon icon-github icon-small"></i></a></li></ul></nav></div><div class="developer-nav open"><ul class=search><li><input name=search type=search placeholder=search tabindex=1></li></ul><ul class=nav><li class=active><a href=/documentation/v/edge/guide><span>Guide</span></a></li><li><a href=/documentation/v/edge/sdk-reference><span>SDK Reference</span></a></li><li><a href=/documentation/v/edge/kuzzle-dsl><span>Kuzzle DSL</span></a></li><li><a href=/documentation/v/edge/validation-reference><span>Data Validation</span></a></li><li><a href=/documentation/v/edge/api-documentation><span>API Documentation</span></a></li><li><a href=/documentation/v/edge/plugins-reference><span>Plugins Reference</span></a></li><li><a href=/documentation/v/edge/elasticsearch-cookbook><span>Elasticsearch Cookbook</span></a></li></ul><div class=search-results><ul></ul></div><script type=text/plain id=search-results-template><li>
        <a href="__link__" tabindex="__tabindex__">
          <p class="page">
            <span class="title">__title__</span>
            <span class="firstMember">__firstMember__</span>
            <span class="parent">__parent__</span>
          </p>
          <p class="preview">__preview__</p>
        </a>
      </li></script></div></header><div class=container><div class=tocify-wrapper><ul class=search-results></ul><div class=tocify><ul class=tocify-header><li class="tocify-item tocify-focus tocify-hover"></li></ul><ul class=tocify-header><li class=tocify-item><a style="color: #111; text-decoration: none" href=https://stafyniaksacha.github.io/documentation/v/edge/guide title="back to Guide home">Guide</a></li><ul class=tocify-subheader><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/getting-started title="learn kuzzle in a few steps">Getting started</a></li><li class="tocify-item tocify-focus"><a style="color: #FFF; text-decoration: none" href=# title="learn mechanisms of kuzzle">Essentials</a></li><ul class=tocify-header><ul class=tocify-subheader><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials title="learn mechanisms of kuzzle">&#x203A; Introduction</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/installing-kuzzle title="Installing Kuzzle">&#x203A; Installing Kuzzle</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/installing-backoffice title="Installing Kuzzle Backoffice">&#x203A; Installing Kuzzle Backoffice</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/configuration title="Configuring Kuzzle">&#x203A; Configuring Kuzzle</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/proxy-configuration title="Configuring Kuzzle proxy">&#x203A; Configuring Kuzzle proxy</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/persisted title="Working with persistent data">&#x203A; Working with persistent data</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/data-validation title="Data Validation">&#x203A; Data Validation</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/real-time title="Real-time notifications">&#x203A; Real-time notifications</a></li><li class="tocify-item tocify-level-2 tocify-focus"><a style="color: #FFF; text-decoration: none" href=/documentation/v/edge/guide/essentials/security title=Security>&#x203A; Security</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/request-and-response-format title="Request and Response format">&#x203A; Request and Response format</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/cli title="Command Line Interface">&#x203A; Command Line Interface</a></li><li class="tocify-item tocify-level-2"><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/essentials/plugins title="The Plugin System">&#x203A; The Plugin System</a></li></ul></ul><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/tutorial title="learn kuzzle in a real case">Tutorial</a></li><li class=tocify-item><a style="color: #002835; text-decoration: none" href=/documentation/v/edge/guide/kuzzle-depth title="understand how to extend kuzzle">Kuzzle in depth</a></li></ul></ul><ul class=toc-footer><li><a href=/documentation/ >1.0.0-RC9 (latest)</a></li><li><span style=color:#717171>1.0.0-RC10 (next)</span></li></ul></div></div><div class=page-wrapper><div class=toc><ul><li class="toc-item toc-level-1"><a href=#security title=Security>Security</a></li><li class="toc-item toc-level-2"><a href=#fresh-installation-default-rights title="Fresh installation default rights.">Fresh installation default rights.</a></li><li class="toc-item toc-level-2"><a href=#authentication title=Authentication>Authentication</a></li><li class="toc-item toc-level-2"><a href=#permissions title=Permissions>Permissions</a></li><li class="toc-item toc-level-3"><a href=#users-profiles-and-roles title="Users, profiles and roles">Users, profiles and roles</a></li><li class="toc-item toc-level-2"><a href=#role-definition title="Role definition">Role definition</a></li><li class="toc-item toc-level-2"><a href=#profile-definition title="Profile definition">Profile definition</a></li><li class="toc-item toc-level-2"><a href=#composition-rules title="Composition rules">Composition rules</a></li><li class="toc-item toc-level-3"><a href=#actions-permissions-functions title="Actions permissions functions">Actions permissions functions</a></li></ul></div><div class=content><div class=mobile-breadcrumb><p><a href=https://stafyniaksacha.github.io/documentation/v/edge/ >Kuzzle documentation</a> &#xBB; <a href=https://stafyniaksacha.github.io/documentation/v/edge/guide>Guide</a> &#xBB; <a href=https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials>Essentials</a> &#xBB; Security</p></div><div class=nav-sibling><div class=nav-left><p><a href=https://github.com/stafyniaksacha/documentation/edit/rc.x/src/guide/essentials/security.md>edit on github<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span> <a href="https://github.com/stafyniaksacha/documentation/issues/new?labels=guide&amp;title=Feedback%20about%20page%20&apos;guide/essentials/security.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span><select class=rate-documentation><option value=""></option><option value=1>Unusable documentation</option><option value=2>Poor documentation</option><option value=3>OK documentation</option><option value=4>Good documentation</option><option value=5>Excellent documentation</option></select></p></div><div class=nav-right><p><a href=https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/real-time>&#xAB; Real-time notifications</a> <span class=separator>|</span> <a href=https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/request-and-response-format>Request and Response format &#xBB;</a></p></div><div style=clear:both></div></div><div class=toc-inline><ul><li class="toc-item toc-level-1"><a href=#security title=Security>Security</a></li><li class="toc-item toc-level-2"><a href=#fresh-installation-default-rights title="Fresh installation default rights.">Fresh installation default rights.</a></li><li class="toc-item toc-level-2"><a href=#authentication title=Authentication>Authentication</a></li><li class="toc-item toc-level-2"><a href=#permissions title=Permissions>Permissions</a></li><li class="toc-item toc-level-3"><a href=#users-profiles-and-roles title="Users, profiles and roles">Users, profiles and roles</a></li><li class="toc-item toc-level-2"><a href=#role-definition title="Role definition">Role definition</a></li><li class="toc-item toc-level-2"><a href=#profile-definition title="Profile definition">Profile definition</a></li><li class="toc-item toc-level-2"><a href=#composition-rules title="Composition rules">Composition rules</a></li><li class="toc-item toc-level-3"><a href=#actions-permissions-functions title="Actions permissions functions">Actions permissions functions</a></li></ul></div><div class=main-content><h1><a class=anchor id=security></a>Security</h1><p>Kuzzle provides a full set of functionalities to finely define the permissions for your data.</p><hr><h2><a class=anchor id=fresh-installation-default-rights></a>Fresh installation default rights.</h2><p>When installing Kuzzle for the very first time, no default user is created and the Anonymous user is allowed to perform any action on the data. The only restriction is on the internal data storage used by Kuzzle to store its configuration.</p><p>Once a first admin user is created, either via the <a href=/documentation/v/edge/guide/essentials/running-backoffice/#create-an-admin-account>Kuzzle Back Office</a> or the <a href=/documentation/v/edge/guide/essentials/cli/#createfirstadmin>CLI</a>, the Anonymous permissions are dropped.</p><p>You can then use the Back Office to administrate your user rights.</p><hr><h2><a class=anchor id=authentication></a>Authentication</h2><p>The first step to secure your data is to be able to identify your users. Kuzzle ships by default with a local login/password strategy.</p><p>If the &quot;local&quot; strategy (i.e. storing the users&apos; credentials in the local database) doesn&apos;t fit your needs, you can use the <a href=https://github.com/kuzzleio/kuzzle-plugin-auth-passport-oauth>Oauth authentication plugin</a>, or develop your own (see <a href=/documentation/v/edge/plugins-reference/plugins-features/adding-authentication-strategy>Plugin documentation</a> for more details).</p><p>If the authentication request identifies an existing user, Kuzzle generates a <a href=https://tools.ietf.org/html/rfc7519>JSON Web Token</a> that must be <a href=/documentation/v/edge/api-documentation/query-syntax/authorization-token/#authorization-token>appended to all the subsequent requests</a>.</p><aside class=notice>More information on the login process <a href=/documentation/v/edge/api-documentation/controller-auth/login>here</a>.</aside><hr><h2><a class=anchor id=permissions></a>Permissions</h2><p>Once you know who is connected, you need a way to grant your users with some privileges to control their access to data.</p><h3><a class=anchor id=users-profiles-and-roles></a>Users, profiles and roles</h3><p>Kuzzle associates <code>users</code> to one or more <code>profiles</code>.<br>You can think to a <code>profile</code> as a user group. All the <code>users</code> that share the same <code>profile</code> will get the same privileges.</p><p>Because some sets of permissions can be shared between several <code>profiles</code>, Kuzzle includes an additional level of abstraction below the <code>profile</code>: the <code>roles</code>.</p><p>A <code>profile</code> is associated to a set of <code>roles</code>. Each <code>role</code> defines a set of permissions.</p><p><a class=image href=/documentation/v/edge/assets/images/permissions/profiles-roles.png><img src=/documentation/v/edge/assets/images/permissions/profiles-roles.png alt="Users, profiles and roles"></a></p><p>In the simple example above, the <em>editor</em> profile is a superset of the <em>contributor</em> one, which, in turn, extends the <em>default</em> profile.</p><p><code>roles</code> and <code>profiles</code> can be edited in <a href=/documentation/v/edge/guide/essentials/installing-backoffice>Kuzzle Back Office</a>.</p><hr><h2><a class=anchor id=role-definition></a>Role definition</h2><p>A <code>role</code> definition is a hierarchical JSON object in which permissions can be defined at <code>controller</code> and <code>action</code> level.</p><p>The <code>role</code> definition is represented as a Javascript object. Each key at the root of the object identifies a <code>controller</code> by its name.</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> myRoleDefinition = {
  <span class=hljs-attr>controllers</span>: {
    &lt; controller|* &gt;: {
      <span class=hljs-attr>actions</span>: {
        &lt; action|* &gt;: <span class=xml><span class=hljs-tag>&lt; <span class=hljs-attr>action</span> <span class=hljs-attr>permission</span>|* &gt;</span>,
        <span class=hljs-tag>&lt; <span class=hljs-attr>action</span>|* &gt;</span>: <span class=hljs-tag>&lt; <span class=hljs-attr>action</span> <span class=hljs-attr>permission</span>|* &gt;</span>,
        ...
      }
    }
  }
};</span></code></pre><p>Each entry of the <code>controllers</code>, <code>actions</code> tree can be set to either an explicit value or the &quot;*&quot; wildcard.</p><p>When <code>controller</code> is declared within a Plugin, its name must be prefixed with the name of the Plugin, like <code>&lt; plugin-name/controller-name &gt;</code>.</p><p>The <code>action permission</code> value can be set either to:</p><ul><li>a boolean. When set to <code>true</code>, the user is allowed to perform the action.</li><li>an object describing a dynamic right definition (more about it in the <a href=/documentation/v/edge/guide/kuzzle-depth/roles-definitions>advanced roles definition documentation</a>).</li></ul><p>You can find a <strong>comprehensive summary of all the available controllers</strong> and actions by sending a <code>GET</code> request to the root endpoint of the Kuzzle API via the HTTP protocol:</p><pre><code class="hljs bash"><span class=hljs-meta>#!/bin/bash
</span>
curl -XGET http://localhost:7512/\?pretty\=<span class=hljs-literal>true</span></code></pre><p>Take a look at the example below:</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> anonymousRole = {
  <span class=hljs-attr>controllers</span>: {
    <span class=hljs-attr>auth</span>: {
      <span class=hljs-attr>actions</span>: {
        <span class=hljs-attr>login</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>checkToken</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>getCurrentUser</span>: <span class=hljs-literal>true</span>
      }
    }
  }
};</code></pre><p>The example above is the permission definition set by Kuzzle for the Anonymous user after the first admin user has been created.</p><p>In this example, the role grants the user with the permission to perform the <code>login</code>, <code>checkToken</code> and <code>getCurrentUser</code> actions of the <code>auth</code> controller.</p><hr><h2><a class=anchor id=profile-definition></a>Profile definition</h2><p>A <code>profile</code> definition is a Javascript object that contains an array of policies, composed by a roleId and restrictions:</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> myProfileDefinition = {
  <span class=hljs-attr>policies</span>: [
    {
      <span class=hljs-attr>roleId</span>: <span class=hljs-string>&quot;&lt; role Id &gt;&quot;</span>,
      <span class=hljs-attr>restrictedTo</span>: [
        {
          <span class=hljs-attr>index</span>: <span class=hljs-string>&quot;&lt; some index &gt;&quot;</span>,
          <span class=hljs-attr>collections</span>: [
            <span class=hljs-string>&quot;&lt; a collection &gt;&quot;</span>,
            <span class=hljs-string>&quot;&lt; another collection &gt;&quot;</span>
          ]
        },
        ...
      ]  
    },
    &lt;another role&gt;,
    ...
  ]
};</code></pre><p>A role can be applied globally on the profile, or it can be restricted to a list of indexes or index/collections pairs.</p><p>For example, if we have a &quot;publisher&quot; role which allows to request any action of the <code>document</code> controller:</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> publisherRole = {
  <span class=hljs-attr>controllers</span>: {
    <span class=hljs-attr>document</span>: {
      <span class=hljs-attr>actions</span>: {
        <span class=hljs-string>&apos;*&apos;</span>: <span class=hljs-literal>true</span>
      }
    }
  }
};</code></pre><p>Then we declare 3 profiles using this role:</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> profile1 = {
  <span class=hljs-attr>roles</span>: [ {<span class=hljs-attr>_id</span>: <span class=hljs-string>&apos;publisherRole&apos;</span> } ]
};

<span class=hljs-keyword>var</span> profile2 = {
  <span class=hljs-attr>roles</span>: [
    {
      <span class=hljs-attr>_id</span>: <span class=hljs-string>&apos;publisherRole&apos;</span>,
      <span class=hljs-attr>restrictedTo</span>: [{<span class=hljs-attr>index</span>: <span class=hljs-string>&apos;index1&apos;</span>}]
    }
  ]
};

<span class=hljs-keyword>var</span> profile3 = {
  <span class=hljs-attr>roles</span>: [
    {
      <span class=hljs-attr>_id</span>: <span class=hljs-string>&apos;publisherRole&apos;</span>,
      <span class=hljs-attr>restrictedTo</span>: [
        {<span class=hljs-attr>index</span>: <span class=hljs-string>&apos;index1&apos;</span>, <span class=hljs-attr>collections</span>: [<span class=hljs-string>&apos;foo&apos;</span>, <span class=hljs-string>&apos;bar&apos;</span>]},
        {<span class=hljs-attr>index</span>: <span class=hljs-string>&apos;index2&apos;</span>}
      ]
    }
  ]
};</code></pre><p>With this sample profiles:</p><ul><li>users with <code>profile1</code> are allowed to use all <code>document</code> controller actions on all indexes and collections.</li><li>users with <code>profile2</code> are only allowed to use <code>document</code> controller actions on collections stored in index <code>index1</code>.</li><li>users with <code>profile3</code> are only allowed to use <code>document</code> controller actions on:<ul><li>all collections stored in index <code>index2</code></li><li>collections <code>foo</code> and <code>bar</code> stored in index <code>index1</code>.</li></ul></li></ul><hr><h2><a class=anchor id=composition-rules></a>Composition rules</h2><p>In Kuzzle, permissions follow the <a href=https://en.wikipedia.org/wiki/Whitelist>Whitelist</a> strategy, which means that <strong>an action must be explicitly allowed</strong> by at least one role of the user profile (including restrictions).</p><p>That means:</p><ul><li>If a role allows it, the action is authorized, <em>even if another role denies it</em>.</li><li>If no role explicitly allows it, the action if denied, even if no role explicitly denies it as well.</li></ul><h3><a class=anchor id=actions-permissions-functions></a>Actions permissions functions</h3><p>So far, we&apos;ve seen how to set permissions based on the user profile only.</p><p>Now, let&apos;s say we have a chat application and want the users to be allowed to edit &amp; delete their own messages only.</p><p><strong>This type of rules depends on the context and cannot be expressed as a simple boolean</strong>.</p><p>Kuzzle lets you define more complex permissions using custom functions, allowing dynamic decision about whether the user is allowed to proceed or not, depending on the context.</p><p>In our chat example, the rule can be expressed as:</p><pre><code class="hljs js"><span class=hljs-keyword>var</span> role = {
  <span class=hljs-attr>controllers</span>: {
    <span class=hljs-attr>write</span>: {
      <span class=hljs-attr>actions</span>: {
        <span class=hljs-attr>create</span>: <span class=hljs-literal>true</span>,
        <span class=hljs-attr>delete</span>: {
          <span class=hljs-attr>args</span>: {
            <span class=hljs-attr>document</span>: {
              <span class=hljs-attr>index</span>: <span class=hljs-string>&quot;$request.input.resource.index&quot;</span>,
              <span class=hljs-attr>collection</span>: <span class=hljs-string>&quot;$request.input.resource.collection&quot;</span>,
              <span class=hljs-attr>action</span>: {
                <span class=hljs-attr>get</span>: <span class=hljs-string>&quot;$currentId&quot;</span>
              }
            }
          },
          <span class=hljs-attr>test</span>: <span class=hljs-string>&quot;return args.document.content.user.id === $currentUserId&quot;</span>
        }
      }
    }
  }
};</code></pre><p>See more details at <a href=/documentation/v/edge/guide/kuzzle-depth/roles-definitions>Core documentation section</a></p><div style="clear: both"></div></div><hr><div id=disqus_thread></div><script async>var disqus_developer = 1;
      
        var disqus_config = function () {
          this.page.url = 'https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/security';
          this.page.title = 'Security';
          this.page.identifier = 'guide/essentials/security';
        };
      
        (function() {
          var d = document, s = d.createElement('script');
          s.src = 'https://kuzzle-documentation.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();</script><div class="nav-sibling bottom"><div class=nav-left><p><a href=https://github.com/stafyniaksacha/documentation/edit/rc.x/src/guide/essentials/security.md>edit on github<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span> <a href="https://github.com/stafyniaksacha/documentation/issues/new?labels=guide&amp;title=Feedback%20about%20page%20&apos;guide/essentials/security.md&apos;">send feedback about this content<i class="icon icon-github icon-small"></i></a> <span class=separator>|</span><select class=rate-documentation><option value=""></option><option value=1>Unusable documentation</option><option value=2>Poor documentation</option><option value=3>OK documentation</option><option value=4>Good documentation</option><option value=5>Excellent documentation</option></select></p></div><div class=nav-right><p><a href=https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/real-time>&#xAB; Real-time notifications</a> <span class=separator>|</span> <a href=https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/request-and-response-format>Request and Response format &#xBB;</a></p></div><div style=clear:both></div></div></div></div></div><script src=//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js></script><script src=//cdn.jsdelivr.net/algoliasearch/3/algoliasearch.min.js></script><script src=//cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.6.0/clipboard.min.js></script><script src=/documentation/v/edge/assets/javascript/lib/jquery.barrating.js></script><script type=text/javascript>// store helper
  var store = function store(key, value) {
    var lsSupport = false;

    // Check for native support
    if (localStorage) {
      lsSupport = true;
    }

    // If value is detected, set new or modify store
    if (typeof value !== "undefined" && value !== null) {
      // Convert object values to JSON
      if ( typeof value === 'object' ) {
        value = JSON.stringify(value);
      }
      // Set the store
      if (lsSupport) { // Native support
        localStorage.setItem(key, value);
      } else { // Use Cookie
        createCookie(key, value, 30);
      }
    }

    // No value supplied, return value
    if (typeof value === "undefined") {
      // Get value
      if (lsSupport) { // Native support
        data = localStorage.getItem(key);
      } else { // Use cookie
        data = readCookie(key);
      }

      // Try to parse JSON...
      try {
        data = JSON.parse(data);
      }
      catch(e) {
        data = data;
      }

      return data;
    }

    // Null specified, remove store
    if (value === null) {
      if (lsSupport) { // Native support
        localStorage.removeItem(key);
      } else { // Use cookie
        createCookie(key, '', -1);
      }
    }

    /**
     * Creates new cookie or removes cookie with negative expiration
     * @param  key       The key or identifier for the store
     * @param  value     Contents of the store
     * @param  exp       Expiration - creation defaults to 30 days
     */
    function createCookie(key, value, exp) {
      var date = new Date();
      date.setTime(date.getTime() + (exp * 24 * 60 * 60 * 1000));
      var expires = "; expires=" + date.toGMTString();
      document.cookie = key + "=" + value + expires + "; path=/";
    }

    /**
     * Returns contents of cookie
     * @param  key       The key or identifier for the store
     */
    function readCookie(key) {
      var nameEQ = key + "=";
      var ca = document.cookie.split(';');
      for (var i = 0, max = ca.length; i < max; i++) {
        var c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }
  };






  // google analytics
  (function(i, s, o, g, r, a, m) {
      i['GoogleAnalyticsObject'] = r;
      i[r] = i[r] || function() {
              (i[r].q = i[r].q || []).push(arguments)
          }, i[r].l = 1 * new Date();
      a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
      a.async = 1;
      a.src = g;
      m.parentNode.insertBefore(a, m)
  })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

  ga('create', 'UA-67035328-1', 'auto');
  ga('send', 'pageview');

  (function scrollToHash() {
    if (window.location.hash != '') {
      var anchor = $(location.hash).get(0);
      if (anchor) {
        anchor.scrollIntoView();
      }
    }
  })();




  (function mobileNavBuger() {
    var $body = $('body');

    $('.mobile-nav-burger').on('click', function() {
      $body.toggleClass('nav-burger-open');
    });
  })();







  (function rateDocumentation() {
    var $rateDocumentation = $('.rate-documentation');
    var pagePath = 'guide/essentials/security'.replace(/\//g, '-');
    var categoryRating = parseInt(store('rate-documentation-' + pagePath));

    $rateDocumentation.barrating({
      theme: 'fontawesome-stars',
      initialRatting: 0,
      allowEmpty: true,
      onSelect: function(value, text, event) {
        if (typeof(event) !== 'undefined') {
          // rating was selected by a user
          store('rate-documentation-' + pagePath, event.target.dataset.ratingValue);
          $rateDocumentation.barrating('set', event.target.dataset.ratingValue);
          // $rateDocumentation.barrating('readonly', true); // wired on mobile

          ga('send', 'event', {
            eventCategory: 'documentation-rate',
            eventAction: 'https://stafyniaksacha.github.io/documentation/v/edge/guide/essentials/security',
            eventLabel: event.target.dataset.ratingText,
            transport: 'beacon'
          });

          window.setTimeout(function() {
            $('.br-current-rating').css('transition', 'opacity 0.15s');
            $('.br-current-rating').css('opacity', '0');

            window.setTimeout(function() {
              $('.br-current-rating').css('transition', 'opacity 0.9s');
              $('.br-current-rating').text("thank's for feedback !");
              $('.br-current-rating').css('opacity', '1');
            }, 140);
          }, 1);

          window.setTimeout(function() {
            $('.br-current-rating').css('opacity', '0');

            window.setTimeout(function() {
              $('.br-current-rating').css('transition', 'opacity 0.2s');
              if (event.target.dataset.ratingText === 'Excellent documentation') {
                $('.br-current-rating').text(event.target.dataset.ratingText + ' \\o/');
              }
              else {
                $('.br-current-rating').text(event.target.dataset.ratingText);
              }
              $('.br-current-rating').css('opacity', '1');
            }, 1000);
          }, 2500);
        }
        else {
          // rating was selected programmatically
          // by calling `set` method
        }
      }
    });

    $('.br-current-rating').addClass('visible');

    if (!isNaN(categoryRating)) {
      $rateDocumentation.barrating('set', categoryRating);
      $rateDocumentation.barrating('readonly', true);
    }
  })();











  (function leftNavUX() {
    var $wrapper = $('.tocify-wrapper');

    if ($wrapper.length !== 0) {
      var $selectedItem = $('.tocify-level-2.tocify-focus', $wrapper);

      if ($selectedItem.length === 0) {
        $selectedItem = $('.tocify-focus', $wrapper);
      }

      if ($selectedItem.get(0).offsetTop + 120 > $wrapper.height()) {
        $wrapper.scrollTop(Math.ceil($selectedItem.get(0).offsetTop - $wrapper.height() / 2));
      }
    }
  })();









  (function tocUX() {
    var $toc = $('.toc');
    var $content = $('.content');

    //----------------------------
    // fixes toc next to content
    if ($toc.length > 0) {
      var debounceComputeSize = false;
      var computeSize = function() {
        // 280 is the width of left nav / 15 is the margin with content
        $toc.css('left', $content.get('0').offsetLeft + $content.get('0').offsetWidth + 280 + 15 +'px');
        // 30 is the margin with bottom window
        $toc.css('max-height', window.innerHeight - $toc.get('0').offsetTop - 30  + 'px');
      }

      $(window).on('resize', function() {
        clearTimeout(debounceComputeSize);
        debounceComputeSize = setTimeout(computeSize, 13);
      })
      computeSize();
    }
    //----------------------------

    //---------------------------------------------------------------------
    // toogle 'active' class on toc link when headings pass window offset
    if ($toc.length > 0) {
      var headings = {};
      var debounceActiveItem = false;
      var computeActiveItem = function() {
        var lastPassedItem;

        for (let key in headings) {
          headings[key].$link.removeClass('active');

          if (headings[key].offset <= window.pageYOffset + 70) {
            lastPassedItem = headings[key];
          }
        }

        if (lastPassedItem) {
          lastPassedItem.$link.addClass('active');
        }
      }

      $('a[href]', $toc).each(function(index, element) {
        var id = element.href.slice(element.href.indexOf('#'));
        var $ref = $(id).parent();

        if ($ref.length > 0) {
          headings[id] = {
            $ref: $ref,
            $link: $(element),
            offset: $ref.get('0').offsetTop
          }
        }
      });

      $(window).on('scroll', function() {
        clearTimeout(debounceActiveItem);
        debounceActiveItem = setTimeout(computeActiveItem, 10);
      })
      computeActiveItem();
    }
    //---------------------------------------------------------------------
  })();

















  //---------------------------------------------------------------------
  // copy code to clipboard button
  (function codeClipboard() {
    $hljs = $('.hljs');

    if ($hljs.length > 0) {
      var debounceClipboard = false;
      var clipboardSnippets;

      function fallbackMessage(action) {
          var actionMsg = '';
          var actionKey = (action === 'cut' ? 'X' : 'C');
          if (/iPhone|iPad/i.test(navigator.userAgent)) {
              actionMsg = 'No support :(';
          } else if (/Mac/i.test(navigator.userAgent)) {
              actionMsg = 'Press ⌘-' + actionKey + ' to ' + action;
          } else {
              actionMsg = 'Press Ctrl-' + actionKey + ' to ' + action;
          }
          return actionMsg;
      }

      $hljs.each(function(index, element) {
        $(element).before('<button class="clipboard" title="copy code to clipboard" data-clipboard-snippet><i class="fa fa-clipboard" aria-hidden="true"></i></button>');
      })

      clipboardSnippets = new Clipboard('[data-clipboard-snippet]', {
          target: function(trigger) {
              return trigger.nextElementSibling;
          }
      });

      clipboardSnippets.on('success', function(e) {
          e.clearSelection();
          $(e.trigger).text('Copied!')

          clearTimeout(debounceClipboard);
          debounceClipboard = setTimeout(function() {
            $(e.trigger).html('<i class="fa fa-clipboard" aria-hidden="true"></i>');
          }, 1200);
      });
      clipboardSnippets.on('error', function(e) {
        e.clearSelection();
        $(e.trigger).text(fallbackMessage(e.action));

        clearTimeout(debounceClipboard);
        debounceClipboard = setTimeout(function() {
          $(e.trigger).html('<i class="fa fa-clipboard" aria-hidden="true"></i>');
        }, 2400);
      });
    }
  })();
  //---------------------------------------------------------------------








  //---------------------------------------------------------------------
  // language tab selector
  (function languageTabSelector() {
    var $languageTabSelector = $('.language-tab-selector a');
    var pageCategory = 'guide'.replace(/\//g, '-');
    var selectedLanguage = store('selected-language' + pageCategory);

    if (selectedLanguage) {
      if ($('.language-tab[data-language="' + selectedLanguage + '"]').length > 0) {
        $('.language-tab-active').removeClass('language-tab-active');
        $('.language-tab-selector a[data-language-name="' + selectedLanguage + '"]').addClass('language-tab-active');
        $('.language-tab[data-language="' + selectedLanguage + '"]').addClass('language-tab-active');
      }
    }

    if ($languageTabSelector.length > 0) {
      $languageTabSelector.on('click touch', function(e) {
        e.preventDefault();
        e.stopPropagation();

        var language = $(this).data('languageName');

        $('.language-tab-active').removeClass('language-tab-active');
        $('.language-tab-selector a[data-language-name="' + language + '"]').addClass('language-tab-active');
        $('.language-tab[data-language="' + language + '"]').addClass('language-tab-active');

        store('selected-language' + pageCategory, language)
      });
    }
  })();
  //---------------------------------------------------------------------









  (function instantSearchUI() {
    var KEY_UP = 38;
    var KEY_DOWN = 40;
    var client = algoliasearch("4RFBRWISJR", "6febf1ebe906bd82bce58d5a20ac6c1b");
    var index = client.initIndex('kuzzle-documentation');
    var template = $('#search-results-template').html();
    var $searchInput = $('.search input[type=search]');
    var $searchResults = $('.search-results');
    var $searchResultsContainer = $('ul', $searchResults);
    var watchResultsDebounce = false;
    var selectedIndex = -1;
    var watchClose = false;
    var lastHits = 0;

    // focus search input on content loaded
    $searchInput.focus();


    $(window).on('keydown', function (event) {
      if (watchClose) {
        var $results = $('a', $searchResultsContainer);
        var $focusResult = $('a:hover, a:focus', $searchResultsContainer);

        if ($focusResult.length > 0) {
          $results.each(function(index, element) {
            console.log('key:', index, $results[index], $focusResult.get(0));

            if ($results[index] === $focusResult.get(0)) {
              selectedIndex = index;
            }
          })
        }

        console.log('post selectedIndex:', selectedIndex, $results.length, $focusResult.length);

        switch (event.keyCode) {
          case KEY_UP:
            event.stopPropagation();
            if (selectedIndex === 0) {
              selectedIndex = -1;
            }

            if (selectedIndex === -1) {
              $searchInput.focus();
              selectedIndex = $results.length - 1;
            }
            else {
              selectedIndex -= 1;
              $results.get(selectedIndex).focus();
            }
            //$('li:not(:last-child).selected').removeClass('selected').next().addClass('selected');

            return false;
          case KEY_DOWN:
            event.stopPropagation();
            if (selectedIndex >= $results.length -1) {
              $searchInput.focus();
              selectedIndex = -1;
            }
            else {
              selectedIndex += 1;
              $results.get(selectedIndex).focus();
            }
            //$('li:not(:first-child).selected').removeClass('selected').prev().addClass('selected');
            return false;
        }
      }
    });

    // search results open/close handlers
    $(window).on('click touch', function() {
      console.log('?')
      if (watchClose) {
        $searchResults.removeClass('display');
        watchClose = false;

        if (watchResultsDebounce) {
          window.clearTimeout(watchResultsDebounce);
        }
      }
    });

    $searchInput.on('click touch', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }
      event.stopPropagation();
    });

    $searchInput.on('focus', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }

      selectedIndex = -1;
    });

    $searchInput.on('blur', function(event) {
      if (lastHits > 0) {
        $searchResults.addClass('display');
        watchClose = true;
      }
    });
    // end - search results open/close handlers


    // main input listener
    $searchInput.on('input', function(event) {
      var $input = $(this);
      var searchResultsContent = '';
      // var length = (this.value.length + 1) * 6;

      selectedIndex = -1;

      // // resize input length to fit value
      // length = (length > 450) ? 450 : length;
      // this.style.width = (length > 220) ? length + 'px' : '220px';


      // clear search result on empty input
      if (this.value === '') {
        $searchResultsContainer.empty();
        $searchResults.removeClass('display');
        watchClose = false;

        return;
      }

      index.search(this.value, function(err, res) {
        if (err) {
          console.error(err);
          return;
        }

        lastHits = res.hits.length;
        if (watchResultsDebounce) {
          window.clearTimeout(watchResultsDebounce);
        }

        if (lastHits === 0) {
          $searchResultsContainer.empty();
          $searchResults.removeClass('display');
          return;
        }

        // send ga event when user has search results but does nothing
        watchResultsDebounce = window.setTimeout(function() {
          ga('send', 'event', {
            eventCategory: 'documentation-search',
            eventAction: (lastHits > 0) ? '<watch_results>' : '<no_results>',
            eventLabel: $searchInput.val(),
            transport: 'beacon'
          });
        }, 4000);

        $searchResults.addClass('display');
        watchClose = true;

        // make search result item from
        for (var key in res.hits) {
          var content = template;

          // here we secure manualy all xml tags wich may can be retrieved by results, but we keep <em> tags for highlighting
          var elements = res.hits[key]._snippetResult.content.value.split('<em>');
          var preview = '';

          for (var k in elements) {
            elements[k] = elements[k].replace(/</g, '&lt;');
            elements[k] = elements[k].replace(/>/g, '&gt;');
          }

          // restore <em></em> tags
          preview = elements.join('<em>');
          preview = preview.replace(/&lt;\/em&gt;/g, '</em>');

          // replace variables in template
          content = content.replace(/__tabindex__/g, key + 2);
          content = content.replace(/__link__/g, 'https://stafyniaksacha.github.io/documentation/v/edge/' + res.hits[key].path);
          content = content.replace(/__parent__/g, res.hits[key].parent || '');
          content = content.replace(/__firstMember__/g, res.hits[key].firstMember || '');
          content = content.replace(/__title__/g, res.hits[key]._highlightResult.title.value);
          content = content.replace(/__preview__/g, preview);

          searchResultsContent += content;
        }

        // add algolia copyright
        searchResultsContent += '<li style="text-align: right"><img src="https://www.algolia.com/assets/pricing_new/algolia-powered-by-ac7dba62d03d1e28b0838c5634eb42a9.svg" style="margin: 8px 8px 0 0;"></li>';

        // magic jQuery
        $searchResultsContainer.html(searchResultsContent);

        // send ga event on search result hit
        $('a', $searchResultsContainer).on('click touch', function(event) {
          ga('send', 'event', {
            eventCategory: 'documentation-search',
            eventAction: this.href,
            eventLabel: $searchInput.val(),
            transport: 'beacon'
          });
        });
      });
    });

  })();</script></body></html>